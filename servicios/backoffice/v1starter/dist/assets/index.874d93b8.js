import{r as n,I as Oe,v as A,as as He,z as Ue,o as u,x as k,a as e,w as l,g as q,h as H,c as g,a$ as Ie,N as V,b as s,t as T,a3 as x,bw as Je,a_ as Ae,u as h,p as y,a2 as ue,Z as de,F as D,C as G,$ as qe,a0 as De,q as v,a1 as Me,b8 as X,b7 as Fe,ba as Z,V as K,e as C,aT as Le,b3 as je,b4 as $e,b5 as Re,aM as ce,c7 as Q,b6 as Be,aW as We,n as Y,aq as M,b9 as Ge,aX as Xe}from"./index.88d3c7f5.js";import{l as ee}from"./lodash.ef907739.js";import Ze from"./StatusWidgetGye.30dda0b3.js";import{V as Ke}from"./VBadge.0df54a63.js";import{V as Qe}from"./VNavigationDrawer.44422f4c.js";import{V as S}from"./VTooltip.2d0a8708.js";import{V as me}from"./VTextarea.86fae113.js";const Ye={class:"text-h6 guarda white--text mb-2"},ea={key:2,class:"text-body-2 guarda white--text mb-4 text-opacity-70"},aa={class:"custom-heading d-flex align-center justify-space-between"},la=s("div",null,[s("h6",{class:"text-h6 py-4 pl-4"}," Usuarios activos en configuraci\xF3n "),s("span",{class:"text-body-1"})],-1),oa={style:{padding:"1rem"}},ta=s("span",{class:"ms-4"},"Online",-1),sa={key:0,class:"d-inline-block boton-fija"},ra={style:{padding:"1rem",border:"1px solid rgba(var(--v-theme-on-background), var(--v-disabled-opacity))","border-radius":"7px"}},ia={scope:"col",class:"d-flex gap-4 pb-4"},na=s("tr",null,[s("th",{scope:"col",style:{width:"300px"}},"T\xEDtulo"),s("th",{scope:"col",style:{width:"170px"}},"Hora de inicio"),s("th",{scope:"col",style:{width:"170px"}},"Hora de fin"),s("th",{scope:"col",class:"d-flex gap-4 pb-4"})],-1),ua={class:"py-4"},da={class:"py-4"},ca={class:"py-4"},ma={class:"py-4"},pa={class:"d-flex gap-4 py-4"},va=s("span",null,"Agregar Player Personalizado a este horario espec\xEDfico",-1),fa=s("span",null,"Modificar Player Personalizado",-1),ga={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},ba=s("span",null,"Este titular aparecer\xE1 en lugar del t\xEDtulo del programa sobre el reproductor",-1),ha={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},ya=s("span",null,"Este texto es el que aparece en el indicador que parpadea sobre el header",-1),_a={style:{display:"flex",margin:"1rem"}},Va={style:{"margin-left":"2rem"}},xa={class:"d-inline-block"},wa=s("div",null,[s("span",null,"Estado del player: ")],-1),za={style:{"margin-left":"2rem"}},ka={style:{width:"100%","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-2"},Ca={class:"d-inline-block"},Ja={__name:"index",setup(Ea){const N=n("");n(!1);const pe=n(!1),d=n({estado:!1,titulo:"",label:""}),ve=Oe(),F=n(!1),O=n("tab-detalles"),ae=n(""),f=n([]),U=n([]),le=n(!1),I=n(null),m=n(!1),b=n(""),w=n(0);n(!1);const fe=n(""),ge=n(!1),z=n({value:"",estadoHtml:!1}),L=[{title:"Lunes",value:1},{title:"Martes",value:2},{title:"Mi\xE9rcoles",value:3},{title:"Jueves",value:4},{title:"Viernes",value:5},{title:"S\xE1bado",value:6},{title:"Domingo",value:0}],be=async()=>{try{const a=await(await fetch("https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_guayaquil.js")).text(),c=a.indexOf("{"),r=a.lastIndexOf("}"),t=a.substring(c,r+1);return JSON.parse(t)}catch(o){return console.error("Error cargando configuraci\xF3n:",o),null}},he=({step:o,progress:a})=>{switch(w.value=a,o){case 1:b.value="Guardando actualizaci\xF3n...",N.value="";break;case 2:b.value="Verificando cambios...",N.value="Esto puede tardar varios segundos";break;case 3:b.value="Finalizando actualizaci\xF3n...",N.value="";break}},j=n({estado:!1,titulo:"",label:""}),$=n({value:"",estadoHtml:!1}),R=n([]),oe=A(()=>!ee.exports.isEqual(f.value,R.value)),te=A(()=>!ee.exports.isEqual(d.value,j.value)),se=A(()=>!ee.exports.isEqual(z.value,$.value)),ye=async o=>{try{o.forzado&&(j.value=JSON.parse(JSON.stringify(o.forzado))),Array.isArray(o.horarios)&&(f.value=JSON.parse(JSON.stringify(o.horarios)),U.value=JSON.parse(JSON.stringify(o.horarios)),R.value=JSON.parse(JSON.stringify(o.horarios))),o.html&&($.value=JSON.parse(JSON.stringify(o.html))),b.value="Actualizaci\xF3n completada con \xE9xito",N.value="",w.value=100,await new Promise(a=>setTimeout(a,2e3)),m.value=!1}catch(a){console.error("Error actualizando datos locales:",a),re(a)}},_e=()=>{m.value=!1,le.value=!1,B(),b.value="La actualizaci\xF3n est\xE1 tomando m\xE1s tiempo de lo esperado",console.warn("Timeout en la actualizaci\xF3n")},re=o=>{m.value=!1,le.value=!1,b.value="Error en la actualizaci\xF3n",console.error("Error en la actualizaci\xF3n:",o),B()};async function B(){var o,a,c;F.value=!0;try{const r=await be();if(!r)throw new Error("No se pudo cargar la configuraci\xF3n");console.log("Configuraci\xF3n cargada:",r),pe.value=((o=r.forzado)==null?void 0:o.estado)||!1,d.value=r.forzado||{estado:!1,titulo:"",label:""},j.value=JSON.parse(JSON.stringify(d.value)),f.value=Array.isArray(r.horarios)?[...r.horarios]:[],U.value=Array.isArray(r.horarios)?[...r.horarios]:[],R.value=JSON.parse(JSON.stringify(f.value)),fe.value=((a=r.html)==null?void 0:a.value)||"",ge.value=((c=r.html)==null?void 0:c.estadoHtml)||!1,z.value=r.html||{value:"",estadoHtml:!1},$.value=JSON.parse(JSON.stringify(z.value))}catch(r){console.error("Error al obtener configuraci\xF3n:",r)}F.value=!1}const Ve=o=>({data_string:{html:{value:o.html.value||"",estadoHtml:o.html.estadoHtml||!1},forzado:{estado:o.forzado.estado||!1,titulo:o.forzado.titulo||"",label:o.forzado.label||""},horarios:o.horarios||[]}});async function W(o){const a=Ve(o);try{if(!(await fetch("https://servicio-github-dynamic.vercel.app/live-web/guayaquil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Error en la respuesta del servidor");return!0}catch(c){return console.error("Error al enviar datos:",c),!1}}async function xe(){var o;m.value=!0,w.value=0,b.value="Iniciando actualizaci\xF3n...";try{const a={html:z.value,forzado:d.value,horarios:f.value};await W(a)?(o=I.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar:",a),m.value=!1}}async function we(){var o;m.value=!0,w.value=0,b.value="Iniciando actualizaci\xF3n de player forzado...";try{const a={html:z.value,forzado:d.value,horarios:U.value};await W(a)?(o=I.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar datos de player:",a),m.value=!1}}async function ze(){var o;m.value=!0,w.value=0,b.value="Actualizando c\xF3digo del reproductor...";try{const a={html:z.value,forzado:d.value,horarios:U.value};await W(a)?(o=I.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar nuevo c\xF3digo del reproductor:",a),m.value=!1}}const ie=A(()=>{if(f.value&&f.value.length>0){const o=f.value.map(a=>a.dia);return L.filter(a=>!o.includes(a.value))}return L});function ke(o){const a=L.find(c=>o===c.value);return a?a.title:""}const Ce=o=>{f.value.splice(o,1)},Ee=o=>{let a={tituloPrograma:"",estadoHorario:!0,inicio:"12:00",fin:"14:00"};f.value[o].horas.push(a)},Se=(o,a)=>{f.value[o].horas[a].iframe="Pon tu html aqui"},Ne=(o,a)=>{f.value[o].horas.splice(a,1)},Pe=()=>{let o=localStorage.getItem("role");o!=="administrador"&&o!=="webmaster"&&ve.push({path:"/pages/errors/not-authorized"})},J=n(!1),ne=localStorage.getItem("role"),P=n([]),Te=()=>{let a=JSON.parse(localStorage.getItem("userData")).email;const r=new Pusher("69f5e107f97ef8dcc25f",{cluster:"us2",forceTLS:!0,channelAuthorization:{paramsProvider:()=>({param1:a}),endpoint:"https://pusher-auth-mocha.vercel.app/pusher/auth"}}).subscribe("presence-configuracion");r.bind("pusher:subscription_succeeded",()=>r.members.each(t=>P.value.push({email:t.id}))),r.bind("pusher:member_added",t=>{P.value.push({email:t.id})}),r.bind("pusher:member_removed",t=>{const i=Array.from(P.value).findIndex(E=>E.email===t.id);i!==-1&&P.value.splice(i,1)})};return He(async()=>{console.log("Componente montado, iniciando carga...");try{await B(),console.log("Configuraci\xF3n cargada correctamente"),Te(),Pe()}catch(o){console.error("Error en la inicializaci\xF3n:",o)}}),(o,a)=>{const c=Ue("PerfectScrollbar"),r=Xe;return u(),k("section",null,[e(Ae,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=t=>m.value=t),class:"align-center justify-center",persistent:""},{default:l(()=>[e(q,{color:"primary",width:"300"},{default:l(()=>[e(H,{class:"text-center"},{default:l(()=>[w.value<100?(u(),g(Ie,{key:0,indeterminate:"",color:"white",class:"mb-4"})):(u(),g(V,{key:1,icon:"tabler-check",color:"white",size:"32",class:"mb-4"})),s("div",Ye,T(b.value),1),N.value?(u(),k("div",ea,T(N.value),1)):x("",!0),e(Je,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=t=>w.value=t),color:"white",height:"8",rounded:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ze,{ref_key:"statusMonitor",ref:I,"asset-url":"https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_guayaquil.js","poll-interval":2e3,"max-attempts":30,onProgress:he,onSuccess:ye,onTimeout:_e,onError:re},null,512),h(ne)=="administrador"?(u(),g(y,{key:0,icon:"",size:"small",class:"app-custom-toggler rounded-s-lg rounded-0",style:{"z-index":"1001"},onClick:a[2]||(a[2]=t=>J.value=!0)},{default:l(()=>[e(V,{icon:"tabler-users"})]),_:1})):x("",!0),h(ne)=="administrador"?(u(),g(Qe,{key:1,modelValue:J.value,"onUpdate:modelValue":a[4]||(a[4]=t=>J.value=t),temporary:"",location:"end",width:"400",scrim:!1,class:"app-customizer"},{default:l(()=>[s("div",aa,[la,e(y,{icon:"",variant:"text",color:"secondary",size:"x-small",onClick:a[3]||(a[3]=t=>J.value=!1)},{default:l(()=>[e(V,{icon:"tabler-x",size:"20"})]),_:1})]),e(ue),s("div",oa,[e(c,{tag:"ul",options:{wheelPropagation:!1}},{default:l(()=>[e(de,{lines:"two",border:""},{default:l(()=>[(u(!0),k(D,null,G(P.value,(t,_)=>(u(),k(D,{key:t.email},[e(qe,null,{default:l(()=>[e(De,null,{default:l(()=>[v(T(t.email),1)]),_:2},1024),e(Me,{class:"mt-1"},{default:l(()=>[e(Ke,{dot:"",location:"start center","offset-x":"2",color:"success",class:"me-3"},{default:l(()=>[ta]),_:1})]),_:1})]),_:2},1024),_!==P.value.length-1?(u(),g(ue,{key:0})):x("",!0)],64))),128))]),_:1})]),_:1})])]),_:1},8,["modelValue"])):x("",!0),e(Fe,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=t=>O.value=t),class:"v-tabs-pill"},{default:l(()=>[e(X,{value:"tab-config"},{default:l(()=>[v("Configuraci\xF3n de Horarios")]),_:1}),e(X,{value:"tab-forzado"},{default:l(()=>[v("Player Forzado")]),_:1}),e(X,{value:"tab-embed"},{default:l(()=>[v("C\xF3digo del reproductor")]),_:1})]),_:1},8,["modelValue"]),e(Ge,{modelValue:O.value,"onUpdate:modelValue":a[11]||(a[11]=t=>O.value=t)},{default:l(()=>[e(Z,{value:"tab-config"},{default:l(()=>[e(q,{class:"mt-5",title:"Configuraci\xF3n de los horarios"},{default:l(()=>[F.value?(u(),g(H,{key:0},{default:l(()=>[v(" Cargando configuraci\xF3n... ")]),_:1})):(u(),g(H,{key:1,class:"py-4 gap-0 w-100"},{default:l(()=>[e(K,null,{default:l(()=>[e(C,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[e(C,{cols:"4"},{default:l(()=>[e(Le,{modelValue:ae.value,"onUpdate:modelValue":a[6]||(a[6]=t=>ae.value=t),items:h(ie),disabled:h(ie).length===0,label:"D\xEDa de la semana"},null,8,["modelValue","items","disabled"])]),_:1}),e(C,{cols:"6",class:"d-flex gap-4"},{default:l(()=>[O.value==="tab-config"?(u(),k("div",sa,[e(y,{rounded:"pill",color:"success",onClick:xe,disabled:!h(oe)},{default:l(()=>[e(V,{size:"30",icon:"tabler-device-floppy"})]),_:1},8,["disabled"]),e(S,{activator:"parent",location:"top","open-on-hover":!h(oe)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])):x("",!0)]),_:1})]),_:1}),e(C,{cols:"12"},{default:l(()=>[e(de,{class:"card-list"},{default:l(()=>[e(je,{variant:"accordion",multiple:""},{default:l(()=>[(u(!0),k(D,null,G(f.value,(t,_)=>(u(),g($e,{key:_},{default:l(()=>[e(Re,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:l(()=>[s("h3",null,T(ke(t.dia)),1),e(ce,{color:t.estadoDia?"success":"warning",class:"mr-4"},{default:l(()=>[v(T(t.estadoDia?"Activo":"Inactivo"),1)]),_:2},1032,["color"]),e(Q,{modelValue:t.estadoDia,"onUpdate:modelValue":i=>t.estadoDia=i,color:"success",label:t.estadoDia?"D\xEDa activo":"D\xEDa inactivo"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),e(Be,{class:"d-flex flex-wrap justify-space-between"},{default:l(()=>[s("div",ra,[e(We,{class:"w-full"},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",ia,[e(y,{color:"primary",onClick:i=>Ee(_)},{default:l(()=>[v(" A\xF1adir hora ")]),_:2},1032,["onClick"]),e(y,{color:"error",onClick:i=>Ce(_)},{default:l(()=>[v(" Eliminar d\xEDa ")]),_:2},1032,["onClick"])])]),na]),s("tbody",null,[(u(!0),k(D,null,G(t.horas.sort((i,E)=>i.inicio.localeCompare(E.inicio)),(i,E)=>(u(),k("tr",{key:E},[s("td",ua,[e(Y,{modelValue:i.tituloPrograma,"onUpdate:modelValue":p=>i.tituloPrograma=p,label:"T\xEDtulo del horario",placeholder:"Escriba el t\xEDtulo...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",da,[e(r,{modelValue:i.inicio,"onUpdate:modelValue":p=>i.inicio=p,label:"Hora Inicio",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ca,[e(r,{modelValue:i.fin,"onUpdate:modelValue":p=>i.fin=p,label:"Hora Fin",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ma,[s("div",pa,[e(Q,{modelValue:i.estadoHorario,"onUpdate:modelValue":p=>i.estadoHorario=p,color:"success",label:i.estadoHorario?"Horario activo":"Horario inactivo"},null,8,["modelValue","onUpdate:modelValue","label"]),t.horas.length>1?(u(),g(y,{key:0,color:"error",onClick:p=>Ne(_,E)},{default:l(()=>[e(V,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):x("",!0),i.iframe?x("",!0):(u(),g(S,{key:1,location:"top"},{activator:l(({props:p})=>[e(y,{color:"primary",onClick:Sa=>Se(_,E)},{default:l(()=>[e(V,M(p,{icon:"tabler-adjustments-horizontal"}),null,16)]),_:2},1032,["onClick"])]),default:l(()=>[va]),_:2},1024)),i.iframe?(u(),g(S,{key:2,location:"top"},{activator:l(({props:p})=>[e(y,{color:"success"},{default:l(()=>[e(V,M(p,{icon:"tabler-adjustments"}),null,16)]),_:2},1024)]),default:l(()=>[fa]),_:1})):x("",!0),i.iframe?(u(),g(me,{key:3,label:"c\xF3digo de custom player",modelValue:i.iframe,"onUpdate:modelValue":p=>i.iframe=p,rows:"3"},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)])])]))),128))])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1}),e(Z,{value:"tab-forzado"},{default:l(()=>[e(q,{class:"mt-5",title:"Player Forzado",subtitle:"Para transmisiones emergentes, este m\xF3dulo permitir\xE1 activar el reproductor de forma forzada"},{default:l(()=>[e(H,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(K,null,{default:l(()=>[e(C,{cols:"8"},{default:l(()=>[s("div",ga,[e(Y,{modelValue:d.value.titulo,"onUpdate:modelValue":a[7]||(a[7]=t=>d.value.titulo=t),label:"T\xEDtulo sobre el player",placeholder:"Escriba el t\xEDtulo que mostrar\xE1 sobre el reproductor...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(S,{location:"top"},{activator:l(({props:t})=>[e(V,M(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[ba]),_:1})]),s("div",ha,[e(Y,{modelValue:d.value.label,"onUpdate:modelValue":a[8]||(a[8]=t=>d.value.label=t),label:"Texto del Indicador",placeholder:"Escriba el texto que deseas en el indicador parpadeante...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(S,{location:"top"},{activator:l(({props:t})=>[e(V,M(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[ya]),_:1})])]),_:1}),e(C,{cols:"4",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",_a,[s("div",null,[e(Q,{modelValue:d.value.estado,"onUpdate:modelValue":a[9]||(a[9]=t=>d.value.estado=t),color:"success",label:d.value.estado?"Activo":"Inactivo"},null,8,["modelValue","label"])]),s("div",Va,[s("div",xa,[e(y,{color:"primary",onClick:we,disabled:!h(te)},{default:l(()=>[v(" ENVIAR ")]),_:1},8,["disabled"]),e(S,{activator:"parent",location:"top","open-on-hover":!h(te)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])])])]),_:1}),e(C,{cols:"12",style:{display:"flex","align-items":"center"}},{default:l(()=>[wa,s("div",za,[e(ce,{color:d.value.estado==!0?"success":"warning",class:"mr-4"},{default:l(()=>[v(T(d.value.estado==!0?"Activo":"Inactivo"),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Z,{value:"tab-embed"},{default:l(()=>[e(q,{class:"mt-5",title:"Embed player",subtitle:"Proporciona el c\xF3digo HTML del reproductor que presentar\xE1 embebido en la seccion de audio"},{default:l(()=>[e(H,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(K,null,{default:l(()=>[e(C,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",ka,[e(me,{modelValue:z.value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>z.value.value=t),label:"C\xF3digo",placeholder:"Escriba el c\xF3digo html del reproductor...",class:"ms-0 me-1 chat-list-search","auto-grow":""},null,8,["modelValue"])]),s("div",Ca,[e(y,{color:"primary",onClick:ze,disabled:!h(se)},{default:l(()=>[v(" ENVIAR ")]),_:1},8,["disabled"]),e(S,{activator:"parent",location:"top","open-on-hover":!h(se)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Ja as default};
