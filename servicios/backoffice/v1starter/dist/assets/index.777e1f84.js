import{r as s,Q as b,bb as _,as as X,v as Z,o as x,x as w,a,w as o,e as i,b as m,p as S,q as d,g as ee,h as N,aR as j,b2 as te,m as ae,V as z,n as p,a3 as le,N as oe}from"./index.88d3c7f5.js";import{V as H}from"./VAutocomplete.bb0d71fb.js";import{V as se}from"./VTextarea.86fae113.js";const ne={class:"demo-space-x"},re={class:"d-flex flex-wrap py-4 gap-4 align-items-center",style:{"justify-content":"space-between"}},ie={class:"px-4"},ue=["onSubmit"],ce={key:0,class:"bloque_editar_template"},de={key:0},me=["innerHTML"],pe={key:1},fe=m("p",{class:"text-center"},"Debe de seleccionar una plantilla",-1),ve=[fe],he={__name:"index",setup(be){const T=s(""),C=s(""),L=s(""),k=s(""),f=s(""),I=s([]),U=s([]),M=s([]),$=s([]),D=s([]),n=s(""),g=s("https://www.ecuavisa.com/binrepository/1200x842/0c121/1200d600/none/11705/CCLO/2023082070755-cuenca-elecciones-antic_1138756_20230911181429.jpg"),V=s("Lorem ipsum dolor sit amet consectetur adipisicing elit. Non animi suscipit nam adipisci."),v=s("https://www.ecuavisa.com"),h=s("Lorem ipsum, dolor sit amet consectetur adipisicing elit. Consequatur qui adipisci ut, veniam ad nesciunt. Illum dolore voluptatibus eligendi repellat iure. Sint aliquam repellendus vitae quidem similique temporibus explicabo aspernatur.");b(f,async l=>{if(l)try{let t=function(r){const u=atob(r);return Uint8Array.from(u,A=>A.codePointAt(0))};const e=await _.get(`https://api.sendpulse.com/template/${l}`,{headers:{Authorization:`Bearer ${c}`}});n.value=new TextDecoder().decode(t(e.data.body)),q(),B(),F(),P(),R()}catch(e){console.error("Error al obtener el cuerpo del template",e)}}),b(g,()=>{q()}),b(V,()=>{B()}),b(v,()=>{F()}),b(h,()=>{P()});function q(){const e=new DOMParser().parseFromString(n.value,"text/html"),t=e.querySelector(".back_img");t&&(t.src=g.value,n.value=e.body.innerHTML)}function B(){const e=new DOMParser().parseFromString(n.value,"text/html"),t=e.querySelector(".back_titulo");t&&(t.textContent=V.value,n.value=e.body.innerHTML)}function P(){const e=new DOMParser().parseFromString(n.value,"text/html"),t=e.querySelector(".back_body");t&&(t.textContent=h.value,n.value=e.body.innerHTML)}function F(){const e=new DOMParser().parseFromString(n.value,"text/html"),t=e.querySelector(".back_titulo_url"),r=e.querySelector(".back_url_vermas");t&&(t.href=v.value,n.value=e.body.innerHTML),r&&(r.href=v.value,n.value=e.body.innerHTML)}function O(){const l=["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"],e=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],t=new Date,r=l[t.getDay()],u=t.getDate().toString().padStart(2,"0"),A=e[t.getMonth()],W=t.getFullYear();return`${r}, ${u} de ${A} de ${W}`}function R(){const l=O(),t=new DOMParser().parseFromString(n.value,"text/html"),r=t.querySelector(".fechaDelDia");r&&(r.textContent=l,n.value=t.body.innerHTML)}const y=[{text:"Diario",value:"3499"},{text:"Opini\xF3n",value:"8323"}];for(var E in y)$.value.push({title:`${y[E].text} - ${y[E].value}`,value:y[E].value});$.value.sort((l,e)=>l.title.localeCompare(e.title));const J=s({message:"Datos guardados",type:"success",model:!1}),Q="c79f7382012df0ea4c6fa37afec6374e",Y="164551af334e1ec93e1b3099afd93a88";let c=null;const G=async()=>{try{c=(await _.post("https://api.sendpulse.com/oauth/access_token",{grant_type:"client_credentials",client_id:Q,client_secret:Y},{headers:{"Content-Type":"application/json"}})).data.access_token}catch(l){console.error("Error al obtener el token de acceso de SendPulse",l)}};X(async()=>{if(await G(),!!c)try{const e=await _.get("https://api.sendpulse.com/addressbooks",{headers:{Authorization:`Bearer ${c}`}});I.value=e.data;for(var l in e.data)M.value.push({title:`${e.data[l].name}`,value:e.data[l].id});M.value.sort((r,u)=>r.title.localeCompare(u.title));const t=await _.get("https://api.sendpulse.com/templates/?owner=me",{headers:{Authorization:`Bearer ${c}`}});U.value=t.data;for(var l in t.data)D.value.push({title:`${t.data[l].name} - ${t.data[l].real_id}`,value:t.data[l].real_id});D.value.sort((r,u)=>r.title.localeCompare(u.title))}catch(e){console.error("Error al obtener datos de la API de SendPulse",e)}});const K=()=>{if(!c){console.error("Token de acceso no disponible");return}function l(t){const r=Array.from(t,u=>String.fromCodePoint(u)).join("");return btoa(r)}const e={sender_name:C.value,sender_email:"ecuavisainforma@ecuavisa.com",name:T.value,subject:L.value,list_id:k.value,body:l(new TextEncoder().encode(n.value))};console.log("campaignData:",e),_.post("https://api.sendpulse.com/campaigns",e,{headers:{Authorization:`Bearer ${c}`}}).then(t=>{console.log("Campa\xF1a creada con \xE9xito",t.data),J.value={message:"Enviado con exito",type:"success",model:!0}}).catch(t=>{console.error("Error al crear la campa\xF1a",t)})};return Z(()=>{const l=f.value;if(l){const e=U.value.find(t=>t.real_id===l);if(e)return e.preview}return""}),(l,e)=>(x(),w("div",null,[a(z,null,{default:o(()=>[a(i,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:o(()=>[m("div",ne,[a(S,{color:"primary",variant:"text",class:"mb-4 d-none",to:{name:"apps-mailing-list"}},{default:o(()=>[d(" Lista de Newsletter ")]),_:1}),a(S,{color:"primary",class:"mb-4",to:{name:"apps-mailing-forzado"}},{default:o(()=>[d(" Enviar Forzado ")]),_:1}),a(S,{color:"primary",variant:"text",class:"mb-4",to:{name:"apps-mailing-tabs-edit"}},{default:o(()=>[d(" Editar newsletter ")]),_:1})]),a(ee,{class:"mt-5"},{default:o(()=>[a(N,null,{default:o(()=>[m("div",re,[m("div",null,[a(j,null,{default:o(()=>[d(" Crear campa\xF1a v2 ")]),_:1}),a(te,null,{default:o(()=>[d(" Esta modulo nos permite enviar boletines de manera manual ")]),_:1})])]),m("div",ie,[a(N,{class:"align-center px-0 pb-0 pt-2"},{default:o(()=>[m("form",{onSubmit:ae(K,["prevent"])},[a(z,{class:"al-center"},{default:o(()=>[a(i,{cols:"12",sm:"6",md:"6"},{default:o(()=>[a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-clipboard-text",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),label:"Nombre del Newsletter",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-mail-check",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),label:"Escribir el remitente","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-mail-check",modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=t=>L.value=t),label:"Escribir el asunto","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(H,{"prepend-inner-icon":"tabler-users",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),items:M.value,label:"Lista de usuarios"},null,8,["modelValue","items"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(H,{"prepend-inner-icon":"tabler-template",modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),items:D.value,label:"Lista de plantillas del sendpulse"},null,8,["modelValue","items"])]),_:1}),f.value?(x(),w("div",ce,[a(j,null,{default:o(()=>[d("Campos para editar el template ")]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-list",modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),label:"Imagen del articulo","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-list",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t),label:"Url del articulo","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(p,{"prepend-inner-icon":"tabler-list",modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t),label:"Titulo del articulo","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(se,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=t=>h.value=t),label:"Subtitulo del articulo","persistent-hint":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})])):le("",!0),a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[a(S,{color:"success",type:"submit"},{default:o(()=>[a(oe,{size:22,icon:"tabler-mail-fast"}),d(" Crear Campa\xF1a ")]),_:1})]),_:1})]),_:1}),a(i,{cols:"12",sm:"6",md:"6",class:"fondo-gris"},{default:o(()=>[a(i,{cols:"12",sm:"12",md:"12"},{default:o(()=>[n.value?(x(),w("div",de,[m("p",{innerHTML:n.value},null,8,me)])):(x(),w("div",pe,ve))]),_:1})]),_:1})]),_:1})],40,ue)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{he as default};
