import{r as i,as as pe,Q as fe,z as ve,o as D,c as O,w as r,a as l,f as he,u as p,q as h,t as $,aR as Me,h as z,V as J,e as v,aT as ge,i as x,b as T,$ as be,aU as we,aV as Ve,a1 as _e,x as je,F as ye,C as Se,g as G,b3 as Ee,b4 as Te,b5 as Ce,b6 as Ie,n as A,N as H,p as B,a3 as Ne,b0 as Ue}from"./index.88d3c7f5.js";import{V as ke}from"./VAutocomplete.bb0d71fb.js";import{V as De}from"./VAlert.3e8ed100.js";import{V as $e,a as Ae}from"./VToolbar.19b789c8.js";import{V as Be}from"./VSpacer.2a3e77c9.js";import{V as Le}from"./VToolbarItems.56927371.js";const Oe={style:{"line-height":"1.2",display:"block","font-size":"10px","padding-top":"4px","padding-left":"4px"}},ze=["src"],Qe={__name:"edit_1",setup(Je){const C=i([]),I=i(0),M=i(!1),F=i([]),Z=i([]),R=i([]),P=i([]),g=i(""),L=i([]),ee=i([]),ae=i({});i(""),i(""),i(""),i(""),i(""),i("asdfg12345");const b=i("");i([]);const w=i([]),N=i([]),oe=i([]),V=i({message:"Datos guardados",type:"success",model:!1});oe.value=["2","3","4","5","6"];const d=i([]);pe(async()=>{await le(),await ne(),await ie(),await de(),await ue()});async function q(){var o,e,n,a,t,s,m,S,E,k,j,y,K,W,X;try{let Y=[];d.value=[];for(const u of C.value){let f={radios:(o=u.config.horarioEjecucion)==null?void 0:o.method,calendariosInputs:[{value:1,minutoModel:(e=u.config.horarioEjecucion)==null?void 0:e.horario[0].minutoModel},{value:2,horaModel:(n=u.config.horarioEjecucion)==null?void 0:n.horario[1].horaModel,minutoModel:(a=u.config.horarioEjecucion)==null?void 0:a.horario[1].minutoModel},{value:3,diaModel:(t=u.config.horarioEjecucion)==null?void 0:t.horario[2].diaModel,horaModel:(s=u.config.horarioEjecucion)==null?void 0:s.horario[2].horaModel,minutoModel:(m=u.config.horarioEjecucion)==null?void 0:m.horario[2].minutoModel},{value:4,diaModel:(S=u.config.horarioEjecucion)==null?void 0:S.horario[3].diaModel,horaModel:(E=u.config.horarioEjecucion)==null?void 0:E.horario[3].horaModel,mesModel:(k=u.config.horarioEjecucion)==null?void 0:k.horario[3].mesModel,minutoModel:(j=u.config.horarioEjecucion)==null?void 0:j.horario[3].minutoModel},{value:5,diaModel:((y=u.config.horarioEjecucion)==null?void 0:y.horario.length)>4?u.config.horarioEjecucion.horario[4].diaModel:null,horaModel:((K=u.config.horarioEjecucion)==null?void 0:K.horario.length)>4?u.config.horarioEjecucion.horario[4].horaModel:null,mesModel:((W=u.config.horarioEjecucion)==null?void 0:W.horario.length)>4?u.config.horarioEjecucion.horario[4].mesModel:null,minutoModel:((X=u.config.horarioEjecucion)==null?void 0:X.horario.length)>4?u.config.horarioEjecucion.horario[4].minutoModel:null}]};d.value.push(f),g.value=null;const c=f.calendariosInputs[f.radios-1];f.radios==2&&c.horaModel&&c.minutoModel&&(g.value=U(f.radios,c)),f.radios==3&&c.diaModel&&c.horaModel&&c.minutoModel&&(g.value=U(f.radios,c)),f.radios==4&&c.diaModel&&c.mesModel&&c.horaModel&&c.minutoModel&&(g.value=U(f.radios,c)),f.radios==5&&c.diaModel&&c.mesModel&&c.horaModel&&c.minutoModel&&(g.value=U(f.radios,c))}}catch(Y){return console.error(Y.message)}}async function le(){try{var o=new Headers;o.append("Content-Type","application/json");var e={method:"GET",headers:o,redirect:"follow"},n=await fetch("https://ads-service.vercel.app/newsletter/all-select",e);const a=await n.json();N.value=a.data.reduce((t,s)=>(t.push({title:`${s.nombre}`,subject:`${s.subject}`,value:s._id}),t),[]),N.value.length>0&&(w.value=N.value[0].value)}catch(a){return console.error(a.message)}}async function te(o){try{M.value=!0;var e=new Headers;e.append("Content-Type","application/json");var n={method:"GET",headers:e,redirect:"follow"},a=await fetch(`https://ads-service.vercel.app/newsletter/get/${o}`,n);const t=await a.json();ae.value=t.data,C.value=[t.data],M.value=!1}catch(t){return console.error(t.message)}}const re=async o=>{const e=C.value[o];if(e.nombre==""||e.nombre.length<1)return alert("Debe ingresar un nombre"),!1;if(e.descripcion==""||e.descripcion.length<1)return alert("Debe ingresar una descripci\xF3n"),!1;if(e.subject==""||e.subject.length<1)return alert("Debe ingresar un subject"),!1;if(e.sender_name==""||e.sender_name.length<1)return alert("Debe ingresar un nombre del remitente"),!1;if(e.pass==""||e.pass.length<1)return alert("Debe ingresar una contrase\xF1a de seguridad"),!1;var n=await ce(o),a=n.method-1,t=n.horario[a];Object.keys(t).forEach(s=>{if(s!="value"&&t[s]==null)return alert(`No hay valor para: ${s}`),!1}),await se({nombre:e.nombre,descripcion:e.descripcion,subject:e.subject,pass:e.pass,preview:e.preview,sender_email:e.sender_email||"ecuavisainforma@ecuavisa.com",sender_name:e.sender_name||""},e._id)},se=async(o,e)=>{try{M.value=!0;var n=o,a=new Headers;a.append("Content-Type","application/json");var t={method:"POST",headers:a,body:JSON.stringify(n),redirect:"follow"},s=await fetch("https://ads-service.vercel.app/newsletter/update/"+e,t);const m=await s.json();m.resp?V.value={message:"Dato editado",type:"success",model:!0}:V.value={message:"Un error se present\xF3"+m.error,type:"error",model:!0},await q(),M.value=!1}catch(m){console.error(m.message),V.value={message:"Un error se present\xF3"+m.message,type:"error",model:!0}}};async function ne(){var o=JSON.stringify({grant_type:"client_credentials",client_id:"c79f7382012df0ea4c6fa37afec6374e",client_secret:"164551af334e1ec93e1b3099afd93a88"}),e={method:"POST",headers:{"Content-Type":"application/json"},body:o,redirect:"follow"};const a=await(await fetch("https://api.sendpulse.com/oauth/access_token",e)).json();b.value=a.access_token}async function ie(){try{if(!b.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+b.value);var e={method:"GET",headers:o,redirect:"follow"};const t=await(await fetch("https://api.sendpulse.com/addressbooks",e)).json();Z.value=t;for(var n in t)F.value.push({title:`${t[n].name} - ${t[n].id}`,value:t[n].id});F.value.sort((s,m)=>s.title.localeCompare(m.title))}catch(a){console.error(a.message)}}async function de(){try{if(!b.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+b.value);var e={method:"GET",headers:o,redirect:"follow"};const t=await(await fetch("https://api.sendpulse.com/templates/?owner=me",e)).json();P.value=t;for(var n in t)R.value.push({title:`${t[n].name}`,value:t[n].real_id});R.value.sort((s,m)=>s.title.localeCompare(m.title))}catch(a){console.error(a.message)}}async function ue(){try{if(!b.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+b.value);var e={method:"GET",headers:o,redirect:"follow"};const t=await(await fetch("https://api.sendpulse.com/senders",e)).json();ee.value=t;for(var n in t)L.value.push({title:`${t[n].email}`,value:t[n].email});L.value.sort((s,m)=>s.title.localeCompare(m.title))}catch(a){console.error(a.message)}}async function ce(o){console.log("indexP ",o);var e=d.value[o].radios||2,n={method:e,horario:[{value:1,minutoModel:null},{value:2,horaModel:null,minutoModel:null},{value:3,diaModel:null,horaModel:null,minutoModel:null},{value:4,diaModel:null,horaModel:null,mesModel:null,minutoModel:null},{value:5,diaModel:null,horaModel:null,mesModel:null,minutoModel:null}]};return d.value[o].calendariosInputs.forEach((a,t)=>{t!=e-1&&(d.value[o].calendariosInputs[t]=n.horario[t])}),n={method:e,horario:[{value:1,minutoModel:d.value[o].calendariosInputs[0].minutoModel},{value:2,horaModel:d.value[o].calendariosInputs[1].horaModel,minutoModel:d.value[o].calendariosInputs[1].minutoModel},{value:3,diaModel:d.value[o].calendariosInputs[2].diaModel,horaModel:d.value[o].calendariosInputs[2].horaModel,minutoModel:d.value[o].calendariosInputs[2].minutoModel},{value:4,diaModel:d.value[o].calendariosInputs[3].diaModel,horaModel:d.value[o].calendariosInputs[3].horaModel,mesModel:d.value[o].calendariosInputs[3].mesModel,minutoModel:d.value[o].calendariosInputs[3].minutoModel},{value:5,diaModel:d.value[o].calendariosInputs[4].diaModel,horaModel:d.value[o].calendariosInputs[4].horaModel,mesModel:d.value[o].calendariosInputs[4].mesModel,minutoModel:d.value[o].calendariosInputs[4].minutoModel}]},n}const _=i(!1),Q=i(""),me=async o=>{_.value=!0,Q.value=o};fe(async()=>w.value,async()=>{w.value&&(await te(w.value),await q(),I.value=0)});function U(o,e){if(o==2)return"El newsletter se enviar\xE1 todos los d\xEDas a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==3)return"El newsletter se enviar\xE1 el "+e.diaModel.toString().padStart(2,"0")+" de cada mes, a las  "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==4)return"El newsletter se enviar\xE1 cada a\xF1o, el "+e.diaModel.toString().padStart(2,"0")+" de "+e.mesModel.toString().padStart(2,"0")+" a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==5){let n=e.diaModel.join(",");const a={Lunes:1,Martes:2,Mi\u00E9rcoles:3,Jueves:4,Viernes:5};let t=n.split(",");t.sort((j,y)=>a[j]-a[y]);let s=t.join(","),m=e.mesModel.join(",");const S={Enero:1,Febrero:2,Marzo:3,Abril:4,Mayo:5,Junio:6,Julio:7,Agosto:8,Septiembre:9,Octubre:10,Noviembre:11,Diciembre:12};let E=m.split(",");E.sort((j,y)=>S[j]-S[y]);let k=E.join(",");return"El newsletter se enviar\xE1 en los d\xEDas de la semana: "+s+" para los meses:  "+k+" a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0")}}return(o,e)=>{const n=ve("v-list-item-content");return D(),O(G,{class:"pa-sm-14 pa-5"},{default:r(()=>[l(he,{modelValue:p(V).model,"onUpdate:modelValue":e[0]||(e[0]=a=>p(V).model=a),location:"top end",variant:"flat",color:p(V).type},{default:r(()=>[h($(p(V).message),1)]),_:1},8,["modelValue","color"]),l(Me,{class:"text-h5 mb-3"},{default:r(()=>[h(" Gesti\xF3n Newsletter ")]),_:1}),l(z,null,{default:r(()=>[l(J,null,{default:r(()=>[l(v,{cols:"12",sm:"12",md:"4",class:"pb-0 mb-0"},{default:r(()=>[l(ge,{"item-text":"title","item-value":"value",modelValue:p(w),"onUpdate:modelValue":e[1]||(e[1]=a=>x(w)?w.value=a:null),items:p(N),label:"Seleccione el Newsletter","menu-props":{maxHeight:"400"}},{selection:r(({item:a})=>[T("div",null,$(a.title),1)]),item:r(({item:a,props:t})=>[l(be,we(Ve(t)),{default:r(()=>[l(n,null,{default:r(()=>[l(_e,null,{default:r(()=>[T("p",null,"_id: "+$(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1}),l(v,{cols:"12",sm:"12",md:"12",class:"mt-0 py-0"}),l(v,{cols:"12",sm:"12",md:"12"},{default:r(()=>[l(J,{class:"d-flex"},{default:r(()=>[(D(!0),je(ye,null,Se(p(C),(a,t)=>(D(),O(v,{cols:"12",class:"container"},{default:r(()=>[l(G,{class:"mt-5",title:"Editar "+a.nombre},{default:r(()=>[l(z,null,{default:r(()=>[l(Ee,{modelValue:p(I),"onUpdate:modelValue":e[2]||(e[2]=s=>x(I)?I.value=s:null)},{default:r(()=>[l(Te,{disabled:p(M)},{default:r(()=>[l(Ce,null,{default:r(()=>[h("Formulario")]),_:1}),l(Ie,null,{default:r(()=>[l(J,null,{default:r(()=>[l(v,{cols:"12",sm:"6",md:"6"},{default:r(()=>[l(A,{modelValue:a.nombre,"onUpdate:modelValue":s=>a.nombre=s,label:"Nombre del Newsletter para SendPulse",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"]),T("small",Oe,[l(H,{icon:"mdi-information-outline",size:"13px"}),h(" Nombre como se va a guardar en SendPulse")])]),_:2},1024),l(v,{cols:"12",sm:"6",md:"6"},{default:r(()=>[l(A,{modelValue:a.descripcion,"onUpdate:modelValue":s=>a.descripcion=s,label:"Escribir descripci\xF3n corta",placeholder:"Ayuda dar al correo una descripci\xF3n breve",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(v,{cols:"12",sm:"6",md:"12"},{default:r(()=>[l(A,{modelValue:a.subject,"onUpdate:modelValue":s=>a.subject=s,label:"Escribir el asunto","persistent-hint":"",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(v,{cols:"12",sm:"6",md:"5"},{default:r(()=>[l(A,{modelValue:a.sender_name,"onUpdate:modelValue":s=>a.sender_name=s,label:"Nombre del remitente","persistent-hint":"",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(v,{cols:"12",sm:"7"},{default:r(()=>[l(ke,{modelValue:a.sender_email,"onUpdate:modelValue":s=>a.sender_email=s,items:p(L),label:"Lista de remitentes disponible"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(v,{cols:"12",sm:"6",md:"12"})]),_:2},1024)]),_:2},1024)]),_:2},1032,["disabled"])]),_:2},1032,["modelValue"])]),_:2},1024),l(z,{class:"d-flex justify-end flex-wrap gap-3"},{default:r(()=>[l(B,{disabled:p(M),onClick:s=>me(a.preview)},{default:r(()=>[h(" Vista previa ")]),_:2},1032,["disabled","onClick"]),l(B,{disabled:p(M),onClick:s=>re(t)},{default:r(()=>[h(" Guardar ")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024))),256))]),_:1})]),_:1}),l(v,{cols:"12",sm:"6",md:"12"},{default:r(()=>[p(g)?(D(),O(De,{key:0,density:"default",color:"success",variant:"tonal"},{default:r(()=>[l(H,{icon:"mdi-clock-time-eight-outline"}),h(" "+$(p(g)),1)]),_:1})):Ne("",!0)]),_:1})]),_:1})]),_:1}),l(Ue,{modelValue:p(_),"onUpdate:modelValue":e[5]||(e[5]=a=>x(_)?_.value=a:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:r(()=>[l(G,null,{default:r(()=>[T("div",null,[l($e,{color:"primary"},{default:r(()=>[l(B,{icon:"",variant:"plain",onClick:e[3]||(e[3]=a=>_.value=!1)},{default:r(()=>[l(H,{color:"white",icon:"tabler-x"})]),_:1}),l(Ae,null,{default:r(()=>[h("Vista previa del Newsletter")]),_:1}),l(Be),l(Le,null,{default:r(()=>[l(B,{variant:"text",onClick:e[4]||(e[4]=a=>_.value=!1)},{default:r(()=>[h(" Cerrar ")]),_:1})]),_:1})]),_:1})]),T("iframe",{loading:"lazy",width:"100%",height:"2000px",src:p(Q),frameborder:"0"},null,8,ze)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Qe as default};
