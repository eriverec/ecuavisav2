import{r as i,I as Te,v as A,as as Oe,z as Pe,o as u,x,a as e,w as l,g as q,h as P,c as h,a$ as He,N as k,b as s,t as N,a3 as T,bw as Ie,a_ as Ue,u as g,p as w,a2 as ne,Z as ue,F as D,C as W,$ as Je,a0 as Ae,q as v,a1 as qe,b8 as G,b7 as De,ba as X,V as Z,e as z,aT as Fe,b3 as Le,b4 as Me,b5 as Re,aM as de,c7 as K,b6 as $e,aW as je,n as Q,aq as ce,b9 as Be,aX as We}from"./index.88d3c7f5.js";import{l as Y}from"./lodash.ef907739.js";import Ge from"./StatusWidget.018b2b46.js";import{V as Xe}from"./VBadge.0df54a63.js";import{V as Ze}from"./VNavigationDrawer.44422f4c.js";import{V as H}from"./VTooltip.2d0a8708.js";import{V as Ke}from"./VTextarea.86fae113.js";const Qe={class:"text-h6 guarda white--text mb-2"},Ye={key:2,class:"text-body-2 guarda white--text mb-4 text-opacity-70"},ea={class:"custom-heading d-flex align-center justify-space-between"},aa=s("div",null,[s("h6",{class:"text-h6 py-4 pl-4"}," Usuarios activos en configuraci\xF3n "),s("span",{class:"text-body-1"})],-1),la={style:{padding:"1rem"}},oa=s("span",{class:"ms-4"},"Online",-1),ta={key:0,class:"d-inline-block boton-fija"},sa={style:{padding:"1rem",border:"1px solid rgba(var(--v-theme-on-background), var(--v-disabled-opacity))","border-radius":"7px"}},ra={scope:"col",class:"d-flex gap-4 pb-4"},ia=s("tr",null,[s("th",{scope:"col",style:{width:"300px"}},"T\xEDtulo"),s("th",{scope:"col",style:{width:"170px"}},"Hora de inicio"),s("th",{scope:"col",style:{width:"170px"}},"Hora de fin"),s("th",{scope:"col",class:"d-flex gap-4 pb-4"})],-1),na={class:"py-4"},ua={class:"py-4"},da={class:"py-4"},ca={class:"py-4"},ma={class:"d-flex gap-4 py-4"},va={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},pa=s("span",null,"Este titular aparecer\xE1 en lugar del t\xEDtulo del programa sobre el reproductor",-1),fa={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},ga=s("span",null,"Este texto es el que aparece en el indicador que parpadea sobre el header",-1),ha={style:{display:"flex",margin:"1rem"}},ba={style:{"margin-left":"2rem"}},ya={class:"d-inline-block"},_a=s("div",null,[s("span",null,"Estado del player: ")],-1),Va={style:{"margin-left":"2rem"}},xa={style:{width:"100%","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-2"},wa={class:"d-inline-block"},Pa={__name:"index",setup(za){const E=i("");i(!1);const me=i(!1),d=i({estado:!1,titulo:"",label:""}),ve=Te(),F=i(!1),O=i("tab-detalles"),ee=i(""),p=i([]),I=i([]),ae=i(!1),U=i(null),m=i(!1),f=i(""),b=i(0);i(!1);const pe=i(""),fe=i(!1),y=i({value:"",estadoHtml:!1}),L=[{title:"Lunes",value:1},{title:"Martes",value:2},{title:"Mi\xE9rcoles",value:3},{title:"Jueves",value:4},{title:"Viernes",value:5},{title:"S\xE1bado",value:6},{title:"Domingo",value:0}],ge=async()=>{try{const a=await(await fetch("https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_quito.js")).text(),c=a.indexOf("{"),r=a.lastIndexOf("}"),t=a.substring(c,r+1);return JSON.parse(t)}catch(o){return console.error("Error cargando configuraci\xF3n:",o),null}},he=({step:o,progress:a})=>{switch(b.value=a,o){case 1:f.value="Guardando actualizaci\xF3n...",E.value="";break;case 2:f.value="Verificando cambios...",E.value="Esto puede tardar varios segundos";break;case 3:f.value="Finalizando actualizaci\xF3n...",E.value="";break}},M=i({estado:!1,titulo:"",label:""}),R=i({value:"",estadoHtml:!1}),$=i([]),le=A(()=>!Y.exports.isEqual(p.value,$.value)),oe=A(()=>!Y.exports.isEqual(d.value,M.value)),te=A(()=>!Y.exports.isEqual(y.value,R.value)),be=async o=>{try{o.forzado&&(M.value=JSON.parse(JSON.stringify(o.forzado))),Array.isArray(o.horarios)&&(p.value=JSON.parse(JSON.stringify(o.horarios)),I.value=JSON.parse(JSON.stringify(o.horarios)),$.value=JSON.parse(JSON.stringify(o.horarios))),o.html&&(R.value=JSON.parse(JSON.stringify(o.html))),f.value="Actualizaci\xF3n completada con \xE9xito",E.value="",b.value=100,await new Promise(a=>setTimeout(a,2e3)),m.value=!1}catch(a){console.error("Error actualizando datos locales:",a),se(a)}},ye=()=>{m.value=!1,ae.value=!1,j(),f.value="La actualizaci\xF3n est\xE1 tomando m\xE1s tiempo de lo esperado",console.warn("Timeout en la actualizaci\xF3n")},se=o=>{m.value=!1,ae.value=!1,f.value="Error en la actualizaci\xF3n",console.error("Error en la actualizaci\xF3n:",o),j()};async function j(){var o,a,c;F.value=!0;try{const r=await ge();if(!r)throw new Error("No se pudo cargar la configuraci\xF3n");console.log("Configuraci\xF3n cargada:",r),me.value=((o=r.forzado)==null?void 0:o.estado)||!1,d.value=r.forzado||{estado:!1,titulo:"",label:""},M.value=JSON.parse(JSON.stringify(d.value)),p.value=Array.isArray(r.horarios)?[...r.horarios]:[],I.value=Array.isArray(r.horarios)?[...r.horarios]:[],$.value=JSON.parse(JSON.stringify(p.value)),pe.value=((a=r.html)==null?void 0:a.value)||"",fe.value=((c=r.html)==null?void 0:c.estadoHtml)||!1,y.value=r.html||{value:"",estadoHtml:!1},R.value=JSON.parse(JSON.stringify(y.value))}catch(r){console.error("Error al obtener configuraci\xF3n:",r)}F.value=!1}const _e=o=>({data_string:{html:{value:o.html.value||"",estadoHtml:o.html.estadoHtml||!1},forzado:{estado:o.forzado.estado||!1,titulo:o.forzado.titulo||"",label:o.forzado.label||""},horarios:o.horarios||[]}});async function B(o){const a=_e(o);try{if(!(await fetch("https://servicio-github-dynamic.vercel.app/live-web/quito",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Error en la respuesta del servidor");return!0}catch(c){return console.error("Error al enviar datos:",c),!1}}async function Ve(){var o;m.value=!0,b.value=0,f.value="Iniciando actualizaci\xF3n...";try{const a={html:y.value,forzado:d.value,horarios:p.value};await B(a)?(o=U.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar:",a),m.value=!1}}async function xe(){var o;m.value=!0,b.value=0,f.value="Iniciando actualizaci\xF3n de player forzado...";try{const a={html:y.value,forzado:d.value,horarios:I.value};await B(a)?(o=U.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar datos de player:",a),m.value=!1}}async function we(){var o;m.value=!0,b.value=0,f.value="Actualizando c\xF3digo del reproductor...";try{const a={html:y.value,forzado:d.value,horarios:I.value};await B(a)?(o=U.value)==null||o.startMonitoring():m.value=!1}catch(a){console.error("Error al enviar nuevo c\xF3digo del reproductor:",a),m.value=!1}}const re=A(()=>{if(p.value&&p.value.length>0){const o=p.value.map(a=>a.dia);return L.filter(a=>!o.includes(a.value))}return L});function ze(o){const a=L.find(c=>o===c.value);return a?a.title:""}const ke=o=>{p.value.splice(o,1)},Ee=o=>{let a={tituloPrograma:"",estadoHorario:!0,inicio:"12:00",fin:"14:00"};p.value[o].horas.push(a)},Ce=(o,a)=>{p.value[o].horas.splice(a,1)},Se=()=>{let o=localStorage.getItem("role");o!=="administrador"&&o!=="webmaster"&&ve.push({path:"/pages/errors/not-authorized"})},J=i(!1),ie=localStorage.getItem("role"),C=i([]),Ne=()=>{let a=JSON.parse(localStorage.getItem("userData")).email;const r=new Pusher("69f5e107f97ef8dcc25f",{cluster:"us2",forceTLS:!0,channelAuthorization:{paramsProvider:()=>({param1:a}),endpoint:"https://pusher-auth-mocha.vercel.app/pusher/auth"}}).subscribe("presence-configuracion");r.bind("pusher:subscription_succeeded",()=>r.members.each(t=>C.value.push({email:t.id}))),r.bind("pusher:member_added",t=>{C.value.push({email:t.id})}),r.bind("pusher:member_removed",t=>{const n=Array.from(C.value).findIndex(S=>S.email===t.id);n!==-1&&C.value.splice(n,1)})};return Oe(async()=>{console.log("Componente montado, iniciando carga...");try{await j(),console.log("Configuraci\xF3n cargada correctamente"),Ne(),Se()}catch(o){console.error("Error en la inicializaci\xF3n:",o)}}),(o,a)=>{const c=Pe("PerfectScrollbar"),r=We;return u(),x("section",null,[e(Ue,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=t=>m.value=t),class:"align-center justify-center",persistent:""},{default:l(()=>[e(q,{color:"primary",width:"300"},{default:l(()=>[e(P,{class:"text-center"},{default:l(()=>[b.value<100?(u(),h(He,{key:0,indeterminate:"",color:"white",class:"mb-4"})):(u(),h(k,{key:1,icon:"tabler-check",color:"white",size:"32",class:"mb-4"})),s("div",Qe,N(f.value),1),E.value?(u(),x("div",Ye,N(E.value),1)):T("",!0),e(Ie,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=t=>b.value=t),color:"white",height:"8",rounded:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ge,{ref_key:"statusMonitor",ref:U,"asset-url":"https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_quito.js","poll-interval":2e3,"max-attempts":30,onProgress:he,onSuccess:be,onTimeout:ye,onError:se},null,512),g(ie)=="administrador"?(u(),h(w,{key:0,icon:"",size:"small",class:"app-custom-toggler rounded-s-lg rounded-0",style:{"z-index":"1001"},onClick:a[2]||(a[2]=t=>J.value=!0)},{default:l(()=>[e(k,{icon:"tabler-users"})]),_:1})):T("",!0),g(ie)=="administrador"?(u(),h(Ze,{key:1,modelValue:J.value,"onUpdate:modelValue":a[4]||(a[4]=t=>J.value=t),temporary:"",location:"end",width:"400",scrim:!1,class:"app-customizer"},{default:l(()=>[s("div",ea,[aa,e(w,{icon:"",variant:"text",color:"secondary",size:"x-small",onClick:a[3]||(a[3]=t=>J.value=!1)},{default:l(()=>[e(k,{icon:"tabler-x",size:"20"})]),_:1})]),e(ne),s("div",la,[e(c,{tag:"ul",options:{wheelPropagation:!1}},{default:l(()=>[e(ue,{lines:"two",border:""},{default:l(()=>[(u(!0),x(D,null,W(C.value,(t,_)=>(u(),x(D,{key:t.email},[e(Je,null,{default:l(()=>[e(Ae,null,{default:l(()=>[v(N(t.email),1)]),_:2},1024),e(qe,{class:"mt-1"},{default:l(()=>[e(Xe,{dot:"",location:"start center","offset-x":"2",color:"success",class:"me-3"},{default:l(()=>[oa]),_:1})]),_:1})]),_:2},1024),_!==C.value.length-1?(u(),h(ne,{key:0})):T("",!0)],64))),128))]),_:1})]),_:1})])]),_:1},8,["modelValue"])):T("",!0),e(De,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=t=>O.value=t),class:"v-tabs-pill"},{default:l(()=>[e(G,{value:"tab-config"},{default:l(()=>[v("Configuraci\xF3n de Horarios")]),_:1}),e(G,{value:"tab-forzado"},{default:l(()=>[v("Player Forzado")]),_:1}),e(G,{value:"tab-embed"},{default:l(()=>[v("C\xF3digo del reproductor")]),_:1})]),_:1},8,["modelValue"]),e(Be,{modelValue:O.value,"onUpdate:modelValue":a[11]||(a[11]=t=>O.value=t)},{default:l(()=>[e(X,{value:"tab-config"},{default:l(()=>[e(q,{class:"mt-5",title:"Configuraci\xF3n de los horarios"},{default:l(()=>[F.value?(u(),h(P,{key:0},{default:l(()=>[v(" Cargando configuraci\xF3n... ")]),_:1})):(u(),h(P,{key:1,class:"py-4 gap-0 w-100"},{default:l(()=>[e(Z,null,{default:l(()=>[e(z,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[e(z,{cols:"4"},{default:l(()=>[e(Fe,{modelValue:ee.value,"onUpdate:modelValue":a[6]||(a[6]=t=>ee.value=t),items:g(re),disabled:g(re).length===0,label:"D\xEDa de la semana"},null,8,["modelValue","items","disabled"])]),_:1}),e(z,{cols:"6",class:"d-flex gap-4"},{default:l(()=>[O.value==="tab-config"?(u(),x("div",ta,[e(w,{rounded:"pill",color:"success",onClick:Ve,disabled:!g(le)},{default:l(()=>[e(k,{size:"30",icon:"tabler-device-floppy"})]),_:1},8,["disabled"]),e(H,{activator:"parent",location:"top","open-on-hover":!g(le)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])):T("",!0)]),_:1})]),_:1}),e(z,{cols:"12"},{default:l(()=>[e(ue,{class:"card-list"},{default:l(()=>[e(Le,{variant:"accordion",multiple:""},{default:l(()=>[(u(!0),x(D,null,W(p.value,(t,_)=>(u(),h(Me,{key:_},{default:l(()=>[e(Re,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:l(()=>[s("h3",null,N(ze(t.dia)),1),e(de,{color:t.estadoDia==!0?"success":"warning",class:"mr-4"},{default:l(()=>[v(N(t.estadoDia==!0?"Activo":"Inactivo"),1)]),_:2},1032,["color"]),e(K,{modelValue:t.estadoDia,"onUpdate:modelValue":n=>t.estadoDia=n,color:"success",label:t.estadoDia==!0?"D\xEDa activo":"D\xEDa inactivo"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),e($e,{class:"d-flex flex-wrap justify-space-between"},{default:l(()=>[s("div",sa,[e(je,{class:"w-full"},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",ra,[e(w,{color:"primary",onClick:n=>Ee(_)},{default:l(()=>[v(" A\xF1adir hora ")]),_:2},1032,["onClick"]),e(w,{style:{"margin-left":"0.5rem"},color:"error",onClick:n=>ke(_)},{default:l(()=>[v(" Eliminar d\xEDa ")]),_:2},1032,["onClick"])])]),ia]),s("tbody",null,[(u(!0),x(D,null,W(t.horas.sort((n,S)=>n.inicio.localeCompare(S.inicio)),(n,S)=>(u(),x("tr",{key:S},[s("td",na,[e(Q,{modelValue:n.tituloPrograma,"onUpdate:modelValue":V=>n.tituloPrograma=V,label:"T\xEDtulo del horario",placeholder:"Escriba el t\xEDtulo...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ua,[e(r,{modelValue:n.inicio,"onUpdate:modelValue":V=>n.inicio=V,label:"Hora Inicio",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",da,[e(r,{modelValue:n.fin,"onUpdate:modelValue":V=>n.fin=V,label:"Hora Fin",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ca,[s("div",ma,[e(K,{modelValue:n.estadoHorario,"onUpdate:modelValue":V=>n.estadoHorario=V,color:"success",label:n.estadoHorario==!0?"Horario activo":"Horario inactivo"},null,8,["modelValue","onUpdate:modelValue","label"]),t.horas.length>1?(u(),h(w,{key:0,color:"error",onClick:V=>Ce(_,S)},{default:l(()=>[e(k,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):T("",!0)])])]))),128))])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1}),e(X,{value:"tab-forzado"},{default:l(()=>[e(q,{class:"mt-5",title:"Player Forzado",subtitle:"Para transmisiones emergentes, este m\xF3dulo permitir\xE1 activar el reproductor de forma forzada"},{default:l(()=>[e(P,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(Z,null,{default:l(()=>[e(z,{cols:"8",style:{}},{default:l(()=>[s("div",va,[e(Q,{modelValue:d.value.titulo,"onUpdate:modelValue":a[7]||(a[7]=t=>d.value.titulo=t),label:"T\xEDtulo sobre el player",placeholder:"Escriba el t\xEDtulo que mostrar\xE1 sobre el reproductor...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(H,{location:"top"},{activator:l(({props:t})=>[e(k,ce(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[pa]),_:1})]),s("div",fa,[e(Q,{modelValue:d.value.label,"onUpdate:modelValue":a[8]||(a[8]=t=>d.value.label=t),label:"Texto del Indicador",placeholder:"Escriba el texto que deseas en el indicador parpadeante...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(H,{location:"top"},{activator:l(({props:t})=>[e(k,ce(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[ga]),_:1})])]),_:1}),e(z,{cols:"4",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",ha,[s("div",null,[e(K,{modelValue:d.value.estado,"onUpdate:modelValue":a[9]||(a[9]=t=>d.value.estado=t),color:"success",label:d.value.estado==!0?"Activo":"Inactivo"},null,8,["modelValue","label"])]),s("div",ba,[s("div",ya,[e(w,{color:"primary",onClick:xe,disabled:!g(oe)},{default:l(()=>[v(" ENVIAR ")]),_:1},8,["disabled"]),e(H,{activator:"parent",location:"top","open-on-hover":!g(oe)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])])])]),_:1}),e(z,{cols:"12",style:{display:"flex","align-items":"center"}},{default:l(()=>[_a,s("div",Va,[e(de,{color:d.value.estado==!0?"success":"warning",class:"mr-4"},{default:l(()=>[v(N(d.value.estado==!0?"Activo":"Inactivo"),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{value:"tab-embed"},{default:l(()=>[e(q,{class:"mt-5",title:"Embed player",subtitle:"Proporciona el c\xF3digo HTML del reproductor que presentar\xE1 embebido en la seccion de audio"},{default:l(()=>[e(P,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(Z,null,{default:l(()=>[e(z,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",xa,[e(Ke,{modelValue:y.value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>y.value.value=t),label:"C\xF3digo",placeholder:"Escriba el c\xF3digo html del reproductor...",class:"ms-0 me-1 chat-list-search","auto-grow":""},null,8,["modelValue"])]),s("div",wa,[e(w,{color:"primary",onClick:we,disabled:!g(te)},{default:l(()=>[v(" ENVIAR ")]),_:1},8,["disabled"]),e(H,{activator:"parent",location:"top","open-on-hover":!g(te)},{default:l(()=>[v(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{Pa as default};
