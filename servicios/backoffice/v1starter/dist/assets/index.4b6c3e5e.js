import{R as ye,U as xe,r as l,Q as W,v as we,as as Ve,z as Ye,o as Y,x as F,a as r,w as i,u as a,g as le,h as A,q as U,p as S,i as z,b0 as Me,t as v,f as De,e as Ce,b as o,L as je,aT as se,c as oe,a3 as H,n as Fe,aW as Ue,F as Ie,C as $e,X as ke,d as Se,N as X,Y as Te,Z as Ne,$ as re,ao as ne,ap as ie,a2 as Ee,V as Le,a4 as ze,bc as Pe,aX as Be}from"./index.88d3c7f5.js";import{a as Re}from"./formatters.a9a9bf7f.js";import{d as Ae}from"./debounce.967b9882.js";import{M as He}from"./index.50982b4e.js";import{V as Oe}from"./VSpacer.2a3e77c9.js";import{V as qe}from"./VPagination.9412c3b8.js";import{p as O}from"./parseISO.d0bde0b5.js";const Ge=o("h1",{class:"mb-4"},'Usuarios registrados para la campa\xF1a "La Hija del Embajador"',-1),Je={class:"app-user-search-filter d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},Qe=o("span",{style:{cursor:"pointer"},class:"px-0 py-p m-0"},"Exportar usuarios",-1),We={key:0,class:"px-0 py-1 text-disabled"},Xe={key:0,class:"text-disabled"},Ze=o("thead",null,[o("tr",null,[o("th",{scope:"col"}," Nombres "),o("th",{scope:"col"}," Fecha de nacimiento "),o("th",{scope:"col"}," Tel\xE9fono "),o("th",{scope:"col"}," Fecha de registro "),o("th",{scope:"col"}," Ciudad "),o("th",{scope:"col"}," Acciones ")])],-1),Ke={key:0},ea={class:"d-flex align-center"},aa={key:1},ta={class:"d-flex flex-column"},la={class:"text-base",title:"Ver detalles del usuario"},sa={class:"text-sm text-disabled"},oa={class:"text-base"},ra={class:"text-base"},na={class:"text-base"},ia={class:"text-base"},ua={class:"text-center",style:{width:"5rem"}},da=o("tr",null,[o("td",{colspan:"7",class:"text-center"}," No hay datos que mostrar ")],-1),ca=[da],fa=o("tr",null,[o("td",{colspan:"7",class:"text-center"}," Cargando datos, por favor espere un momento... ")],-1),ma=[fa],va={class:"text-sm text-disabled"},Ya={__name:"index",setup(pa){const b=ye.exports.extendMoment(He);b.locale("es",[xe]),b.tz.setDefault("America/Guayaquil");const M=l("Ver todos los registros");l(null);const I=l(0);l(0);const $=l([]),n=l(1),P=l(0),p=l(10),Z=l(null),K=l("");l(""),l(null),l(!0),l("");const y=l(!1),w=l("");l({loading:!1,disabled:!1}),l(null),l(null);const ee=l(null);l(!1),l([]),l([]);const g=l(!1),k=b().format("YYYY-MM-DD"),q=b().subtract(7,"days").format("YYYY-MM-DD"),f=l({inicio:q,fin:k}),h=l({message:"Datos guardados",type:"success",model:!1}),B=l(""),G=l("usuarios_hija_embajador"),ae=l({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at:"created_at",created_at_campaign:"created_at_campaign",ciudad:"ciudad",telefono:"telefono"}),ue={fechasModel:[O(q),O(k)],fechasVModel:[O(k)],fechasVConfig:{position:"auto right",mode:"single",minDate:O(k),altFormat:"d F j, Y",dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0},fechai:q,fechaV:k,fechaf:k},x=l(ue);W(n,async()=>{n.value>P.value&&(n.value=P.value),await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})}),W(p,async()=>{n.value=1,await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})});const de=we(()=>{const s=$.value.length?n.value*p.value:0;return $.value.length+n.value*p.value,I.value<p.value?`Mostrandos ${I.value} de ${I.value} registros `:`Mostrando ${s} de ${I.value} registros `});Ve(async()=>{await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})});async function D(s={}){const{page:t=1,limit:u=10,fechai:d="",fechaf:c="",search:e=""}=s;try{g.value=!0;var _=new Headers;_.append("Content-Type","application/json");var m={method:"GET",headers:_,redirect:"follow"};M.value=="Por Fecha"?(B.value=`https://usuarios-backoffice.vercel.app/campaign-landings/all-users/hija_embajador?fechai=${d}&fechaf=${c}&search=${e}`,G.value="usuarios_hija_embajador_por_fecha",console.log(1)):(B.value=`https://usuarios-backoffice.vercel.app/campaign-landings/all-users/hija_embajador?fechai=&fechaf=&search=${e}`,G.value="usuarios_hija_embajador",console.log(2));var Q=await fetch(`${B.value}&page=${t}&limit=${u}`,m);const j=await Q.json();if(j.resp)$.value=j.data,I.value=j.total,P.value=Math.ceil(j.total/j.limit);else return h.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},g.value=!1,!1;g.value=!1}catch(j){return h.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},g.value=!1,console.error(j.message)}}const J=l(!0);async function ce(s,t,u){s.length>1&&(ee.value=null,J.value=!0,n.value=1,x.value.fechai=b(s[0]).format("DD-MM-YYYY"),x.value.fechaf=b(s[1]).format("DD-MM-YYYY"),f.value.inicio=b(x.value.fechai,"DD-MM-YYYY").format("YYYY-MM-DD"),f.value.fin=b(x.value.fechaf,"DD-MM-YYYY").format("YYYY-MM-DD"),await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})),s.length==2&&(ee.value=null,x.value.fechasVConfig.minDate=s[1],x.value.fechasVModel=[s[1]],J.value=!0),s.length==0&&(J.value=!1,await D({page:n.value,limit:p.value,fechai:"",fechaf:"",search:w.value}))}const T=l({tamanioActual:0,tamanioTotal:0}),N=l([]);async function fe(s=1,t=10){try{var u=new Headers;u.append("Content-Type","application/json");var d={method:"GET",headers:u,redirect:"follow"},c=await fetch(`${B.value}&page=${s}&limit=${t}`,d);const e=await c.json();return e.resp?e:(h.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},null)}catch(e){return h.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(e.message),null}}function me(s){const t=new Set;return s.filter(u=>t.has(u.wylexId)?!1:(t.add(u.wylexId),!0))}async function ve(){T.value={tamanioActual:0,tamanioTotal:0},N.value=[];for(var s=1;;){const t=await fe(s,500),u=t.data,d=t.total;if(u.forEach(c=>{const e=c.user;let _={};for(let m in ae.value)e.hasOwnProperty(m)?_[m]=e[m]:m=="created_at_campaign"?_[m]=c.created_at_campaign:_[m]="";N.value.push(_)}),T.value.tamanioActual=N.value.length,T.value.tamanioTotal=d,N.value.sort((c,e)=>b(e.created_at_campaign,"DD/MM/YYYY-HH:mm:ss").diff(b(c.created_at_campaign,"DD/MM/YYYY-HH:mm:ss"))),s++,u.length<1)break}return!0}function pe(s){for(var t=typeof s!="object"?JSON.parse(s):s,u="",d=0;d<t.length;d++){var c="";for(var e in t[d])c!=""&&(c+=","),c+=t[d][e];u+=c+`\r
`}return u}function he(s,t,u){s&&t[0].wylexId!=="wylexId"&&t.unshift(s);var d=JSON.stringify(t),c=pe(d),e=u+".csv"||"export.csv",_=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(_,e);else{var m=document.createElement("a");if(m.download!==void 0){var Q=URL.createObjectURL(_);m.setAttribute("href",Q),m.setAttribute("download",e),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)}}}async function _e(){try{if($.value.length<1)return h.value={message:"No hay datos que exportar.",type:"error",model:!0},!1;y.value=!0,await ve(),y.value=!1;let t=[];t=N.value;var s=`${G.value}`;ze("descarga-completa-usuarios-hija-embajador"),he(ae.value,me(t),s)}catch(t){return console.log(t),h.value={message:"No se pudo recuperar los datos de usuario, recargue de nuevo.",type:"error",model:!0},y.value=!1,!1}}W(M,async()=>{n.value=1,M.value&&await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})});const R=l(""),te=Ae(async()=>{var s;try{w.value=(s=R.value)==null?void 0:s.toLowerCase(),n.value=1,await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})}catch(t){return console.error("Error en buscarUsuarios:",t),h.value={message:"No se pudo recuperar los datos de usuario al realizar la b\xFAsqueda, recargue de nuevo.",type:"error",model:!0},null}},500),V=l(!1),C=l(!1),E=l(!1),L=l({}),ge=async s=>{V.value=!0,C.value=s},be=async()=>{try{if(!C.value)return h.value={message:"Id no especificado para eliminar",type:"error",model:!0},!1;E.value=!0,y.value=!0,L.value[C.value]=!0;var s=new Headers;s.append("Content-Type","application/json");var t={method:"DELETE",headers:s,redirect:"follow"},u=await fetch(`https://usuarios-backoffice.vercel.app/campaign-landings/delete-user/${C.value}/hija_embajador`,t);return(await u.json()).resp?(n.value=1,await D({page:n.value,limit:p.value,fechai:f.value.inicio,fechaf:f.value.fin,search:w.value})):h.value={message:"No se pudo eliminar el registro, intente de nuevo",type:"error",model:!0},C.value=null,y.value=!1,E.value=!1,L.value[C.value]=!1,V.value=!1,!0}catch(d){return h.value={message:"No se pudo eliminar el registro, intente de nuevo",type:"error",model:!0},y.value=!1,L.value[C.value]=!1,V.value=!1,E.value=!1,console.error(d.message)}};return(s,t)=>{const u=Pe,d=Be,c=Ye("RouterLink");return Y(),F("section",null,[r(Me,{modelValue:a(V),"onUpdate:modelValue":t[2]||(t[2]=e=>z(V)?V.value=e:null),persistent:"",class:"v-dialog-sm"},{default:i(()=>[r(u,{onClick:t[0]||(t[0]=e=>V.value=!a(V))}),r(le,{title:"Eliminar registro"},{default:i(()=>[r(A,null,{default:i(()=>[U(" \xBFDesea eliminar el registro? ")]),_:1}),r(A,{class:"d-flex justify-end gap-3 flex-wrap"},{default:i(()=>[r(S,{color:"secondary",variant:"tonal",onClick:t[1]||(t[1]=e=>V.value=!1)},{default:i(()=>[U(" No, Cerrar ")]),_:1}),r(S,{onClick:be,loading:a(E),disabled:a(E)},{default:i(()=>[U(" Si, eliminar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(De,{modelValue:a(h).model,"onUpdate:modelValue":t[3]||(t[3]=e=>a(h).model=e),location:"top end",variant:"flat",timeout:a(h).timeout||2e3,color:a(h).type},{default:i(()=>[U(v(a(h).message),1)]),_:1},8,["modelValue","timeout","color"]),r(Le,null,{default:i(()=>[r(Ce,{cols:"12",sm:"12",lg:"12"},{default:i(()=>[Ge,r(A,{class:"d-flex py-4 gap-4 px-0 flex-wrap",style:{"align-items":"flex-start"}},{default:i(()=>[o("div",{class:je("me-3 d-flex gap-4"+(a(y)?" disabled":""))},[r(se,{disabled:a(g),class:"bg-white",modelValue:a(p),"onUpdate:modelValue":t[4]||(t[4]=e=>z(p)?p.value=e:null),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["disabled","modelValue"]),r(se,{disabled:a(g),label:"Tipo de b\xFAsqueda","item-text":"title",style:{"min-width":"9rem"},"item-value":"value",class:"bg-white",density:"compact",modelValue:a(M),"onUpdate:modelValue":t[5]||(t[5]=e=>z(M)?M.value=e:null),variant:"outlined",items:["Ver todos los registros","Por Fecha"]},null,8,["disabled","modelValue"]),a(M)=="Por Fecha"&&!a(g)?(Y(),oe(d,{key:0,clearable:"",class:"bg-white",style:{width:"19rem"},label:"Fecha de inicio y fin del curso","prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:a(x).fechasModel,"onUpdate:modelValue":t[6]||(t[6]=e=>a(x).fechasModel=e),"show-current":"true",onOnChange:ce,config:{position:"auto right",mode:"range",altFormat:"d F j, Y",maxDate:new Date,dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0}},null,8,["modelValue"])):H("",!0),r(Fe,{clearable:"",title:"Buscar por correo, email, apellido, tel\xE9fono o c\xE9dula",disabled:a(g),class:"bg-white",modelValue:a(R),"onUpdate:modelValue":t[7]||(t[7]=e=>z(R)?R.value=e:null),label:"Buscar por correo, email, apellido, tel\xE9fono o c\xE9dula","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",onInput:a(te),"onClick:clear":a(te),style:{"min-width":"16rem"}},null,8,["disabled","modelValue","onInput","onClick:clear"])],2),r(Oe),o("div",Je,[r(S,{loading:a(y),disabled:a(y)||a(g),variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:_e},{default:i(()=>[Qe]),_:1},8,["loading","disabled"]),a(y)?(Y(),F("small",We," Exportando "+v(a(T).tamanioActual)+" / "+v(a(T).tamanioTotal)+" registros ",1)):H("",!0)])]),_:1}),a(M)=="Por Fecha"?(Y(),F("small",Xe,[U("Se ha filtrado usuarios "),o("b",null,v(a(Z)&&a(K).length>0?a(K).filter(e=>a(Z).includes(e.value))[0].title:""),1),U(" , desde "+v(a(x).fechai)+" hasta "+v(a(x).fechaf)+" con un total de "+v(a(I))+" registros ",1)])):H("",!0),r(le,{class:"mt-1"},{default:i(()=>[r(Ue,{class:"text-no-wrap"},{default:i(()=>[Ze,a(g)==!1?(Y(),F("tbody",Ke,[(Y(!0),F(Ie,null,$e(a($),e=>(Y(),F("tr",{key:e.user._id,style:{height:"3.75rem"}},[o("td",null,[o("div",ea,[r(ke,{variant:"tonal",color:"success",class:"me-3",size:"38"},{default:i(()=>[e.user.avatar?(Y(),oe(Se,{key:0,src:e.user.avatar},null,8,["src"])):(Y(),F("span",aa,v(a(Re)(`${e.user.first_name} ${e.user.last_name}`)),1))]),_:2},1024),o("div",ta,[o("h6",la,[r(c,{to:{name:"apps-user-view-id",params:{id:e.user.wylexId}},class:"font-weight-medium user-list-name"},{default:i(()=>[U(v(e.user.first_name)+" "+v(e.user.last_name),1)]),_:2},1032,["to"])]),o("span",sa,v(e.user.email),1)])])]),o("td",null,[o("span",oa,v(e.user.birth_date),1)]),o("td",null,[o("span",ra,v(e.user.phone_number||e.user.telefono),1)]),o("td",null,[o("span",na,v(a(b)(e.created_at_campaign).format("YYYY-MM-DD HH:mm:ss")),1)]),o("td",null,[o("span",ia,v(e.user.ciudad),1)]),o("td",ua,[r(S,{title:"Ver detalles del usuario",icon:"",size:"x-small",color:"default",variant:"text",to:{name:"apps-user-view-id",params:{id:e.user.wylexId}}},{default:i(()=>[r(X,{size:"22",icon:"tabler-eye"})]),_:2},1032,["to"]),r(S,{title:"Eliminar registro",icon:"",size:"x-small",color:"default",variant:"text",modelValue:a(L)[e.user.wylexId],"onUpdate:modelValue":_=>a(L)[e.user.wylexId]=_,onClick:_=>ge(e.user.wylexId)},{default:i(()=>[r(X,{size:"22",icon:"tabler-trash"})]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"]),r(S,{disabled:"true",icon:"",size:"x-small",color:"default",variant:"text",class:"d-none"},{default:i(()=>[r(X,{size:"22",icon:"tabler-dots-vertical"}),r(Te,{activator:"parent"},{default:i(()=>[r(Ne,null,{default:i(()=>[r(re,{title:"View",to:{name:"apps-user-view-id",params:{id:e.user.wylexId}}},null,8,["to"]),r(re,{title:"Suspend",href:"javascript:void(0)"})]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))])):H("",!0),ne(o("tfoot",null,ca,512),[[ie,!a($).length&&a(g)==!1]]),ne(o("tfoot",null,ma,512),[[ie,a(g)]])]),_:1}),r(Ee),r(A,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:i(()=>[o("span",va,v(a(de)),1),r(qe,{modelValue:a(n),"onUpdate:modelValue":t[8]||(t[8]=e=>z(n)?n.value=e:null),size:"small","total-visible":5,length:a(P)},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{Ya as default};
