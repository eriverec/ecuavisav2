import{R as Y,S as X,U as E,ak as te,r as x,as as se,v as oe,o as S,x as C,a,w as t,e as $,b as p,u as _,i as L,aT as re,p as N,q as y,V as P,bx as le,ao as ie,ap as ne,aR as G,t as b,aW as ce,F as R,C as H,h as J,bP as U,aX as ue,M as de,z as pe,b7 as me,b8 as j,g as fe,b9 as he,ba as A,c as M,a3 as _e,b2 as ve,Z as be,$ as ge,aM as B,N as ye,a0 as we,a1 as xe,bZ as Se}from"./index.88d3c7f5.js";const Ve={class:"date-picker-wrapper",style:{width:"100%"}},Te=p("thead",null,[p("tr",null,[p("th",{scope:"col"},"Nombre"),p("th",{scope:"col"},"Email"),p("th",{scope:"col"},"N\xFAmero de tel\xE9fono")])],-1),De={__name:"ChartSugerenciasAnalytics",setup(n){const i=Y.exports.extendMoment(X);i.locale("es",[E]);const l=e=>{const r=`rgba(${U(e.colors["on-surface"])},${e.variables["medium-emphasis-opacity"]})`,c=`rgba(${U(e.colors["on-surface"])},${e.variables["disabled-opacity"]})`,s=`rgba(${U(String(e.variables["border-color"]))},${e.variables["border-opacity"]})`,m=`rgba(${U(e.colors["on-surface"])},${e.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:r,themeDisabledTextColor:c,themeBorderColor:s,themePrimaryTextColor:m}},o=te(),h=x([]),u=x([]),{themeBorderColor:d,themeDisabledTextColor:g}=l(o.current.value),T=x([]),I=x(""),k=x(!1),D=x("");async function W(){await fetch("https://sugerencias-ecuavisa.vercel.app/all").then(e=>e.json()).then(e=>{let r=e.data.filter(c=>c.estado==!0&&c.users_suscribed>0);h.value=r})}se(async()=>{await W()});const Z=e=>{e.length>1&&(T.value=e)},F=oe(()=>{let e,r=Array.from(T.value);if(r.length>0){let f=new Date(r[0]),w=new Date(r[1]);e=Array.from(h.value).filter(V=>{let O=new Date(V.created_at);return O.getTime()>=f.getTime()&&O.getTime()<=w.getTime()})}else e=Array.from(h.value);const c={data:[]},s=[];for(let f in e){let w=parseInt(e[f].users_suscribed);c.data.push(w),s.push(e[f].title)}return{series:[c],options:{chart:{parentHeightOffset:0,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{borderRadius:8,barHeight:"60%",horizontal:!0}},grid:{borderColor:d,xaxis:{lines:{show:!1}},padding:{top:-10}},yaxis:{labels:{style:{colors:g}}},xaxis:{axisBorder:{show:!1},axisTicks:{color:d},categories:s,labels:{style:{colors:g}}}},intereses:s}});async function q(e){let c=h.value.filter(s=>s.title==e)[0]._id;await fetch("https://sugerencias-ecuavisa.vercel.app/sugerencia/group/usuario?"+new URLSearchParams({idSugerencia:c})).then(s=>s.json()).then(s=>{u.value=s.data}),k.value=!0}const K=()=>{T.value=[],I.value=""};function Q(e){for(var r=typeof e!="object"?JSON.parse(e):e,c="",s=0;s<r.length;s++){var m="";for(var f in r[s])m!=""&&(m+=","),m+=r[s][f];c+=m+`\r
`}return c}function ee(e,r,c){e&&r[0].wylexId!=="wylexId"&&r.unshift(e);var s=JSON.stringify(r),m=Q(s),f=c+".csv"||"export.csv",w=new Blob([m],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(w,f);else{var v=document.createElement("a");if(v.download!==void 0){var V=URL.createObjectURL(w);v.setAttribute("href",V),v.setAttribute("download",f),v.style.visibility="hidden",document.body.appendChild(v),v.click(),document.body.removeChild(v)}}}async function ae(){let e={userId:"userId",interesId:"interesId",meta_existe:"meta_existe",created_at:"created",first_name:"first_name",last_name:"last_name",phone_number:"phone_number",email:"email",site:"site"},r=[];r=Array.from(u.value);let c="users_"+D.value.replace(/ /g,"_"),s=i().format("DD/MM/YYYY HH:mm:ss").toString(),m=JSON.parse(localStorage.getItem("userData"));if(m.email!=="admin@demo.com"){var f=new Headers;f.append("Content-Type","application/json");var w=JSON.stringify({usuario:m.email,pagina:"interesesSugerencias-listaSugerencias-estadisticas",accion:"export",fecha:s}),v={method:"POST",headers:f,body:w,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",v).then(V=>{}).catch(V=>console.log("error",V))}ee(e,r,c)}return(e,r)=>{const c=ue;return S(),C(R,null,[a(P,{style:{display:"flex","flex-wrap":"wrap","row-gap":"0.1em","padding-top":"5px"}},{default:t(()=>[a($,{cols:"4"},{default:t(()=>[p("div",Ve,[a(c,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:_(I),"onUpdate:modelValue":r[0]||(r[0]=s=>L(I)?I.value=s:null),"show-current":"true",onOnChange:Z,config:{mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date}},null,8,["modelValue","config"])])]),_:1}),a($,{cols:"3"},{default:t(()=>[a(re,{style:{width:"100%"},modelValue:_(D),"onUpdate:modelValue":[r[1]||(r[1]=s=>L(D)?D.value=s:null),q],items:_(F).intereses,label:"Sugerencias"},null,8,["modelValue","items"])]),_:1}),a($,{cols:"5",style:{display:"flex","flex-wrap":"wrap","column-gap":"0.2em","row-gap":"0.2em"}},{default:t(()=>[a(N,{color:"primary",onClick:K,disabled:e.isExportLoading},{default:t(()=>[y(" Reinciar filtro ")]),_:1},8,["disabled"]),a(N,{color:"primary",onClick:ae},{default:t(()=>[y(" Exportar ")]),_:1})]),_:1})]),_:1}),a(_(le),{type:"bar",height:"400",options:_(F).options,series:_(F).series},null,8,["options","series"]),ie(a(J,null,{default:t(()=>[a(G,null,{default:t(()=>[y("Usuarios suscritos a "+b(_(D)),1)]),_:1}),a(ce,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:t(()=>[Te,p("tbody",null,[(S(!0),C(R,null,H(_(u),s=>(S(),C("tr",null,[p("td",null,b(s.first_name)+" "+b(s.last_name),1),p("td",null,b(s.email),1),p("td",null,b(s.phone_number),1)]))),256))])]),_:1})]),_:1},512),[[ne,_(k)]])],64)}}};const Ce={class:"d-flex flex-wrap py-4 gap-4 align-items-center",style:{"justify-content":"space-between"}},Ie={class:"text-xs text-disabled"},z=Y.exports.extendMoment(X);z.locale("es",[E]);function Ue(n,i){const l=XLSX.utils.book_new(),o=XLSX.utils.json_to_sheet(n);XLSX.utils.book_append_sheet(l,o,"Datos"),XLSX.writeFile(l,i+".xlsx")}const $e={data(){return{listUsuariosG:[],usuarioFielModel:"",listUsuarioFieles:[],datos:[],suggestion:{title:"",description:"",estado:!0},maxRegistros:500,currentTab:"tab-lista"}},watch:{async usuarioFielModel(n,i){this.obtenerDatosGrupoUsuarios(n)}},async mounted(){this.authorizedCheck(),this.obtenerDatos()},methods:{async searchUsers(){var n=[],i="";for(var l in this.listUsuarioFieles)this.listUsuarioFieles[l].value==this.usuarioFielModel&&(i=this.listUsuarioFieles[l].title);for(var l in this.listUsuariosG){var o=this.listUsuariosG[l];n.push({Sugerencia:i,Nombre:`${o.first_name}`,Apellido:`${o.last_name}`,"Nombre completo":`${o.first_name} ${o.last_name}`,Tel\u00E9fono:`${o.phone_number}`,Correo:`${o.email}`,wylexId:`${o.wylexId}`})}Ue(n,`usuarios-${i}`)},async obtenerDatosGrupoUsuarios(n){const l=await(await fetch(`https://sugerencias-ecuavisa.vercel.app/sugerencia/group/usuario?idSugerencia=${n}`)).json();this.listUsuariosG=l.data},async obtenerDatos(){const l=(await(await fetch("https://sugerencias-ecuavisa.vercel.app/all")).json()).data,o={};var h=[];l.forEach(d=>{const g=d.title,T=1;o[g]||(o[g]=0),o[g]+=T,h.push({title:g,value:d._id})}),this.listUsuarioFieles=h,Object.keys(o).map(d=>({title:d})).map(d=>({estado:d})).sort((d,g)=>g.title-d.title),this.datos=l},async handleSubmit(){try{const n=await Se.post("https://sugerencias-ecuavisa.vercel.app/add",this.suggestion);window.location.reload()}catch(n){console.error(n)}},async accionBackoffice(n){let i=z().format("DD/MM/YYYY HH:mm:ss").toString(),l=JSON.parse(localStorage.getItem("userData"));if(l.email!=="admin@demo.com"){var o=new Headers;o.append("Content-Type","application/json");var h=JSON.stringify({usuario:l.email,pagina:n,fecha:i}),u={method:"POST",headers:o,body:h,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",u).then(d=>{}).catch(d=>console.log("error",d))}},authorizedCheck(){let n=localStorage.getItem("role");n!=="administrador"&&n!=="webmaster"&&this.$router.push({path:"/pages/errors/not-authorized"})}}},Le=Object.assign($e,{__name:"index",setup(n){const i=x("tab-lista");return(l,o)=>{const h=pe("RouterLink");return S(),C("section",null,[a(P,null,{default:t(()=>[a($,{class:"mt-6",cols:"12",md:"12",lg:"12"},{default:t(()=>[a(me,{modelValue:_(i),"onUpdate:modelValue":o[0]||(o[0]=u=>L(i)?i.value=u:null),class:"v-tabs-pill"},{default:t(()=>[a(j,{value:"tab-lista"},{default:t(()=>[y("Listado")]),_:1}),a(j,{value:"tab-agregar"},{default:t(()=>[y("Estad\xEDsticas")]),_:1})]),_:1},8,["modelValue"]),a(fe,{class:"mt-5"},{default:t(()=>[a(J,null,{default:t(()=>[a(he,{modelValue:_(i),"onUpdate:modelValue":o[1]||(o[1]=u=>L(i)?i.value=u:null)},{default:t(()=>[a(A,{value:"tab-lista"},{default:t(()=>[p("div",Ce,[p("div",null,[l.usuarioFielModel?(S(),M(G,{key:0},{default:t(()=>[y("Lista de temas a sugerir para los usuarios de ecuavisa.com ")]),_:1})):_e("",!0),a(ve,null,{default:t(()=>[y(" Al sugerir un tema nuevo y habilitarlo, aparecer\xE1 en el \xE1rea de perfil del sitio ")]),_:1})])]),a(be,{lines:"two"},{default:t(()=>[(S(!0),C(R,null,H(l.datos,(u,d)=>(S(),M(ge,{key:d,border:""},{append:t(()=>[a(B,{color:u.estado==!0?"success":"warning",class:"mr-4"},{default:t(()=>[y(b(u.estado==!0?"Activo":"Inactivo"),1)]),_:2},1032,["color"]),a(B,{color:l.default,class:"mr-4"},{default:t(()=>[y(b(u.users_suscribed)+" Suscrito(s) ",1)]),_:2},1032,["color"]),a(h,{to:{name:"apps-sugerencias-slug-id",params:{id:u._id}},class:"font-weight-medium user-list-name"},{default:t(()=>[a(N,{variant:"text",rounded:"pill"},{default:t(()=>[a(ye,{icon:"mdi-pencil"})]),_:1})]),_:2},1032,["to"])]),default:t(()=>[a(we,null,{default:t(()=>[p("span",null,b(u.title),1)]),_:2},1024),a(xe,{class:"mt-1",color:"info"},{default:t(()=>[p("span",Ie,"Item N\xB0 "+b(d+1)+": "+b(u.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(A,{value:"tab-agregar"},{default:t(()=>[a(De)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Ne=de(Le,[["__scopeId","data-v-b83c974b"]]);export{Ne as default};
