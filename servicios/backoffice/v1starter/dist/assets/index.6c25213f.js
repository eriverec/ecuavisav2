import{R as J,U as W,r as n,Q as X,v as T,as as Z,o as h,x as _,a as l,w as d,q as V,t as i,f as ee,e as ae,g as se,h as F,b as s,aT as te,n as oe,b1 as le,p as A,a2 as Y,aW as re,F as B,C as j,u as C,aM as ne,N as de,a3 as ie,ao as L,ap as z,V as ue}from"./index.88d3c7f5.js";import{M as ce}from"./index.50982b4e.js";import{_ as pe}from"./datos.01e6e251.js";import{V as ve}from"./VSpacer.2a3e77c9.js";import{V as ge}from"./VPagination.9412c3b8.js";import"./VTooltip.2d0a8708.js";const me={class:"me-3 d-flex gap-4"},fe={class:"app-user-search-filter d-flex align-top"},he=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Nombre"),s("th",{scope:"col"},"Apellido"),s("th",{scope:"col"},"Email"),s("th",{scope:"col"},"Estado"),s("th",{scope:"col"},"Pagos"),s("th",{scope:"col"},"Pais"),s("th",{scope:"col"},"Ciudad"),s("th",{scope:"col"},"Fecha de suscripcion"),s("th",{scope:"col"},"Acciones")])],-1),_e={key:0},xe={class:"text-center",style:{width:"5rem"}},ye=s("tr",null,[s("td",{colspan:"9",class:"text-center"},"No hay datos que mostrar")],-1),be=[ye],Ve=s("tr",null,[s("td",{colspan:"9",class:"text-center"},"Cargando datos, por favor espere un momento...")],-1),Ce=[Ve],we={class:"text-sm text-disabled"},ke={__name:"index",setup(Ae){const m=J.exports.extendMoment(ce);m.locale("es",[W]),m.tz.setDefault("America/Guayaquil");const $=n(0),E=n([]),p=n([]),f=n(1),x=n(0),u=n(10),g=n(!1),y=n(!1),b=n(!1),w=n(""),v=n({message:"Datos guardados",type:"success",model:!1});async function N(a,t){const e=`https://ecuavisa-suscripciones.vercel.app/suscripciones/all?page=${a}&limit=${t}`,c=await(await fetch(e)).json();return c.resp?c:null}async function H(){g.value=!0;try{let a=[],t=1,e=!0;for(;e;){const r=await N(t,100);r&&r.data&&r.data.length>0?(a=[...a,...r.data],t++):e=!1}E.value=a,p.value=a,$.value=a.length,x.value=Math.ceil(a.length/u.value)}catch(a){console.error("Error al obtener los usuarios:",a),v.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0}}finally{g.value=!1}}function D(){y.value=!0;const a=w.value.toLowerCase();p.value=E.value.filter(t=>{if(t.user&&t.user.length>0){const e=t.user[0].first_name.toLowerCase(),r=t.user[0].last_name.toLowerCase();return e.includes(a)||r.includes(a)}return!1}),f.value=1,x.value=Math.ceil(p.value.length/u.value),y.value=!1}X(u,()=>{f.value=1,x.value=Math.ceil(p.value.length/u.value)});const I=T(()=>{const a=p.value.length?(f.value-1)*u.value+1:0,t=Math.min(a+u.value-1,p.value.length);return`Mostrando ${a} a ${t} de ${p.value.length} registros`}),M=T(()=>{const a=(f.value-1)*u.value,t=a+u.value;return p.value.slice(a,t)});Z(()=>{H()});const O={ex:"Exito",ak:"Alkosto",cd:"Codensa",sx:"Sodexo",ol:"Olimpica",ep:"EPM",csd:"Colsubsidio",bbva:"BBVA",cmr:"Falabella",cn:"Carnet",cs:"Credisensa",so:"Solidario",up:"Union Pay",el:"Elo",jc:"JCB",au:"Aura",hpc:"Hipercard",vi:"Visa",mc:"Mastercard",ax:"American Express",di:"Diners",dc:"Discover",ms:"Maestro"},P=a=>O[a]||a||"N/A",U={0:"Esperando para ser Pagada",1:"Se requiere verificaci\xF3n, por favor revise la secci\xF3n de Verificar",2:"Pagada Parcialmente",3:"Pagada",4:"En Disputa",5:"Sobrepagada",6:"Fraude",7:"Reverso",8:"Contracargo",9:"Rechazada por el procesador",10:"Error en el sistema",11:"Fraude detectado por Nuvei",12:"Blacklist de Nuvei",13:"Tiempo de tolerancia",14:"Expirada por Nuvei",15:"Expirado por el carrier",16:"Rechazado por Nuvei",17:"Abandonada por Nuvei",18:"Abandonada por el cliente",19:"C\xF3digo de autorizaci\xF3n invalido",20:"C\xF3digo de autorizaci\xF3n expirado",21:"Fraude Nuvei - Reverso pendiente",22:"AuthCode Inv\xE1lido - Reverso pendiente",23:"AuthCode Expirado - Reverso pendiente",24:"Fraude Nuvei - Reverso solicitado",25:"AuthCode Inv\xE1lido - Reverso solicitado",26:"AuthCode Expirado - Reverso solicitado",27:"Comercio - Reverso pendiente",28:"Comercio - Reverso solicitado",29:"Anulada",30:"Transacci\xF3n asentada (solo para Ecuador)",31:"Esperando OTP",32:"OTP validado correctamente",33:"OTP no validado",34:"Reverso parcial",35:"M\xE9todo 3DS solicitado, esperando para continuar",36:"Desaf\xEDo 3DS solicitado, esperando el CRES",37:"Rechazada por 3DS",47:"Validaci\xF3n de CPF fallida",48:"Autenticado por 3DS"};async function q(){let a=[],t=1,e=!0;for(;e;){const r=await N(t,100);r&&r.data&&r.data.length>0?(a=[...a,...r.data],t++):e=!1}return a}async function K(){try{b.value=!0;const a=await q();let e=["ID","Nombre","Apellido","Email","Estado","Pagos","Pa\xEDs","Ciudad","Fecha de suscripcion","Hora de suscripcion"].join(",")+`
`;a.forEach(o=>{var R,S;const Ne=new Date(o.created_at).toISOString().replace("T"," ").substr(0,19),Q=o.pagos_tarjetas.map(k=>`${k.card_details.bank_name||"N/A"} (${P(k.card_details.type)||"N/A"})`).join(" - "),G=[o._id,o.user&&o.user.length>0?o.user[0].first_name:"N/A",o.user&&o.user.length>0?(R=o.user)==null?void 0:R[0].last_name:"N/A",o.user&&o.user.length>0?(S=o.user)==null?void 0:S[0].email:"N/A",U[o.estado]||"Estado desconocido",Q,o.billing_details.pais,o.billing_details.ciudad,m(o.billing_details.created_at).format("DD/MM/YYYY"),m(o.billing_details.created_at).format("HH:mm:ss")];e+=G.join(",")+`
`});const r=new Blob([e],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");if(c.download!==void 0){const o=URL.createObjectURL(r);c.setAttribute("href",o),c.setAttribute("download",`usuarios_suscritos_${m().format("YYYYMMDD_HHmmss")}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}v.value={message:"Exportaci\xF3n completada con \xE9xito.",type:"success",model:!0}}catch(a){console.error("Error al exportar datos:",a),v.value={message:"Error al exportar datos. Por favor, intente de nuevo.",type:"error",model:!0}}finally{b.value=!1}}return(a,t)=>(h(),_("section",null,[l(pe),l(ee,{modelValue:v.value.model,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value.model=e),location:"top end",variant:"flat",timeout:v.value.timeout||2e3,color:v.value.type},{default:d(()=>[V(i(v.value.message),1)]),_:1},8,["modelValue","timeout","color"]),l(ue,null,{default:d(()=>[l(ae,{cols:"12",sm:"12",lg:"12"},{default:d(()=>[l(se,{title:"Listado de Usuarios Suscritos"},{default:d(()=>[l(F,{class:"d-flex py-4 gap-4 flex-wrap",style:{"align-items":"flex-start"}},{default:d(()=>[s("div",me,[l(te,{class:"bg-white",modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"]),l(oe,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),label:"Buscar por nombre o apellido","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",onKeyup:le(D,["enter"]),style:{width:"300px"}},null,8,["modelValue","onKeyup"]),l(A,{color:"primary",loading:y.value,disabled:y.value||g.value,onClick:D},{default:d(()=>[V(" Buscar ")]),_:1},8,["loading","disabled"])]),l(ve),s("div",fe,[l(A,{loading:b.value,disabled:b.value||g.value,variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:K},{default:d(()=>[V(" Exportar datos ")]),_:1},8,["loading","disabled"])])]),_:1}),l(Y),l(re,{class:"text-no-wrap"},{default:d(()=>[he,g.value?ie("",!0):(h(),_("tbody",_e,[(h(!0),_(B,null,j(C(M),e=>(h(),_("tr",{key:e._id,style:{height:"3.75rem"}},[s("td",null,i(e.user&&e.user.length>0?e.user[0].first_name:"N/A"),1),s("td",null,i(e.user&&e.user.length>0?e.user[0].last_name:"N/A"),1),s("td",null,i(e.user&&e.user.length>0?e.user[0].email:"N/A"),1),s("td",null,[l(ne,{color:e.estado=="3"?"success":"error"},{default:d(()=>[V(i(U[e.estado]||"Estado desconocido"),1)]),_:2},1032,["color"])]),s("td",null,[s("ul",null,[(h(!0),_(B,null,j(e.pagos_tarjetas,r=>(h(),_("li",{style:{"list-style":"circle"},key:r.transaction.transaction_id},i(r.card_details.bank_name||"N/A")+" ("+i(P(r.card_details.type))+") ",1))),128))])]),s("td",null,i(e.billing_details.pais),1),s("td",null,i(e.billing_details.ciudad),1),s("td",null,i(C(m)(e.billing_details.created_at).format("DD/MM/YYYY HH:mm:ss")),1),s("td",xe,[l(A,{icon:"",size:"x-small",color:"default",variant:"text",to:{name:"apps-user-view-id",params:{id:e.user&&e.user.length>0?e.user[0].wylexId:"0"}}},{default:d(()=>[l(de,{size:"22",icon:"tabler-eye"})]),_:2},1032,["to"])])]))),128))])),L(s("tfoot",null,be,512),[[z,!C(M).length&&!g.value]]),L(s("tfoot",null,Ce,512),[[z,g.value]])]),_:1}),l(Y),l(F,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:d(()=>[s("span",we,i(C(I)),1),l(ge,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=e=>f.value=e),size:"small","total-visible":5,length:x.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{ke as default};
