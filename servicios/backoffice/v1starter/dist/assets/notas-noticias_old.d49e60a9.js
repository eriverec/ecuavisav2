import{M as Ae,R as Be,S as Ee,U as ze,r as f,v as de,bA as ae,bB as Le,as as $e,Q as Je,o as Y,c as N,w as i,a as n,e as E,g as te,aQ as z,b as o,bC as je,u,i as le,aR as L,q as b,b2 as fe,t as h,h as $,x as M,a3 as Qe,n as qe,p as k,aW as me,F as J,C as j,L as he,bD as ve,ao as pe,ap as _e,N as Ye,V as We,bE as Ge,aX as Xe,bd as Ze,be as Ke}from"./index.88d3c7f5.js";import{V as De,a as be}from"./VTimelineItem.36b36f8a.js";const C=H=>(Ze("data-v-6dbe1795"),H=H(),Ke(),H),ea={class:"d-flex"},aa={class:"descripcion"},ta={class:"bg-ecuavisa py-2"},la={class:"date-picker-wrapper",style:{width:"250px"}},sa={key:0,class:"date-picker-wrapper",style:{width:"300px",display:"none"}},oa={style:{width:"20rem"}},na=C(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),o("th",{scope:"col"},"VISITAS")])],-1)),ia=["onClick"],ra={class:"text-medium-emphasis"},ca={class:"d-flex align-center justify-space-between botonescurrentPage",id:"target"},ua={style:{display:"flex","flex-wrap":"wrap"}},da={style:{width:"max-content"}},fa={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},ma=C(()=>o("thead",null,[o("tr",null,[o("th",{scope:"col"},"Nombre"),o("th",{scope:"col"},"Fecha"),o("th",{scope:"col"},"Cantidad"),o("th",{scope:"col"},"Hora")])],-1)),ha=["onClick"],va={class:"text-high-emphasis"},pa={class:"text-medium-emphasis"},_a={class:"text-medium-emphasis"},Ya={class:"text-medium-emphasis"},Da={class:"d-flex justify-space-between align-center flex-wrap"},ba={class:"text-base font-weight-semibold me-1"},ga={class:"mb-0"},ya={style:{"font-size":"12px",display:"block","margin-bottom":"10px"}},wa=C(()=>o("br",null,null,-1)),Ma={class:"mb-1"},xa=C(()=>o("span",null,"Heathrow Airport, London",-1)),Fa=C(()=>o("p",{class:"mb-2"}," 6:30 AM ",-1)),Va={href:"#",class:"d-flex align-center"},Ca=C(()=>o("h6",{class:"text-primary font-weight-semibold text-sm"}," booking-card.pdf ",-1)),Sa={__name:"notas-noticias_old",setup(H){const g=Be.exports.extendMoment(Ee);g.locale("es",[ze]);const O=f(""),T=f(""),P=f(""),x=f(!1),R=f([]),y=f([]),_=f(1),U=8,Q=f([]),se=de(()=>y.value.length),q=f(""),W=f([]),G=f(!1),oe=f([]),ge=f(""),X=f([]),A=f(!1),ne=f(""),w=f(""),ie=f(null),re=f(null),ce=f(g().format("DD/MM/YYYY HH:mm:ss").toString()),Z=f(JSON.parse(localStorage.getItem("userData"))),K=ae(),B=f({i:K.i,f:K.f,title:K.title}),F=f("Hoy"),ye=Le();async function ee(l="",t=""){x.value=!0;const r=[];var e=new Headers;e.append("Content-Type","application/json");var d=JSON.stringify({fechai:l,fechaf:t}),v={method:"POST",headers:e,body:d,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/seccion/full/Noticias",v).then(a=>a.json()).then(a=>{let s=Array.from(a.data);s.forEach(c=>{Q.value.push(c)});for(const c of s)for(const m of c.navigationRecord){let p={title:m.title,url:m.url};r.push(p)}}).catch(a=>{console.error(a)});const D=r.reduce((a,s)=>{var c=a.findIndex(m=>m.title==s.title||m.url==s.url);return c===-1?a.push({url:s.url,title:s.title,count:1}):a[c].count++,a},[]);R.value=Array.from(D),R.value.sort((a,s)=>s.count-a.count),y.value=Array.from(D),y.value.sort((a,s)=>s.count-a.count),x.value=!1}async function we(l){try{if(l.length>1){_.value=1;let t=g(l[0]).format("MM/DD/YYYY"),r=g(l[1]).format("MM/DD/YYYY");O.value=t,T.value=r,await ee(t,r)}}catch(t){console.error(t)}}const Me=de(()=>{const l=(_.value-1)*U,t=l+U;return y.value.slice(l,t)}),xe=()=>{_.value*U<y.value.length&&_.value++},Fe=()=>{_.value>1&&_.value--},Ve=()=>{P.value=O.value+" a "+T.value};async function ue(l){if(Z.value.email!=="admin@demo.com"){var t=new Headers;t.append("Content-Type","application/json");var r=JSON.stringify(l),e={method:"POST",headers:t,body:r,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",e).then(d=>{}).catch(d=>console.log("error",d))}}$e(async()=>{let l=ae(F.value);B.value={i:l.i,f:l.f,title:l.title},_.value=1;let t=l.i.format("MM/DD/YYYY"),r=l.f.format("MM/DD/YYYY");O.value=t,T.value=r,Ve(),await ee(t,r),await ue({usuario:Z.value.email,pagina:"trazabilidad-visitas-list-notasNoticias",fecha:ce.value})});const Ce=()=>{if(w.value!==""){_.value=1;const l=w.value.endsWith("/")?w.value.replace(/\/$/,"").trim():w.value.trim(),t=R.value.filter(r=>r.url.trim().includes(l));y.value=t}},Se=()=>{_.value=1,w.value="",A.value=!1,G.value=!1,y.value=R.value},Ie=l=>{q.value=l,ie.value=l,A.value=!1,setTimeout(()=>{document.getElementById("target").scrollIntoView({behavior:"smooth"})},100);const t=Q.value.map(({first_name:a,last_name:s,navigationRecord:c})=>({first_name:a,last_name:s,navigationRecord:c})),r=[];for(let a of t)for(let s of a.navigationRecord)if(s.title===l||s.url===l){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],d=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let c=g(s.fecha,e,!0).format("DD/MM/YYYY"),m=s.hora.split(":");if(m[2].indexOf(" ")>=0){let I=m[2].split(" ");m[2]=I[0]}let p=m[0]+":"+m[1]+":"+m[2],V=c+" "+p,S=g(V,d,!0).format();if(a.first_name!==void 0&&a.last_name!==void 0&&a.first_name!==null&&a.last_name!==null&&a.first_name!==""&&a.last_name!==""){let I={first_name:a.first_name,last_name:a.last_name,url:s.url,title:s.title,fecha:c,fechaRaw:s.fecha,fullFecha:S,hora:p,horaRaw:s.hora};r.push(I)}}let v={};r.forEach(a=>{let s=a.first_name+"-"+a.last_name;v.hasOwnProperty(s)?(new Date(a.fullFecha)>new Date(v[s].fullFecha)&&(v[s]=a),v[s].cantidad=(v[s].cantidad||1)+1):(a.cantidad=1,v[s]=a)});let D=Object.values(v);D.sort((a,s)=>{var c=new Date(a.fullFecha),m=new Date(s.fullFecha);return m-c}),W.value=D.slice(0,25),oe.value=W.value.map(({first_name:a,last_name:s,fecha:c,hora:m,cantidad:p,title:V,url:S})=>({first_name:a,last_name:s,fecha:c,hora:m,cantidad:p,title:V,url:S})),G.value=!0,ge.value=l};function Ne(l){for(var t=typeof l!="object"?JSON.parse(l):l,r="",e=0;e<t.length;e++){var d="";for(var v in t[e])d!=""&&(d+=","),d+=t[e][v];r+=d+`\r
`}return r}function ke(l,t,r){l&&t[0].wylexId!=="wylexId"&&t.unshift(l);var e=JSON.stringify(t),d=Ne(e),v=r+".csv"||"export.csv",D=new Blob([d],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(D,v);else{var a=document.createElement("a");if(a.download!==void 0){var s=URL.createObjectURL(D);a.setAttribute("href",s),a.setAttribute("download",v),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}async function He(){let l={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},t=[];t=Array.from(oe.value);let r="noticias_ultimos_usuarios_"+q.value.replace(/[^A-Z0-9]+/ig,"_");await ue({usuario:Z.value.email,pagina:"trazabilidad-visitas-list-notasNoticias",accion:"export",fecha:ce.value}),ke(l,t,r)}function Oe(l){const t={};return l.forEach((e,d)=>{t.hasOwnProperty(e.title)?t[e.title].data.push(e):t[e.title]={title:e.title,url:e.url,fecha:e.fecha,hora:e.hora,data:[e]}}),Object.values(t)}const Te=(l,t)=>{re.value=l;const r=Q.value.map(({first_name:a,last_name:s,navigationRecord:c})=>({first_name:a,last_name:s,navigationRecord:c})),e=[];ne.value=l+" "+t;let d=l+" "+t;for(let a of r)if(a.first_name+" "+a.last_name==d)for(let c of a.navigationRecord){var v=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],D=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let m=g(c.fecha,v,!0).format("DD/MM/YYYY"),p=c.hora.split(":");if(p[2].indexOf(" ")>=0){let Ue=p[2].split(" ");p[2]=Ue[0]}let V=p[0]+":"+p[1]+":"+p[2],S=m+" "+V,I=g(S,D,!0).format(),Re={first_name:a.first_name,last_name:a.last_name,url:c.url,title:c.title,fecha:m,fechaRaw:c.fecha,fullFecha:I,hora:V};e.push(Re)}e.sort((a,s)=>{var c=new Date(s.fullFecha),m=new Date(a.fullFecha);return m-c}),X.value=Oe(e),A.value=!0};var Pe=function(l,t){const r=JSON.stringify(X.value),e=JSON.parse(r);if(l){if(t==e.length-1)return"";const d=e[t*1+1];return Ge(`${d.fecha} ${d.hora}`,l,e[t*1])}else return null};return Je(async()=>F.value,async()=>{x.value=!0;let l=ae(F.value);B.value={i:l.i,f:l.f,title:l.title};let t=l.i.format("MM/DD/YYYY"),r=l.f.format("MM/DD/YYYY");O.value=t,T.value=r,await ee(t,r)}),(l,t)=>{const r=Xe;return Y(),N(We,null,{default:i(()=>[n(E,{lg:"12",cols:"12"},{default:i(()=>[n(te,null,{default:i(()=>[n(z,{class:"header_card_item"},{append:i(()=>[o("div",ta,[o("div",la,[n(je,{disabled:u(x),modelValue:u(F),"onUpdate:modelValue":t[0]||(t[0]=e=>le(F)?F.value=e:null),items:u(ye),variant:"outlined",label:"Fecha","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])])]),default:i(()=>[o("div",ea,[o("div",aa,[n(L,null,{default:i(()=>[b("P\xE1ginas m\xE1s vistas")]),_:1}),n(fe,null,{default:i(()=>[b("Un total de "+h(u(se))+" registros, mostrando data desde "+h(u(B).i.format("YYYY-MM-DD"))+" hasta "+h(u(B).f.format("YYYY-MM-DD")),1)]),_:1})])])]),_:1}),n($,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:i(()=>[n(z,{class:"pb-sm-0",style:{display:"none"}},{default:i(()=>[n(L,null,{default:i(()=>[b("P\xE1ginas m\xE1s vistas")]),_:1}),n(fe,null,{default:i(()=>[b("Un total de "+h(u(se))+" registros",1)]),_:1})]),_:1}),u(x)?Qe("",!0):(Y(),M("div",sa,[n(r,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:u(P),"onUpdate:modelValue":t[1]||(t[1]=e=>le(P)?P.value=e:null),"show-current":"true",onOnChange:we,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),n(E,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:i(()=>[o("div",oa,[n(qe,{modelValue:u(w),"onUpdate:modelValue":t[2]||(t[2]=e=>le(w)?w.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),n(k,{"prepend-icon":"tabler-search",onClick:Ce},{default:i(()=>[b(" Buscar ")]),_:1}),n(k,{onClick:Se},{default:i(()=>[b(" Reiniciar ")]),_:1})]),_:1})]),_:1}),u(x)?(Y(),N($,{key:0},{default:i(()=>[b("Cargando datos...")]),_:1})):(Y(),N($,{key:1},{default:i(()=>[n(me,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[na,o("tbody",null,[(Y(!0),M(J,null,j(u(Me),e=>(Y(),M("tr",{class:he(["clickable",{active:e.title===u(ie)}]),onClick:d=>Ie(e.title||e.url)},[o("td",null,h(e.title?e.title:e.url),1),o("td",ra,h(e.count),1)],10,ia))),256))])]),_:1}),o("div",ca,[n(k,{icon:"tabler-arrow-big-left-lines",onClick:Fe,disabled:u(_)===1},null,8,["disabled"]),b(" P\xE1gina "+h(u(_))+" ",1),n(k,{icon:"tabler-arrow-big-right-lines",onClick:xe,disabled:u(_)*U>=u(y).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),n(E,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(ve,null,{default:i(()=>[pe(n(te,null,{default:i(()=>[n(z,{class:"pb-sm-0"},{default:i(()=>[o("div",ua,[o("div",da,[n(L,null,{default:i(()=>[b("\xDAltimas visitas a la p\xE1gina "+h(u(q)),1)]),_:1})]),o("div",fa,[n(k,{color:"success",onClick:He},{default:i(()=>[b(" Exportar ")]),_:1})])]),n(me,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[ma,o("tbody",null,[(Y(!0),M(J,null,j(u(W),e=>(Y(),M("tr",{key:e.first,class:he(["clickable",{active:e.first_name===u(re)}]),onClick:d=>Te(e.first_name,e.last_name,e.first)},[o("td",va,h(e.first_name)+" "+h(e.last_name),1),o("td",pa,h(e.fecha),1),o("td",_a,h(e.cantidad),1),o("td",Ya,h(e.hora),1)],10,ha))),128))])]),_:1})]),_:1})]),_:1},512),[[_e,u(G)]])]),_:1})]),_:1}),n(E,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(ve,null,{default:i(()=>[pe(n(te,null,{default:i(()=>[n(z,null,{default:i(()=>[n(L,null,{default:i(()=>[b("Actividad del usuario "+h(u(ne)),1)]),_:1})]),_:1}),n($,null,{default:i(()=>[n(De,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:i(()=>[(Y(!0),M(J,null,j(u(X),(e,d)=>(Y(),N(be,{"dot-color":"primary",size:"x-small"},{default:i(()=>[o("div",Da,[o("h4",ba,h(e.title||e.url),1)]),o("p",ga,h(e.fecha)+" "+h(e.hora),1),o("span",ya,h(u(Pe)(`${e.fecha} ${e.hora}`,d)),1),wa,n(De,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact"},{default:i(()=>[(Y(!0),M(J,null,j(e.data,(v,D)=>(Y(),N(be,{"dot-color":"info",size:"x-small"},{default:i(()=>[o("p",Ma,[o("span",null,h(v.fecha)+" "+h(v.hora),1),n(Ye,{size:"20",icon:"tabler-arrow-right",class:"mx-2"}),xa]),Fa,o("a",Va,[n(Ye,{color:"primary",icon:"tabler-link",size:"18",class:"me-1"}),Ca])]),_:2},1024))),256))]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[_e,u(A)]])]),_:1})]),_:1})]),_:1})}}},ka=Ae(Sa,[["__scopeId","data-v-6dbe1795"]]);export{ka as default};
