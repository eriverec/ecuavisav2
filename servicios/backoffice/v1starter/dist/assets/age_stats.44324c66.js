import{M as j,r as d,Q as x,as as B,o as f,x as v,b as y,a as n,w as h,N as w,q as k,p as $,a$ as N,c as z,u as A,bx as F,bb as R,bd as q,be as L}from"./index.88d3c7f5.js";import{V as M}from"./VTooltip.2d0a8708.js";const S=p=>(q("data-v-42227e8a"),p=p(),L(),p),O={class:"stats-container"},P={class:"d-flex align-center justify-space-between mb-6"},U=S(()=>y("div",{class:"date-picker-wrapper",style:{width:"calc(100% - 48px)"}},null,-1)),W={class:"d-flex justify-center align-center gap-6 mb-6"},Q={key:0,class:"text-center py-8"},Y=S(()=>y("div",{class:"mt-4"},"Cargando estad\xEDsticas...",-1)),G={key:1},H={key:1,class:"text-center py-8"},J={__name:"age_stats",props:{campaignId:{type:String,required:!0},dateRange:{type:Object,required:!0}},emits:["loading"],setup(p,{emit:C}){const s=p,m=d(!1),_=d(!1),l=d(!0),r=d(!0),I={preview:"#B8A5FF",click:"#8471CE"},b=e=>{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},D=new Date;d({start:b(D),end:b(D)});const c=d({series:[],options:{chart:{type:"bar",height:300,toolbar:{show:!1},stacked:!0,background:"transparent"},plotOptions:{bar:{borderRadius:4,horizontal:!1,columnWidth:"40%"}},colors:[I.preview,I.click],dataLabels:{enabled:!0,style:{colors:["#666666"]},formatter:function(e){return e}},xaxis:{categories:[],labels:{rotate:-45,trim:!1,style:{colors:"#666666"}}},yaxis:{labels:{style:{colors:"#666666"}},title:{text:"Total de Interacciones",style:{color:"#666666",fontFamily:"Public Sans, sans-serif",fontSize:"15px"}}},fill:{opacity:1},tooltip:{y:{formatter:function(e){return e+" interacciones"}}},legend:{show:!1},theme:{mode:"dark"}}}),V=e=>{const a=e.map(i=>i.rango),o=[];return r.value&&o.push({name:"Impresiones",data:e.map(i=>i.byType.preview)}),l.value&&o.push({name:"Clicks",data:e.map(i=>i.byType.click)}),{categories:a,series:o}},g=async()=>{m.value=!0,C("loading",!0);try{const e=await R.get(`https://ads-service.vercel.app/grafico/stats-edades/${s.campaignId}`,{params:{fechai:s.dateRange.start,fechaf:s.dateRange.end,page:1,limit:5e5}});if(e.data.resp&&e.data.data){const{categories:a,series:o}=V(e.data.data);c.value={...c.value,series:o,options:{...c.value.options,xaxis:{...c.value.options.xaxis,categories:a}}}}}catch(e){console.error("Error fetching age stats:",e)}finally{m.value=!1,C("loading",!1)}},E=async()=>{_.value=!0;try{const e=await R.get(`https://ads-service.vercel.app/grafico/stats-edades/btn-descargar/${s.campaignId}`,{params:{fechai:s.dateRange.start,fechaf:s.dateRange.end,page:1,limit:5e5}});if(e.data.resp&&e.data.data){const a=[];a.push(["Rango de Edad","Tipo","ID Wylex","Nombre","Apellido","Tel\xE9fono","Email","Fecha de Nacimiento","Edad","Total"].join(",")),e.data.data.forEach(t=>{a.push([`"${t.rango}"`,`"${t.type}"`,`"${t.user.wylexId}"`,`"${t.user.first_name||""}"`,`"${t.user.last_name||""}"`,`"${t.user.phone_number||""}"`,`"${t.user.email||""}"`,`"${t.user.birth_date||""}"`,`"${t.edad}"`,t.total].join(","))});const o=a.join(`
`),i=new Blob([o],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),T=b(new Date);u.href=URL.createObjectURL(i),u.setAttribute("download",`stats_edades_${T}.csv`),document.body.appendChild(u),u.click(),document.body.removeChild(u)}}catch(e){console.error("Error al descargar los datos:",e)}finally{_.value=!1}};return x(()=>s.campaignId,e=>{e&&g()},{immediate:!0}),x(()=>s.dateRange,e=>{e&&g()},{deep:!0}),x([l,r],()=>{if(!l.value&&!r.value){r.value=!0;return}g()}),B(()=>{s.campaignId&&g()}),(e,a)=>(f(),v("div",O,[y("div",P,[U,n($,{icon:"",variant:"text",size:"large",loading:_.value,onClick:E,class:"download-btn"},{default:h(()=>[n(w,{icon:"tabler-download",size:"24",color:"grey-darken-1"}),n(M,{activator:"parent",location:"top"},{default:h(()=>[k("Descargar datos")]),_:1})]),_:1},8,["loading"])]),y("div",W,[n($,{variant:"text",color:l.value?"primary":"grey",onClick:a[0]||(a[0]=o=>l.value=!l.value),class:"filter-btn"},{default:h(()=>[n(w,{icon:l.value?"tabler-mouse-filled":"tabler-mouse",size:"20",class:"me-2"},null,8,["icon"]),k(" Clicks ")]),_:1},8,["color"]),n($,{variant:"text",color:r.value?"primary":"grey",onClick:a[1]||(a[1]=o=>r.value=!r.value),class:"filter-btn"},{default:h(()=>[n(w,{icon:r.value?"tabler-eye-filled":"tabler-eye",size:"20",class:"me-2"},null,8,["icon"]),k(" Impresiones ")]),_:1},8,["color"])]),m.value?(f(),v("div",Q,[n(N,{indeterminate:"",color:"primary"}),Y])):(f(),v("div",G,[c.value.series.length>0?(f(),z(A(F),{key:0,options:c.value.options,series:c.value.series,height:300,width:"100%"},null,8,["options","series"])):(f(),v("div",H," No hay datos disponibles para el per\xEDodo seleccionado "))]))]))}},Z=j(J,[["__scopeId","data-v-42227e8a"]]);export{Z as default};
