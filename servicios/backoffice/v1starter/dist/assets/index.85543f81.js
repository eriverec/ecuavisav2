import{R,U as S,r as o,Q as $,v as N,as as E,o as m,x as g,a as l,w as i,e as F,g as I,aR as K,N as C,h as M,b as s,aT as j,n as Q,b1 as G,p as D,q as W,a2 as A,aW as H,F as J,C as O,u as x,t as h,a3 as X,ao as k,ap as B,V as Y}from"./index.88d3c7f5.js";import{M as Z}from"./index.50982b4e.js";import{V as ee}from"./VSpacer.2a3e77c9.js";import{V as ae}from"./VPagination.9412c3b8.js";const se=s("span",{class:"text-primary"},"Ver dispositivos",-1),te=s("span",{class:"text-medium-emphasis"}," de usuarios suscritos",-1),le={class:"me-3 d-flex gap-4"},oe=s("div",{class:"app-user-search-filter d-flex align-top"},null,-1),re=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Nombre"),s("th",{scope:"col"},"Apellido"),s("th",{scope:"col"},"Email"),s("th",{scope:"col"},"Ver dispositivos")])],-1),ne={key:0},ue={class:"text-center",style:{width:"5rem"}},ie=s("tr",null,[s("td",{colspan:"4",class:"text-center"},"No hay datos que mostrar")],-1),ce=[ie],de=s("tr",null,[s("td",{colspan:"4",class:"text-center"},"Cargando datos, por favor espere un momento...")],-1),pe=[de],ve={class:"text-sm text-disabled"},xe={__name:"index",setup(fe){const y=R.exports.extendMoment(Z);y.locale("es",[S]),y.tz.setDefault("America/Guayaquil");const L=o(0),V=o([]),r=o([]),c=o(1),p=o(0),n=o(10),d=o(!1),v=o(!1);o(!1);const _=o(""),P=o({message:"Datos guardados",type:"success",model:!1});async function T(t,a){const e=`https://ecuavisa-suscripciones.vercel.app/suscripciones/all?page=${t}&limit=${a}`,f=await(await fetch(e)).json();return f.resp?f:null}async function q(){d.value=!0;try{let t=[],a=1,e=!0;for(;e;){const u=await T(a,100);u&&u.data&&u.data.length>0?(t=[...t,...u.data],a++):e=!1}V.value=t,r.value=w(t),L.value=r.value.length,p.value=Math.ceil(r.value.length/n.value)}catch(t){console.error("Error al obtener los usuarios:",t),P.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0}}finally{d.value=!1}}function w(t){const a=new Map;return t.forEach(e=>{if(e.user&&e.user.length>0){const u=e.user[0].email;a.has(u)||a.set(u,e)}}),Array.from(a.values())}function b(){v.value=!0;const t=_.value.toLowerCase(),a=V.value.filter(e=>{if(e.user&&e.user.length>0){const u=e.user[0].first_name.toLowerCase(),f=e.user[0].last_name.toLowerCase();return u.includes(t)||f.includes(t)}return!1});r.value=w(a),c.value=1,p.value=Math.ceil(r.value.length/n.value),v.value=!1}$(n,()=>{c.value=1,p.value=Math.ceil(r.value.length/n.value)});const z=N(()=>{const t=r.value.length?(c.value-1)*n.value+1:0,a=Math.min(t+n.value-1,r.value.length);return`Mostrando ${t} a ${a} de ${r.value.length} registros`}),U=N(()=>{const t=(c.value-1)*n.value,a=t+n.value;return r.value.slice(t,a)});return E(()=>{q()}),(t,a)=>(m(),g("section",null,[l(Y,null,{default:i(()=>[l(F,{cols:"12",sm:"12",lg:"12"},{default:i(()=>[l(I,{style:{padding:"25px"}},{default:i(()=>[l(K,null,{default:i(()=>[l(C,{icon:"tabler-devices",color:"primary",size:"24",class:"me-2"}),se,te]),_:1}),l(M,{class:"d-flex py-4 gap-4 flex-wrap",style:{"align-items":"flex-start"}},{default:i(()=>[s("div",le,[l(j,{class:"bg-white",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"]),l(Q,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),label:"Buscar por nombre o apellido","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",onKeyup:G(b,["enter"]),style:{width:"300px"}},null,8,["modelValue","onKeyup"]),l(D,{color:"primary",loading:v.value,disabled:v.value||d.value,onClick:b},{default:i(()=>[W(" Buscar ")]),_:1},8,["loading","disabled"])]),l(ee),oe]),_:1}),l(A),l(H,{class:"text-no-wrap"},{default:i(()=>[re,d.value?X("",!0):(m(),g("tbody",ne,[(m(!0),g(J,null,O(x(U),e=>(m(),g("tr",{key:e._id,style:{height:"3.75rem"}},[s("td",null,h(e.user&&e.user.length>0?e.user[0].first_name:"N/A"),1),s("td",null,h(e.user&&e.user.length>0?e.user[0].last_name:"N/A"),1),s("td",null,h(e.user&&e.user.length>0?e.user[0].email:"N/A"),1),s("td",ue,[l(D,{icon:"",size:"x-small",color:"default",variant:"text",to:{name:"apps-suscriptores-userdevice-id",params:{id:e.user&&e.user.length>0?e.user[0].wylexId:"0"}}},{default:i(()=>[l(C,{size:"22",icon:"tabler-devices"})]),_:2},1032,["to"])])]))),128))])),k(s("tfoot",null,ce,512),[[B,!x(U).length&&!d.value]]),k(s("tfoot",null,pe,512),[[B,d.value]])]),_:1}),l(A),l(M,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:i(()=>[s("span",ve,h(x(z)),1),l(ae,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),size:"small","total-visible":5,length:p.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1})]))}};export{xe as default};
