import{R as momentRange,S as hooks,U as esLocale,M as _export_sfc,bx as VueApexCharts,ak as useTheme,bP as hexToRgb,z as resolveComponent,o as openBlock,x as createElementBlock,a as createVNode,w as withCtx,e as VCol,bF as VBtnToggle,F as Fragment,C as renderList,c as createBlock,p as VBtn,q as createTextVNode,t as toDisplayString,aT as VSelect,b as createBaseVNode,V as VRow,ao as withDirectives,ap as vShow,h as VCardText,L as normalizeClass,aX as _sfc_main$2,g as VCard,aQ as VCardItem,aR as VCardTitle,b2 as VCardSubtitle,a2 as VDivider,aW as VTable,X as VAvatar,N as VIcon,a3 as createCommentVNode,bD as VExpandTransition,a4 as logAction}from"./index.88d3c7f5.js";import{V as VTimeline,a as VTimelineItem}from"./VTimelineItem.36b36f8a.js";const ChartDispositivosExtra_vue_vue_type_style_index_0_lang="",moment$1=momentRange.exports.extendMoment(hooks);moment$1.locale("es",[esLocale]);const _sfc_main$1={components:{VueApexCharts},emits:["activityData"],setup(){const t=useTheme().current.value,s=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["medium-emphasis-opacity"]})`,o=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["disabled-opacity"]})`,a=`rgba(${hexToRgb(String(t.variables["border-color"]))},${t.variables["border-opacity"]})`,l=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:s,themeDisabledTextColor:o,themeBorderColor:a,themePrimaryTextColor:l}},data(){return{fechai:"",fechaf:"",fechaiN:"",fechafN:"",getDataFetch:[],dataOnlyGrafico:[],dataFormateada:[],getData:[],visita:!0,isLoading:!0,preguntas:[],preguntasData:[],preguntasConCount:[],params:{},trivias:[],dateRangeModel:null,chartList:[],series:[],chartOptions:{series:[],labels:[]},itemActividad:[{title:"Por sesi\xF3n",value:"sesion"},{title:"Por p\xE1ginas vistas",value:"visita"}],itemDispositivos:[{title:"Movil",value:"movil"},{title:"Desktop",value:"desktop"}],itemOs:[{title:"Windows",value:"Windows"},{title:"Mac OS",value:"Mac OS"},{title:"Linux",value:"Linux"},{title:"Android",value:"Android"},{title:"Todos",value:"todos"}],itemBrowser:[{title:"Chrome",value:"Chrome"},{title:"Safari",value:"Safari"},{title:"Firefox",value:"Firefox"},{title:"Todos",value:"todos"}],selectedActividad:"sesion",selectedDispositivo:"",selectedOs:"todos",selectedBrowser:"todos",fechaIngesada:"",activityData:[],filtrosDispositivos:[],filtroSelected:{},btnFiltros:"",filtroDefault:{}}},computed:{chartConfig(){var r=useTheme(),t=r.current.value,s=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["medium-emphasis-opacity"]})`,o=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["disabled-opacity"]})`,a=`rgba(${hexToRgb(String(t.variables["border-color"]))},${t.variables["border-opacity"]})`,l=`rgba(${hexToRgb(t.colors["on-surface"])},${t.variables["high-emphasis-opacity"]})`;this.themeSecondaryTextColor=s,this.themeDisabledTextColor=o,this.themeBorderColor=a,this.themePrimaryTextColor=l;const h={series3:"#e0cffe",series2:"#b992fe",series1:"#ab7efd"};return{visita:this.visita,chart:{id:"crejemplo",parentHeightOffset:0,zoom:{enabled:!1},toolbar:{show:!1},animations:{enabled:!0,easing:"easeinout",speed:300}},tooltip:{shared:!1,enabled:!0,custom:function({series:f,seriesIndex:d,dataPointIndex:m,w:u}){var n=f[d][m],c=u.config.visita?"Sesiones":"P\xE1ginas visitadas";return n<2&&(c=u.config.visita?"Sesi\xF3n":"P\xE1gina visitada"),'<div class="custom-tooltip"><span class="title">D\xEDa:</span><span class="value">'+u.globals.categoryLabels[m]+'</span><br><span class="value">'+n+" "+c+"</span></div>"},style:{fontSize:"12px",fontFamily:void 0}},dataLabels:{enabled:!1},stroke:{show:!1,curve:"smooth"},legend:{position:"top",horizontalAlign:"left",labels:{colors:this.themeSecondaryTextColor},markers:{offsetY:1,offsetX:-3},itemMargin:{vertical:3,horizontal:10}},colors:[h.series3,h.series2,h.series1],fill:{opacity:1,type:"solid"},grid:{show:!0,borderColor:this.themeBorderColor,xaxis:{lines:{show:!0}}},yaxis:{labels:{style:{colors:this.themeDisabledTextColor}}},xaxis:{axisBorder:{show:!1},axisTicks:{color:this.themeBorderColor},crosshairs:{stroke:{color:this.themeBorderColor}},labels:{style:{colors:this.themeDisabledTextColor}},categories:[]}}}},methods:{groupBy(r,t){for(var s=0,o,a,l=[],h=[];s<r.length;s++)o=r[s][t],a=l.indexOf(o),a>-1?h[a].push(r[s]):(l.push(o),h.push([r[s]]));return h},groupByF(r,t){var s={};return r.forEach(function(o){var a=JSON.stringify(t(o));s[a]=s[a]||[],s[a].push(o)}),Object.keys(s).map(function(o){return s[o]})},existeFecha(r,t){for(var s in r)if(r[s].x==t)return{resp:!0,index:s,value:r[s].y};return{resp:!1}},async getDataTrazabilidadDevice2(r){var t=[r];r.length>1&&(t=this.groupBy(r,"device")),this.groupByF(r,function(p){return[p.os,p.device,p.browser]});var s=[],o=[];for(var a in t){var l=[],h="",f=0;for(var d in t[a]){var m=t[a][d];h=m.device;var u=1;this.visita||(u=m.navigationRecord);const g=m.timestamp.replace(/[-]/g,"/");m.timestamp=g,m.timestamp=m.timestamp.split(",")[0];var n=moment$1(m.created_at).format("YYYY-MM-DD");f+=u,s.push(n);var c=this.existeFecha(l,n);c.resp?(l[c.index],l[c.index]={x:n,y:parseInt(u*1+c.value*1)}):l.push({x:n,y:parseInt(u)})}o.push({name:h,data:l.sort((p,g)=>g.x-p.x),total:parseInt(f)})}let v=s.filter((p,g)=>s.indexOf(p)===g);for(var a in o)if(o[a].data.length!=v.length){for(var _ in v){var V=!1;for(var d in o[a].data)v[_]==o[a].data[d].x&&(V=!0);V||o[a].data.push({x:v[_],y:0})}o[a].data.sort(function(g,y){var x=new Date(moment$1(g.x,"YYYY-MM-DD")),D=new Date(moment$1(y.x,"YYYY-MM-DD"));return x-D})}return o.sort((p,g)=>g.total-p.total)},async getDataTrazabilidadFull2(data){var serieTotal=[];let query="";this.selectedOs=="Android"&&this.selectedDispositivo=="movil"?query!==""?query+=" && e.device == this.selectedDispositivo && e.os == 'Linux' ":query+="e.device == this.selectedDispositivo && e.os == 'Linux'":this.selectedOs=="Android"&&this.selectedDispositivo=="desktop"?query!==""?query+=" && e.device == 'x' && e.os == 'x' ":query+="e.device == 'x' && e.os == 'x' ":this.selectedOs=="Linux"&&this.selectedDispositivo=="desktop"?query!==""?query+=" && e.device == this.selectedDispositivo && e.os == 'Linux' ":query+="e.device == this.selectedDispositivo && e.os == 'Linux'":this.selectedOs=="Linux"&&this.selectedDispositivo=="movil"?query!==""?query+=" && e.device == 'x' && e.os == 'x' ":query+="e.device == 'x' && e.os == 'x' ":this.selectedOs=="Linux"||this.selectedOs=="Android"?query!==""?query+=" && e.os == 'Linux' ":query+="e.os == 'Linux' ":(this.selectedOs!==""&&this.selectedOs!=="todos"&&(query!==""?query+=" && e.os == this.selectedOs":query+="e.os == this.selectedOs"),this.selectedDispositivo!==""&&(query!==""?query+=" && e.device == this.selectedDispositivo":query+="e.device == this.selectedDispositivo")),this.selectedBrowser!==""&&this.selectedBrowser!=="todos"&&(query!==""?query+=" && e.browser == this.selectedBrowser":query+="e.browser == this.selectedBrowser");let dataGroupBrowser;query!==""?dataGroupBrowser=data.filter(e=>eval(query)):dataGroupBrowser=data,this.activityData=dataGroupBrowser,document.querySelector(".divtext"),document.getElementById("crejemplo");var serieData=[],nameSerie="Total dispositivos",total=0;for(var i in dataGroupBrowser){var renderData=dataGroupBrowser[i],count=1;this.visita||(count=renderData.navigationRecord);const t=renderData.timestamp.replace(/[-]/g,"/");renderData.timestamp=t,renderData.timestamp=renderData.timestamp.split(",")[0];var fecha=moment$1(renderData.created_at).format("YYYY-MM-DD");total+=count,serieTotal.push(fecha);var procrosarFecha=this.existeFecha(serieData,fecha);procrosarFecha.resp?(serieData[procrosarFecha.index],serieData[procrosarFecha.index]={x:fecha,y:parseInt(count*1+procrosarFecha.value*1)}):serieData.push({x:fecha,y:parseInt(count)})}var dataFormat={name:nameSerie,data:serieData.sort((r,t)=>t.x-r.x),total:parseInt(total)};let seriTotalFiltrada=serieTotal.filter((r,t)=>serieTotal.indexOf(r)===t);if(dataFormat.data.length!=seriTotalFiltrada.length)for(var z in seriTotalFiltrada){var existe=!1;for(var j in dataFormat[i].data)seriTotalFiltrada[z]==dataFormat.data[j].x&&(existe=!0);existe||dataFormat[i].data.push({x:seriTotalFiltrada[z],y:0})}return this.dataFormateada=[dataFormat],[dataFormat]},async getInitGraficoDispositivos(){if(await this.fetchFiltros(),this.filtroDefault){let r=this.filtroDefault.fecha.split("a");moment$1(r[0]).add(1,"days").format("MM/DD/YYYY"),moment$1(r[1]).add(-1,"days").format("MM/DD/YYYY"),this.fechaIngesada=this.filtroDefault.fecha}else{let r=moment$1().add(-3,"days").format("MM-DD-YYYY"),t=moment$1().format("MM-DD-YYYY");this.fechaIngesada=String(r+" a "+t),moment$1().add(-1,"days").format("MM-DD-YYYY"),moment$1().add(1,"days").format("MM-DD-YYYY")}return!0},async getDataNoFilter(){await this.resolveActividad();let r=moment$1().add(-29,"days").format("MM-DD-YYYY"),t=moment$1().format("MM-DD-YYYY");return this.fechaIngesada=String(r+" a "+t),!0},async getDataGrafico1(r,t){var s=JSON.stringify({fechai:r,fechaf:t}),o=await fetch("https://servicio-de-actividad.vercel.app/dispositivos/full",{method:"POST",headers:{"Content-Type":"application/json"},body:s}),a=await o.json();return this.getDataFetch=a.grafico,a},async getDataGrafico(r,t){var s=[];let o=1;for(;;){var a=new Headers;a.append("Content-Type","application/json");var l=JSON.stringify({fechai:r,fechaf:t,page:o}),h={method:"POST",headers:a,body:l,redirect:"follow"};const m=(await(await fetch("https://servicio-de-actividad.vercel.app/dispositivos/full",h)).json()).grafico;if(m.length===0)break;s.push(...m),this.getDataFetch=Array.from(s),this.dataFormateada=await this.getDataTrazabilidadFull2(s),o+=1,this.emitData()}},async resolveChart(){await this.getDataOnlyGrafico(this.fechaiN,this.fechafN),this.selectedActividad=="visita"&&(this.visita=!1,this.emitData()),this.selectedActividad=="sesion"&&(this.visita=!0,this.emitData())},async getDataOnlyGrafico(r,t){this.isLoading=!0;let s="",o="",a="",l="";this.selectedOs=="Android"&&this.selectedDispositivo=="movil"?(a=this.selectedDispositivo,s="Linux"):this.selectedOs=="Android"&&this.selectedDispositivo=="desktop"?(s="x",a="x"):this.selectedOs=="Linux"&&this.selectedDispositivo=="desktop"?(s="Linux",a=this.selectedDispositivo):this.selectedOs=="Linux"&&this.selectedDispositivo=="movil"?(s="x",a="x"):this.selectedOs=="Linux"||this.selectedOs=="Android"?s="x":(this.selectedOs!==""&&this.selectedOs!=="todos"&&(s=this.selectedOs),this.selectedDispositivo!==""&&(a=this.selectedDispositivo)),this.selectedBrowser!==""&&this.selectedBrowser!=="todos"&&(o=this.selectedBrowser),l=this.selectedActividad;var h=JSON.stringify({fechai:r,fechaf:t,os:s,browser:o,dispositivo:a,actividad:l});console.log("data enviar ",h);var f=await fetch("https://servicio-de-actividad.vercel.app/dispositivos/grafico/v3",{method:"POST",headers:{"Content-Type":"application/json"},body:h}),d=await f.json();console.log("data Obtenida n",d),this.dataOnlyGrafico=d.data;let m=[d.data];return ApexCharts.exec("crejemplo","updateSeries",m),this.isLoading=!1,d.data},async obtenerFechaDispositivos(r,t,s){console.log("obtener fecha"),await this.resolveActividad(),r.length>1&&(this.fechai=moment$1(r[0]).add(1,"days").format("MM/DD/YYYY"),this.fechaf=moment$1(r[1]).add(-1,"days").format("MM/DD/YYYY"),this.fechaiN=moment$1(r[0]).format("MM/DD/YYYY"),this.fechafN=moment$1(r[1]).format("MM/DD/YYYY"),await this.getDataOnlyGrafico(this.fechaiN,this.fechafN),await this.getDataGrafico(this.fechai,this.fechaf))},async resolveActividad(){this.selectedActividad=="visita"&&(this.visita=!1),this.selectedActividad=="sesion"&&(this.visita=!0)},async fetchFiltros(){await fetch("https://servicio-filtros.vercel.app/dispositivos/grafico/all").then(t=>t.json()).then(t=>{this.filtrosDispositivos=Array.from(t)}).catch(t=>t);let r=Array.from(this.filtrosDispositivos);if(r.length>0){let t=r.filter(s=>s.isDefault===!0);this.filtroDefault=t[0],this.btnFiltros=t[0]._id,this.selectedBrowser=t[0].browser,this.selectedOs=t[0].os,this.selectedDispositivo=t[0].device,this.selectedActividad=t[0].actividad}},async resolveFiltroSelection(r){await fetch("https://servicio-filtros.vercel.app/dispositivos/grafico/id?"+new URLSearchParams({id:r})).then(s=>s.json()).then(s=>{this.filtroSelected=s}).catch(s=>s);let t=this.filtroSelected;this.selectedBrowser=t.browser,this.selectedOs=t.os,this.selectedDispositivo=t.device,this.selectedActividad=t.actividad,this.fechaIngesada=String(t.fecha)},async reset(){this.btnFiltros="",this.selectedBrowser="",this.selectedOs="",this.selectedDispositivo="",this.selectedActividad="sesion",await this.getDataNoFilter(),this.emitData()},emitData(){let r={data:this.activityData,visita:this.visita};this.$emit("activityData",r)}},async mounted(){await this.getInitGraficoDispositivos(),this.emitData()}},_hoisted_1$1={class:"date-picker-wrapper",style:{width:"100%"}},_hoisted_2$1={class:"loaderText"},_hoisted_3$1={class:"v-row"},_hoisted_4$1={class:"v-col-12"},_hoisted_5$1=createBaseVNode("div",{class:"divtext d-none"},"No se encontraron datos, selecciona otros filtros",-1);function _sfc_render(r,t,s,o,a,l){const h=_sfc_main$2,f=resolveComponent("VueApexCharts");return openBlock(),createElementBlock(Fragment,null,[createVNode(VRow,null,{default:withCtx(()=>[createVNode(VCol,{cols:"12"},{default:withCtx(()=>[createVNode(VBtnToggle,{class:"d-none",modelValue:a.btnFiltros,"onUpdate:modelValue":t[0]||(t[0]=d=>a.btnFiltros=d),color:"primary",variant:"outlined",divided:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.filtrosDispositivos,d=>(openBlock(),createBlock(VBtn,{value:d._id,onClick:m=>l.resolveFiltroSelection(d._id)},{default:withCtx(()=>[createTextVNode(toDisplayString(d.nombre),1)]),_:2},1032,["value","onClick"]))),256))]),_:1},8,["modelValue"])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createVNode(VSelect,{modelValue:a.selectedDispositivo,"onUpdate:modelValue":[t[1]||(t[1]=d=>a.selectedDispositivo=d),l.resolveChart],items:a.itemDispositivos,label:"Dispositivos",disabled:a.isLoading},null,8,["modelValue","items","onUpdate:modelValue","disabled"])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createVNode(VSelect,{modelValue:a.selectedActividad,"onUpdate:modelValue":[t[2]||(t[2]=d=>a.selectedActividad=d),l.resolveChart],items:a.itemActividad,label:"Actividad",disabled:a.isLoading},null,8,["modelValue","items","onUpdate:modelValue","disabled"])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createVNode(VSelect,{modelValue:a.selectedOs,"onUpdate:modelValue":[t[3]||(t[3]=d=>a.selectedOs=d),l.resolveChart],items:a.itemOs,label:"Sistema operativo",disabled:a.isLoading},null,8,["modelValue","items","onUpdate:modelValue","disabled"])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createVNode(VSelect,{modelValue:a.selectedBrowser,"onUpdate:modelValue":[t[4]||(t[4]=d=>a.selectedBrowser=d),l.resolveChart],items:a.itemBrowser,label:"Browser",disabled:a.isLoading},null,8,["modelValue","items","onUpdate:modelValue","disabled"])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createVNode(h,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:a.fechaIngesada,"onUpdate:modelValue":t[5]||(t[5]=d=>a.fechaIngesada=d),"show-current":"true",onOnChange:l.obtenerFechaDispositivos,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"m-d-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","onOnChange","config"])])]),_:1}),createVNode(VCol,{sm:"4",cols:"12"},{default:withCtx(()=>[createVNode(VBtn,{color:"success",onClick:l.reset,disabled:a.isLoading},{default:withCtx(()=>[createTextVNode(" Reiniciar filtros")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1}),withDirectives(createBaseVNode("h3",_hoisted_2$1,"Cargando...",512),[[vShow,a.isLoading]]),createBaseVNode("div",{class:normalizeClass(r.classLoading)},[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[createVNode(VCardText,null,{default:withCtx(()=>[_hoisted_5$1,createBaseVNode("div",null,[createVNode(f,{id:"crejemplo",type:"area",height:"400",options:l.chartConfig,series:a.series},null,8,["options","series"])])]),_:1})])])],2)],64)}const ChartAreaDispositivosFecha=_export_sfc(_sfc_main$1,[["render",_sfc_render]]),index_vue_vue_type_style_index_0_lang="",_hoisted_1={style:{display:"flex","flex-wrap":"wrap"}},_hoisted_2={style:{width:"max-content"}},_hoisted_3={style:{"margin-left":"auto","margin-bottom":"0.80rem"}},_hoisted_4=createBaseVNode("div",{class:"dataTable d-none"},"No se encontraron datos.",-1),_hoisted_5=createBaseVNode("thead",null,[createBaseVNode("tr",null,[createBaseVNode("th",{scope:"col"},"USUARIO"),createBaseVNode("th",{scope:"col"},"DISPOSITIVO"),createBaseVNode("th",{scope:"col"},"OS"),createBaseVNode("th",{scope:"col"},"BROWSER"),createBaseVNode("th",{scope:"col"},"ACTIVIDAD")])],-1),_hoisted_6={key:0},_hoisted_7=["onClick"],_hoisted_8={class:"text-medium-emphasis"},_hoisted_9={class:"text-medium-emphasis"},_hoisted_10={class:"font-weight-medium"},_hoisted_11={class:"font-weight-medium"},_hoisted_12={class:"text-medium-emphasis"},_hoisted_13={class:"text-medium-emphasis"},_hoisted_14={key:1,class:"tablaDatos"},_hoisted_15=createBaseVNode("tr",null,[createBaseVNode("td",{colspan:"4"},"No se encontraron datos.")],-1),_hoisted_16=[_hoisted_15],_hoisted_17={class:"pagination px-4 pagtable"},_hoisted_18={class:"px-2"},_hoisted_19={class:"d-flex justify-space-between align-center flex-wrap"},_hoisted_20={class:"text-base font-weight-semibold me-1"},_hoisted_21={class:"mb-1"},_hoisted_22=createBaseVNode("br",null,null,-1),_hoisted_23={style:{"text-align":"center"}},moment=momentRange.exports.extendMoment(hooks);moment.locale("es",[esLocale]);const __default__={data(){return{userSelected:"",visita:!0,fechaInicio:"",fechaFin:"",datos:[],isLoading:!0,dataN:[],datosFiltrados:[],datosGrouped:[],currentPage:1,itemsPerPage:10,totalPaginas:0,actividadUsuario:[],actividadUsuarioFull:[],actividadUsuarioVisible:!1,verMas:!1,dateNowF:moment().format("DD/MM/YYYY HH:mm:ss").toString(),userBackoffice:JSON.parse(localStorage.getItem("userData")),iconDevices:[{browser:"Chrome",os:"Windows",icon:"tabler-brand-windows",color:"info"},{browser:"Safari",os:"Mac OS",icon:"tabler-brand-apple",color:"secondary"},{browser:"Chrome",os:"Android",icon:"tabler-brand-android",color:"success"},{browser:"Chrome",os:"Linux",icon:"mdi-linux",color:"success"}],device:[{name:"movil",icon:"mdi-cellphone-android"},{name:"desktop",icon:"mdi-laptop-chromebook"}]}},computed:{totalPages(){return Math.ceil(this.datosGrouped.length/this.itemsPerPage)},visibleData(){var f,d;this.isLoading=!0;const r=(this.currentPage-1)*this.itemsPerPage,t=r+this.itemsPerPage,s=JSON.parse(JSON.stringify(this.dataN)),o=document.querySelector(".dataTable"),a=document.querySelector(".tableDataUser"),l=document.querySelector(".pagtable");if(o&&(s!=0?(o.classList.add("d-none"),a.classList.remove("d-none"),l.classList.remove("d-none")):(o.classList.remove("d-none"),a.classList.add("d-none"),l.classList.add("d-none"))),s.length!==0){this.isLoading=!1;let m=[];for(let n in s){let c={device:s[n].device,os:s[n].os,browser:s[n].browser,first_name:(f=s[n].users[0])!=null&&f.first_name?s[n].users[0].first_name.trim():"",last_name:(d=s[n].users[0])!=null&&d.last_name?s[n].users[0].last_name.trim():"",navigationRecord:s[n].navigationRecord,total:0};m.push(c)}const u=m.reduce((n,c)=>{var v=n.findIndex(_=>_.first_name==c.first_name&_.last_name==c.last_name&_.os==c.os&_.browser==c.browser&_.device==c.device);return v===-1?n.push({os:c.os,browser:c.browser,device:c.device,navigationRecord:c.navigationRecord,first_name:c.first_name,last_name:c.last_name,total:c.navigationRecord,count:1}):(n[v].total+=parseInt(n[v].navigationRecord),n[v].count++),n},[]);if(this.visita)for(var h in u){let n=u[h].count;u[h].total=n}u.sort((n,c)=>{if(n.total>c.total)return-1;if(n.total<c.total)return 1}),this.datosGrouped=u}return this.datosGrouped.slice(r,t)}},async mounted(){},methods:{getActivity(r){this.dataN=r.data,this.visita=r.visita,this.isLoading=!1},resolveActividadUser(r,t){const s=JSON.parse(JSON.stringify(this.dataN)),o=[];s.forEach(d=>{var u,n;let m={first_name:(u=d.users[0])==null?void 0:u.first_name,last_name:(n=d.users[0])==null?void 0:n.last_name,navigationData:d.navigationData};o.push(m)});const a=[];this.userSelected=r+" "+t;let l=r+" "+t;for(let d of o)if(d.first_name+" "+d.last_name==l)for(let u of d.navigationData){var h=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],f=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let n=moment(u.fecha,h,!0).format("DD/MM/YYYY"),c=u.hora.split(":");if(c[2].indexOf(" ")>=0){let g=c[2].split(" ");c[2]=g[0]}let v=c[0]+":"+c[1]+":"+c[2],_=n+" "+v,V=moment(_,f,!0).format(),p={first_name:d.first_name,last_name:d.last_name,url:u.url,title:u.title,fecha:n,fechaRaw:u.fecha,fullFecha:V,hora:v};a.push(p)}a.sort((d,m)=>{var u=new Date(d.fullFecha),n=new Date(m.fullFecha);return n-u}),this.actividadUsuario=a.slice(0,10),this.actividadUsuarioFull=a,this.actividadUsuarioVisible=!0},convertToCSV(r){for(var t=typeof r!="object"?JSON.parse(r):r,s="",o=0;o<t.length;o++){var a="";for(var l in t[o])a!=""&&(a+=","),a+=t[o][l];s+=a+`\r
`}return s},exportCSVFile(r,t,s){r&&t[0].wylexId!=="wylexId"&&t.unshift(r);var o=JSON.stringify(t),a=this.convertToCSV(o),l=s+".csv"||"export.csv",h=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(h,l);else{var f=document.createElement("a");if(f.download!==void 0){var d=URL.createObjectURL(h);f.setAttribute("href",d),f.setAttribute("download",l),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}},async download(){const r=JSON.parse(JSON.stringify(this.dataN)),t=[];for(let a of r){let l=a.users[0],h={userId:a.userId,first_name:l==null?void 0:l.first_name,last_name:l==null?void 0:l.last_name,phone_number:l==null?void 0:l.phone_number,browser:a.browser,created_at:a.created_at,device:a.device,actividad:a.navigationRecord,os:a.os,timestamp:a.timestamp};t.push(h)}let s={userId:"userId",first_name:"first_name",last_name:"last_name",phone_number:"phone_number",browser:"browser",created_at:"created_at",device:"device",actividad:"actividad",os:"os",timestamp:"timestamp"},o="usuarios_dispositivos";logAction("export"),this.exportCSVFile(s,t,o)},filtrarDatos(){this.isLoading=!0,JSON.parse(JSON.stringify(this.dataN)),document.querySelector(".dataTable"),document.querySelector(".tableDataUser"),document.querySelector(".pagtable")},async accionBackoffice(r){if(this.userBackoffice.email!=="admin@demo.com"){var t=new Headers;t.append("Content-Type","application/json");var s=JSON.stringify(r),o={method:"POST",headers:t,body:s,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",o).then(a=>{}).catch(a=>console.log("error",a))}}}},_sfc_main=Object.assign(__default__,{__name:"index",setup(r){return(t,s)=>(openBlock(),createBlock(VRow,null,{default:withCtx(()=>[createVNode(VCol,{cols:"12"},{default:withCtx(()=>[createVNode(VCard,null,{default:withCtx(()=>[createVNode(VCardText,{class:"flex-wrap justify-space-between gap-4"},{default:withCtx(()=>[createVNode(VCardItem,{class:"pt-0 pb-0"},{default:withCtx(()=>[createVNode(VCardTitle,null,{default:withCtx(()=>[createTextVNode("Resumen de Tecnolog\xEDa")]),_:1}),createVNode(VCardSubtitle,null,{default:withCtx(()=>[createTextVNode("Categor\xEDa de dispositivos de los \xFAltimos 7 d\xEDas")]),_:1})]),_:1}),createVNode(VDivider),createVNode(ChartAreaDispositivosFecha,{onActivityData:t.getActivity},null,8,["onActivityData"])]),_:1})]),_:1})]),_:1}),createVNode(VCol,{cols:"12"},{default:withCtx(()=>[createVNode(VCard,null,{default:withCtx(()=>[createVNode(VCardText,{class:"flex-wrap justify-space-between gap-4",id:"id-card-actividad"},{default:withCtx(()=>[createVNode(VCardItem,{class:"pt-0 pb-0"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(VCardTitle,null,{default:withCtx(()=>[createTextVNode("Usuarios")]),_:1}),createVNode(VCardSubtitle,null,{default:withCtx(()=>[createTextVNode(" Registro de actividad de los usuarios")]),_:1})]),createBaseVNode("div",_hoisted_3,[createVNode(VBtn,{color:"primary",onClick:t.download},{default:withCtx(()=>[createTextVNode(" Exportar ")]),_:1},8,["onClick"])])])]),_:1}),createVNode(VCardItem,{class:"pt-0 pb-0"},{default:withCtx(()=>[_hoisted_4]),_:1}),createVNode(VTable,{class:"text-no-wrap w-100 px-4 tableDataUser",hover:"true"},{default:withCtx(()=>[_hoisted_5,t.visibleData.length?(openBlock(),createElementBlock("tbody",_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.visibleData,(o,a)=>(openBlock(),createElementBlock("tr",{class:"clickable",key:a,onClick:l=>t.resolveActividadUser(o.first_name,o.last_name)},[createBaseVNode("td",_hoisted_8,toDisplayString(o.first_name)+" "+toDisplayString(o.last_name),1),createBaseVNode("td",_hoisted_9,[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.device,l=>(openBlock(),createElementBlock("span",{key:l.name},[l.name===o.device?(openBlock(),createBlock(VAvatar,{key:0,size:22,class:"me-3"},{default:withCtx(()=>[createVNode(VIcon,{color:l.color,icon:l.icon},null,8,["color","icon"])]),_:2},1024)):createCommentVNode("",!0)]))),128)),createBaseVNode("span",_hoisted_10,toDisplayString(o.device),1)]),createBaseVNode("td",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.iconDevices,l=>(openBlock(),createElementBlock("span",{key:l.browser},[(o.os=="Linux"&o.device=="movil"?"Android":o.os)===l.os?(openBlock(),createBlock(VAvatar,{key:0,size:22,class:"me-3"},{default:withCtx(()=>[createVNode(VIcon,{color:l.color,icon:l.icon},null,8,["color","icon"])]),_:2},1024)):createCommentVNode("",!0)]))),128)),createBaseVNode("span",_hoisted_11,toDisplayString(o.os=="Linux"&o.device=="movil"?"Android":o.os),1)]),createBaseVNode("td",_hoisted_12,toDisplayString(o.browser),1),createBaseVNode("td",_hoisted_13,toDisplayString(o.total),1)],8,_hoisted_7))),128))])):(openBlock(),createElementBlock("tbody",_hoisted_14,_hoisted_16))]),_:1}),createBaseVNode("div",_hoisted_17,[createVNode(VBtn,{disabled:t.currentPage===1,onClick:s[0]||(s[0]=o=>t.currentPage-=1),size:"small",color:"primary"},{default:withCtx(()=>[createTextVNode(" Anterior ")]),_:1},8,["disabled"]),createBaseVNode("span",_hoisted_18,toDisplayString(t.currentPage)+" de "+toDisplayString(t.totalPages||0)+" de un total de "+toDisplayString(t.datosGrouped.length||0)+" registros",1),createVNode(VBtn,{disabled:t.currentPage===t.totalPages,onClick:s[1]||(s[1]=o=>t.currentPage+=1),size:"small",color:"primary"},{default:withCtx(()=>[createTextVNode(" Siguiente ")]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1}),createVNode(VCol,{lg:"12",cols:"12",sm:"12"},{default:withCtx(()=>[createVNode(VExpandTransition,{id:"actividadusuario"},{default:withCtx(()=>[withDirectives(createVNode(VCard,null,{default:withCtx(()=>[createVNode(VCardItem,null,{default:withCtx(()=>[createVNode(VCardTitle,null,{default:withCtx(()=>[createTextVNode(" Actividad del usuario "),createBaseVNode("b",null,toDisplayString(t.userSelected),1)]),_:1})]),_:1}),t.actividadUsuario.length>0?(openBlock(),createBlock(VCardText,{key:0},{default:withCtx(()=>[createVNode(VTimeline,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.verMas?t.actividadUsuarioFull:t.actividadUsuario,o=>(openBlock(),createBlock(VTimelineItem,{"dot-color":o.title===t.titleSelected?"success":"primary",size:"x-small"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_19,[createBaseVNode("h4",_hoisted_20,toDisplayString(o.title||o.url),1)]),createBaseVNode("p",_hoisted_21,toDisplayString(o.fecha)+" "+toDisplayString(o.hora),1),createVNode(VDivider)]),_:2},1032,["dot-color"]))),256))]),_:1}),_hoisted_22,createBaseVNode("div",_hoisted_23,[!t.verMas&&t.actividadUsuarioFull.length>10?(openBlock(),createBlock(VBtn,{key:0,color:"primary",onClick:s[2]||(s[2]=o=>t.verMas=!0)},{default:withCtx(()=>[createTextVNode("Ver m\xE1s")]),_:1})):createCommentVNode("",!0),t.verMas&&t.actividadUsuarioFull.length>10?(openBlock(),createBlock(VBtn,{key:1,color:"primary",onClick:s[3]||(s[3]=o=>t.verMas=!1)},{default:withCtx(()=>[createTextVNode("Ver menos")]),_:1})):createCommentVNode("",!0)])]),_:1})):(openBlock(),createBlock(VCardText,{key:1},{default:withCtx(()=>[createTextVNode("No existen datos")]),_:1}))]),_:1},512),[[vShow,t.actividadUsuarioVisible]])]),_:1})]),_:1})]),_:1}))}});export{_sfc_main as default};
