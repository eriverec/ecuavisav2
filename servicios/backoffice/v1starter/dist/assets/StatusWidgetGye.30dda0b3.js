import{l as w}from"./lodash.ef907739.js";import{r as u,bz as y}from"./index.88d3c7f5.js";const C={__name:"StatusWidgetGye",props:{assetUrl:{type:String,required:!0},pollInterval:{type:Number,default:2e3},maxAttempts:{type:Number,default:30}},emits:["progress","success","error","timeout"],setup(g,{expose:m,emit:e}){const a=g,i=u(null),o=u(0),n=u(null),p=async(r,c=!0)=>{try{const t=await fetch(`${r}${c?"?t="+Date.now():""}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const l=await t.text(),d=l.indexOf("{"),f=l.lastIndexOf("}");if(d===-1||f===-1)throw new Error("No se encontr\xF3 el objeto de configuraci\xF3n");const x=l.substring(d,f+1);return JSON.parse(x)}catch(t){throw console.error("Error en loadConfiguracion:",t),t}},v=(r,c)=>!w.exports.isEqual(r,c),h=async()=>{o.value=0;try{i.value=await p(a.assetUrl,!1),e("progress",{step:1,message:"Guardando cambios...",progress:33}),n.value=setInterval(async()=>{try{o.value++,console.log(`Intento ${o.value} de verificaci\xF3n`),e("progress",{step:2,progress:Math.min(66+o.value*2,95)});const r=await p(a.assetUrl,!0);if(v(i.value,r)){console.log("Cambios detectados"),s(),e("progress",{step:3,message:"Cambios verificados",progress:100}),e("success",r);return}if(o.value>=a.maxAttempts){console.log("M\xE1ximo de intentos alcanzado"),s(),e("timeout");return}}catch(r){console.error("Error en la verificaci\xF3n:",r),s(),e("error",r)}},a.pollInterval)}catch(r){console.error("Error inicial:",r),e("error",r)}},s=()=>{n.value&&(clearInterval(n.value),n.value=null)};return y(()=>{s()}),m({startMonitoring:h,stopMonitoring:s}),()=>{}}};export{C as default};
