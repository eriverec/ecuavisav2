import{M as S,r as b,Q as k,o as u,x as _,b as t,a as n,a$ as U,w as l,F as V,C as j,c as B,u as i,b4 as O,b5 as T,X as z,t as f,aM as m,q as v,b6 as M,aW as A,p as N,m as q,N as F,b3 as K,bd as Q,be as W}from"./index.88d3c7f5.js";const I=h=>(Q("data-v-abdd6e27"),h=h(),W(),h),X={class:"location-stats py-4"},G=I(()=>t("div",{class:"d-flex justify-space-between align-center mb-4"},[t("div",{class:"date-picker-wrapper",style:{width:"calc(100% - 48px)"}})],-1)),H={class:"location-stats-container"},J={key:0,class:"d-flex justify-center align-center py-4"},Y={key:1,class:"location-stats-scroll"},Z={class:"d-flex align-center"},ee={class:"country-name"},ae={class:"d-flex align-center"},te=I(()=>t("thead",null,[t("tr",null,[t("th",null,"Ciudad"),t("th",{class:"text-center"},"Clicks"),t("th",{class:"text-center"},"Impresiones"),t("th",{class:"text-center"},"Descargar usuarios")])],-1)),se={class:"text-center"},oe={class:"text-center"},ne={class:"text-center"},le={__name:"location_stats",props:{campaignId:{type:String,required:!0},dateRange:{type:Object,required:!0}},setup(h){const r=h,x=b([]),g=b(!0),y=b([0]),$=c=>({"United States":"us","United Kingdom":"gb",Spain:"es",Mexico:"mx",Colombia:"co",Argentina:"ar",Chile:"cl",Peru:"pe",Ecuador:"ec",Venezuela:"ve",Brazil:"br"})[c]||c.slice(0,2).toLowerCase(),w=async()=>{try{g.value=!0;const s=(await(await fetch(`https://ads-service.vercel.app/grafico/stats-paises-ciudades/${r.campaignId}?fechai=${r.dateRange.start}&fechaf=${r.dateRange.end}&page=1&limit=500000`)).json()).consulta.reduce((e,a)=>(e[a.pais]||(e[a.pais]={country:a.pais,cities:{},totalCities:0}),e[a.pais].cities[a.ciudad]||(e[a.pais].cities[a.ciudad]={name:a.ciudad,clicks:0,views:0},e[a.pais].totalCities++),a.type==="click"?e[a.pais].cities[a.ciudad].clicks+=a.total:a.type==="preview"&&(e[a.pais].cities[a.ciudad].views+=a.total),e),{});x.value=Object.values(s).map(e=>({...e,cities:Object.values(e.cities)}))}catch(c){console.error("Error fetching location data:",c)}finally{g.value=!1}},E=async(c,d)=>{try{const a=(await(await fetch(`https://ads-service.vercel.app/grafico/stats-paises-ciudades/btn-descargar/${r.campaignId}?fechai=${r.dateRange.start}&fechaf=${r.dateRange.end}&page=1&limit=500000`)).json()).consulta.filter(o=>o.pais===c&&o.ciudad===d.name),R={type:"Tipo",total:"Total",pais:"Pa\xEDs",ciudad:"Ciudad",userId:"ID Usuario",first_name:"Nombre",last_name:"Apellido",email:"Email",phone:"Tel\xE9fono"},D=a.map(o=>({type:o.type,total:o.total,pais:o.pais,ciudad:o.ciudad,userId:o.user._id,first_name:o.user.first_name,last_name:o.user.last_name,email:o.user.email,phone:o.user.phone_number||""})),L=[Object.values(R).join(","),...D.map(o=>Object.values(o).join(","))].join(`
`),P=new Blob(["\uFEFF"+L],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),C=URL.createObjectURL(P);p.setAttribute("href",C),p.setAttribute("download",`estadisticas_${c}_${d.name}.csv`),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(C)}catch(s){console.error("Error downloading data:",s)}};return k(()=>r.campaignId,()=>{w()},{immediate:!0}),k(()=>r.dateRange,()=>{w()},{deep:!0}),(c,d)=>(u(),_("div",X,[G,t("div",H,[g.value?(u(),_("div",J,[n(U,{indeterminate:"",color:"primary"})])):(u(),_("div",Y,[n(i(K),{modelValue:y.value,"onUpdate:modelValue":d[0]||(d[0]=s=>y.value=s)},{default:l(()=>[(u(!0),_(V,null,j(x.value,s=>(u(),B(i(O),{key:s.country,class:"location-panel"},{default:l(()=>[n(i(T),{class:"d-flex flex-wrap justify-space-between gap-4"},{default:l(()=>[t("div",Z,[n(i(z),{class:"me-3",size:"34",image:`https://hatscripts.github.io/circle-flags/flags/${$(s.country).toLowerCase()}.svg`},null,8,["image"]),t("span",ee,f(s.country),1)]),t("div",ae,[n(i(m),{label:"",color:"primary",variant:"tonal",class:"me-2 cities-chip"},{default:l(()=>[v(f(s.totalCities)+" "+f(s.totalCities===1?"Ciudad":"Ciudades"),1)]),_:2},1024)])]),_:2},1024),n(i(M),null,{default:l(()=>[n(i(A),{hover:"",class:"stats-table"},{default:l(()=>[te,t("tbody",null,[(u(!0),_(V,null,j(s.cities,e=>(u(),_("tr",{key:e.name},[t("td",null,f(e.name),1),t("td",se,[n(i(m),{label:"",color:e.clicks>0?"success":"grey",size:"small",variant:"tonal"},{default:l(()=>[v(f(e.clicks),1)]),_:2},1032,["color"])]),t("td",oe,[n(i(m),{label:"",color:e.views>0?"warning":"grey",size:"small",variant:"tonal"},{default:l(()=>[v(f(e.views),1)]),_:2},1032,["color"])]),t("td",ne,[n(i(N),{icon:"",size:"small",color:"primary",variant:"text",onClick:q(a=>E(s.country,e),["stop"])},{default:l(()=>[n(F,null,{default:l(()=>[v("mdi-account-arrow-down-outline")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]))])]))}},ce=S(le,[["__scopeId","data-v-abdd6e27"]]);export{ce as default};
