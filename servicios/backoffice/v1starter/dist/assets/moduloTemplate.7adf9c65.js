import{M as ue,R as ce,S as me,U as ve,r as l,as as pe,v as fe,o as L,x as z,a as t,w as s,q as v,t as Q,u as o,f as ge,g as k,b as W,h as j,p as R,i as g,b0 as X,e as V,bw as Ve,c as be,aQ as ye,aR as we,l as _e,m as Y,V as P,n as S,bC as Z,b1 as he,bu as B,bc as Ce}from"./index.88d3c7f5.js";const xe=["title","src"],Te={key:0,style:{height:"300px"},class:"d-flex align-center"},je={class:"px-4"},Re={__name:"moduloTemplate",props:{action:String,idVideo:String},emits:["get:eventModalCR"],setup(ee,{emit:D}){const I=ee;ce.exports.extendMoment(me).locale("es",[ve]);const E=l(!1),q=l(!1);l("tab-lista");const u=l(!0);l(1);const $=l([]),ae=l(1);l(1),l(""),l(!1),l(!1),l(!1);const _=l(!1),U=l(null),x=l(!1),h=l(""),te=l(""),p=l(""),c=l("");l(""),l(!0),l(""),l("");const m=l(""),b=l(""),y=l(null),f=l(null),T=l("https://estadisticas.ecuavisa.com/sites/gestor/Recursos/ecuavisa.com.jpg"),N=l(""),n=l({message:"Datos guardados",type:"success",model:!1}),F=l([]),G=l([]);pe(async()=>{await H(),await J(),I.action=="add"?await se():await ie(I.idVideo),u.value=!1});async function H(d=1,a=10){try{q.value=!0;var i=new Headers;i.append("Content-Type","application/json");var e={method:"GET",headers:i,redirect:"follow"},C=await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/elearning/etiqueta/listar.php",e);const r=await C.json();F.value=r,q.value=!1}catch(r){return n.value={message:"No se pudo recuperar las etiquetas, recargue de nuevo.",type:"error",model:!0},console.error(r.message)}}async function J(d=1,a=10){try{E.value=!0;var i=new Headers;i.append("Content-Type","application/json");var e={method:"GET",headers:i,redirect:"follow"},C=await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/elearning/categoria/listar.php",e);const r=await C.json();G.value=r,E.value=!1}catch(r){return n.value={message:"No se pudo recuperar las categor\xEDas, recargue de nuevo.",type:"error",model:!0},console.error(r.message)}}async function le(d=1,a=10){try{K.value=1;var i=new Headers;i.append("Content-Type","application/json");var e={method:"GET",headers:i,redirect:"follow"},C=await fetch("https://servicio-elearning.vercel.app/video/all?limit=200&page=1",e);const r=await C.json();$.value=r.data,ae.value=Math.ceil(r.total/r.limit)}catch(r){return n.value={message:"No se pudo recuperar los videos, recargue de nuevo.",type:"error",model:!0},console.error(r.message)}}const A=8,K=l(1);fe(()=>{const d=(K.value-1)*A,a=d+A;return $.value.slice(d,a)});function O(){N.value="",y.value="",p.value="",c.value="",f.value="",T.value="https://estadisticas.ecuavisa.com/sites/gestor/Recursos/ecuavisa.com.jpg",c.value="",b.value="",m.value=""}function oe(){O(),x.value=!1,B(()=>{D("get:eventModalCR",{modalShow:!1,action:"modal"})})}async function se(){O(),h.value="add",x.value=!0}async function ie(d){try{O(),h.value="edit";const e=(await(await fetch("https://servicio-elearning.vercel.app/video/get/"+d)).json()).data;N.value=e._id,y.value=e.titulo,p.value=e.idRudo,c.value=e.duracion,f.value=e.descripcion,T.value="https://estadisticas.ecuavisa.com/sites/gestor/Recursos/ecuavisa.com.jpg",b.value=e.etiquetas,m.value=e.categoria,x.value=!0}catch(a){return n.value={message:"No se pudo recuperar los datos para editar, recargue de nuevo.",type:"error",model:!0},console.error(a.message)}}async function re(){if(!m.value||!p.value||!f.value||!T.value||!c.value)return n.value={message:"Llenar todos los campos para crear el registro",type:"error",model:!0},!1;u.value=!0;var d=new Headers;if(d.append("Content-Type","application/json"),h.value==="add"){let e={titulo:y.value,descripcion:f.value,idRudo:p.value,thumbnail:T.value,duracion:c.value,categoria:m.value,etiquetas:b.value};var a=JSON.stringify(e),i={method:"POST",headers:d,body:a,redirect:"follow"};const r=await(await fetch("https://servicio-elearning.vercel.app/video/create",i)).json();if(r.resp)n.value={message:"Registro creado correctamente",type:"success",model:!0};else return n.value={message:r.mensaje,type:"error",model:!0},console.error(r.error),!1;x.value=!1,u.value=!1,B(()=>{D("get:eventModalCR",{modalShow:!1,id:r.id,action:"add"})})}else if(h.value==="edit"){let e={titulo:y.value,descripcion:f.value,idRudo:p.value,thumbnail:T.value,duracion:c.value,categoria:m.value,etiquetas:b.value};var a=JSON.stringify(e),i={method:"POST",headers:d,body:a,redirect:"follow"};const M=await(await fetch("https://servicio-elearning.vercel.app/video/update/"+N.value,i)).json();M.resp?(n.value={message:"Registro actualizado correctamente",type:"success",model:!0},B(()=>{D("get:eventModalCR",{modalShow:!1,data:M,action:"edit"})})):(n.value={message:M.mensaje,type:"error",model:!0},console.error(M.error))}return x.value=!1,!1}const w=l(!1),ne=l("");async function de(){var d={method:"DELETE",redirect:"follow"};const i=await(await fetch("https://servicio-elearning.vercel.app/video/delete/"+ne.value,d)).json();i.resp?n.value={message:"Desaf\xEDo eliminado correctamente",type:"success",model:!0}:n.value={message:i.mensaje,type:"error",model:!0},await le(),w.value=!1}return(d,a)=>{const i=Ce;return L(),z("section",null,[t(ge,{modelValue:o(n).model,"onUpdate:modelValue":a[0]||(a[0]=e=>o(n).model=e),location:"top end",variant:"flat",timeout:o(n).timeout||4e3,color:o(n).type},{default:s(()=>[v(Q(o(n).message),1)]),_:1},8,["modelValue","timeout","color"]),t(X,{modelValue:o(_),"onUpdate:modelValue":a[3]||(a[3]=e=>g(_)?_.value=e:null),width:"500",persistent:""},{activator:s(({props:e})=>[]),default:s(()=>[t(i,{onClick:a[1]||(a[1]=e=>_.value=!o(_))}),t(k,{title:o(U).idRudoModel},{default:s(()=>[W("iframe",{class:"mt-3",title:"Video "+o(U).idRudoModel,width:"100%",height:"300",src:o(U).urlContent},null,8,xe),t(j,{class:"d-flex justify-end"},{default:s(()=>[t(R,{onClick:a[2]||(a[2]=e=>_.value=!1)},{default:s(()=>[v(" Aceptar ")]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),t(X,{modelValue:o(w),"onUpdate:modelValue":a[6]||(a[6]=e=>g(w)?w.value=e:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[t(i,{onClick:a[4]||(a[4]=e=>w.value=!o(w))}),t(k,{title:"Eliminar registro"},{default:s(()=>[t(j,null,{default:s(()=>[v(" \xBFDesea eliminar el registro? ")]),_:1}),t(j,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[t(R,{color:"secondary",variant:"tonal",onClick:a[5]||(a[5]=e=>w.value=!1)},{default:s(()=>[v(" No, cerrar ")]),_:1}),t(R,{onClick:de},{default:s(()=>[v(" Si, eliminar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(P,null,{default:s(()=>[t(V,{cols:"12",md:"12",lg:"12"},{default:s(()=>[o(u)?(L(),z("div",Te,[t(k,{width:"300",class:"mx-auto mt-5 mb-5",color:"primary"},{default:s(()=>[t(j,{class:"pt-3"},{default:s(()=>[v(" Cargando datos... espere "),t(Ve,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})])):(L(),be(k,{key:1,class:"px-2 py-2"},{default:s(()=>[t(ye,{class:"text-center"},{default:s(()=>[t(we,{class:"text-h5 mb-3"},{default:s(()=>[v(Q(o(h)==="add"||o(h)==="duplicate"?"Crear video":"Editar video"+o(te)),1)]),_:1})]),_:1}),t(j,null,{default:s(()=>[W("div",je,[t(_e,{class:"mt-6",onSubmit:Y(re,["prevent"])},{default:s(()=>[t(P,{class:""},{default:s(()=>[t(P,null,{default:s(()=>[t(V,{cols:"6"},{default:s(()=>[t(S,{disabled:o(u),modelValue:o(y),"onUpdate:modelValue":a[7]||(a[7]=e=>g(y)?y.value=e:null),label:"T\xEDtulo del video"},null,8,["disabled","modelValue"])]),_:1}),t(V,{cols:"6"},{default:s(()=>[t(S,{disabled:o(u),modelValue:o(f),"onUpdate:modelValue":a[8]||(a[8]=e=>g(f)?f.value=e:null),label:"Descripci\xF3n"},null,8,["disabled","modelValue"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(S,{disabled:o(u),modelValue:o(p),"onUpdate:modelValue":a[9]||(a[9]=e=>g(p)?p.value=e:null),label:"Id video de RUDO"},null,8,["disabled","modelValue"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(S,{disabled:o(u),modelValue:o(c),"onUpdate:modelValue":a[10]||(a[10]=e=>g(c)?c.value=e:null),label:"Tiempo en minutos del video",suffix:"minutos","append-inner-icon":"tabler-clock",type:"number"},null,8,["disabled","modelValue"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(Z,{modelValue:o(m),"onUpdate:modelValue":a[11]||(a[11]=e=>g(m)?m.value=e:null),items:o(G),chips:"",label:"Seleccione la categor\xEDa del video","menu-props":{maxHeight:"300"},onKeydown:he(Y(o(m),["prevent"]),["enter"]),disabled:o(E),"append-icon":"mdi-refresh","onClick:append":J},null,8,["modelValue","items","onKeydown","disabled"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(Z,{"item-text":"title","item-value":"value",modelValue:o(b),"onUpdate:modelValue":a[12]||(a[12]=e=>g(b)?b.value=e:null),items:o(F),chips:"",multiple:"",label:"Etiquetas","menu-props":{maxHeight:"300"},disabled:o(q),"append-icon":"mdi-refresh","onClick:append":H},null,8,["modelValue","items","disabled"])]),_:1})]),_:1}),t(V,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:s(()=>[t(R,{type:"submit",disabled:o(u)},{default:s(()=>[v(" Guardar ")]),_:1},8,["disabled"]),t(R,{color:"secondary",disabled:o(u),variant:"tonal",onClick:oe},{default:s(()=>[v(" Cancelar ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])]),_:1})]),_:1}))]),_:1})]),_:1})])}}},De=ue(Re,[["__scopeId","data-v-6715429c"]]);export{De as m};
