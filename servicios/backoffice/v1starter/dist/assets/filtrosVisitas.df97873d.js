import{r as f,as as te,o as D,x as j,a as e,w as l,f as R,u as i,i as B,q as r,b as u,aR as k,p as v,h as g,c as L,aW as le,F as J,C as se,t as F,aM as oe,N as z,b0 as E,g as N,aQ as U,l as Y,m as q,V as A,e as m,n as M,c7 as I,bc as ie,aX as ne}from"./index.88d3c7f5.js";const re={class:"d-flex align-center flex-wrap gap-2"},ue=u("thead",null,[u("tr",null,[u("th",{scope:"col"},"Nombre"),u("th",{scope:"col"},"Fecha"),u("th",{scope:"col"},"Default"),u("th",{scope:"col"},"Acciones")])],-1),de={class:"text-center",style:{width:"5rem"}},fe=u("span",null,"\xBF Est\xE1 seguro que desea eliminar",-1),ce=u("br",null,null,-1),pe={__name:"filtrosVisitas",setup(ve){const S=f(!0),o=f({}),n=f({}),V=f({}),b=f(!1),y=f(!1),_=f(!1),x=f([]),c=f(!1),h=f(!1);async function C(){S.value=!0,await fetch("https://servicio-filtros.vercel.app/visitas/all").then(s=>s.json()).then(s=>{x.value=Array.from(s),S.value=!1}).catch(s=>s)}te(C);async function Q(){y.value=!0}async function W(){c.value=!1,h.value=!1;let a=Array.from(x.value).filter(t=>t.isDefault===!0);if(console.log("data a enviar",n.value),a.length&&n.value.isDefault===!0){let t=JSON.stringify({id:a[0]._id,isDefault:!1});await fetch("https://servicio-filtros.vercel.app/visitas/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:t}).catch(w=>w)}let d="visitas",p=JSON.stringify({nombre:n.value.nombre,tipo:d,device:n.value.device,browser:n.value.browser,os:n.value.os,actividad:n.value.actividad,fecha:n.value.fecha,isDefault:n.value.isDefault});await fetch("https://servicio-filtros.vercel.app/visitas/add",{method:"POST",headers:{"Content-Type":"application/json"},body:p}).then(t=>t.json()).then(t=>(console.log(t),t=="El filtro ya existe"?(c.value=!0,!1):t=="Faltan datos"?(h.value=!0,!1):(y.value=!1,h.value=!1,c.value=!1,C(),!0))).catch(t=>t)}const X=()=>{n.value={},y.value=!1},T=s=>{s===!1&&(n.value={}),y.value=s},$=f("");async function G(s){await fetch("https://servicio-filtros.vercel.app/visitas/id?"+new URLSearchParams({id:s})).then(a=>a.json()).then(a=>{o.value=a,$.value=a.nombre}).catch(a=>a),b.value=!0}async function H(s){c.value=!1;let d=Array.from(x.value).filter(t=>t.isDefault===!0);if(d.length&&o.value.isDefault===!0){let t=JSON.stringify({id:d[0]._id,isDefault:!1});await fetch("https://servicio-filtros.vercel.app/visitas/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:t}).catch(w=>w)}let p;o.value.nombre==$.value?p=JSON.stringify({id:s,device:o.value.device,browser:o.value.browser,os:o.value.os,actividad:o.value.actividad,fecha:o.value.fecha,isDefault:o.value.isDefault}):p=JSON.stringify({id:s,nombre:o.value.nombre,device:o.value.device,browser:o.value.browser,os:o.value.os,actividad:o.value.actividad,fecha:o.value.fecha,isDefault:o.value.isDefault}),await fetch("https://servicio-filtros.vercel.app/visitas/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:p}).then(t=>t.json()).then(t=>t=="El nombre del filtro ya existe"?(c.value=!0,!1):(b.value=!1,c.value=!1,C(),!0)).catch(t=>t)}const K=()=>{o.value={},b.value=!1},O=s=>{s===!1&&(o.value={}),b.value=s};async function Z(s){_.value=!0,await fetch("https://servicio-filtros.vercel.app/visitas/id?"+new URLSearchParams({id:s})).then(a=>a.json()).then(a=>{V.value=a}).catch(a=>a)}async function ee(){console.log("nombre a eliminar",V.value.nombre);let s=V.value._id;var a={method:"DELETE",redirect:"follow"};await fetch("https://servicio-filtros.vercel.app/visitas/delete?"+new URLSearchParams({id:s}),a).then(d=>d.json()).then(d=>(_.value=!1,V.value={},C(),!0)).catch(d=>d)}const P=s=>{s===!1&&(V.value={}),_.value=s},ae=()=>{V.value={},_.value=!1};return(s,a)=>{const d=ie,p=ne;return D(),j(J,null,[e(g,null,{default:l(()=>[e(R,{modelValue:i(c),"onUpdate:modelValue":a[0]||(a[0]=t=>B(c)?c.value=t:null),color:"error",transition:"scale-transition",location:"top center"},{default:l(()=>[r(" El nombre del filtro ya est\xE1 en uso. ")]),_:1},8,["modelValue"]),e(R,{modelValue:i(h),"onUpdate:modelValue":a[1]||(a[1]=t=>B(h)?h.value=t:null),color:"error",transition:"scale-transition",location:"top center"},{default:l(()=>[r(" Porfavor ingresar todos los datos. ")]),_:1},8,["modelValue"]),u("div",re,[e(k,null,{default:l(()=>[r("Filtros de Visitas")]),_:1}),e(v,{"prepend-icon":"tabler-plus",onClick:Q},{default:l(()=>[r(" A\xF1adir filtro ")]),_:1})])]),_:1}),i(S)?(D(),L(g,{key:0},{default:l(()=>[r("Cargando datos...")]),_:1})):(D(),L(g,{key:1},{default:l(()=>[e(le,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:l(()=>[ue,u("tbody",null,[(D(!0),j(J,null,se(i(x),t=>(D(),j("tr",null,[u("td",null,F(t.nombre),1),u("td",null,F(t.fecha),1),u("td",null,[e(oe,{color:t.isDefault==!0?"success":"warning",class:"mr-4"},{default:l(()=>[r(F(t.isDefault==!0?"Default":"No default"),1)]),_:2},1032,["color"])]),u("td",de,[e(v,{icon:"",size:"x-small",color:"default",variant:"text",onClick:w=>G(t._id)},{default:l(()=>[e(z,{size:"22",icon:"tabler-edit"})]),_:2},1032,["onClick"]),e(v,{icon:"",size:"x-small",color:"default",variant:"text",onClick:w=>Z(t._id)},{default:l(()=>[e(z,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),256))])]),_:1}),e(E,{persistent:"","no-click-animation":"",width:s.$vuetify.display.smAndDown?"auto":700,"model-value":i(b),"onUpdate:modelValue":O},{default:l(()=>[e(d,{onClick:a[2]||(a[2]=t=>O(!1))}),e(N,{class:"pa-sm-14 pa-5"},{default:l(()=>[e(U,{class:"text-center"},{default:l(()=>[e(k,{class:"text-h5 mb-3"},{default:l(()=>[r(" Editar el filtro ")]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(Y,{class:"mt-6",onSubmit:a[7]||(a[7]=q(t=>H(i(o)._id),["prevent"]))},{default:l(()=>[e(A,{class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(A,null,{default:l(()=>[e(m,{cols:"6"},{default:l(()=>[e(M,{modelValue:i(o).nombre,"onUpdate:modelValue":a[3]||(a[3]=t=>i(o).nombre=t),label:"Nombre"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(p,{label:"Fecha","prepend-inner-icon":"tabler-calendar",density:"compact","default-value":new Date,modelValue:i(o).fecha,"onUpdate:modelValue":a[4]||(a[4]=t=>i(o).fecha=t),"show-current":"true",onOnChange:a[5]||(a[5]=()=>{}),config:{mode:"range",altFormat:"F j, Y",dateFormat:"m-d-Y",maxDate:new Date,reactive:!0}},null,8,["default-value","modelValue","config"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(I,{modelValue:i(o).isDefault,"onUpdate:modelValue":a[6]||(a[6]=t=>i(o).isDefault=t),density:"compact",label:"Default"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(v,{type:"submit"},{default:l(()=>[r(" Enviar ")]),_:1}),e(v,{color:"secondary",variant:"tonal",onClick:K},{default:l(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(E,{persistent:"","no-click-animation":"",width:s.$vuetify.display.smAndDown?"auto":700,"model-value":i(y),"onUpdate:modelValue":T},{default:l(()=>[e(d,{onClick:a[8]||(a[8]=t=>T(!1))}),e(N,{class:"pa-sm-14 pa-5"},{default:l(()=>[e(U,{class:"text-center"},{default:l(()=>[e(k,{class:"text-h5 mb-3"},{default:l(()=>[r(" A\xF1adir un filtro ")]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(Y,{class:"mt-6",onSubmit:a[13]||(a[13]=q(t=>W(),["prevent"]))},{default:l(()=>[e(A,{class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(A,null,{default:l(()=>[e(m,{cols:"6"},{default:l(()=>[e(M,{modelValue:i(n).nombre,"onUpdate:modelValue":a[9]||(a[9]=t=>i(n).nombre=t),label:"Nombre"},null,8,["modelValue"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(p,{label:"Fecha","prepend-inner-icon":"tabler-calendar",density:"compact","default-value":new Date,modelValue:i(n).fecha,"onUpdate:modelValue":a[10]||(a[10]=t=>i(n).fecha=t),"show-current":"true",onOnChange:a[11]||(a[11]=()=>{}),config:{mode:"range",altFormat:"F j, Y",dateFormat:"m-d-Y",maxDate:new Date,reactive:!0}},null,8,["default-value","modelValue","config"])]),_:1}),e(m,{cols:"6"},{default:l(()=>[e(I,{modelValue:i(n).isDefault,"onUpdate:modelValue":a[12]||(a[12]=t=>i(n).isDefault=t),density:"compact",label:"Default"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(v,{type:"submit"},{default:l(()=>[r(" Enviar ")]),_:1}),e(v,{color:"secondary",variant:"tonal",onClick:X},{default:l(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(E,{persistent:"","no-click-animation":"",width:s.$vuetify.display.smAndDown?"auto":600,"model-value":i(_),"onUpdate:modelValue":P},{default:l(()=>[e(d,{onClick:a[14]||(a[14]=t=>P(!1))}),e(N,{class:"pa-sm-14 pa-5"},{default:l(()=>[e(U,{class:"text-center"},{default:l(()=>[e(k,{class:"text-h5 mb-3 p-5"},{default:l(()=>[fe,ce,u("span",null,[r("el filtro "),u("i",null,F(i(V).nombre),1),r(" ?")])]),_:1})]),_:1}),e(U,null,{default:l(()=>[e(m,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(v,{color:"error",onClick:ee},{default:l(()=>[r(" Aceptar ")]),_:1}),e(v,{onClick:ae},{default:l(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"])]),_:1}))],64)}}};export{pe as default};
