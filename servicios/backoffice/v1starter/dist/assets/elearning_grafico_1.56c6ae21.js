import{R as X,S as K,U as Z,r as c,ak as ee,as as te,bP as p,v as ae,Q as L,z as oe,o as h,c as O,w as i,b as y,a as u,aT as se,u as n,i as V,$ as R,n as re,a2 as le,t as P,aU as ne,aV as ie,a1 as ce,p as ue,N as A,h as de,bU as pe,x as B,F as me,C as ve,bV as fe,L as ge,X as be,bx as he,g as ye}from"./index.88d3c7f5.js";import{V as xe}from"./VSlideGroupItem.ca4927bd.js";const we={class:"mt-n4 me-n2 d-flex align-center"},_e=["onClick"],Se={class:"mb-0"},Ce={key:1,class:"py-4"},ke={__name:"elearning_grafico_1",setup(Ve){const $=X.exports.extendMoment(K);$.locale("es",[Z]);const x=c(null),E=c(!1),f=c(null),T=c([]),g=c([]),w=c([]);c([]);const m=c(0),k=c(!1),G=c(),j=c(""),z=c(""),_=c({categories:[],data:[],colors:["#7367F0"]}),S=c({categories:[],completados:[],registrados:[]}),I={enero:"01",febrero:"02",marzo:"03",abril:"04",mayo:"05",junio:"06",julio:"07",agosto:"08",septiembre:"09",octubre:"10",noviembre:"11",diciembre:"12"},W={enero:"Ene",febrero:"Feb",marzo:"Mar",abril:"Abr",mayo:"May",junio:"Jun",julio:"Jul",agosto:"Ago",septiembre:"Sep",octubre:"Oct",noviembre:"Nov",diciembre:"Dic"},Y=t=>{const a=`rgba(${p(t.colors["on-surface"])},${t.variables["medium-emphasis-opacity"]})`,s=`rgba(${p(t.colors["on-surface"])},${t.variables["disabled-opacity"]})`,e=`rgba(${p(String(t.variables["border-color"]))},${t.variables["border-opacity"]})`,o=`rgba(${p(t.colors["on-surface"])},${t.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:a,themeDisabledTextColor:s,themeBorderColor:e,themePrimaryTextColor:o}},b=ee();Y(b.current.value),te(async()=>{const t=b.current.value.colors,a=b.current.value.variables,s=`rgba(${p(t.primary)},${a["dragged-opacity"]})`;j.value=s,z.value=t,await q();for(var e=2023;e<=2034;e++)w.value.push({title:e.toString(),value:e.toString()}),T.value.push({title:e.toString(),value:e.toString()}),g.value=$().format("YYYY").toString()});async function D(t=2024){try{k.value=!1;var a=new Headers;a.append("Content-Type","application/json");var s={method:"GET",headers:a,redirect:"follow"},e=await fetch(`https://servicio-elearning.vercel.app/grafico/students/mes/grouped?anio=${t}`,s);const o=await e.json();if(o.resp){const d=o.data.map(l=>W[l.mes]),r=o.data.map(l=>l.registros||0),v=o.data.map(l=>I[l.mes]==$().format("MM")?z.value.primary:j.value);_.value={categories:d,data:r,colors:v}}else alert("No se pudo cargar el gr\xE1fico, intente nuevamente");k.value=!0}catch(o){return alert("No se pudo cargar el gr\xE1fico, intente nuevamente"),console.error(o.message)}}async function q(){try{var t=new Headers;t.append("Content-Type","application/json");var a={method:"GET",headers:t,redirect:"follow"},s=await fetch("https://servicio-elearning.vercel.app/grafico/cursos/numero-estudiantes/grouped",a);const e=await s.json();if(e.resp){const o=e.data.map(v=>v.titulo),d=e.data.map(v=>v.registrados||0),r=e.data.map(v=>v.completados||0);S.value={categories:o,registrados:d,completados:r}}else alert("No se pudo cargar el gr\xE1fico, intente nuevamente")}catch(e){return alert("No se pudo cargar el gr\xE1fico, intente nuevamente"),console.error(e.message)}}const C=ae(()=>{const t=b.current.value.colors,a=b.current.value.variables;`${p(t.success)}`;const s=`rgba(${p(t["on-background"])},${a["high-emphasis-opacity"]})`,e=`rgba(${p(t.primary)},${a["dragged-opacity"]})`,o=`rgba(${p(t["on-background"])},${a["high-emphasis-opacity"]})`,d=`rgba(${p(String(a["border-color"]))},${a["border-opacity"]})`,r=`rgba(${p(t["on-surface"])},${a["disabled-opacity"]})`;j.value=e,z.value=t;const v=[t["grey-300"],t.primary];return[{title:"Usuarios",icon:"tabler-users",chartOptions:{chart:{parentHeightOffset:0,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{columnWidth:"32%",startingShape:"rounded",borderRadius:4,distributed:!0,dataLabels:{position:"top"}}},grid:{show:!1,padding:{top:0,bottom:0,left:-10,right:-10}},colors:_.value.colors,dataLabels:{enabled:!0,formatter(l){return`${l}`},offsetY:-25,style:{fontSize:"15px",colors:[o],fontWeight:"600",fontFamily:"Public Sans"}},legend:{show:!1},tooltip:{enabled:!1},xaxis:{categories:_.value.categories,axisBorder:{show:!0,color:d},axisTicks:{show:!1},labels:{style:{colors:r,fontSize:"14px",fontFamily:"Public Sans"}}},yaxis:{title:{text:"Usuarios registrados",style:{fontSize:"11px",fontFamily:"Public Sans",color:r}},labels:{formatter(l){return`${parseInt(l/1)}`},style:{fontSize:"14px",colors:r,fontFamily:"Public Sans"},min:0,max:6e4,tickAmount:6}},responsive:[{breakpoint:1441,options:{plotOptions:{bar:{columnWidth:"41%"}}}},{breakpoint:590,options:{plotOptions:{bar:{columnWidth:"61%"}},yaxis:{labels:{show:!1}},grid:{padding:{right:0,left:-20}},dataLabels:{style:{fontSize:"12px",fontWeight:"400"}}}}]},series:[{data:_.value.data}],height:270},{title:"Curso",icon:"tabler-forms",chartOptions:{chart:{parentHeightOffset:0,zoom:{enabled:!1},toolbar:{show:!1},type:"bar",height:350,events:{dataPointSelection:function(l,M,N){}}},colors:v,stroke:{show:!0,width:1,colors:["transparent"]},dataLabels:{enabled:!1},xaxis:{categories:S.value.categories,axisBorder:{show:!0,color:d},axisTicks:{show:!1},labels:{style:{colors:r,fontSize:"11px",fontFamily:"Public Sans"}}},yaxis:{title:{text:"Mejores 5 cursos",style:{fontSize:"11px",fontFamily:"Public Sans",color:r}},labels:{formatter(l){return`${parseInt(l/1)}`},style:{fontSize:"14px",colors:r,fontFamily:"Public Sans"},min:0,max:6e4,tickAmount:6}},fill:{opacity:1},tooltip:{y:{formatter:function(l){return l+" Visitas"}},theme:!1,custom:function({series:l,seriesIndex:M,dataPointIndex:N,w:F}){return`<div class="tooltip-content">
              <div class="tooltip-body">
                <div class="tooltip-title">
                  ${F.config.xaxis.categories[N]}
                </div>
                <!--<div class="tooltip-subtitle">
                  Campa\xF1a
                </div>-->
                <div class="tooltip-data-flex">
                  <div class="tooltip-data-title">
                    ${F.config.series[M].name}
                  </div>
                  <div class="tooltip-data-value">
                    ${l[M][N]}
                  </div>
                </div>
              </div>
            </div>`}},legend:{labels:{colors:s,useSeriesColors:!1}},states:{hover:{filter:{type:"none"}}},grid:{show:!1,padding:{top:0,bottom:0,left:-10,right:-10}}},series:[{name:"Usuarios Registrados",data:S.value.registrados},{name:"Usuarios que completaron el curso",data:S.value.completados}],height:270}]});async function U(t={}){try{const{limit:o=1e3,page:d=1}=t;var a=new Headers;a.append("Content-Type","application/json");var s={method:"GET",headers:a,redirect:"follow"},e=await fetch(`https://servicio-elearning.vercel.app/grafico-export-all/students/mes/grouped?page=${d}&limit=${o}&anio=${g.value}`,s);const r=await e.json();return r.resp?r.data.length<1?null:r.data:null}catch{return console.log("No se pudo cargar el gr\xE1fico, intente nuevamente"),null}}function H(t){const a=Object.keys(t[0]).join(","),s=t.map(e=>Object.values(e).join(","));return[a,...s].join(`
`)}function J(t,a){const s=new Blob([t],{type:"text/csv"}),e=URL.createObjectURL(s),o=document.createElement("a");o.setAttribute("hidden",""),o.setAttribute("href",e),o.setAttribute("download",a),document.body.appendChild(o),o.click(),document.body.removeChild(o)}async function Q(){m.value=="0",m.value=="1";var t=1e3,a=1,s=await U({limit:t,page:a});if(!s)return alert("No hay datos que exportar"),!0;for(;;){a++;var e=await U({limit:t,page:a});if(!e)break;s.push(...e)}const o=H(s);J(o,"estudiantes_registrados.csv")}return L(async()=>g.value,async()=>{g.value&&await D(g.value)}),L(async()=>f.value,async()=>{f.value?w.value=T.value.filter(t=>t.title.toLowerCase().indexOf(f.value.toLowerCase())>-1||t.value.indexOf(f.value)>-1):w.value=T.value}),L(x,t=>{t||setTimeout(()=>{f.value=""},1e3)}),(t,a)=>{const s=oe("v-list-item-content");return h(),O(ye,{title:"Usuarios registrados",subtitle:"Mira los usuarios registrados, cursos y logros"},{append:i(()=>[y("div",we,[u(se,{class:"mr-3",style:{"min-width":"150px"},menu:n(x),"onUpdate:menu":a[1]||(a[1]=e=>V(x)?x.value=e:null),"no-data-text":"No existen el a\xF1o que deseas buscar",disabled:n(E),"item-text":"title","item-value":"value",modelValue:n(g),"onUpdate:modelValue":a[2]||(a[2]=e=>V(g)?g.value=e:null),items:n(w),label:"Filtrar por a\xF1o","menu-props":{maxHeight:"400"}},{"prepend-item":i(()=>[u(R,null,{default:i(()=>[u(s,null,{default:i(()=>[u(re,{modelValue:n(f),"onUpdate:modelValue":a[0]||(a[0]=e=>V(f)?f.value=e:null),clearable:"",placeholder:"Buscar"},null,8,["modelValue"])]),_:1})]),_:1}),u(le,{class:"mt-2"})]),selection:i(({item:e})=>[y("div",null,P(e.title),1)]),item:i(({item:e,props:o})=>[u(R,ne(ie(o)),{default:i(()=>[u(s,null,{default:i(()=>[u(ce,null,{default:i(()=>[y("p",null,"_id: "+P(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"]),u(ue,{icon:"",size:"x-small",variant:"plain",color:"default",onClick:Q},{default:i(()=>[u(A,{size:"22",color:"success",icon:"tabler-download"})]),_:1})])]),default:i(()=>[u(de,null,{default:i(()=>[u(pe,{modelValue:n(m),"onUpdate:modelValue":a[3]||(a[3]=e=>V(m)?m.value=e:null),"show-arrows":"",mandatory:""},{default:i(()=>[(h(!0),B(me,null,ve(n(C),(e,o)=>(h(),O(xe,{key:e.title,value:o},{default:i(({isSelected:d,toggle:r})=>[y("div",{style:fe([{width:"110px",height:"94px"},d?"border-color:rgb(var(--v-theme-primary)) !important":""]),class:ge([d?"border":"border border-dashed","d-flex flex-column justify-center align-center cursor-pointer rounded px-5 py-2 me-6"]),onClick:r},[u(be,{rounded:"",size:"38",color:d?"primary":"secondary",variant:"tonal",class:"mb-2"},{default:i(()=>[u(A,{icon:e.icon},null,8,["icon"])]),_:2},1032,["color"]),y("p",Se,P(e.title),1)],14,_e)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(k)?(h(),O(n(he),{ref_key:"refVueApexChart",ref:G,key:n(m),options:n(C)[Number(n(m))].chartOptions,series:n(C)[Number(n(m))].series,height:n(C)[Number(n(m))].height,class:"mt-3"},null,8,["options","series","height"])):(h(),B("div",Ce," Cargando datos... "))]),_:1})]),_:1})}}};export{ke as _};
