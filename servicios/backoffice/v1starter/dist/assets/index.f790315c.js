import{M as ce,R as ue,S as fe,U as ve,r as _,as as _e,v as L,o as v,c as U,w as s,a as l,e as q,g as R,u as r,h as me,x as b,Z as ge,b3 as pe,F as Y,C as M,b4 as he,b5 as be,b as e,X as xe,q as m,t as c,aM as T,b6 as ye,aW as O,L as F,ao as A,ap as D,aQ as $,aR as Q,p as C,V as Ue,a4 as W,bd as we,be as Ce}from"./index.88d3c7f5.js";const J=V=>(we("data-v-d589424a"),V=V(),Ce(),V),Ne={key:0},Pe={style:{},class:F("d-flex align-center text-secondary")},Re={style:{border:"1px solid rgba(var(--v-theme-on-background), var(--v-disabled-opacity))","border-radius":"7px"}},Ve=J(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Ciudad"),e("th",{scope:"col"},"Sesiones"),e("th",{scope:"col"},"Visitas de P\xE1ginas")])],-1)),ke=["onClick"],Ie={style:{display:"flex","flex-wrap":"wrap"}},Se={style:{width:"max-content"}},Ye={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},Me=J(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Nombre"),e("th",{scope:"col"},"Ciudad"),e("th",{scope:"col"},"Sesiones"),e("th",{scope:"col"},"Visitas de P\xE1ginas")])],-1)),Ae={class:"text-high-emphasis"},De={class:"text-medium-emphasis"},$e={class:"text-medium-emphasis"},Ee={class:"text-medium-emphasis"},je={class:"d-flex align-center justify-space-between botonescurrentPage"},Be={class:"mt-5"},Le={style:{display:"flex","flex-wrap":"wrap"}},Te={style:{width:"max-content"}},Oe={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},Fe=J(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"Nombre"),e("th",{scope:"col"},"Sesiones"),e("th",{scope:"col"},"Visitas de P\xE1ginas")])],-1)),Je={class:"text-high-emphasis"},Ze={class:"text-medium-emphasis"},ze={class:"text-medium-emphasis"},He={class:"d-flex align-center justify-space-between botonescurrentPage"},qe={__name:"index",setup(V){const k=ue.exports.extendMoment(fe);k.locale("es",[ve]);const w=_([]),N=_({}),E=_(!0),X=_(""),x=_([]),P=_([]),h=8;_(k().format("DD/MM/YYYY HH:mm:ss").toString()),_(JSON.parse(localStorage.getItem("userData"))),N.value={i:k().add(-2,"days"),f:k()},_e(async()=>{await G()});async function G(){var a=[];let i=1;for(;;){const o=await(await fetch(`https://servicio-de-actividad.vercel.app/ubicaciones/dataUsuarios/all?fechai=${N.value.i.format("MM-DD-YYYY")}&fechaf=${N.value.f.format("MM-DD-YYYY")}&page=${i}`)).json();if(o.data.length===0)break;a.push(...o.data),w.value=Array.from(a),i+=1,w.value===0?E.value=!0:E.value=!1}}const K=L(()=>(X.value,w.value)),j=_(!1),I=_(""),ee=a=>{if(I.value!==a){I.value=a;let t=Array.from(w.value).filter(n=>n.country===a),o=[];t.forEach(n=>{n.data.forEach(f=>{f.dataUsers.forEach(y=>{let de={userId:y.userId,first_name:y.first_name,last_name:y.last_name,totalNavigationRecordUser:y.totalNavigationRecordUser,sesionesUser:y.sesionesUser,city:f.city};o.push(de)})})});let u={};for(let n of o){let f=`${n.userId}-${n.first_name}-${n.last_name}`;u[f]?(u[f].totalNavigationRecordUser+=n.totalNavigationRecordUser,u[f].sesionesUser+=n.sesionesUser):u[f]={userId:n.userId,first_name:n.first_name,last_name:n.last_name,totalNavigationRecordUser:n.totalNavigationRecordUser,sesionesUser:n.sesionesUser,city:n.city}}let d=Object.values(u);x.value=d,g.value=1,x.value.length>0&&(j.value=!0)}},g=_(1),Z=L(()=>{const a=(g.value-1)*h,i=a+h;return x.value.slice(a,i)}),te=()=>{g.value*h<x.value.length&&g.value++},ae=()=>{g.value>1&&g.value--},B=_(!1),S=_(""),se=a=>{if(S.value!==a){S.value=a;let t=Array.from(w.value).flatMap(d=>d.data).find(d=>d.city===a).dataUsers,o={};for(let d of t){let n=`${d.userId}-${d.first_name}-${d.last_name}`;o[n]?(o[n].totalNavigationRecordUser+=d.totalNavigationRecordUser,o[n].sesionesUser+=d.sesionesUser):o[n]={userId:d.userId,first_name:d.first_name,last_name:d.last_name,totalNavigationRecordUser:d.totalNavigationRecordUser,sesionesUser:d.sesionesUser}}let u=Object.values(o);P.value=u,p.value=1,x.value.length>0&&(B.value=!0)}},p=_(1),z=L(()=>{const a=(p.value-1)*h,i=a+h;return P.value.slice(a,i)}),oe=()=>{p.value*h<P.value.length&&p.value++},le=()=>{p.value>1&&p.value--};function ie(a){for(var i=typeof a!="object"?JSON.parse(a):a,t="",o=0;o<i.length;o++){var u="";for(var d in i[o])u!=""&&(u+=","),u+=i[o][d];t+=u+`\r
`}return t}function H(a,i,t){a&&i[0].wylexId!=="wylexId"&&i.unshift(a);var o=JSON.stringify(i),u=ie(o),d=t+".csv"||"export.csv",n=new Blob([u],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,d);else{var f=document.createElement("a");if(f.download!==void 0){var y=URL.createObjectURL(n);f.setAttribute("href",y),f.setAttribute("download",d),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}}async function ne(){let a={userId:"userId",first_name:"first_name",last_name:"last_name",totalNavigationRecordUser:"totalNavigationRecordUser",sesionesUser:"sesionesUser",city:"city"},i=[];i=Array.from(x.value);let t="usuarios_"+I.value.replace(/[^A-Z0-9]+/ig,"_");W("export-usersCountry"),H(a,i,t)}async function re(){let a={userId:"userId",first_name:"first_name",last_name:"last_name",totalNavigationRecordUser:"totalNavigationRecordUser",sesionesUser:"sesionesUser"},i=[];i=Array.from(P.value);let t="usuarios_"+S.value.replace(/[^A-Z0-9]+/ig,"_");W("export-usersCity"),H(a,i,t)}return(a,i)=>(v(),U(Ue,null,{default:s(()=>[l(q,{lg:"6",cols:"12",sm:"6"},{default:s(()=>[l(R,{title:"Resumen de datos demogr\xE1ficos de los \xFAltimos 30 d\xEDas",subtitle:"Datos de usuarios registrados desde "+r(N).i.format("YYYY-MM-DD")+" hasta "+r(N).f.format("YYYY-MM-DD")},{default:s(()=>[l(me,null,{default:s(()=>[r(E)?(v(),b("div",Ne,"Cargando datos...")):(v(),U(ge,{key:1,class:"card-list"},{default:s(()=>[l(pe,{variant:"accordion"},{default:s(()=>[(v(!0),b(Y,null,M(r(K),t=>(v(),U(he,{key:t.country,onClick:o=>ee(t.country)},{default:s(()=>[l(be,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:s(()=>[e("div",null,[l(xe,{class:"ava",size:"34",image:"https://www.countryflagicons.com/FLAT/64/"+t.countryCode+".png"},null,8,["image"]),m(" "+c(t.country),1)]),e("div",Pe,[l(T,{label:""},{default:s(()=>[m(c(t.data.length)+" "+c(t.data.length>1?"Ciudades":"Ciudad"),1)]),_:2},1024)])]),_:2},1024),l(ye,null,{default:s(()=>[e("div",Re,[l(O,{class:"text-no-wrap",hover:""},{default:s(()=>[Ve,e("tbody",null,[(v(!0),b(Y,null,M(t.data,o=>(v(),b("tr",{class:"clickable",key:o.city,onClick:u=>se(o.city)},[e("td",null,c(o.city),1),e("td",null,[e("div",{class:F(`d-flex align-center font-weight-semibold ${o.sesiones>0?"text-success":"text-error"}`)},[l(T,{label:""},{default:s(()=>[m(c(o.sesiones),1)]),_:2},1024)],2)]),e("td",null,[e("div",{class:F(`d-flex align-center font-weight-semibold ${o.sesiones>0?"text-warning":"text-error"}`)},[l(T,{label:""},{default:s(()=>[m(c(o.totalNavigationRecord),1)]),_:2},1024)],2)])],8,ke))),128))])]),_:2},1024)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}))]),_:1})]),_:1},8,["subtitle"])]),_:1}),l(q,{lg:"6",cols:"12",sm:"6"},{default:s(()=>[e("div",null,[r(Z).length===0?A((v(),U(R,{key:0},{default:s(()=>[m("No existen datos")]),_:1},512)),[[D,r(j)]]):A((v(),U(R,{key:1},{default:s(()=>[l($,{class:"pb-sm-0"},{default:s(()=>[e("div",Ie,[e("div",Se,[l(Q,null,{default:s(()=>[m("Usuarios de "+c(r(I)),1)]),_:1})]),e("div",Ye,[l(C,{color:"success",onClick:ne},{default:s(()=>[m(" Exportar ")]),_:1})])]),l(O,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:s(()=>[Me,e("tbody",null,[(v(!0),b(Y,null,M(r(Z),t=>(v(),b("tr",null,[e("td",Ae,c(t.first_name)+" "+c(t.last_name),1),e("td",De,c(t.city),1),e("td",$e,c(t.sesionesUser),1),e("td",Ee,c(t.totalNavigationRecordUser),1)]))),256))])]),_:1})]),_:1}),l($,null,{default:s(()=>[e("div",je,[l(C,{icon:"tabler-arrow-big-left-lines",onClick:ae,disabled:r(g)===1},null,8,["disabled"]),m(" P\xE1gina "+c(r(g))+" ",1),l(C,{icon:"tabler-arrow-big-right-lines",onClick:te,disabled:r(g)*h>=r(x).length},null,8,["disabled"])])]),_:1})]),_:1},512)),[[D,r(j)]])]),e("div",Be,[r(z).length===0?A((v(),U(R,{key:0},{default:s(()=>[m("No existen datos")]),_:1},512)),[[D,r(B)]]):A((v(),U(R,{key:1},{default:s(()=>[l($,{class:"pb-sm-0"},{default:s(()=>[e("div",Le,[e("div",Te,[l(Q,null,{default:s(()=>[m("Usuarios de la ciudad de "+c(r(S)),1)]),_:1})]),e("div",Oe,[l(C,{color:"success",onClick:re},{default:s(()=>[m(" Exportar ")]),_:1})])]),l(O,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:s(()=>[Fe,e("tbody",null,[(v(!0),b(Y,null,M(r(z),t=>(v(),b("tr",null,[e("td",Je,c(t.first_name)+" "+c(t.last_name),1),e("td",Ze,c(t.sesionesUser),1),e("td",ze,c(t.totalNavigationRecordUser),1)]))),256))])]),_:1})]),_:1}),l($,null,{default:s(()=>[e("div",He,[l(C,{icon:"tabler-arrow-big-left-lines",onClick:le,disabled:r(p)===1},null,8,["disabled"]),m(" P\xE1gina "+c(r(p))+" ",1),l(C,{icon:"tabler-arrow-big-right-lines",onClick:oe,disabled:r(p)*h>=r(P).length},null,8,["disabled"])])]),_:1})]),_:1},512)),[[D,r(B)]])])]),_:1})]),_:1}))}},We=ce(qe,[["__scopeId","data-v-d589424a"]]);export{We as default};
