import{M as ze,ak as Je,r as m,R as We,S as Qe,U as qe,v as ce,I as Ge,as as Xe,o as g,x as V,a as n,w as r,e as k,b7 as Ze,u as h,i as P,b8 as ue,q as w,V as de,ba as fe,g as z,h as B,aQ as ae,aR as te,b2 as Ke,t as p,a3 as me,c as A,bF as ea,F as U,C as j,p as H,b as c,n as aa,aW as he,bD as ve,ao as pe,ap as Ye,a2 as ta,b9 as la,aX as sa,bd as oa,be as na,bE as _e}from"./index.88d3c7f5.js";import ra from"./notas-drivers.0bde3fff.js";import{V as De,a as ye}from"./VTimelineItem.36b36f8a.js";const ge=$=>(oa("data-v-d0d1a39f"),$=$(),na(),$),ia={key:0,class:"date-picker-wrapper",style:{width:"300px"}},ca={style:{width:"20rem"}},ua=ge(()=>c("thead",null,[c("tr",null,[c("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),c("th",{scope:"col"},"VISITAS")])],-1)),da=["onClick"],fa={class:"text-medium-emphasis"},ma={class:"d-flex align-center justify-space-between botonescurrentPage"},ha={style:{display:"flex","flex-wrap":"wrap"}},va={style:{width:"max-content"}},pa={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},Ya=ge(()=>c("thead",null,[c("tr",null,[c("th",{scope:"col"},"Nombre"),c("th",{scope:"col"},"Fecha"),c("th",{scope:"col"},"Cantidad"),c("th",{scope:"col"},"Hora")])],-1)),_a=["onClick"],Da={class:"text-high-emphasis"},ya={class:"text-medium-emphasis"},ga={class:"text-medium-emphasis"},ba={class:"text-medium-emphasis"},wa={class:"d-flex justify-space-between align-center flex-wrap"},Ma={class:"text-base font-weight-semibold me-1"},xa={class:"d-flex justify-space-between align-center"},Va={class:"d-flex justify-space-between align-center flex-wrap"},Fa={class:"text-base font-weight-semibold me-1"},Sa={class:"mt-0 mb-0"},Ta={style:{"font-size":"10px","font-style":"italic"}},Ca={__name:"indexNovale",setup($){Je();const C=m(0),y=We.exports.extendMoment(Qe);y.locale("es",[qe]);const F=m([]),J=m([]),O=m(!0),E=8,M=m(1),I=m(""),W=m([]),Q=m([]),be=ce(()=>F.value.length),le=m(""),se=m(""),q=m(!1),G=m(!1),we=m(""),X=m([]),oe=m({}),R=m(""),Z=m({}),K=m(""),ne=m([]),re=m(""),Me=Ge(),S=m(""),L=m([]);async function xe(){await fetch("https://servicio-filtros.vercel.app/visitas/all").then(a=>a.json()).then(a=>{X.value=Array.from(a)}).catch(a=>a);let t=Array.from(X.value);if(t.length>0){let a=t.filter(s=>s.isDefault===!0);Z.value=a[0],R.value=a[0]._id,I.value=String(a[0].fecha)}}async function ee(t,a){O.value=!0;let s,e;if(t&&a)s=t,e=a;else if(Z.value){let o=Z.value.fecha.split("a");s=y(o[0]).add(1,"days").format("MM/DD/YYYY"),e=y(o[1]).add(-1,"days").format("MM/DD/YYYY")}else s=y().add(-6,"days").format("MM-DD-YYYY"),e=y().add(1,"days").format("MM-DD-YYYY");var i=new Headers;i.append("Content-Type","application/json");var d=JSON.stringify({fechai:s,fechaf:e}),Y={method:"POST",headers:i,body:d,redirect:"follow"};const l=[];await fetch("https://servicio-de-actividad.vercel.app/count",Y).then(o=>o.text()).then(async o=>{let u=parseInt(o);var f=new Headers;f.append("Content-Type","application/json");for(let v=1;v<u+1;v++){var _=JSON.stringify({fechai:s,fechaf:e,page:v}),b={method:"POST",headers:f,body:_,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/full",b).then(D=>D.json()).then(async D=>{let T=Array.from(D.data);T.forEach(N=>{J.value.push(N)});for(const N of T)for(const ie of N.navigationRecord){let Le={title:ie.title,url:ie.url};l.push(Le)}}).catch(D=>D)}const x=l.reduce((v,D)=>{var T=v.findIndex(N=>N.title==D.title||N.url==D.url);return T===-1?v.push({url:D.url,title:D.title,count:1}):v[T].count++,v},[]);L.value=Array.from(x),L.value.sort((v,D)=>D.count-v.count),F.value=Array.from(x),F.value.sort((v,D)=>D.count-v.count),O.value=!1}).catch(o=>o)}async function Ve(){await xe();let t=y().add(-7,"days").format("MM-DD-YYYY"),a=y().format("MM-DD-YYYY");I.value=String(t+" a "+a),ee()}async function Fe(t,a,s){try{if(R.value="",t.length>1){let e=y(t[0]).add(1,"days").format("MM/DD/YYYY"),i=y(t[1]).format("MM/DD/YYYY");le.value=e,se.value=i,await ee(e,i)}}catch(e){console.error(e)}}async function Se(t){try{let a=t.toString().split("a");if(a.length>1){let s=y(a[0]).add(1,"days").format("MM/DD/YYYY"),e=y(a[1]).format("MM/DD/YYYY");le.value=s,se.value=e,await ee(s,e)}}catch(a){console.error(a)}}async function Te(t){await fetch("https://servicio-filtros.vercel.app/visitas/id?"+new URLSearchParams({id:t})).then(s=>s.json()).then(s=>{oe.value=s}).catch(s=>s);let a=oe.value;I.value=String(a.fecha),await Se(a.fecha)}const Ce=()=>{let t=localStorage.getItem("role");t!=="administrador"&&t!=="webmaster"&&Me.push({path:"/pages/errors/not-authorized"})};Xe(()=>{Ce(),Ve()});const Ie=ce(()=>{const t=(M.value-1)*E,a=t+E;return F.value.slice(t,a)}),Ne=()=>{M.value*E<F.value.length&&M.value++},ke=()=>{M.value>1&&M.value--},Ae=()=>{if(S.value!==""){M.value=1;const t=S.value.endsWith("/")?S.value.replace(/\/$/,"").trim():S.value.trim(),a=L.value.filter(s=>s.url.trim().includes(t));F.value=a}},Ue=()=>{M.value=1,S.value="",G.value=!1,q.value=!1,F.value=L.value},He=t=>{K.value=t;const a=J.value.map(({first_name:l,last_name:o,navigationRecord:u})=>({first_name:l,last_name:o,navigationRecord:u})),s=[];for(let l of a)for(let o of l.navigationRecord)if(o.title===t||o.url===t){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],i=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let u=y(o.fecha,e,!0).format("DD/MM/YYYY"),f=o.hora.split(":");if(f[2].indexOf(" ")>=0){let v=f[2].split(" ");f[2]=v[0]}let _=f[0]+":"+f[1]+":"+f[2],b=u+" "+_,x=y(b,i,!0).format();if(l.first_name!==void 0&&l.last_name!==void 0&&l.first_name!==null&&l.last_name!==null&&l.first_name!==""&&l.last_name!==""){let v={first_name:l.first_name,last_name:l.last_name,url:o.url,title:o.title,fecha:u,fechaRaw:o.fecha,fullFecha:x,hora:_,horaRaw:o.hora};s.push(v)}}let d={};s.forEach(l=>{let o=l.first_name+"-"+l.last_name;d.hasOwnProperty(o)?(new Date(l.fullFecha)>new Date(d[o].fullFecha)&&(d[o]=l),d[o].cantidad=(d[o].cantidad||1)+1):(l.cantidad=1,d[o]=l)});let Y=Object.values(d);Y.sort((l,o)=>{var u=new Date(l.fullFecha),f=new Date(o.fullFecha);return f-u}),W.value=Y.slice(0,25),ne.value=W.value.map(({first_name:l,last_name:o,fecha:u,hora:f,cantidad:_,title:b,url:x})=>({first_name:l,last_name:o,fecha:u,hora:f,cantidad:_,title:b,url:x})),q.value=!0,we.value=t};function Oe(t){const a=[];let s=null;return t.forEach((e,i)=>{i===0||e.title!==t[i-1].title?(s={title:e.title,url:e.url,fecha:e.fecha,hora:e.hora,fullFecha:e.fullFecha,data:[e]},a.push(s)):s.data.push(e)}),a}var Re=function(t={}){const{fecha:a,indice:s,dataActual:e,dataTotal:i,indiceDelTotal:d,tamanioTotal:Y,objectoActual:l=null}=t,o=JSON.stringify(e),u=JSON.parse(o);if(u.length-1>s){const b=u[s*1+1],x=`${b.fecha} ${b.hora}`;return _e(x,a,u[s],b)}var f={},_=null;return Y-1>d&&(f=i[d*1+1],_=`${f.fecha} ${f.hora}`),Y-1==d&&u.length-1==s?{tiempoTranscurrido:"Fin de la navegaci\xF3n",fechai:a,fechaf:null,tipo:""}:_e(_,a,i[d],i[d*1+1])},Pe=function(t={}){const{data:a,index:s}=t;var e=[],i=Q.value,d=i.length;for(var Y in a){const l=`${a[Y].fecha} ${a[Y].hora}`,o=Re({fecha:l,indice:Y,indiceDelTotal:s,dataTotal:i,tamanioTotal:d,dataActual:a,objectoActual:null}),u=`${o.tiempoTranscurrido}`;e.push({title:u,fechai:o.fechai,fechaf:o.fechaf})}return e};const Be=(t,a)=>{const s=J.value.map(({first_name:l,last_name:o,navigationRecord:u})=>({first_name:l,last_name:o,navigationRecord:u})),e=[];re.value=t+" "+a;let i=t+" "+a;for(let l of s)if(l.first_name+" "+l.last_name==i)for(let u of l.navigationRecord){var d=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],Y=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let f=y(u.fecha,d,!0).format("DD/MM/YYYY"),_=u.hora.split(":");if(_[2].indexOf(" ")>=0){let T=_[2].split(" ");_[2]=T[0]}let b=_[0]+":"+_[1]+":"+_[2],x=f+" "+b,v=y(x,Y,!0).format(),D={first_name:l.first_name,last_name:l.last_name,url:u.url,title:u.title,fecha:f,fechaRaw:u.fecha,fullFecha:v,hora:b};e.push(D)}e.sort((l,o)=>{var u=new Date(l.fullFecha),f=new Date(o.fullFecha);return f-u}),Q.value=Oe(e),G.value=!0};function je(t){for(var a=typeof t!="object"?JSON.parse(t):t,s="",e=0;e<a.length;e++){var i="";for(var d in a[e])i!=""&&(i+=","),i+=a[e][d];s+=i+`\r
`}return s}function $e(t,a,s){t&&a[0].wylexId!=="wylexId"&&a.unshift(t);var e=JSON.stringify(a),i=je(e),d=s+".csv"||"export.csv",Y=new Blob([i],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(Y,d);else{var l=document.createElement("a");if(l.download!==void 0){var o=URL.createObjectURL(Y);l.setAttribute("href",o),l.setAttribute("download",d),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}async function Ee(){let t={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},a=[];a=Array.from(ne.value);let s="ultimos_usuarios_"+K.value.replace(/[^A-Z0-9]+/ig,"_");$e(t,a,s)}return(t,a)=>{const s=sa;return g(),V(U,null,[n(de,{style:{"margin-bottom":"0.5rem"}},{default:r(()=>[n(k,{lg:"12",cols:"12",sm:"6"},{default:r(()=>[n(Ze,{modelValue:h(C),"onUpdate:modelValue":a[0]||(a[0]=e=>P(C)?C.value=e:null),class:"v-tabs-pill"},{default:r(()=>[n(ue,null,{default:r(()=>[w(" Ecuavisa.com ")]),_:1}),n(ue,null,{default:r(()=>[w(" Notas drivers ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(la,{modelValue:h(C),"onUpdate:modelValue":a[4]||(a[4]=e=>P(C)?C.value=e:null)},{default:r(()=>[n(fe,null,{default:r(()=>[n(de,null,{default:r(()=>[n(k,{lg:"12",cols:"12",sm:"6"},{default:r(()=>[n(z,null,{default:r(()=>[n(B,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:r(()=>[n(ae,{class:"pb-sm-0"},{default:r(()=>[n(te,null,{default:r(()=>[w("P\xE1ginas m\xE1s vistas (Ecuavisa.com)")]),_:1}),n(Ke,null,{default:r(()=>[w("Un total de "+p(h(be))+" registros",1)]),_:1})]),_:1}),h(O)?me("",!0):(g(),V("div",ia,[n(s,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:h(I),"onUpdate:modelValue":a[1]||(a[1]=e=>P(I)?I.value=e:null),"show-current":"true",onOnChange:Fe,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"m-d-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),n(k,{cols:"12"},{default:r(()=>[h(O)?me("",!0):(g(),A(ea,{key:0,modelValue:h(R),"onUpdate:modelValue":a[2]||(a[2]=e=>P(R)?R.value=e:null),color:"primary",class:"d-none",divided:""},{default:r(()=>[(g(!0),V(U,null,j(h(X),e=>(g(),A(H,{value:e._id,onClick:i=>Te(e._id)},{default:r(()=>[w(p(e.nombre),1)]),_:2},1032,["value","onClick"]))),256))]),_:1},8,["modelValue"]))]),_:1}),n(k,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[c("div",ca,[n(aa,{modelValue:h(S),"onUpdate:modelValue":a[3]||(a[3]=e=>P(S)?S.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),n(H,{"prepend-icon":"tabler-search",onClick:Ae},{default:r(()=>[w(" Buscar ")]),_:1}),n(H,{onClick:Ue},{default:r(()=>[w(" Reiniciar ")]),_:1})]),_:1})]),_:1}),h(O)?(g(),A(B,{key:0},{default:r(()=>[w("Cargando datos...")]),_:1})):(g(),A(B,{key:1},{default:r(()=>[n(he,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:r(()=>[ua,c("tbody",null,[(g(!0),V(U,null,j(h(Ie),e=>(g(),V("tr",null,[c("td",{class:"clickable",onClick:i=>He(e.title||e.url)},p(e.title?e.title:e.url),9,da),c("td",fa,p(e.count),1)]))),256))])]),_:1}),c("div",ma,[n(H,{icon:"tabler-arrow-big-left-lines",onClick:ke,disabled:h(M)===1},null,8,["disabled"]),w(" P\xE1gina "+p(h(M))+" ",1),n(H,{icon:"tabler-arrow-big-right-lines",onClick:Ne,disabled:h(M)*E>=h(F).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),n(k,{lg:"6",cols:"12",sm:"6"},{default:r(()=>[n(ve,null,{default:r(()=>[pe(n(z,null,{default:r(()=>[n(ae,{class:"pb-sm-0"},{default:r(()=>[c("div",ha,[c("div",va,[n(te,null,{default:r(()=>[w("\xDAltimas visitas a la p\xE1gina "+p(h(K)),1)]),_:1})]),c("div",pa,[n(H,{color:"primary",onClick:Ee},{default:r(()=>[w(" Exportar ")]),_:1})])]),n(he,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:r(()=>[Ya,c("tbody",null,[(g(!0),V(U,null,j(h(W),e=>(g(),V("tr",{class:"clickable",onClick:i=>Be(e.first_name,e.last_name)},[c("td",Da,p(e.first_name)+" "+p(e.last_name),1),c("td",ya,p(e.fecha),1),c("td",ga,p(e.cantidad),1),c("td",ba,p(e.hora),1)],8,_a))),256))])]),_:1})]),_:1})]),_:1},512),[[Ye,h(q)]])]),_:1})]),_:1}),n(k,{lg:"6",cols:"12",sm:"6"},{default:r(()=>[n(ve,null,{default:r(()=>[pe(n(z,null,{default:r(()=>[n(ae,null,{default:r(()=>[n(te,null,{default:r(()=>[w("Actividad del usuario "+p(h(re)),1)]),_:1})]),_:1}),n(B,null,{default:r(()=>[n(De,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:r(()=>[(g(!0),V(U,null,j(h(Q),e=>(g(),A(ye,{"dot-color":"primary",size:"x-small"},{default:r(()=>[c("div",wa,[c("h4",Ma,p(e.title||e.url),1)]),n(z,{class:"",variant:"text"},{default:r(()=>[n(B,null,{default:r(()=>[c("div",xa,[n(De,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact timeline-2"},{default:r(()=>[(g(!0),V(U,null,j(h(Pe)({data:e.data,index:t.index}),(i,d)=>(g(),A(ye,{"dot-color":"info",size:"x-small"},{default:r(()=>[c("div",Va,[c("h4",Fa,p(i.fechai),1)]),c("p",Sa,p(i.title),1),n(ta),c("small",Ta,p(i.fechai)+" "+p(i.fechaf?"hasta "+i.fechaf:""),1)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[Ye,h(G)]])]),_:1})]),_:1})]),_:1})]),_:1}),n(fe,null,{default:r(()=>[n(ra)]),_:1})]),_:1},8,["modelValue"])],64)}}},Aa=ze(Ca,[["__scopeId","data-v-d0d1a39f"]]);export{Aa as default};
