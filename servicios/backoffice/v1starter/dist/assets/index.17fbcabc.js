import{r as u,v as A,as as ae,z as te,o as m,x as V,a as e,w as t,q as i,t as c,u as n,f as le,g as x,b2 as R,h as T,n as oe,c as U,aM as ne,a3 as D,aW as re,b as a,F as $,C as z,p as h,i as E,b0 as M,e as ie,b9 as ue,ba as de,aR as ce,N as j,Z as F,$ as G,a0 as O,a2 as me,V as pe,bc as fe}from"./index.88d3c7f5.js";const ve=a("br",null,null,-1),_e=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Usuario"),a("th",{scope:"col"},"Correo"),a("th",{scope:"col"},"Agregar")])],-1),ge=a("br",null,null,-1),be=a("b",null,"_id: ",-1),he={class:"text-medium-emphasis"},Ve={class:"text-medium-emphasis"},ye={key:1},we=a("td",{colspan:"3"},"No hay datos",-1),Ce=[we],ke={class:"d-flex flex-wrap py-4 gap-4 align-items-center",style:{"justify-content":"space-between"}},xe={class:"px-4"},Te=a("br",null,null,-1),Ue={class:"pl-3"},De=a("div",{class:"loading"},null,-1),je={class:"nombre-desafio d-flex flex-column"},Ie={class:"d-flex"},Le=a("small",null,"Usuario",-1),Ne={class:"text-disabled"},$e={class:"p-0"},Ee=a("b",null,"_id:",-1),Me={class:"content-items d-flex"},Se={class:"content-userTest"},Be={class:"content-time pl-3"},Pe=a("b",null,"UserId: ",-1),qe={class:"espacio-right-2"},Ae={class:"d-flex align-center justify-space-between botonescurrentPage"},Ge={__name:"index",setup(Re){const I=u("tab-lista"),g=u([]),C=u([]),L=u(!1),W=u(!1),S=u(null),f=u(null),B=u(""),d=u({message:"Datos guardados",type:"success",model:!1}),y=u({mensaje:"",visible:!1}),p=u(!1),v=u(!1),k=8,_=u(1),P=A(()=>{const o=(_.value-1)*k,l=o+k;return g.value.slice(o,l)}),J=()=>{_.value*k<g.value.length&&_.value++},Z=()=>{_.value>1&&_.value--};async function H(){p.value=!0,v.value=!0,L.value&&await q(),v.value=!1}async function K(o){try{v.value=!0;const r=await(await fetch(`https://ads-service.vercel.app/busqueda/user/?s=${encodeURIComponent(o)}`)).json();v.value=!1,r.resp?(C.value=r.data,y.value.visible=!1,L.value=!0):(y.value.mensaje=r.error,y.value.visible=!0)}catch(l){console.error(l)}}function Q(o){clearTimeout(S.value),S.value=setTimeout(async()=>{console.log(o),await K(o.target.value)},1e3)}async function N(o=1,l=10){try{var r=new Headers;r.append("Content-Type","application/json");var w={method:"GET",headers:r,redirect:"follow"},s=await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/usertester/usertester/listar.php",w);const b=await s.json();g.value=b}catch(b){return console.error(b.message)}}async function X(o){try{var l=new Headers;l.append("Content-Type","application/json");var r={method:"POST",headers:l,body:JSON.stringify({name:`${o.first_name} ${o.last_name}`,userId:o.wylexId,email:o.email}),redirect:"follow"};v.value=!0;var w=await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/usertester/usertester/add.php",r);const s=await w.json();return v.value=!1,s.resp?(d.value={message:"Usuario a\xF1adido",type:"success",model:!0},await N(),p.value=!1,!0):(d.value={message:s.mensaje,type:"error",model:!0},p.value=!0,!1)}catch(s){return d.value={message:"No se pudo cargar los usuarios, intente nuevamente",type:"error",model:!0},p.value=!0,console.log(s),[]}}async function q(){try{const l=await(await fetch("https://ads-service.vercel.app/busqueda/user/")).json();C.value=l.data,L.value=!1}catch(o){return d.value={message:"No se pudo cargar los usuarios, intente nuevamente",type:"error",model:!0},console.log(o),[]}}ae(async()=>{await N(),await q()});const Y=A(()=>C.value);function ee(o){f.value=!0,B.value=o}async function se(){var o={method:"DELETE",redirect:"follow"};const r=await(await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/usertester/usertester/eliminar.php?id="+B.value,o)).json();r.resp?d.value={message:"Usuario eliminado correctamente",type:"success",model:!0}:d.value={message:r.mensaje,type:"error",model:!0},await N(),f.value=!1}return(o,l)=>{const r=fe,w=te("moduloTemplate");return m(),V("section",null,[e(le,{modelValue:n(d).model,"onUpdate:modelValue":l[0]||(l[0]=s=>n(d).model=s),location:"top end",variant:"flat",timeout:n(d).timeout||2e3,color:n(d).type},{default:t(()=>[i(c(n(d).message),1)]),_:1},8,["modelValue","timeout","color"]),e(M,{modelValue:n(p),"onUpdate:modelValue":l[2]||(l[2]=s=>E(p)?p.value=s:null),persistent:"",class:"v-dialog-lg"},{default:t(()=>[e(r,{onClick:l[1]||(l[1]=s=>p.value=!n(p))}),e(x,{title:"Lista de usuarios"},{default:t(()=>[e(R,{class:"pl-6 mb-3"},{default:t(()=>[i(" Solo se obtendr\xE1 los 20 primeros registros de acuerdo a la b\xFAsqueda. ")]),_:1}),e(T,null,{default:t(()=>[e(oe,{disabled:n(v),"append-inner-icon":"tabler-user-search",type:"text",onInput:Q,label:"Buscar por correo, tel\xE9fono o nombre",placeholder:"Buscar usuarios"},null,8,["disabled"]),n(y).visible?(m(),U(ne,{key:0,color:"error",class:"mt-2"},{default:t(()=>[i(" Error: "+c(n(y).mensaje),1)]),_:1})):D("",!0),ve,e(re,{style:{width:"100%"},class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:t(()=>[_e,a("tbody",null,[n(C).length>0?(m(!0),V($,{key:0},z(n(Y),s=>(m(),V("tr",{key:s.userId,class:""},[a("td",null,[i(c((s.last_name+" "+s.first_name).length>25?(s.last_name+" "+s.first_name).substring(0,25)+"...":s.last_name+" "+s.first_name)+" ",1),ge,be,a("small",null,c(s.wylexId),1)]),a("td",he,c(s.email),1),a("td",Ve,[e(h,{disabled:n(v),class:"mt-4",color:"success",onClick:b=>X(s),icon:"mdi-plus-circle-outline",variant:"text"},null,8,["disabled","onClick"])])]))),128)):(m(),V("tr",ye,Ce))])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:o.isDialogVisibleAddModulo,"onUpdate:modelValue":l[4]||(l[4]=s=>o.isDialogVisibleAddModulo=s),width:"600"},{default:t(()=>[e(r,{onClick:l[3]||(l[3]=s=>o.isDialogVisibleAddModulo=!o.isDialogVisibleAddModulo)}),e(x,null,{default:t(()=>[e(w,{"onGet:eventModalCR":o.receiveTime},null,8,["onGet:eventModalCR"])]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:n(f),"onUpdate:modelValue":l[7]||(l[7]=s=>E(f)?f.value=s:null),persistent:"",class:"v-dialog-sm"},{default:t(()=>[e(r,{onClick:l[5]||(l[5]=s=>f.value=!n(f))}),e(x,{title:"Eliminar registro"},{default:t(()=>[e(T,null,{default:t(()=>[i(" \xBFDesea eliminar el registro? ")]),_:1}),e(T,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[e(h,{color:"secondary",variant:"tonal",onClick:l[6]||(l[6]=s=>f.value=!1)},{default:t(()=>[i(" No, cerrar ")]),_:1}),e(h,{onClick:se},{default:t(()=>[i(" Si, eliminar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(pe,null,{default:t(()=>[e(ie,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:t(()=>[e(x,{class:"mt-5"},{default:t(()=>[e(T,null,{default:t(()=>[e(ue,{modelValue:n(I),"onUpdate:modelValue":l[8]||(l[8]=s=>E(I)?I.value=s:null)},{default:t(()=>[e(de,{value:"tab-lista"},{default:t(()=>[a("div",ke,[a("div",null,[e(ce,null,{default:t(()=>[i(" Listado de usuarios que podr\xE1n ver nuevas funcionalidades ")]),_:1}),e(R,null,{default:t(()=>[i(" Mantenimiento de usuarios tester ")]),_:1})])]),a("div",xe,[e(h,{color:"success",class:"mb-4",onClick:H},{default:t(()=>[i(" A\xF1adir usuarios "),e(j,{end:"",icon:"mdi-account-plus"})]),_:1}),Te,a("small",Ue,"Total de usuarios a\xF1adidos: "+c(n(g).length),1),n(g).length<1?(m(),U(F,{key:0,lines:"two",border:""},{default:t(()=>[e(G,null,{default:t(()=>[e(O,null,{default:t(()=>[De]),_:1})]),_:1})]),_:1})):D("",!0),n(g).length>0?(m(),U(F,{key:1,lines:"two",border:""},{default:t(()=>[(m(!0),V($,null,z(n(P),(s,b)=>(m(),V($,{key:b},[e(G,{disabled:n(W)},{append:t(()=>[a("div",qe,[e(h,{title:"Eliminar el registro",icon:"",size:"x-small",color:"error",variant:"text",onClick:ze=>ee(s.id)},{default:t(()=>[e(j,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]),default:t(()=>[e(O,null,{default:t(()=>[a("div",je,[a("div",Ie,[Le,a("small",Ne,[a("code",$e,[Ee,i(c(s.id),1)])])]),a("label",null,c(s.name),1),a("div",Me,[a("div",Se,[e(j,{size:"20",icon:"tabler-mail"}),i(" "+c(s.email),1)]),a("div",Be,[e(j,{size:"20",icon:"tabler-user"}),Pe,i(" "+c(s.userId),1)])])])]),_:2},1024)]),_:2},1032,["disabled"]),b<n(P).length-1?(m(),U(me,{key:0})):D("",!0)],64))),128))]),_:1})):D("",!0),a("div",Ae,[e(h,{icon:"tabler-arrow-big-left-lines",onClick:Z,disabled:n(_)===1},null,8,["disabled"]),i(" P\xE1gina "+c(n(_))+" ",1),e(h,{icon:"tabler-arrow-big-right-lines",onClick:J,disabled:n(_)*k>=n(g).length},null,8,["disabled"])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{Ge as default};
