import{M as Oe,R as Pe,S as Be,U as Ee,r as h,v as re,bA as ae,bB as Le,as as $e,Q as je,o as D,x,a as n,w as i,q as g,t as v,u as d,f as ze,e as E,g as L,aQ as $,b as r,bC as Je,i as te,aR as j,b2 as ce,h as I,a3 as Qe,n as qe,p as A,c as z,aW as ue,F as J,C as Q,L as de,bD as fe,ao as me,ap as he,a2 as We,V as Ge,a4 as Xe,bE as ve,aX as Ze,bd as Ke,be as ea}from"./index.88d3c7f5.js";import{V as pe,a as _e}from"./VTimelineItem.36b36f8a.js";const Ye=N=>(Ke("data-v-9331b356"),N=N(),ea(),N),aa={class:"d-flex"},ta={class:"descripcion"},la={class:"bg-ecuavisa py-2"},sa={class:"date-picker-wrapper",style:{width:"250px"}},oa={key:0,class:"date-picker-wrapper",style:{width:"300px",display:"none"}},na={style:{width:"20rem"}},ia=Ye(()=>r("thead",null,[r("tr",null,[r("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),r("th",{scope:"col"},"VISITAS")])],-1)),ra=["onClick"],ca={class:"text-medium-emphasis"},ua={class:"d-flex align-center justify-space-between botonescurrentPage",id:"target"},da={style:{display:"flex","flex-wrap":"wrap"}},fa={style:{width:"max-content"}},ma={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},ha=Ye(()=>r("thead",null,[r("tr",null,[r("th",{scope:"col"},"Nombre"),r("th",{scope:"col"},"Fecha"),r("th",{scope:"col"},"Cantidad"),r("th",{scope:"col"},"Hora")])],-1)),va=["onClick"],pa={class:"text-high-emphasis"},_a={class:"text-medium-emphasis"},Ya={class:"text-medium-emphasis"},Da={class:"text-medium-emphasis"},ga={class:"d-flex justify-space-between align-center flex-wrap"},ba={class:"text-base font-weight-semibold me-1"},ya={class:"d-flex justify-space-between align-center"},wa={class:"d-flex justify-space-between align-center flex-wrap"},Ma={class:"text-base font-weight-semibold me-1"},xa={class:"mt-0 mb-0"},Va={style:{"font-size":"10px","font-style":"italic"}},Fa={__name:"notas-drivers",setup(N){const y=Pe.exports.extendMoment(Be);y.locale("es",[Ee]);const k=h(""),H=h(""),U=h(""),F=h(!1),R=h([]),w=h([]),Y=h(1),O=8,q=h([]),le=re(()=>w.value.length),W=h(""),G=h([]),X=h(!1),se=h([]),De=h(""),Z=h([]),P=h(!1),oe=h(""),M=h(""),ne=h(null),ie=h(null);h(y().format("DD/MM/YYYY HH:mm:ss").toString()),h(JSON.parse(localStorage.getItem("userData")));const K=ae(),C=h({message:"Datos guardados",type:"success",model:!1}),B=h({i:K.i,f:K.f,title:K.title}),S=h("Hoy"),ge=Le();async function ee(l="",t=""){F.value=!0;const o=[];var e=new Headers;e.append("Content-Type","application/json");var f=JSON.stringify({fechai:l,fechaf:t}),u={method:"POST",headers:e,body:f,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/driver/full",u).then(a=>a.json()).then(a=>{let s=Array.from(a.data);s.forEach(c=>{q.value.push(c)});for(const c of s)for(const m of c.navigationRecord){let _={title:m.title,url:m.url};o.push(_)}}).catch(a=>{C.value={message:"No se pudo recuperar los registros de notas drivers.",type:"error",timeout:4e3,model:!0},console.error(a)});const p=o.reduce((a,s)=>{var c=a.findIndex(m=>m.title==s.title||m.url==s.url);return c===-1?a.push({url:s.url,title:s.title,count:1}):a[c].count++,a},[]);R.value=Array.from(p),R.value.sort((a,s)=>s.count-a.count),w.value=Array.from(p),w.value.sort((a,s)=>s.count-a.count),F.value=!1}async function be(l){try{if(l.length>1){Y.value=1;let t=y(l[0]).format("MM/DD/YYYY"),o=y(l[1]).format("MM/DD/YYYY");k.value=t,H.value=o,await ee(t,o)}}catch(t){console.error(t)}}const ye=re(()=>{const l=(Y.value-1)*O,t=l+O;return w.value.slice(l,t)}),we=()=>{Y.value*O<w.value.length&&Y.value++},Me=()=>{Y.value>1&&Y.value--},xe=()=>{U.value=k.value+" a "+H.value};$e(async()=>{let l=ae(S.value);B.value={i:l.i,f:l.f,title:l.title},Y.value=1;let t=l.i.format("MM/DD/YYYY"),o=l.f.format("MM/DD/YYYY");k.value=t,H.value=o,xe(),await ee(t,o)});const Ve=()=>{if(M.value!==""){Y.value=1;const l=M.value.endsWith("/")?M.value.replace(/\/$/,"").trim():M.value.trim(),t=R.value.filter(o=>o.url.trim().includes(l));w.value=t}},Fe=()=>{Y.value=1,M.value="",P.value=!1,X.value=!1,w.value=R.value},Ce=l=>{W.value=l,ne.value=l,P.value=!1,setTimeout(()=>{document.getElementById("target").scrollIntoView({behavior:"smooth"})},100);const t=q.value.map(({first_name:a,last_name:s,navigationRecord:c})=>({first_name:a,last_name:s,navigationRecord:c})),o=[];for(let a of t)for(let s of a.navigationRecord)if(s.title===l||s.url===l){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],f=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let c=y(s.fecha,e,!0).format("DD/MM/YYYY"),m=s.hora.split(":");if(m[2].indexOf(" ")>=0){let T=m[2].split(" ");m[2]=T[0]}let _=m[0]+":"+m[1]+":"+m[2],b=c+" "+_,V=y(b,f,!0).format();if(a.first_name!==void 0&&a.last_name!==void 0&&a.first_name!==null&&a.last_name!==null&&a.first_name!==""&&a.last_name!==""){let T={first_name:a.first_name,last_name:a.last_name,url:s.url,title:s.title,fecha:c,fechaRaw:s.fecha,fullFecha:V,hora:_,horaRaw:s.hora};o.push(T)}}let u={};o.forEach(a=>{let s=a.first_name+"-"+a.last_name;u.hasOwnProperty(s)?(new Date(a.fullFecha)>new Date(u[s].fullFecha)&&(u[s]=a),u[s].cantidad=(u[s].cantidad||1)+1):(a.cantidad=1,u[s]=a)});let p=Object.values(u);p.sort((a,s)=>{var c=new Date(a.fullFecha),m=new Date(s.fullFecha);return m-c}),G.value=p.slice(0,25),se.value=G.value.map(({first_name:a,last_name:s,fecha:c,hora:m,cantidad:_,title:b,url:V})=>({first_name:a,last_name:s,fecha:c,hora:m,cantidad:_,title:b,url:V})),X.value=!0,De.value=l};function Se(l){for(var t=typeof l!="object"?JSON.parse(l):l,o="",e=0;e<t.length;e++){var f="";for(var u in t[e])f!=""&&(f+=","),f+=t[e][u];o+=f+`\r
`}return o}function Te(l,t,o){l&&t[0].wylexId!=="wylexId"&&t.unshift(l);var e=JSON.stringify(t),f=Se(e),u=o+".csv"||"export.csv",p=new Blob([f],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(p,u);else{var a=document.createElement("a");if(a.download!==void 0){var s=URL.createObjectURL(p);a.setAttribute("href",s),a.setAttribute("download",u),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}async function Ie(){let l={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},t=[];t=Array.from(se.value);let o="drivers_ultimos_usuarios_"+W.value.replace(/[^A-Z0-9]+/ig,"_");Xe("export-notasDrivers"),Te(l,t,o)}function Ae(l){const t=[];let o=null;return l.forEach((e,f)=>{f===0||e.title!==l[f-1].title?(o={title:e.title,url:e.url,fecha:e.fecha,hora:e.hora,fullFecha:e.fullFecha,data:[e]},t.push(o)):o.data.push(e)}),t}var Ne=function(l={}){const{data:t,index:o}=l;var e=[],f=Z.value,u=f.length;for(var p in t){const a=`${t[p].fecha} ${t[p].hora}`,s=He({fecha:a,indice:p,indiceDelTotal:o,dataTotal:f,tamanioTotal:u,dataActual:t,objectoActual:null}),c=`${s.tiempoTranscurrido}`;e.push({title:c,fechai:s.fechai,fechaf:s.fechaf})}return e};const ke=(l,t)=>{ie.value=l;const o=q.value.map(({first_name:a,last_name:s,navigationRecord:c})=>({first_name:a,last_name:s,navigationRecord:c})),e=[];oe.value=l+" "+t;let f=l+" "+t;for(let a of o)if(a.first_name+" "+a.last_name==f)for(let c of a.navigationRecord){var u=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],p=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let m=y(c.fecha,u,!0).format("DD/MM/YYYY"),_=c.hora.split(":");if(_[2].indexOf(" ")>=0){let Re=_[2].split(" ");_[2]=Re[0]}let b=_[0]+":"+_[1]+":"+_[2],V=m+" "+b,T=y(V,p,!0).format(),Ue={first_name:a.first_name,last_name:a.last_name,url:c.url,title:c.title,fecha:m,fechaRaw:c.fecha,fullFecha:T,hora:b};e.push(Ue)}e.sort((a,s)=>{var c=new Date(s.fullFecha),m=new Date(a.fullFecha);return m-c}),Z.value=Ae(e),P.value=!0};var He=function(l={}){const{fecha:t,indice:o,dataActual:e,dataTotal:f,indiceDelTotal:u,tamanioTotal:p,objectoActual:a=null}=l,s=JSON.stringify(e),c=JSON.parse(s);if(c.length-1>o){const b=c[o*1+1],V=`${b.fecha} ${b.hora}`;return ve(V,t,c[o],b)}var m={},_=null;return p-1>u&&(m=f[u*1+1],_=`${m.fecha} ${m.hora}`),p-1==u&&c.length-1==o?{tiempoTranscurrido:"Fin de la navegaci\xF3n",fechai:t,fechaf:null,tipo:""}:ve(_,t,f[u],f[u*1+1])};return je(async()=>S.value,async()=>{F.value=!0;let l=ae(S.value);B.value={i:l.i,f:l.f,title:l.title};let t=l.i.format("MM/DD/YYYY"),o=l.f.format("MM/DD/YYYY");k.value=t,H.value=o,await ee(t,o)}),(l,t)=>{const o=Ze;return D(),x("section",null,[n(ze,{modelValue:d(C).model,"onUpdate:modelValue":t[0]||(t[0]=e=>d(C).model=e),location:"top end",variant:"flat",timeout:d(C).timeout||2e3,color:d(C).type},{default:i(()=>[g(v(d(C).message),1)]),_:1},8,["modelValue","timeout","color"]),n(Ge,null,{default:i(()=>[n(E,{lg:"12",cols:"12"},{default:i(()=>[n(L,null,{default:i(()=>[n($,{class:"header_card_item"},{append:i(()=>[r("div",la,[r("div",sa,[n(Je,{disabled:d(F),modelValue:d(S),"onUpdate:modelValue":t[1]||(t[1]=e=>te(S)?S.value=e:null),items:d(ge),variant:"outlined",label:"Fecha","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])])]),default:i(()=>[r("div",aa,[r("div",ta,[n(j,null,{default:i(()=>[g("P\xE1ginas m\xE1s vistas")]),_:1}),n(ce,null,{default:i(()=>[g("Un total de "+v(d(le))+" registros, mostrando data desde "+v(d(B).i.format("YYYY-MM-DD"))+" hasta "+v(d(B).f.format("YYYY-MM-DD")),1)]),_:1})])])]),_:1}),n(I,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:i(()=>[n($,{class:"pb-sm-0",style:{display:"none"}},{default:i(()=>[n(j,null,{default:i(()=>[g("P\xE1ginas m\xE1s vistas ")]),_:1}),n(ce,null,{default:i(()=>[g("Un total de "+v(d(le))+" registros",1)]),_:1})]),_:1}),d(F)?Qe("",!0):(D(),x("div",oa,[n(o,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:d(U),"onUpdate:modelValue":t[2]||(t[2]=e=>te(U)?U.value=e:null),"show-current":"true",onOnChange:be,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),n(E,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:i(()=>[r("div",na,[n(qe,{modelValue:d(M),"onUpdate:modelValue":t[3]||(t[3]=e=>te(M)?M.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),n(A,{"prepend-icon":"tabler-search",onClick:Ve},{default:i(()=>[g(" Buscar ")]),_:1}),n(A,{onClick:Fe},{default:i(()=>[g(" Reiniciar ")]),_:1})]),_:1})]),_:1}),d(F)?(D(),z(I,{key:0},{default:i(()=>[g("Cargando datos...")]),_:1})):(D(),z(I,{key:1},{default:i(()=>[n(ue,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[ia,r("tbody",null,[(D(!0),x(J,null,Q(d(ye),e=>(D(),x("tr",{class:de(["clickable",{active:e.title===d(ne)}]),onClick:f=>Ce(e.title||e.url)},[r("td",null,v(e.title?e.title:e.url),1),r("td",ca,v(e.count),1)],10,ra))),256))])]),_:1}),r("div",ua,[n(A,{icon:"tabler-arrow-big-left-lines",onClick:Me,disabled:d(Y)===1},null,8,["disabled"]),g(" P\xE1gina "+v(d(Y))+" ",1),n(A,{icon:"tabler-arrow-big-right-lines",onClick:we,disabled:d(Y)*O>=d(w).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),n(E,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(fe,null,{default:i(()=>[me(n(L,null,{default:i(()=>[n($,{class:"pb-sm-0"},{default:i(()=>[r("div",da,[r("div",fa,[n(j,null,{default:i(()=>[g("\xDAltimas visitas a la p\xE1gina "+v(d(W)),1)]),_:1})]),r("div",ma,[n(A,{color:"success",onClick:Ie},{default:i(()=>[g(" Exportar ")]),_:1})])]),n(ue,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[ha,r("tbody",null,[(D(!0),x(J,null,Q(d(G),e=>(D(),x("tr",{class:de(["clickable",{active:e.first_name===d(ie)}]),key:e.first,onClick:f=>ke(e.first_name,e.last_name)},[r("td",pa,v(e.first_name)+" "+v(e.last_name),1),r("td",_a,v(e.fecha),1),r("td",Ya,v(e.cantidad),1),r("td",Da,v(e.hora),1)],10,va))),128))])]),_:1})]),_:1})]),_:1},512),[[he,d(X)]])]),_:1})]),_:1}),n(E,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(fe,null,{default:i(()=>[me(n(L,null,{default:i(()=>[n($,null,{default:i(()=>[n(j,null,{default:i(()=>[g("Actividad del usuario "+v(d(oe)),1)]),_:1})]),_:1}),n(I,null,{default:i(()=>[n(pe,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:i(()=>[(D(!0),x(J,null,Q(d(Z),(e,f)=>(D(),z(_e,{"dot-color":"primary",size:"x-small"},{default:i(()=>[r("div",ga,[r("h4",ba,v(e.title||e.url),1)]),n(L,{class:"",variant:"text"},{default:i(()=>[n(I,null,{default:i(()=>[r("div",ya,[n(pe,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact timeline-2"},{default:i(()=>[(D(!0),x(J,null,Q(d(Ne)({data:e.data,index:f}),(u,p)=>(D(),z(_e,{"dot-color":"info",size:"x-small"},{default:i(()=>[r("div",wa,[r("h4",Ma,v(u.fechai),1)]),r("p",xa,v(u.title),1),n(We),r("small",Va,v(u.fechai)+" "+v(u.fechaf?"hasta "+u.fechaf:""),1)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[he,d(P)]])]),_:1})]),_:1})]),_:1})])}}},Ta=Oe(Fa,[["__scopeId","data-v-9331b356"]]);export{Ta as default};
