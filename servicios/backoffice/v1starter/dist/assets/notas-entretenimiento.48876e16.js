import{M as Re,R as Oe,S as Pe,U as Be,r as h,v as re,bA as te,bB as Le,as as $e,Q as je,o as D,x,a as n,w as i,q as g,t as v,u as d,f as ze,e as B,g as L,aQ as $,b as r,bC as Je,i as ae,aR as j,b2 as ce,h as I,a3 as Qe,n as qe,p as A,c as z,aW as ue,F as J,C as Q,L as de,bD as fe,ao as me,ap as he,a2 as We,V as Ge,a4 as Xe,bE as ve,aX as Ze,bd as Ke,be as et}from"./index.88d3c7f5.js";import{V as pe,a as _e}from"./VTimelineItem.36b36f8a.js";const Ye=N=>(Ke("data-v-86041bfe"),N=N(),et(),N),tt={class:"d-flex"},at={class:"descripcion"},lt={class:"bg-ecuavisa py-2"},st={class:"date-picker-wrapper",style:{width:"250px"}},ot={key:0,class:"date-picker-wrapper",style:{width:"300px",display:"none"}},nt={style:{width:"20rem"}},it=Ye(()=>r("thead",null,[r("tr",null,[r("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),r("th",{scope:"col"},"VISITAS")])],-1)),rt=["onClick"],ct={class:"text-medium-emphasis"},ut={class:"d-flex align-center justify-space-between botonescurrentPage",id:"target"},dt={style:{display:"flex","flex-wrap":"wrap"}},ft={style:{width:"max-content"}},mt={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},ht=Ye(()=>r("thead",null,[r("tr",null,[r("th",{scope:"col"},"Nombre"),r("th",{scope:"col"},"Fecha"),r("th",{scope:"col"},"Cantidad"),r("th",{scope:"col"},"Hora")])],-1)),vt=["onClick"],pt={class:"text-high-emphasis"},_t={class:"text-medium-emphasis"},Yt={class:"text-medium-emphasis"},Dt={class:"text-medium-emphasis"},gt={class:"d-flex justify-space-between align-center flex-wrap"},bt={class:"text-base font-weight-semibold me-1"},yt={class:"d-flex justify-space-between align-center"},wt={class:"d-flex justify-space-between align-center flex-wrap"},Mt={class:"text-base font-weight-semibold me-1"},xt={class:"mt-0 mb-0"},Vt={style:{"font-size":"10px","font-style":"italic"}},Ft={__name:"notas-entretenimiento",setup(N){const y=Oe.exports.extendMoment(Pe);y.locale("es",[Be]);const k=h(""),H=h(""),U=h(""),F=h(!1),E=h([]),w=h([]),Y=h(1),R=8,q=h([]),le=re(()=>w.value.length),W=h(""),G=h([]),X=h(!1),se=h([]),De=h(""),Z=h([]),O=h(!1),oe=h(""),M=h(""),ne=h(null),ie=h(null);h(y().format("DD/MM/YYYY HH:mm:ss").toString()),h(JSON.parse(localStorage.getItem("userData")));const K=te(),P=h({i:K.i,f:K.f,title:K.title}),C=h({message:"Datos guardados",type:"success",model:!1}),S=h("Hoy"),ge=Le();async function ee(l="",a=""){F.value=!0;const o=[];var e=new Headers;e.append("Content-Type","application/json");var f=JSON.stringify({fechai:l,fechaf:a}),u={method:"POST",headers:e,body:f,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/seccion/full/Entretenimiento",u).then(t=>t.json()).then(t=>{let s=Array.from(t.data);s.forEach(c=>{q.value.push(c)});for(const c of s)for(const m of c.navigationRecord){let _={title:m.title,url:m.url};o.push(_)}}).catch(t=>{C.value={message:"No se pudo recuperar los registros de entretenimiento, por favor intente nuevamente.",type:"error",timeout:4e3,model:!0},console.error(t)});const p=o.reduce((t,s)=>{var c=t.findIndex(m=>m.title==s.title||m.url==s.url);return c===-1?t.push({url:s.url,title:s.title,count:1}):t[c].count++,t},[]);E.value=Array.from(p),E.value.sort((t,s)=>s.count-t.count),w.value=Array.from(p),w.value.sort((t,s)=>s.count-t.count),F.value=!1}async function be(l){try{if(l.length>1){Y.value=1;let a=y(l[0]).format("MM/DD/YYYY"),o=y(l[1]).format("MM/DD/YYYY");k.value=a,H.value=o,await ee(a,o)}}catch(a){console.error(a)}}const ye=re(()=>{const l=(Y.value-1)*R,a=l+R;return w.value.slice(l,a)}),we=()=>{Y.value*R<w.value.length&&Y.value++},Me=()=>{Y.value>1&&Y.value--},xe=()=>{U.value=k.value+" a "+H.value};$e(async()=>{let l=te(S.value);P.value={i:l.i,f:l.f,title:l.title},Y.value=1;let a=l.i.format("MM/DD/YYYY"),o=l.f.format("MM/DD/YYYY");k.value=a,H.value=o,xe(),await ee(a,o)});const Ve=()=>{if(M.value!==""){Y.value=1;const l=M.value.endsWith("/")?M.value.replace(/\/$/,"").trim():M.value.trim(),a=E.value.filter(o=>o.url.trim().includes(l));w.value=a}},Fe=()=>{Y.value=1,M.value="",O.value=!1,X.value=!1,w.value=E.value},Ce=l=>{W.value=l,ne.value=l,O.value=!1,setTimeout(()=>{document.getElementById("target").scrollIntoView({behavior:"smooth"})},100);const a=q.value.map(({first_name:t,last_name:s,navigationRecord:c})=>({first_name:t,last_name:s,navigationRecord:c})),o=[];for(let t of a)for(let s of t.navigationRecord)if(s.title===l||s.url===l){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],f=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let c=y(s.fecha,e,!0).format("DD/MM/YYYY"),m=s.hora.split(":");if(m[2].indexOf(" ")>=0){let T=m[2].split(" ");m[2]=T[0]}let _=m[0]+":"+m[1]+":"+m[2],b=c+" "+_,V=y(b,f,!0).format();if(t.first_name!==void 0&&t.last_name!==void 0&&t.first_name!==null&&t.last_name!==null&&t.first_name!==""&&t.last_name!==""){let T={first_name:t.first_name,last_name:t.last_name,url:s.url,title:s.title,fecha:c,fechaRaw:s.fecha,fullFecha:V,hora:_,horaRaw:s.hora};o.push(T)}}let u={};o.forEach(t=>{let s=t.first_name+"-"+t.last_name;u.hasOwnProperty(s)?(new Date(t.fullFecha)>new Date(u[s].fullFecha)&&(u[s]=t),u[s].cantidad=(u[s].cantidad||1)+1):(t.cantidad=1,u[s]=t)});let p=Object.values(u);p.sort((t,s)=>{var c=new Date(t.fullFecha),m=new Date(s.fullFecha);return m-c}),G.value=p.slice(0,25),se.value=G.value.map(({first_name:t,last_name:s,fecha:c,hora:m,cantidad:_,title:b,url:V})=>({first_name:t,last_name:s,fecha:c,hora:m,cantidad:_,title:b,url:V})),X.value=!0,De.value=l};function Se(l){for(var a=typeof l!="object"?JSON.parse(l):l,o="",e=0;e<a.length;e++){var f="";for(var u in a[e])f!=""&&(f+=","),f+=a[e][u];o+=f+`\r
`}return o}function Te(l,a,o){l&&a[0].wylexId!=="wylexId"&&a.unshift(l);var e=JSON.stringify(a),f=Se(e),u=o+".csv"||"export.csv",p=new Blob([f],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(p,u);else{var t=document.createElement("a");if(t.download!==void 0){var s=URL.createObjectURL(p);t.setAttribute("href",s),t.setAttribute("download",u),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}async function Ie(){let l={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},a=[];a=Array.from(se.value);let o="entretenimiento_ultimos_usuarios_"+W.value.replace(/[^A-Z0-9]+/ig,"_");Xe("export-notasEntretenimiento"),Te(l,a,o)}function Ae(l){const a=[];let o=null;return l.forEach((e,f)=>{f===0||e.title!==l[f-1].title?(o={title:e.title,url:e.url,fecha:e.fecha,hora:e.hora,fullFecha:e.fullFecha,data:[e]},a.push(o)):o.data.push(e)}),a}var Ne=function(l={}){const{data:a,index:o}=l;var e=[],f=Z.value,u=f.length;for(var p in a){const t=`${a[p].fecha} ${a[p].hora}`,s=He({fecha:t,indice:p,indiceDelTotal:o,dataTotal:f,tamanioTotal:u,dataActual:a,objectoActual:null}),c=`${s.tiempoTranscurrido}`;e.push({title:c,fechai:s.fechai,fechaf:s.fechaf})}return e};const ke=(l,a)=>{ie.value=l;const o=q.value.map(({first_name:t,last_name:s,navigationRecord:c})=>({first_name:t,last_name:s,navigationRecord:c})),e=[];oe.value=l+" "+a;let f=l+" "+a;for(let t of o)if(t.first_name+" "+t.last_name==f)for(let c of t.navigationRecord){var u=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],p=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let m=y(c.fecha,u,!0).format("DD/MM/YYYY"),_=c.hora.split(":");if(_[2].indexOf(" ")>=0){let Ee=_[2].split(" ");_[2]=Ee[0]}let b=_[0]+":"+_[1]+":"+_[2],V=m+" "+b,T=y(V,p,!0).format(),Ue={first_name:t.first_name,last_name:t.last_name,url:c.url,title:c.title,fecha:m,fechaRaw:c.fecha,fullFecha:T,hora:b};e.push(Ue)}e.sort((t,s)=>{var c=new Date(s.fullFecha),m=new Date(t.fullFecha);return m-c}),Z.value=Ae(e),O.value=!0};var He=function(l={}){const{fecha:a,indice:o,dataActual:e,dataTotal:f,indiceDelTotal:u,tamanioTotal:p,objectoActual:t=null}=l,s=JSON.stringify(e),c=JSON.parse(s);if(c.length-1>o){const b=c[o*1+1],V=`${b.fecha} ${b.hora}`;return ve(V,a,c[o],b)}var m={},_=null;return p-1>u&&(m=f[u*1+1],_=`${m.fecha} ${m.hora}`),p-1==u&&c.length-1==o?{tiempoTranscurrido:"Fin de la navegaci\xF3n",fechai:a,fechaf:null,tipo:""}:ve(_,a,f[u],f[u*1+1])};return je(async()=>S.value,async()=>{F.value=!0;let l=te(S.value);P.value={i:l.i,f:l.f,title:l.title};let a=l.i.format("MM/DD/YYYY"),o=l.f.format("MM/DD/YYYY");k.value=a,H.value=o,await ee(a,o)}),(l,a)=>{const o=Ze;return D(),x("section",null,[n(ze,{modelValue:d(C).model,"onUpdate:modelValue":a[0]||(a[0]=e=>d(C).model=e),location:"top end",variant:"flat",timeout:d(C).timeout||2e3,color:d(C).type},{default:i(()=>[g(v(d(C).message),1)]),_:1},8,["modelValue","timeout","color"]),n(Ge,null,{default:i(()=>[n(B,{lg:"12",cols:"12"},{default:i(()=>[n(L,null,{default:i(()=>[n($,{class:"header_card_item"},{append:i(()=>[r("div",lt,[r("div",st,[n(Je,{disabled:d(F),modelValue:d(S),"onUpdate:modelValue":a[1]||(a[1]=e=>ae(S)?S.value=e:null),items:d(ge),variant:"outlined",label:"Fecha","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])])]),default:i(()=>[r("div",tt,[r("div",at,[n(j,null,{default:i(()=>[g("P\xE1ginas m\xE1s vistas")]),_:1}),n(ce,null,{default:i(()=>[g("Un total de "+v(d(le))+" registros, mostrando data desde "+v(d(P).i.format("YYYY-MM-DD"))+" hasta "+v(d(P).f.format("YYYY-MM-DD")),1)]),_:1})])])]),_:1}),n(I,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:i(()=>[n($,{class:"pb-sm-0",style:{display:"none"}},{default:i(()=>[n(j,null,{default:i(()=>[g("P\xE1ginas m\xE1s vistas")]),_:1}),n(ce,null,{default:i(()=>[g("Un total de "+v(d(le))+" registros",1)]),_:1})]),_:1}),d(F)?Qe("",!0):(D(),x("div",ot,[n(o,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:d(U),"onUpdate:modelValue":a[2]||(a[2]=e=>ae(U)?U.value=e:null),"show-current":"true",onOnChange:be,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),n(B,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:i(()=>[r("div",nt,[n(qe,{modelValue:d(M),"onUpdate:modelValue":a[3]||(a[3]=e=>ae(M)?M.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),n(A,{"prepend-icon":"tabler-search",onClick:Ve},{default:i(()=>[g(" Buscar ")]),_:1}),n(A,{onClick:Fe},{default:i(()=>[g(" Reiniciar ")]),_:1})]),_:1})]),_:1}),d(F)?(D(),z(I,{key:0},{default:i(()=>[g("Cargando datos...")]),_:1})):(D(),z(I,{key:1},{default:i(()=>[n(ue,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[it,r("tbody",null,[(D(!0),x(J,null,Q(d(ye),e=>(D(),x("tr",{class:de(["clickable",{active:e.title===d(ne)}]),onClick:f=>Ce(e.title||e.url)},[r("td",null,v(e.title?e.title:e.url),1),r("td",ct,v(e.count),1)],10,rt))),256))])]),_:1}),r("div",ut,[n(A,{icon:"tabler-arrow-big-left-lines",onClick:Me,disabled:d(Y)===1},null,8,["disabled"]),g(" P\xE1gina "+v(d(Y))+" ",1),n(A,{icon:"tabler-arrow-big-right-lines",onClick:we,disabled:d(Y)*R>=d(w).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),n(B,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(fe,null,{default:i(()=>[me(n(L,null,{default:i(()=>[n($,{class:"pb-sm-0"},{default:i(()=>[r("div",dt,[r("div",ft,[n(j,null,{default:i(()=>[g("\xDAltimas visitas a la p\xE1gina "+v(d(W)),1)]),_:1})]),r("div",mt,[n(A,{color:"success",onClick:Ie},{default:i(()=>[g(" Exportar ")]),_:1})])]),n(ue,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:i(()=>[ht,r("tbody",null,[(D(!0),x(J,null,Q(d(G),e=>(D(),x("tr",{key:e.first,class:de(["clickable",{active:e.first_name===d(ie)}]),onClick:f=>ke(e.first_name,e.last_name,e.first)},[r("td",pt,v(e.first_name)+" "+v(e.last_name),1),r("td",_t,v(e.fecha),1),r("td",Yt,v(e.cantidad),1),r("td",Dt,v(e.hora),1)],10,vt))),128))])]),_:1})]),_:1})]),_:1},512),[[he,d(X)]])]),_:1})]),_:1}),n(B,{lg:"6",cols:"12",sm:"6"},{default:i(()=>[n(fe,null,{default:i(()=>[me(n(L,null,{default:i(()=>[n($,null,{default:i(()=>[n(j,null,{default:i(()=>[g("Actividad del usuario "+v(d(oe)),1)]),_:1})]),_:1}),n(I,null,{default:i(()=>[n(pe,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:i(()=>[(D(!0),x(J,null,Q(d(Z),(e,f)=>(D(),z(_e,{"dot-color":"primary",size:"x-small"},{default:i(()=>[r("div",gt,[r("h4",bt,v(e.title||e.url),1)]),n(L,{class:"",variant:"text"},{default:i(()=>[n(I,null,{default:i(()=>[r("div",yt,[n(pe,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact timeline-2"},{default:i(()=>[(D(!0),x(J,null,Q(d(Ne)({data:e.data,index:f}),(u,p)=>(D(),z(_e,{"dot-color":"info",size:"x-small"},{default:i(()=>[r("div",wt,[r("h4",Mt,v(u.fechai),1)]),r("p",xt,v(u.title),1),n(We),r("small",Vt,v(u.fechai)+" "+v(u.fechaf?"hasta "+u.fechaf:""),1)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[he,d(O)]])]),_:1})]),_:1})]),_:1})])}}},Tt=Re(Ft,[["__scopeId","data-v-86041bfe"]]);export{Tt as default};
