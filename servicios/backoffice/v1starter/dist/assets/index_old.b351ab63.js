import{ak as at,R as lt,S as st,U as ot,r as f,v as ye,I as it,bA as ue,bB as nt,as as rt,Q as ct,o as v,x as b,b as o,L as V,a as s,w as r,e as Z,g as K,aQ as ee,bC as ut,u as d,i as L,aR as te,q as T,b2 as ge,t as p,h as P,a3 as k,c as B,bF as dt,F as J,C as Q,p as N,n as we,aW as Me,bD as Te,ao as Ce,ap as Fe,a2 as ft,V as mt,bE as Ve,aX as vt}from"./index.88d3c7f5.js";import ht from"./notas-drivers.0bde3fff.js";import pt from"./notas-entretenimiento.48876e16.js";import Yt from"./notas-estadio.deb1e5df.js";import _t from"./notas-estilo.f0de753c.js";/* empty css                                                                       */import bt from"./notas-mundo.2026bfb1.js";import Dt from"./notas-noticias.76d7481b.js";import yt from"./notas-programas.fad1ff19.js";import{V as ke,a as Se}from"./VTimelineItem.36b36f8a.js";const gt={class:"tab-titles parentTabs"},wt={class:"tab-content"},Mt={key:0,class:"tab-item"},Tt={class:"d-flex"},Ct={class:"descripcion"},Ft={class:"bg-ecuavisa py-2"},Vt={class:"date-picker-wrapper",style:{width:"250px"}},kt={key:0,class:"date-picker-wrapper",style:{width:"300px"}},St={class:"contenedorBotones"},xt={class:"grup_one"},Nt={class:"w-100"},It={class:"grup_two"},Ut={class:"w-100"},At=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),o("th",{scope:"col"},"VISITAS")])],-1),Ht=["onClick"],Ot={class:"text-medium-emphasis"},Rt={class:"d-flex align-center justify-space-between botonescurrentPage",id:"target"},$t={style:{display:"flex","flex-wrap":"wrap"}},Et={style:{width:"max-content"}},Pt={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},Bt=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"Nombre"),o("th",{scope:"col"},"Fecha"),o("th",{scope:"col"},"Cantidad"),o("th",{scope:"col"},"Hora")])],-1),zt=["onClick"],jt={class:"text-high-emphasis"},Lt={class:"text-medium-emphasis"},Jt={class:"text-medium-emphasis"},Qt={class:"text-medium-emphasis"},qt={class:"d-flex justify-space-between align-center flex-wrap"},Wt={class:"text-base font-weight-semibold me-1"},Gt={class:"d-flex justify-space-between align-center"},Xt={class:"d-flex justify-space-between align-center flex-wrap"},Zt={class:"text-base font-weight-semibold me-1"},Kt={class:"mt-0 mb-0"},ea={style:{"font-size":"10px","font-style":"italic"}},ta={key:1,class:"tab-item"},aa={key:2,class:"tab-item"},la={key:3,class:"tab-item"},sa={key:4,class:"tab-item"},oa={key:5,class:"tab-item"},ia={key:6,class:"tab-item"},na={key:7,class:"tab-item"},ra={data(){return{selectedTab:0}},methods:{selectTab(de){this.selectedTab=de}}},ba=Object.assign(ra,{__name:"index_old",setup(de){at();const g=lt.exports.extendMoment(st);g.locale("es",[ot]);const C=f([]),ae=f([]),x=f(!0),q=8,w=f(1),A=f(""),le=f([]),se=f([]),fe=ye(()=>C.value.length),H=f(""),O=f(""),W=f(!1),z=f(!1),xe=f(""),oe=f([]),me=f({}),j=f(""),ie=f({}),ne=f(""),ve=f([]),he=f(""),Ne=it(),S=f(""),I=f(""),R=f([]),pe=f(null),Ye=f(null),_e=f(g().format("DD/MM/YYYY HH:mm:ss").toString()),re=f(JSON.parse(localStorage.getItem("userData"))),ce=ue(),G=f({i:ce.i,f:ce.f,title:ce.title}),$=f("Hoy"),Ie=nt();async function Ue(){await fetch("https://servicio-filtros.vercel.app/visitas/all").then(e=>e.json()).then(e=>{oe.value=Array.from(e)}).catch(e=>e);let t=Array.from(oe.value);if(t.length>0){let e=t.filter(l=>l.isDefault===!0);ie.value=e[0],j.value=e[0]._id,A.value=String(e[0].fecha)}}async function X(t,e){x.value=!0;let l,a;if(t&&e)l=t,a=e;else if(ie.value){let n=ie.value.fecha.split("a");l=g(n[0]).add(1,"days").format("MM/DD/YYYY"),a=g(n[1]).add(-1,"days").format("MM/DD/YYYY")}else l=g().add(-6,"days").format("MM-DD-YYYY"),a=g().add(1,"days").format("MM-DD-YYYY");var c=new Headers;c.append("Content-Type","application/json");var u=JSON.stringify({fechai:l,fechaf:a}),_={method:"POST",headers:c,body:u,redirect:"follow"};const i=[];await fetch("https://servicio-de-actividad.vercel.app/count",_).then(n=>n.text()).then(async n=>{let m=parseInt(n);var h=new Headers;h.append("Content-Type","application/json");for(let Y=1;Y<m+1;Y++){var D=JSON.stringify({fechai:l,fechaf:a,page:Y}),M={method:"POST",headers:h,body:D,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/full",M).then(y=>y.json()).then(async y=>{let U=Array.from(y.data);U.forEach(E=>{ae.value.push(E)});for(const E of U)for(const De of E.navigationRecord){let tt={title:De.title,url:De.url};i.push(tt)}}).catch(y=>y)}const F=i.reduce((Y,y)=>{var U=Y.findIndex(E=>E.title==y.title||E.url==y.url);return U===-1?Y.push({url:y.url,title:y.title,count:1}):Y[U].count++,Y},[]);R.value=Array.from(F),R.value.sort((Y,y)=>y.count-Y.count),C.value=Array.from(F),C.value.sort((Y,y)=>y.count-Y.count),x.value=!1}).catch(n=>(x.value=!1,n))}async function Ae(){await Ue(),A.value=H.value+" a "+O.value,X(H.value,O.value)}async function He(t,e,l){try{if(j.value="",t.length>1){let a=g(t[0]).add(1,"days").format("MM/DD/YYYY"),c=g(t[1]).format("MM/DD/YYYY");H.value=a,O.value=c,await X(a,c)}}catch(a){console.error(a)}}async function Oe(t){try{let e=t.toString().split("a");if(e.length>1){let l=g(e[0]).add(1,"days").format("MM/DD/YYYY"),a=g(e[1]).format("MM/DD/YYYY");H.value=l,O.value=a,await X(l,a)}}catch(e){console.error(e)}}async function Re(t){await fetch("https://servicio-filtros.vercel.app/visitas/id?"+new URLSearchParams({id:t})).then(l=>l.json()).then(l=>{me.value=l}).catch(l=>l);let e=me.value;A.value=String(e.fecha),await Oe(e.fecha)}const $e=()=>{let t=localStorage.getItem("role");t!=="administrador"&&t!=="webmaster"&&Ne.push({path:"/pages/errors/not-authorized"})};async function be(t){if(re.value.email!=="admin@demo.com"){var e=new Headers;e.append("Content-Type","application/json");var l=JSON.stringify(t),a={method:"POST",headers:e,body:l,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",a).then(c=>{}).catch(c=>console.log("error",c))}}rt(async()=>{$e();let t=ue($.value);G.value={i:t.i,f:t.f,title:t.title},w.value=1;let e=t.i.format("MM/DD/YYYY"),l=t.i.format("MM/DD/YYYY");H.value=e,O.value=l,Ae(),await be({usuario:re.value.email,pagina:"trazabilidad-visitas-list",fecha:_e.value})});const Ee=ye(()=>{const t=(w.value-1)*q,e=t+q;return C.value.slice(t,e)}),Pe=()=>{w.value*q<C.value.length&&w.value++},Be=()=>{w.value>1&&w.value--},ze=()=>{if(S.value!==""){w.value=1;const t=S.value.endsWith("/")?S.value.replace(/\/$/,"").trim():S.value.trim(),e=R.value.filter(l=>l.url.trim().includes(t));C.value=e}},je=()=>{if(I.value!==""){w.value=1;const t=I.value.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim(),e=R.value.filter(l=>l.title.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim().includes(t));C.value=e}},Le=()=>{I.value!==""&&(w.value=1,I.value="",z.value=!1,W.value=!1,C.value=R.value)},Je=()=>{S.value!==""&&(w.value=1,S.value="",z.value=!1,W.value=!1,C.value=R.value)},Qe=t=>{ne.value=t,pe.value=t,z.value=!1,setTimeout(()=>{document.getElementById("target").scrollIntoView({behavior:"smooth"})},100);const e=ae.value.map(({first_name:i,last_name:n,navigationRecord:m})=>({first_name:i,last_name:n,navigationRecord:m})),l=[];for(let i of e)for(let n of i.navigationRecord)if(n.title===t||n.url===t){var a=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],c=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let m=g(n.fecha,a,!0).format("DD/MM/YYYY"),h=n.hora.split(":");if(h[2].indexOf(" ")>=0){let Y=h[2].split(" ");h[2]=Y[0]}let D=h[0]+":"+h[1]+":"+h[2],M=m+" "+D,F=g(M,c,!0).format();if(i.first_name!==void 0&&i.last_name!==void 0&&i.first_name!==null&&i.last_name!==null&&i.first_name!==""&&i.last_name!==""){let Y={first_name:i.first_name,last_name:i.last_name,url:n.url,title:n.title,fecha:m,fechaRaw:n.fecha,fullFecha:F,hora:D,horaRaw:n.hora};l.push(Y)}}let u={};l.forEach(i=>{let n=i.first_name+"-"+i.last_name;u.hasOwnProperty(n)?(new Date(i.fullFecha)>new Date(u[n].fullFecha)&&(u[n]=i),u[n].cantidad=(u[n].cantidad||1)+1):(i.cantidad=1,u[n]=i)});let _=Object.values(u);_.sort((i,n)=>{var m=new Date(i.fullFecha),h=new Date(n.fullFecha);return h-m}),le.value=_.slice(0,25),ve.value=le.value.map(({first_name:i,last_name:n,fecha:m,hora:h,cantidad:D,title:M,url:F})=>({first_name:i,last_name:n,fecha:m,hora:h,cantidad:D,title:M,url:F})),W.value=!0,xe.value=t};function qe(t){const e=[];let l=null;return t.forEach((a,c)=>{c===0||a.title!==t[c-1].title?(l={title:a.title,url:a.url,fecha:a.fecha,hora:a.hora,fullFecha:a.fullFecha,data:[a]},e.push(l)):l.data.push(a)}),e}const We=(t,e)=>{Ye.value=t;const l=ae.value.map(({first_name:i,last_name:n,navigationRecord:m})=>({first_name:i,last_name:n,navigationRecord:m})),a=[];he.value=t+" "+e;let c=t+" "+e;for(let i of l)if(i.first_name+" "+i.last_name==c)for(let m of i.navigationRecord){var u=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],_=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let h=g(m.fecha,u,!0).format("DD/MM/YYYY"),D=m.hora.split(":");if(D[2].indexOf(" ")>=0){let U=D[2].split(" ");D[2]=U[0]}let M=D[0]+":"+D[1]+":"+D[2],F=h+" "+M,Y=g(F,_,!0).format(),y={first_name:i.first_name,last_name:i.last_name,url:m.url,title:m.title,fecha:h,fechaRaw:m.fecha,fullFecha:Y,hora:M};a.push(y)}a.sort((i,n)=>{var m=new Date(n.fullFecha),h=new Date(i.fullFecha);return h-m}),se.value=qe(a),z.value=!0};function Ge(t){for(var e=typeof t!="object"?JSON.parse(t):t,l="",a=0;a<e.length;a++){var c="";for(var u in e[a])c!=""&&(c+=","),c+=e[a][u];l+=c+`\r
`}return l}function Xe(t,e,l){t&&e[0].wylexId!=="wylexId"&&e.unshift(t);var a=JSON.stringify(e),c=Ge(a),u=l+".csv"||"export.csv",_=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(_,u);else{var i=document.createElement("a");if(i.download!==void 0){var n=URL.createObjectURL(_);i.setAttribute("href",n),i.setAttribute("download",u),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}}async function Ze(){let t={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},e=[];e=Array.from(ve.value);let l="ultimos_usuarios_"+ne.value.replace(/[^A-Z0-9]+/ig,"_");await be({usuario:re.value.email,pagina:"trazabilidad-visitas-list",accion:"export",fecha:_e.value}),Xe(t,e,l)}var Ke=function(t={}){const{data:e,index:l}=t;var a=[],c=se.value,u=c.length;for(var _ in e){const i=`${e[_].fecha} ${e[_].hora}`,n=et({fecha:i,indice:_,indiceDelTotal:l,dataTotal:c,tamanioTotal:u,dataActual:e,objectoActual:null}),m=`${n.tiempoTranscurrido}`;a.push({title:m,fechai:n.fechai,fechaf:n.fechaf})}return a},et=function(t={}){const{fecha:e,indice:l,dataActual:a,dataTotal:c,indiceDelTotal:u,tamanioTotal:_,objectoActual:i=null}=t,n=JSON.stringify(a),m=JSON.parse(n);if(m.length-1>l){const M=m[l*1+1],F=`${M.fecha} ${M.hora}`;return Ve(F,e,m[l],M)}var h={},D=null;return _-1>u&&(h=c[u*1+1],D=`${h.fecha} ${h.hora}`),_-1==u&&m.length-1==l?{tiempoTranscurrido:"Fin de la navegaci\xF3n",fechai:e,fechaf:null,tipo:""}:Ve(D,e,c[u],c[u*1+1])};return ct(async()=>$.value,async()=>{x.value=!0;let t=ue($.value);G.value={i:t.i,f:t.f,title:t.title};let e=t.i.format("MM/DD/YYYY"),l=t.i.format("MM/DD/YYYY");H.value=e,O.value=l,await X(e,l)}),(t,e)=>{const l=vt;return v(),b("div",null,[o("div",gt,[o("div",{onClick:e[0]||(e[0]=a=>t.selectTab(0)),class:V({active:t.selectedTab===0})},"Ecuavisa.com",2),o("div",{onClick:e[1]||(e[1]=a=>t.selectTab(1)),class:V({active:t.selectedTab===1})},"Notas Drivers",2),o("div",{onClick:e[2]||(e[2]=a=>t.selectTab(2)),class:V({active:t.selectedTab===2})},"Noticias",2),o("div",{onClick:e[3]||(e[3]=a=>t.selectTab(3)),class:V({active:t.selectedTab===3})},"Mundo",2),o("div",{onClick:e[4]||(e[4]=a=>t.selectTab(4)),class:V({active:t.selectedTab===4})},"Estadio",2),o("div",{onClick:e[5]||(e[5]=a=>t.selectTab(5)),class:V({active:t.selectedTab===5})},"Entretenimiento",2),o("div",{onClick:e[6]||(e[6]=a=>t.selectTab(6)),class:V({active:t.selectedTab===6})},"Estilo",2),o("div",{onClick:e[7]||(e[7]=a=>t.selectTab(7)),class:V({active:t.selectedTab===7})},"Programas",2)]),o("div",wt,[t.selectedTab===0?(v(),b("div",Mt,[s(mt,null,{default:r(()=>[s(Z,{lg:"12",cols:"12",sm:"6"},{default:r(()=>[s(K,null,{default:r(()=>[s(ee,{class:"header_card_item"},{append:r(()=>[o("div",Ft,[o("div",Vt,[s(ut,{disabled:d(x),modelValue:d($),"onUpdate:modelValue":e[8]||(e[8]=a=>L($)?$.value=a:null),items:d(Ie),variant:"outlined",label:"Fecha","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])])]),default:r(()=>[o("div",Tt,[o("div",Ct,[s(te,null,{default:r(()=>[T("P\xE1ginas m\xE1s vistas")]),_:1}),s(ge,null,{default:r(()=>[T("Un total de "+p(d(fe))+" registros, mostrando data desde "+p(d(G).i.format("YYYY-MM-DD"))+" hasta "+p(d(G).f.format("YYYY-MM-DD")),1)]),_:1})])])]),_:1}),s(P,{class:"d-flex flex-wrap justify-space-between gap-4",style:{display:"none!important"}},{default:r(()=>[s(ee,{class:"pb-sm-0"},{default:r(()=>[s(te,null,{default:r(()=>[T("P\xE1ginas m\xE1s vistas")]),_:1}),s(ge,null,{default:r(()=>[T("Un total de "+p(d(fe))+" registros",1)]),_:1})]),_:1}),d(x)?k("",!0):(v(),b("div",kt,[s(l,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:d(A),"onUpdate:modelValue":e[9]||(e[9]=a=>L(A)?A.value=a:null),"show-current":"true",onOnChange:He,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"m-d-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),s(Z,{cols:"12"},{default:r(()=>[d(x)?k("",!0):(v(),B(dt,{key:0,modelValue:d(j),"onUpdate:modelValue":e[10]||(e[10]=a=>L(j)?j.value=a:null),color:"primary",class:"d-none",divided:""},{default:r(()=>[(v(!0),b(J,null,Q(d(oe),a=>(v(),B(N,{value:a._id,onClick:c=>Re(a._id)},{default:r(()=>[T(p(a.nombre),1)]),_:2},1032,["value","onClick"]))),256))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),s(P,{class:""},{default:r(()=>[o("div",St,[o("div",xt,[o("div",Nt,[s(we,{modelValue:d(S),"onUpdate:modelValue":e[11]||(e[11]=a=>L(S)?S.value=a:null),placeholder:"Buscar por link...",density:"compact"},null,8,["modelValue"])]),s(N,{"prepend-icon":"tabler-search",onClick:ze}),s(N,{onClick:Je},{default:r(()=>[T(" Reiniciar ")]),_:1})]),o("div",It,[o("div",Ut,[s(we,{modelValue:d(I),"onUpdate:modelValue":e[12]||(e[12]=a=>L(I)?I.value=a:null),placeholder:"Buscar por t\xE9rmino o palabra...",density:"compact"},null,8,["modelValue"])]),s(N,{"prepend-icon":"tabler-search",onClick:je}),s(N,{onClick:Le},{default:r(()=>[T(" Reiniciar ")]),_:1})])])]),_:1}),d(x)?(v(),B(P,{key:0},{default:r(()=>[T("Cargando datos...")]),_:1})):(v(),B(P,{key:1},{default:r(()=>[s(Me,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:r(()=>[At,o("tbody",null,[(v(!0),b(J,null,Q(d(Ee),a=>(v(),b("tr",{class:V(["clickable",{active:a.title===d(pe)}]),onClick:c=>Qe(a.title||a.url)},[o("td",null,p(a.title?a.title:a.url),1),o("td",Ot,p(a.count),1)],10,Ht))),256))])]),_:1}),o("div",Rt,[s(N,{icon:"tabler-arrow-big-left-lines",onClick:Be,disabled:d(w)===1},null,8,["disabled"]),T(" P\xE1gina "+p(d(w))+" ",1),s(N,{icon:"tabler-arrow-big-right-lines",onClick:Pe,disabled:d(w)*q>=d(C).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),s(Z,{lg:"6",cols:"12",sm:"6"},{default:r(()=>[s(Te,null,{default:r(()=>[Ce(s(K,null,{default:r(()=>[s(ee,{class:"pb-sm-0"},{default:r(()=>[o("div",$t,[o("div",Et,[s(te,null,{default:r(()=>[T("\xDAltimas visitas a la p\xE1gina "+p(d(ne)),1)]),_:1})]),o("div",Pt,[s(N,{color:"success",onClick:Ze},{default:r(()=>[T(" Exportar ")]),_:1})])]),s(Me,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:r(()=>[Bt,o("tbody",null,[(v(!0),b(J,null,Q(d(le),a=>(v(),b("tr",{class:V(["clickable",{active:a.first_name===d(Ye)}]),onClick:c=>We(a.first_name,a.last_name)},[o("td",jt,p(a.first_name)+" "+p(a.last_name),1),o("td",Lt,p(a.fecha),1),o("td",Jt,p(a.cantidad),1),o("td",Qt,p(a.hora),1)],10,zt))),256))])]),_:1})]),_:1})]),_:1},512),[[Fe,d(W)]])]),_:1})]),_:1}),s(Z,{lg:"6",cols:"12",sm:"6"},{default:r(()=>[s(Te,null,{default:r(()=>[Ce(s(K,null,{default:r(()=>[s(ee,null,{default:r(()=>[s(te,null,{default:r(()=>[T("Actividad del usuario - "+p(d(he)),1)]),_:1})]),_:1}),s(P,null,{default:r(()=>[s(ke,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:r(()=>[(v(!0),b(J,null,Q(d(se),(a,c)=>(v(),B(Se,{"dot-color":"primary",size:"x-small"},{default:r(()=>[o("div",qt,[o("h4",Wt,p(a.title||a.url),1)]),s(K,{class:"",variant:"text"},{default:r(()=>[s(P,null,{default:r(()=>[o("div",Gt,[s(ke,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact timeline-2"},{default:r(()=>[(v(!0),b(J,null,Q(d(Ke)({data:a.data,index:c}),(u,_)=>(v(),B(Se,{"dot-color":"info",size:"x-small"},{default:r(()=>[o("div",Xt,[o("h4",Zt,p(u.fechai),1)]),o("p",Kt,p(u.title),1),s(ft),o("small",ea,p(u.fechai)+" "+p(u.fechaf?"hasta "+u.fechaf:""),1)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[Fe,d(z)]])]),_:1})]),_:1})]),_:1})])):k("",!0),t.selectedTab===1?(v(),b("div",ta,[s(ht)])):k("",!0),t.selectedTab===2?(v(),b("div",aa,[s(Dt)])):k("",!0),t.selectedTab===3?(v(),b("div",la,[s(bt)])):k("",!0),t.selectedTab===4?(v(),b("div",sa,[s(Yt)])):k("",!0),t.selectedTab===5?(v(),b("div",oa,[s(pt)])):k("",!0),t.selectedTab===6?(v(),b("div",ia,[s(_t)])):k("",!0),t.selectedTab===7?(v(),b("div",na,[s(yt)])):k("",!0)])])}}});export{ba as default};
