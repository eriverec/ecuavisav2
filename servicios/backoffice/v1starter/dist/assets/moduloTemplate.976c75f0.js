import{M as ze,R as De,S as Ee,U as Ue,r as s,as as Ne,v as $e,Q as E,z as Oe,o as V,x as F,a as l,w as o,q as M,t as f,u,f as Pe,g as A,i as b,b0 as ve,e as y,h as me,bw as Fe,c as U,aQ as Ae,aR as Be,l as Ge,m as Je,V as B,n as G,aT as pe,$ as N,a2 as ee,b as g,aU as fe,aV as be,a1 as ae,p as I,Z as Qe,F as ge,C as He,N as R,a0 as Ye,L as _e,a3 as Ve,bu as le,bc as Ze,bd as Ke,be as We}from"./index.88d3c7f5.js";import{m as ye}from"./moduloTemplate.7adf9c65.js";import{V as Xe}from"./VBadge.0df54a63.js";const ea=S=>(Ke("data-v-b78da0f6"),S=S(),We(),S),aa={key:0,style:{height:"300px"},class:"d-flex align-center"},la=ea(()=>g("span",{class:"ms-4"},"Video",-1)),oa={class:"text-xs text-disabled"},ta={class:"content-order pl-4"},sa={class:"content-edit"},na={class:"content-btn"},ia={class:"btn-order",style:{}},ua={__name:"moduloTemplate",props:{action:String,idModulo:String},emits:["get:eventModalCR"],setup(S,{emit:J}){const oe=S;De.exports.extendMoment(Ee).locale("es",[Ue]);const h=s(!1),w=s(!1);s("tab-lista"),s(1);const he=s([]);s(1),s(1),s(""),s(!1);const _=s(!0);s(!1),s(!1),s(!1),s(null);const j=s(!1),z=s(""),$=s(null),Q=s(!1),C=s(null),H=s([]),q=s([]),D=s([]),O=s(null),Y=s(!1),x=s(null),Z=s([]);s("");const we=s(""),te=s("");s(""),s(!0),s(""),s("");const Ce=s(""),v=s(null),k=s(null),r=s([]),T=s(null),xe=s(null),se=!1,K=s(""),c=s({message:"Datos guardados",type:"success",model:!1}),L=s([]);Ne(async()=>{await ne(),await P(),oe.action=="add"?await Me():await Ie(oe.idModulo),_.value=!1});async function ne(n=1,e=10){try{Q.value=!0;var i=new Headers;i.append("Content-Type","application/json");var t={method:"GET",headers:i,redirect:"follow"},a=await fetch("https://e-learning-cuestionario.vercel.app/cuestionarios/all/get",t);const d=await a.json();D.value=d.data.reduce((p,m)=>(p.push({title:`${m.titulo}`,value:m._id}),p),[]),H.value=D.value,Q.value=!1}catch(d){return c.value={message:"No se pudo recuperar los cuestionarios, recargue de nuevo.",type:"error",model:!0},console.error(d.message)}}async function P(n=1,e=10){try{Y.value=!0;var i=new Headers;i.append("Content-Type","application/json");var t={method:"GET",headers:i,redirect:"follow"},a=await fetch("https://servicio-elearning.vercel.app/video/all?limit=200&page=1",t);const d=await a.json();L.value=d.data.reduce((p,m)=>(p.push({title:`${m.titulo}`,value:m._id,bloqueado:m.bloqueado||se}),p),[]),Z.value=L.value,Y.value=!1}catch(d){return c.value={message:"No se pudo recuperar los videos, recargue de nuevo.",type:"error",model:!0},console.error(d.message)}}const ie=8,ke=s(1);$e(()=>{const n=(ke.value-1)*ie,e=n+ie;return he.value.slice(n,e)});function W(){K.value="",k.value="",we.value="",te.value="",T.value="",xe.value="",te.value="",v.value=null,q.value=null,Ce.value="",r.value=[]}function Te(){W(),j.value=!1,le(()=>{J("get:eventModalCR",{modalShow:!1,action:"modal"})})}async function Me(){return W(),z.value="add",j.value=!0,!0}function qe(n,e){return n.filter(t=>e.includes(t.value)).map(t=>t.value)}function Le(n,e){e.sort((t,a)=>t.posicion-a.posicion);let i=[];for(let t=0;t<e.length;t++){let a=n.find(d=>d===e[t]._id);a&&i.push({title:e[t].titulo,bloqueado:e[t].hasOwnProperty("bloqueado")?e[t].bloqueado:se,value:a})}return i}async function Ie(n){try{W(),z.value="edit";const t=(await(await fetch("https://servicio-elearning.vercel.app/modulo/get/"+n)).json()).data;return K.value=t._id,k.value=t.titulo,T.value=t.descripcion,t.cuestionario&&(q.value=t.cuestionario._id),v.value=qe(L.value,t.videos.reduce((a,d)=>(a.push(d._id),a),[])),j.value=!0,r.value=Le(v.value,t.videos),!0}catch(e){return c.value={message:"No se pudo recuperar los datos para editar, recargue de nuevo.",type:"error",model:!0},console.error(e.message)}}async function Re(){try{if(!k.value||!T.value||!v.value)return c.value={message:"Llenar todos los campos para crear el registro",type:"error",model:!0},!1;_.value=!0;var n=new Headers;if(n.append("Content-Type","application/json"),z.value==="add"){let t={titulo:k.value,descripcion:T.value,idCuestionario:q.value||null,videos:ue()};var e=JSON.stringify(t),i={method:"POST",headers:n,body:e,redirect:"follow"};const d=await(await fetch("https://servicio-elearning.vercel.app/modulo/create",i)).json();return d.resp?(c.value={message:"Registro creado correctamente",type:"success",model:!0},le(()=>{J("get:eventModalCR",{modalShow:!1,id:d.id,action:"add"})})):(c.value={message:d.mensaje,type:"error",model:!0},console.error(d.error)),j.value=!1,_.value=!1,!1}else if(z.value==="edit"){let t={titulo:k.value,descripcion:T.value,idCuestionario:q.value||null,videos:ue()};var e=JSON.stringify(t),i={method:"POST",headers:n,body:e,redirect:"follow"};const m=await(await fetch("https://servicio-elearning.vercel.app/modulo/update/"+K.value,i)).json();m.resp?(c.value={message:"Registro actualizado correctamente",type:"success",model:!0},le(()=>{J("get:eventModalCR",{modalShow:!1,data:m,action:"edit"})})):(c.value={message:m.mensaje,type:"error",model:!0},console.error(m.error)),j.value=!1,_.value=!1}}catch(t){return c.value={message:t.message,type:"error",model:!0},console.error(t.message)}}s(!1),s("");function X(){const n=L.value,e=v.value;if(e){if(r.value.length<e.length)for(var i in n)e[e.length-1]==n[i].value&&r.value.push(n[i]);if(r.value.length>e.length){const a=r.value.filter(d=>!e.includes(d.value));for(var t in a)for(var i in r.value)if(a[t].value==r.value[i].value){r.value.splice(i,1);break}}}}E(async()=>v.value,async()=>{v.value&&X()});function ue(){const n=r.value,e=[];return n.forEach((i,t)=>{e.push({value:i.value,posicion:t,bloqueado:i.bloqueado})}),e}function de(n,e){const i=r.value,t=i.findIndex(a=>a.value===n);if(t===-1){console.log("El valor especificado no se encontr\xF3 en la lista.");return}if(e==="arriba"&&t>0)[i[t],i[t-1]]=[i[t-1],i[t]];else if(e==="abajo"&&t<i.length-1)[i[t],i[t+1]]=[i[t+1],i[t]];else{console.log("La direcci\xF3n especificada es inv\xE1lida o el elemento est\xE1 en el extremo de la lista.");return}}E(async()=>x.value,async()=>{x.value?L.value=Z.value.filter(n=>n.title.toLowerCase().indexOf(x.value.toLowerCase())>-1||n.value.indexOf(x.value)>-1):L.value=Z.value}),E(O,n=>{n||setTimeout(()=>{x.value=""},1e3)}),E(async()=>C.value,async()=>{C.value?D.value=H.value.filter(n=>n.title.toLowerCase().indexOf(C.value.toLowerCase())>-1||n.value.indexOf(C.value)>-1):D.value=H.value}),E($,n=>{n||setTimeout(()=>{C.value=""},1e3)});const re=async n=>{n.action=="modal"&&(h.value=n.modalShow,w.value=n.modalShow),n.action=="add"&&(await P(),h.value=n.modalShow,v.value.push(n.id),X()),n.action=="edit"&&(await P(),w.value=n.modalShow,X())},Se=async(n,e)=>{const i=!r.value[e].bloqueado;r.value[e].bloqueado=i,console.log(r.value[e])},ce=s(""),je=n=>{ce.value=n,w.value=!0};return(n,e)=>{const i=Ze,t=Oe("v-list-item-content");return V(),F("section",null,[l(Pe,{modelValue:u(c).model,"onUpdate:modelValue":e[0]||(e[0]=a=>u(c).model=a),location:"top end",variant:"flat",timeout:u(c).timeout||4e3,color:u(c).type},{default:o(()=>[M(f(u(c).message),1)]),_:1},8,["modelValue","timeout","color"]),l(ve,{modelValue:u(w),"onUpdate:modelValue":e[2]||(e[2]=a=>b(w)?w.value=a:null),width:"600",persistent:""},{default:o(()=>[l(i,{onClick:e[1]||(e[1]=a=>w.value=!u(w))}),l(A,null,{default:o(()=>[l(ye,{"onGet:eventModalCR":re,action:"edit",idVideo:u(ce)},null,8,["idVideo"])]),_:1})]),_:1},8,["modelValue"]),l(ve,{modelValue:u(h),"onUpdate:modelValue":e[4]||(e[4]=a=>b(h)?h.value=a:null),width:"600",persistent:""},{default:o(()=>[l(i,{onClick:e[3]||(e[3]=a=>h.value=!u(h))}),l(A,null,{default:o(()=>[l(ye,{"onGet:eventModalCR":re,action:"add"})]),_:1})]),_:1},8,["modelValue"]),l(B,null,{default:o(()=>[l(y,{class:"m-0 p-0",cols:"12",md:"12",lg:"12"},{default:o(()=>[u(_)?(V(),F("div",aa,[l(A,{width:"300",class:"mx-auto mt-5 mb-5",color:"primary"},{default:o(()=>[l(me,{class:"pt-3"},{default:o(()=>[M(" Cargando datos... espere "),l(Fe,{indeterminate:"",color:"white",class:"mb-0"})]),_:1})]),_:1})])):(V(),U(A,{key:1,class:"px-5 py-4"},{default:o(()=>[l(Ae,{class:"text-center"},{default:o(()=>[l(Be,{class:"text-h5 mb-3"},{default:o(()=>[M(f(u(z)=="add"?"Crear m\xF3dulo":"Editar m\xF3dulo"),1)]),_:1})]),_:1}),l(me,null,{default:o(()=>[l(Ge,{class:"mt-6",onSubmit:Je(Re,["prevent"])},{default:o(()=>[l(B,{class:""},{default:o(()=>[l(B,null,{default:o(()=>[l(y,{cols:"6"},{default:o(()=>[l(G,{disabled:u(_),modelValue:u(k),"onUpdate:modelValue":e[5]||(e[5]=a=>b(k)?k.value=a:null),label:"T\xEDtulo del modulo"},null,8,["disabled","modelValue"])]),_:1}),l(y,{cols:"6"},{default:o(()=>[l(G,{disabled:u(_),modelValue:u(T),"onUpdate:modelValue":e[6]||(e[6]=a=>b(T)?T.value=a:null),label:"Descripci\xF3n"},null,8,["disabled","modelValue"])]),_:1}),l(y,{cols:"12"},{default:o(()=>[l(pe,{menu:u($),"onUpdate:menu":e[8]||(e[8]=a=>b($)?$.value=a:null),"no-data-text":"No existen cuestionario que mostrar","append-icon":"mdi-refresh","item-text":"title","item-value":"value",modelValue:u(q),"onUpdate:modelValue":e[9]||(e[9]=a=>b(q)?q.value=a:null),items:u(D),disabled:u(Q),label:"Cuestionario para al final del m\xF3dulo",clearable:"","onClick:append":ne,"menu-props":{maxHeight:"400"}},{"prepend-item":o(()=>[l(N,null,{default:o(()=>[l(t,null,{default:o(()=>[l(G,{modelValue:u(C),"onUpdate:modelValue":e[7]||(e[7]=a=>b(C)?C.value=a:null),clearable:"",placeholder:"Buscar cuestionario"},null,8,["modelValue"])]),_:1})]),_:1}),l(ee,{class:"mt-2"})]),selection:o(({item:a})=>[g("div",null,f(a.title)+" - "+f(a.value),1)]),item:o(({item:a,props:d})=>[l(N,fe(be(d)),{default:o(()=>[l(t,null,{default:o(()=>[l(ae,null,{default:o(()=>[g("p",null,"_id: "+f(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","modelValue","items","disabled"])]),_:1}),l(y,{cols:"12"},{default:o(()=>[l(B,null,{default:o(()=>[l(y,{cols:"9"},{default:o(()=>[l(pe,{menu:u(O),"onUpdate:menu":e[11]||(e[11]=a=>b(O)?O.value=a:null),"no-data-text":"No existen videos que mostrar","append-icon":"mdi-refresh","onClick:append":P,disabled:u(Y),"menu-props":{maxHeight:"300"},"item-text":"title","item-value":"value",modelValue:u(v),"onUpdate:modelValue":e[12]||(e[12]=a=>b(v)?v.value=a:null),items:u(L),chips:"",multiple:"",label:"Videos educativos"},{"prepend-item":o(()=>[l(N,null,{default:o(()=>[l(t,null,{default:o(()=>[l(G,{modelValue:u(x),"onUpdate:modelValue":e[10]||(e[10]=a=>b(x)?x.value=a:null),clearable:"",placeholder:"Buscar video"},null,8,["modelValue"])]),_:1})]),_:1}),l(ee,{class:"mt-2"})]),selection:o(({item:a})=>[g("div",null,f(a.title)+" - "+f(a.value),1)]),item:o(({item:a,props:d})=>[l(N,fe(be(d)),{default:o(()=>[l(t,null,{default:o(()=>[l(ae,null,{default:o(()=>[g("p",null,"_id: "+f(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"])]),_:1}),l(y,{cols:"3"},{default:o(()=>[l(I,{title:"Agregar m\xF3dulo",block:"",onClick:e[13]||(e[13]=a=>h.value=!0)},{default:o(()=>[M(" Agregar ")]),_:1})]),_:1})]),_:1})]),_:1}),u(v)?(V(),U(y,{key:0,cols:"12"},{default:o(()=>[l(Qe,{lines:"two",border:""},{default:o(()=>[(V(!0),F(ge,null,He(u(r),(a,d)=>(V(),F(ge,{key:a.value},[l(N,null,{prepend:o(()=>[l(R,{size:35,icon:"mdi-file-video",color:"success"})]),append:o(()=>[g("div",ta,[g("div",sa,[l(I,{class:"px-0 btn-editar",size:"x-small",title:a.bloqueado?"Desbloquear video":"Bloquear video",variant:"text",onClick:p=>Se(a,d)},{default:o(()=>[a.bloqueado?(V(),U(R,{key:0,top:"",size:25,icon:"tabler-lock",title:"Video bloqueado",color:"error"})):(V(),U(R,{key:1,top:"",size:25,icon:"tabler-lock-open",title:"Video p\xFAblico",color:"success"}))]),_:2},1032,["title","onClick"]),l(I,{style:{"margin-top":"-10px"},class:"px-0 btn-editar",size:"x-small",variant:"text",onClick:p=>je(a.value)},{default:o(()=>[g("div",na,[l(R,{top:"",size:25,icon:"tabler-edit",title:"Video p\xFAblico",color:"primary"}),M(" Editar ")])]),_:2},1032,["onClick"])]),g("div",ia,[l(I,{size:"x-small",class:"px-1",disabled:d==0,variant:"text",onClick:p=>de(a.value,"arriba")},{default:o(()=>[l(R,{size:25,icon:"mdi-arrow-up-bold-box"})]),_:2},1032,["disabled","onClick"]),l(I,{size:"x-small",class:"px-1",disabled:d==u(r).length-1,variant:"text",onClick:p=>de(a.value,"abajo")},{default:o(()=>[l(R,{size:25,icon:"mdi-arrow-down-bold-box"})]),_:2},1032,["disabled","onClick"])])])]),default:o(()=>[l(Ye,{class:_e(a.bloqueado?"disabled":"")},{default:o(()=>[M(f(a.title),1)]),_:2},1032,["class"]),l(ae,{class:_e(a.bloqueado?"disabled":"")},{default:o(()=>[l(Xe,{dot:"",location:"start center","offset-x":"2",color:"success",class:"me-3"},{default:o(()=>[la]),_:1}),g("span",oa,f(a.value),1)]),_:2},1032,["class"])]),_:2},1024),d!==u(r).length-1?(V(),U(ee,{key:0})):Ve("",!0)],64))),128))]),_:1})]),_:1})):Ve("",!0)]),_:1}),l(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:o(()=>[l(I,{type:"submit",disabled:u(_)},{default:o(()=>[M(" Guardar ")]),_:1},8,["disabled"]),l(I,{color:"secondary",disabled:u(_),variant:"tonal",onClick:Te},{default:o(()=>[M(" Cancelar ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}))]),_:1})]),_:1})])}}},ma=ze(ua,[["__scopeId","data-v-b78da0f6"]]);export{ma as m};
