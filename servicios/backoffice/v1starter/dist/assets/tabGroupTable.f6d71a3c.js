import{R as me,S as ve,U as fe,r as s,bA as W,bB as ge,v as K,ak as _e,Q as T,o as R,x as N,a as r,w as d,e as he,g as be,aQ as ye,p as q,u as c,b as l,b2 as X,q as $,t as b,bC as Ce,i as U,aT as xe,a2 as Ye,aW as we,F as De,C as Ve,aR as Me,aM as B,aq as Z,ao as ke,ap as Se,V as $e,bP as O}from"./index.88d3c7f5.js";import{_ as Te}from"./AppDateRange.cbfc1214.js";import{V as ee}from"./VTooltip.2d0a8708.js";import{V as Oe}from"./VPagination.9412c3b8.js";import"./parseISO.d0bde0b5.js";const Ee={class:"d-flex pr-0",style:{"justify-content":"space-between"}},Pe={class:"descripcion"},Re=l("span",null,"Exportar b\xFAsqueda",-1),Ne=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),qe={class:"px-5 py-2"},Ue={class:"bg-ecuavisa py-4 d-flex gap-4 flex-wrap"},Be={class:"date-picker-wrappe",style:{"min-width":"90px",width:"auto"}},Ae={style:{"min-width":"230px",width:"auto"}},Fe={class:"item-limit"},je=l("thead",{class:"text-uppercase"},[l("tr",null,[l("th",{scope:"col"}," N "),l("th",{scope:"col"}," T\xEDtulo de P\xE1gina "),l("th",{scope:"col",class:"text-center"}," Impresiones "),l("th",{scope:"col",class:"text-center"}," Click "),l("th",{scope:"col"}," Nombre de Campa\xF1a "),l("th",{scope:"col"}," Link/Descargar ")])],-1),Ge={class:"text-center"},Ie={style:{"min-width":"17rem","max-width":"17rem","text-align":"left"}},Le={class:"text-center"},ze={class:"text-center"},He={class:"text-center",style:{width:"5rem"}},Je=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),Qe=l("tr",null,[l("td",{colspan:"8",class:"text-center text-body-1"}," No hay datos que mostrar ")],-1),We=[Qe],ta={__name:"tabGroupTable",props:{dataCampaigns:Object},setup(ae){const v=ae,f=me.exports.extendMoment(ve);f.locale("es",[fe]);const D=s([]),E=s(!1),te=async(a,t)=>{if(E.value)return alert("Existe una descarga en curso, espere a que termine"),!1;if(!v.dataCampaigns||!v.dataCampaigns[0])return alert("No hay campa\xF1a seleccionada para exportar"),!1;E.value=!0,D.value[a]=!0;try{await z({title_page:t});const e={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"};let i=C.value||[];await L(e,i,"campaigns_user_full")}catch(e){console.error("Error en load:",e)}finally{E.value=!1,D.value[a]=!1}},le=W(),m=s({i:f(),f:f(),title:"hoy"}),C=s([]);s(0);const V=s(!1);s(!1);const M=s(!1);s(!1);const P=s("Hoy");ge();const k=s(le.limit),S=s(1),x=s(7);s([{title:"Todos los eventos",value:"all"},{title:"Usuarios que vieron la publicidad",value:"preview"},{title:"Usuarios que dieron click en la publicidad",value:"click"}]);const Y=s(null),se=s([{title:"Ordenar por Impresiones DESC",value:1},{title:"Ordenar por Impresiones ASC",value:2},{title:"Ordenar por clicks DESC",value:3},{title:"Ordenar por clicks ASC",value:4},{title:"Ordenar por nombre de p\xE1gina DESC",value:5},{title:"Ordenar por nombre de p\xE1gina ASC",value:6}]);function A(a){switch(a){case 1:return(t,e)=>e.preview-t.preview;case 2:return(t,e)=>t.preview-e.preview;case 3:return(t,e)=>e.click-t.click;case 4:return(t,e)=>t.click-e.click;case 5:return(t,e)=>t.title>e.title?1:-1;case 6:return(t,e)=>e.title>t.title?1:-1;default:return null}}const F=s(null);s(null);const g=s([]),j=async()=>{V.value=!0;try{await H({fechai:m.value.i.format("YYYY-MM-DD"),fechaf:m.value.f.format("YYYY-MM-DD"),limit:k.value,idCampaign:v.dataCampaigns[0].value})}catch(a){console.error("Error al cargar datos:",a)}finally{V.value=!1}};s([]),s([]),s([]),s([]),s([]);const G=s([]),y=s({title:x.value,value:x.value}),ie=[{title:"7",value:7},{title:"30",value:30},{title:"50",value:50},{title:"100",value:100},{title:"200",value:200}],re=K(()=>Math.ceil(g.value.length/x.value)),oe=a=>{const t=`rgba(${O(a.colors["on-surface"])},${a.variables["medium-emphasis-opacity"]})`,e=`rgba(${O(a.colors["on-surface"])},${a.variables["disabled-opacity"]})`,i=`rgba(${O(String(a.variables["border-color"]))},${a.variables["border-opacity"]})`,o=`rgba(${O(a.colors["on-surface"])},${a.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:t,themeDisabledTextColor:e,themeBorderColor:i,themePrimaryTextColor:o}},ne=_e();oe(ne.current.value);const I=K(()=>{const a=(S.value-1)*x.value,t=S.value*x.value;return g.value.slice(a,t)});async function ce(){if(g.value.length<1)return alert("No hay registros que exportar"),!1;if(!v.dataCampaigns||!v.dataCampaigns[0])return alert("No hay campa\xF1a seleccionada para exportar"),!1;M.value=!0;try{await z();const a={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"};let t=C.value||[];await L(a,t,"campaigns_full")}finally{M.value=!1}}async function ue(a){for(var t=typeof a!="object"?JSON.parse(a):a,e="",i=0;i<t.length;i++){var o="";for(var u in t[i])o!=""&&(o+=","),o+=t[i][u];e+=o+`\r
`}return e}async function L(a,t,e){a&&t.unshift(a);var i=JSON.stringify(t),o=await ue(i),u=e+".csv"||"export.csv",n=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,u);else{var p=document.createElement("a");if(p.download!==void 0){var _=URL.createObjectURL(n);p.setAttribute("href",_),p.setAttribute("download",u),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p)}}}async function z(a={}){const{title_page:t=""}=a;C.value=[];let e=1,i=7e3;try{for(;;){if(!v.dataCampaigns||!v.dataCampaigns[0]){console.error("No hay campa\xF1a seleccionada");break}const u=await de({tipo:"all",fechai:m.value.i.format("YYYY-MM-DD"),fechaf:m.value.f.format("YYYY-MM-DD"),limit:i,page:e,idCampaign:v.dataCampaigns[0].value,exportar:!0,title_page:t});if(!u||u.length===0)break;C.value.push(...u),e+=1}const o=C.value.reduce((u,n)=>{var p,_,h,w,J,Q;return u.push({title:n.title,url:n.url,type:n.type,created_at:n.created_at,user_email:((p=n.firstUser)==null?void 0:p.email)||"",user_last_name:((_=n.firstUser)==null?void 0:_.last_name)||"",user_firstname:((h=n.firstUser)==null?void 0:h.firstname)||"",campaign_idCampaign:((w=n.idCampaign)==null?void 0:w._id)||"",campaign_title:((J=n.idCampaign)==null?void 0:J.title)||"",campaign_position:((Q=n.idCampaign)==null?void 0:Q.position)||""}),u},[]);return C.value=o,!0}catch(o){return console.error("Error en exportarDataAudit:",o),!1}}async function de(a={}){try{const{title_page:e="",idCampaign:i=null,tipo:o="all",fechai:u=f().format("YYYY-MM-DD"),fechaf:n=f().format("YYYY-MM-DD"),limit:p=10,page:_=1,exportar:h=!1}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/events/${o}?fechai=${u}&fechaf=${n}&page=${_}&limit=${p}&idCampaign=${i}&userId=&title_page=${e}`);const w=await t.json();if(!h)g.value=w.data,G.value=w.data;else return w.data}catch(e){return console.error(e.message)}}async function H(a={}){try{const{idCampaign:e="",tipo:i="all",fechai:o=f().format("YYYY-MM-DD"),fechaf:u=f().format("YYYY-MM-DD"),limit:n=10,page:p=1,exportar:_=!1}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/group/page/${e}?fechai=${o}&fechaf=${u}&page=${p}&limit=${n}&type=${i}&userId=`);const h=await t.json();if(!_)g.value=h.data,G.value=h.data;else return h.data}catch(e){return console.error(e.message)}}T(async()=>P.value,async()=>{let a=W(P.value);m.value={i:a.i,f:a.f,title:P.value},k.value=a.limit,F.value&&(V.value=!0,await H({fechai:m.value.i.format("YYYY-MM-DD"),fechaf:m.value.f.format("YYYY-MM-DD"),limit:k.value,idCampaign:F.value.value}),V.value=!1)});const pe=async a=>{let t=a;m.value={i:f(t[0]),f:f(t[1]),title:"Fecha personalizada"},k.value=8e3,await j()};return T(()=>v.dataCampaigns,{immediate:!0,handler(a){a&&a.length>0&&j()}}),T(async()=>y.value,async()=>{if(y.value,y.value){const a=y.value.value;x.value=a}}),T(async()=>Y.value,async()=>{const a=g.value;if(Y.value){const e=Y.value.value,i=[...a].sort(A(e));g.value=i}else{const t=[...a].sort(A(1));g.value=t}}),(a,t)=>(R(),N("section",null,[r($e,null,{default:d(()=>[r(he,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:d(()=>[r(be,{class:"px-0 py-0",flat:"",elevation:"0"},{default:d(()=>[r(ye,{class:"header_card_item py-0 pt-4 align-start"},{append:d(()=>[r(q,{variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:ce,loading:c(M),disabled:c(M)},{default:d(()=>[Re,r(ee,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!c(M)},{default:d(()=>[Ne]),_:1},8,["disabled"])]),_:1},8,["loading","disabled"])]),default:d(()=>[l("div",Ee,[l("div",Pe,[r(X,null,{default:d(()=>[$("*Mostrando data desde, "+b(c(m).i.format("YYYY-MM-DD"))+" hasta "+b(c(m).f.format("YYYY-MM-DD")),1)]),_:1}),r(X,null,{default:d(()=>[$("*Este informe muestra un l\xEDmite m\xE1ximo de "+b(c(k))+" registros",1)]),_:1})])])]),_:1}),l("div",qe,[l("div",Ue,[l("div",Be,[r(Te,{"onGet:dateCR":pe})]),l("div",Ae,[r(Ce,{clearable:"",density:"compact",disabled:c(V),modelValue:c(Y),"onUpdate:modelValue":t[0]||(t[0]=e=>U(Y)?Y.value=e:null),items:c(se),variant:"outlined",label:"Ordenar registros","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])]),l("div",Fe,[r(xe,{style:{"min-width":"90px"},modelValue:c(y),"onUpdate:modelValue":t[1]||(t[1]=e=>U(y)?y.value=e:null),items:ie,"item-title":"title","item-value":"value",label:"Escoge cuantos registros mostrar:","persistent-hint":"","return-object":"","single-line":""},null,8,["modelValue"])])]),r(Ye,{class:"my-5"}),r(we,{class:"text-no-wrap invoice-list-table custom-dark-table"},{default:d(()=>[je,l("tbody",null,[(R(!0),N(De,null,Ve(c(I),(e,i)=>(R(),N("tr",{key:i,style:{height:"3.75rem"}},[l("td",Ge,b(i+1),1),l("td",Ie,[r(Me,{class:"px-0",title:e.title,style:{"font-size":"18px"}},{default:d(()=>[l("small",null,b(e.title),1)]),_:2},1032,["title"])]),l("td",Le,[r(B,Z({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:d(()=>[$(b(e.preview),1)]),_:2},1040)]),l("td",ze,[r(B,Z({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:d(()=>[$(b(e.click),1)]),_:2},1040)]),l("td",null,[r(B,{color:"success"},{default:d(()=>[$(b(e.idCampaign.title),1)]),_:2},1024)]),l("td",He,[r(q,{href:e.url,target:"_blank",variant:"text",color:"info",icon:"mdi-link-variant"},null,8,["href"]),r(q,{title:"Descargar usuarios que interactuaron en esta p\xE1gina",variant:"text",loading:c(D)[i],disabled:c(D)[i],color:"warning",icon:"mdi-account-arrow-down-outline",onClick:o=>te(i,e.title)},null,8,["loading","disabled","onClick"]),r(ee,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!c(D)[i]},{default:d(()=>[Je]),_:2},1032,["disabled"])])]))),128))]),ke(l("tfoot",null,We,512),[[Se,!c(I).length]])]),_:1}),r(Oe,{class:"mt-5",modelValue:c(S),"onUpdate:modelValue":t[2]||(t[2]=e=>U(S)?S.value=e:null),length:c(re),"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1})]))}};export{ta as default};
