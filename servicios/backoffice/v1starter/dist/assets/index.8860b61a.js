import{M as Ve,ak as ke,R as Pe,S as Ce,U as He,r as i,v as U,o as p,c as M,w as t,a as l,e as ue,g as O,h as b,aQ as S,aR as E,q as w,b as a,n as Se,u as c,i as Z,p as j,a3 as ee,aW as ae,x as F,F as $,C as L,t as h,bD as te,ao as le,ap as se,V as Te,aX as Ae,bd as Ie,be as Ne}from"./index.88d3c7f5.js";import{V as Re}from"./VPagination.9412c3b8.js";import{V as Be,a as Ue}from"./VTimelineItem.36b36f8a.js";const ne=T=>(Ie("data-v-ddb441dd"),T=T(),Ne(),T),Oe={class:"d-flex align-center flex-wrap gap-2"},Ee={style:{width:"15rem"}},$e=ne(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Nombre"),a("th",{scope:"col"},"Email")])],-1)),Le=["onClick"],ze={class:"text-medium-emphasis"},qe={style:{display:"flex","flex-wrap":"wrap"}},Qe={style:{width:"max-content"}},Je=ne(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"P\xE1gina"),a("th",{scope:"col"},"Cantidad")])],-1)),We=["onClick"],Xe={class:"text-high-emphasis"},Ge={class:"text-medium-emphasis"},Ke={class:"d-flex align-center justify-space-between botonescurrentPage"},Ze={class:"date-picker-wrapper",style:{width:"300px"}},je={class:"d-flex justify-space-between align-center flex-wrap"},ea={class:"text-base font-weight-semibold me-1"},aa={class:"mb-1"},ta={style:{display:"flex","flex-wrap":"wrap"}},la={style:{width:"max-content"}},sa=ne(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Pa\xEDs"),a("th",{scope:"col"},"Dispositivo"),a("th",{scope:"col"},"Fecha"),a("th",{scope:"col"},"Hora")])],-1)),na={class:"clickable"},oa={class:"text-high-emphasis"},ia={class:"text-medium-emphasis"},ca={class:"text-medium-emphasis"},ra={class:"text-medium-emphasis"},da={__name:"index",setup(T){ke();const V=Pe.exports.extendMoment(Ce);V.locale("es",[He]);const A=i([]),z=i(!1),q=i(!1),k=8,fe=i(1),Y=i(1),I=i(""),Q=i([]);U(()=>B.value.length);const N=i(!1),he=i(""),oe=i(""),me=i([]),J=i(""),R=i(""),B=i([]),P=i(""),ie=i([]),C=i([]),W=i(!1),X=i(""),G=i("");i(V().format("DD/MM/YYYY HH:mm:ss").toString()),i(JSON.parse(localStorage.getItem("userData")));const H=i(1),K=i(10),ce=i(0),pe=U(()=>Math.ceil(ce.value/K.value)),ve=async o=>{H.value=o,await re()};async function re(){z.value=!0,q.value=!1,A.value=[],N.value=!1,W.value=!1,await fetch(`https://ads-service.vercel.app/busqueda/user/?s=${R.value}&page=${H.value}&limit=${K.value}`).then(o=>o.json()).then(o=>{B.value=o.data,z.value=!1,q.value=!0}).catch(o=>o)}U(()=>{const o=(fe.value-1)*k,d=o+k;return B.value.slice(o,d)});const _e=async(o,d,v)=>{try{const s=await(await fetch("https://servicio-de-actividad.vercel.app/actividad/full/extra/v2/"+o)).json();if(!s.resp)console.log("No hay nada para mostrar");else{A.value=s.data,I.value="";const n=A.value.map(({country:u,navigationRecord:r})=>({country:u,navigationRecord:r})),m=[];J.value=d+" "+v;for(let u of n)for(let r of u.navigationRecord){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","D/M/YYYY"],_=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let g=V(r.fecha,e,!0).format("DD/MM/YYYY"),D=r.hora.split(":");if(D[2].indexOf(" ")>=0){let Fe=D[2].split(" ");D[2]=Fe[0]}let de=D[0]+":"+D[1]+":"+D[2],xe=g+" "+de,Me=V(xe,_,!0).format(),be={first_name:d,last_name:v,url:r.url,title:r.title,fecha:g,fechaRaw:r.fecha,fullFecha:Me,hora:de,country:u.country};m.push(be)}m.sort((u,r)=>{var g=new Date(u.fullFecha),D=new Date(r.fullFecha);return D-g});let f={};m.forEach(u=>{let r=u.title;u.country!==void 0&&u.country!==null&&u.country!==""&&(f.hasOwnProperty(r)?f[r].cantidad=(f[r].cantidad||1)+1:(u.cantidad=1,f[r]=u))});let x=Object.values(f);x.sort((u,r)=>r.cantidad-u.cantidad),P.value=x,Q.value=m.slice(0,10),ie.value=m,N.value=!0}}catch(y){console.error("Error al buscar la actividad del usuario",y)}},Ye=o=>{if(o.length>1){let d=o[0].toString(),v=o[1].toString();d===v&&(v=new Date(new Date(d).getTime()+60*60*24*1e3)),X.value=d,G.value=v;let e=ie.value.filter(s=>new Date(s.fullFecha)>=new Date(d)&&new Date(s.fullFecha)<=new Date(v));Q.value=e.slice(0,10);let _={};e.forEach(s=>{let n=s.title;s.country!==void 0&&s.country!==null&&s.country!==""&&(_.hasOwnProperty(n)?_[n].cantidad=(_[n].cantidad||1)+1:(s.cantidad=1,_[n]=s))});let y=Object.values(_);y.sort((s,n)=>n.cantidad-s.cantidad),P.value=y}},ge=U(()=>{const o=(Y.value-1)*k,d=o+k;return P.value.slice(o,d)}),De=()=>{Y.value*k<P.value.length&&Y.value++},we=()=>{Y.value>1&&Y.value--},ye=o=>{oe.value=o;const v=A.value.map(({device:s,country:n,navigationRecord:m})=>({device:s,country:n,navigationRecord:m})),e=[];for(let s of v)for(let n of s.navigationRecord)if(n.title===o||n.url===o){var _=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","D/M/YYYY"],y=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let m=V(n.fecha,_,!0).format("DD/MM/YYYY"),f=n.hora.split(":");if(f[2].indexOf(" ")>=0){let g=f[2].split(" ");f[2]=g[0]}let x=f[0]+":"+f[1]+":"+f[2],u=m+" "+x,r=V(u,y,!0).format();if(s.country!==void 0&&s.country!==null&&s.country!==""){let g={device:s.device,country:s.country,url:n.url,title:n.title,fecha:m,fechaRaw:n.fecha,fullFecha:r,hora:x,horaRaw:n.hora};e.push(g)}}if(e.sort((s,n)=>{var m=new Date(s.fullFecha),f=new Date(n.fullFecha);return f-m}),X.value&&G.value){let s=e.filter(n=>new Date(n.fullFecha)>=new Date(X.value)&&new Date(n.fullFecha)<=new Date(G.value));C.value=s.slice(0,25)}else C.value=e.slice(0,25);me.value=C.value.map(({first_name:s,last_name:n,fecha:m,hora:f,cantidad:x,title:u,url:r})=>({first_name:s,last_name:n,fecha:m,hora:f,cantidad:x,title:u,url:r})),W.value=!0,he.value=o};return(o,d)=>{const v=Ae;return p(),M(Te,null,{default:t(()=>[l(ue,{lg:"6",cols:"12",sm:"6"},{default:t(()=>[l(O,null,{default:t(()=>[l(b,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:t(()=>[l(S,{class:"pb-sm-0"},{default:t(()=>[l(E,null,{default:t(()=>[w("Trazabilidad usuarios")]),_:1})]),_:1}),a("div",Oe,[a("div",Ee,[l(Se,{modelValue:c(R),"onUpdate:modelValue":d[0]||(d[0]=e=>Z(R)?R.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),l(j,{"prepend-icon":"tabler-search",onClick:re},{default:t(()=>[w(" Buscar ")]),_:1})])]),_:1}),c(z)?(p(),M(b,{key:0},{default:t(()=>[w("Cargando datos...")]),_:1})):ee("",!0),c(q)?(p(),M(b,{key:1},{default:t(()=>[l(ae,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:t(()=>[$e,a("tbody",null,[(p(!0),F($,null,L(c(B),e=>(p(),F("tr",{class:"clickable",onClick:_=>_e(e.wylexId,e.first_name,e.last_name)},[a("td",null,h(e.first_name)+" "+h(e.last_name),1),a("td",ze,h(e.email),1)],8,Le))),256))])]),_:1}),c(ce)>c(K)?(p(),M(Re,{key:0,modelValue:c(H),"onUpdate:modelValue":[d[1]||(d[1]=e=>Z(H)?H.value=e:null),ve],size:"small","total-visible":10,length:c(pe),class:"mb-4"},null,8,["modelValue","length"])):ee("",!0)]),_:1})):ee("",!0)]),_:1}),l(te,null,{default:t(()=>[le(l(O,{style:{"margin-top":"1rem"}},{default:t(()=>[l(S,{class:"pb-sm-0"},{default:t(()=>[a("div",qe,[a("div",Qe,[l(E,null,{default:t(()=>[w("P\xE1ginas m\xE1s visitadas de "+h(c(J)),1)]),_:1})])]),l(b,null,{default:t(()=>[l(ae,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:t(()=>[Je,a("tbody",null,[(p(!0),F($,null,L(c(ge),e=>(p(),F("tr",{class:"clickable",onClick:_=>ye(e.title||e.url)},[a("td",Xe,h(e.title?e.title:e.url),1),a("td",Ge,h(e.cantidad),1)],8,We))),256))])]),_:1}),a("div",Ke,[l(j,{icon:"tabler-arrow-big-left-lines",onClick:we,disabled:c(Y)===1},null,8,["disabled"]),w(" P\xE1gina "+h(c(Y))+" ",1),l(j,{icon:"tabler-arrow-big-right-lines",onClick:De,disabled:c(Y)*k>=c(P).length},null,8,["disabled"])])]),_:1})]),_:1})]),_:1},512),[[se,c(N)]])]),_:1})]),_:1}),l(ue,{lg:"6",cols:"12",sm:"6"},{default:t(()=>[l(te,null,{default:t(()=>[le(l(O,null,{default:t(()=>[l(S,null,{default:t(()=>[l(E,null,{default:t(()=>[w("Actividad del usuario "+h(c(J)),1)]),_:1})]),_:1}),l(S,null,{default:t(()=>[a("div",Ze,[l(v,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:c(I),"onUpdate:modelValue":d[2]||(d[2]=e=>Z(I)?I.value=e:null),"show-current":"true",onOnChange:Ye,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])]),_:1}),l(b,null,{default:t(()=>[l(Be,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:t(()=>[(p(!0),F($,null,L(c(Q),e=>(p(),M(Ue,{"dot-color":"primary",size:"x-small"},{default:t(()=>[a("div",je,[a("h4",ea,h(e.title||e.url),1)]),a("p",aa,h(e.fecha)+" "+h(e.hora),1)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[se,c(N)]])]),_:1}),l(te,null,{default:t(()=>[le(l(O,{style:{"margin-top":"1rem"}},{default:t(()=>[l(S,{class:"pb-sm-0"},{default:t(()=>[a("div",ta,[a("div",la,[l(E,null,{default:t(()=>[w("\xDAltimas visitas a la p\xE1gina "+h(c(oe)),1)]),_:1})])]),c(C).length==0?(p(),M(b,{key:0},{default:t(()=>[w("No existen datos")]),_:1})):(p(),M(b,{key:1},{default:t(()=>[l(ae,{class:"text-no-wrap tableNavegacion mb-5"},{default:t(()=>[sa,a("tbody",null,[(p(!0),F($,null,L(c(C),e=>(p(),F("tr",na,[a("td",oa,h(e.country),1),a("td",ia,h(e.device),1),a("td",ca,h(e.fecha),1),a("td",ra,h(e.hora),1)]))),256))])]),_:1})]),_:1}))]),_:1})]),_:1},512),[[se,c(W)]])]),_:1})]),_:1})]),_:1})}}},ma=Ve(da,[["__scopeId","data-v-ddb441dd"]]);export{ma as default};
