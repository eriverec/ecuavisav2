import{r as i,as as je,o as j,x as le,a as l,w as t,u as m,g as B,h as U,q as f,p as h,i as te,b0 as re,t as ne,f as ke,e as M,b as D,V as A,F as ze,C as Ce,c as L,L as Ne,b3 as Ue,b4 as De,b5 as Ie,b6 as Te,n as I,N as T,a3 as se,bc as $e}from"./index.88d3c7f5.js";import{V as Fe}from"./VAutocomplete.bb0d71fb.js";import{V as Oe}from"./VAlert.3e8ed100.js";import{V as Be,a as Ae}from"./VToolbar.19b789c8.js";import{V as Le}from"./VSpacer.2a3e77c9.js";import{V as Je}from"./VToolbarItems.56927371.js";const He={class:"demo-space-x"},xe={style:{"line-height":"1.2",display:"block","font-size":"10px","padding-top":"4px","padding-left":"4px"}},Ge=["src"],Ze={__name:"edit",setup(qe){const k=i([]),z=i(!1),J=i([]),ie=i([]),H=i([]),de=i([]),$=i([]),ue=i([]),E=i([]),V=i(""),F=i([]),ce=i([]);ce.value=["2","3","4","5","6"];const u=i([]),O=i("https://services.ecuavisa.com/sendpulse"),x=i([{id:"66146103d6d9f2e80323e95e",name:"\xDAltima hora",forzado:O.value+"/boletin-ultimahora/forzado.php"},{id:"64f9f5455c4a279b69ff2aca",name:"Newsletter Opini\xF3n",forzado:O.value+"/opinion/forzado.php"}]);je(async()=>{await G(),await pe(),await ve(),await he(),await ge()});function C(o,e){if(o==2)return"El newsletter se enviar\xE1 todos los d\xEDas a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==3)return"El newsletter se enviar\xE1 el "+e.diaModel.toString().padStart(2,"0")+" de cada mes, a las  "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==4)return"El newsletter se enviar\xE1 cada a\xF1o, el "+e.diaModel.toString().padStart(2,"0")+" de "+e.mesModel.toString().padStart(2,"0")+" a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");if(o==5){let n=e.diaModel.join(",");const a={Lunes:1,Martes:2,Mi\u00E9rcoles:3,Jueves:4,Viernes:5};let r=n.split(",");r.sort((_,w)=>a[_]-a[w]);let s=e.mesModel.join(",");const p={Enero:1,Febrero:2,Marzo:3,Abril:4,Mayo:5,Junio:6,Julio:7,Agosto:8,Septiembre:9,Octubre:10,Noviembre:11,Diciembre:12};let S=s.split(",");if(S.sort((_,w)=>p[_]-p[w]),r.length===5&&S.length===12)return"El newsletter se enviar\xE1 de lunes a viernes, todos los meses del a\xF1o, a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0");{let _=r.join(","),w=S.join(",");return"El newsletter se enviar\xE1 en los d\xEDas de la semana: "+_+" para los meses de "+w+" a las "+e.horaModel.toString().padStart(2,"0")+":"+e.minutoModel.toString().padStart(2,"0")}}}async function G(){var r,s,p,S,_,w,K,Q,W,X,Y,Z,P,ee,ae;try{let N=[],oe=1,Ee=10;for(;;){var o=new Headers;o.append("Content-Type","application/json");var e={method:"GET",headers:o,redirect:"follow"},n=await fetch(`https://ads-service.vercel.app/newsletter/all?page=${oe}&limit=${Ee}`,e);const d=await n.json();if(d.data.length===0)break;N.push(...d.data),oe+=1}k.value=Array.from(N),E.value=[];for(const d of k.value){let v={radios:(r=d.config.horarioEjecucion)==null?void 0:r.method,calendariosInputs:[{value:1,minutoModel:(s=d.config.horarioEjecucion)==null?void 0:s.horario[0].minutoModel},{value:2,horaModel:(p=d.config.horarioEjecucion)==null?void 0:p.horario[1].horaModel,minutoModel:(S=d.config.horarioEjecucion)==null?void 0:S.horario[1].minutoModel},{value:3,diaModel:(_=d.config.horarioEjecucion)==null?void 0:_.horario[2].diaModel,horaModel:(w=d.config.horarioEjecucion)==null?void 0:w.horario[2].horaModel,minutoModel:(K=d.config.horarioEjecucion)==null?void 0:K.horario[2].minutoModel},{value:4,diaModel:(Q=d.config.horarioEjecucion)==null?void 0:Q.horario[3].diaModel,horaModel:(W=d.config.horarioEjecucion)==null?void 0:W.horario[3].horaModel,mesModel:(X=d.config.horarioEjecucion)==null?void 0:X.horario[3].mesModel,minutoModel:(Y=d.config.horarioEjecucion)==null?void 0:Y.horario[3].minutoModel},{value:5,diaModel:((Z=d.config.horarioEjecucion)==null?void 0:Z.horario.length)>4?d.config.horarioEjecucion.horario[4].diaModel:null,horaModel:((P=d.config.horarioEjecucion)==null?void 0:P.horario.length)>4?d.config.horarioEjecucion.horario[4].horaModel:null,mesModel:((ee=d.config.horarioEjecucion)==null?void 0:ee.horario.length)>4?d.config.horarioEjecucion.horario[4].mesModel:null,minutoModel:((ae=d.config.horarioEjecucion)==null?void 0:ae.horario.length)>4?d.config.horarioEjecucion.horario[4].minutoModel:null}]};u.value.push(v),F.value.push(0);var a="";const c=v.calendariosInputs[v.radios-1];v.radios==2&&c.horaModel&&c.minutoModel&&(a=C(v.radios,c)),v.radios==3&&c.diaModel&&c.horaModel&&c.minutoModel&&(a=C(v.radios,c)),v.radios==4&&c.diaModel&&c.mesModel&&c.horaModel&&c.minutoModel&&(a=C(v.radios,c)),v.radios==5&&c.diaModel&&c.mesModel&&c.horaModel&&c.minutoModel&&(a=C(v.radios,c)),console.log(a,E.value),E.value.push(a)}}catch(N){return console.error(N.message)}}const me=async o=>{const e=k.value[o];if(e.nombre==""||e.nombre.length<1)return alert("Debe ingresar un nombre"),!1;if(e.descripcion==""||e.descripcion.length<1)return alert("Debe ingresar una descripci\xF3n"),!1;if(e.subject==""||e.subject.length<1)return alert("Debe ingresar un subject"),!1;if(e.sender_name==""||e.sender_name.length<1)return alert("Debe ingresar un nombre del remitente"),!1;if(e.pass==""||e.pass.length<1)return alert("Debe ingresar una contrase\xF1a de seguridad"),!1;var n=await Me(o),a=n.method-1,r=n.horario[a];Object.keys(r).forEach(s=>{if(s!="value"&&r[s]==null)return alert(`No hay valor para: ${s}`),!1}),await fe({nombre:e.nombre,descripcion:e.descripcion,subject:e.subject,sender_email:e.sender_email||"ecuavisainforma@ecuavisa.com",sender_name:e.sender_name||""},e._id)},g=i({message:"Datos guardados",type:"success",model:!1}),fe=async(o,e)=>{z.value=!0;var n=o,a=new Headers;a.append("Content-Type","application/json");var r={method:"POST",headers:a,body:JSON.stringify(n),redirect:"follow"},s=await fetch("https://ads-service.vercel.app/newsletter/update/"+e,r);const p=await s.json();p.resp?g.value={message:"Dato editado",type:"success",model:!0}:g.value={message:"Un error se present\xF3"+p.error,type:"error",model:!0},await G(),z.value=!1,isDialogForm.value=!1};async function pe(){var o=JSON.stringify({grant_type:"client_credentials",client_id:"c79f7382012df0ea4c6fa37afec6374e",client_secret:"164551af334e1ec93e1b3099afd93a88"}),e={method:"POST",headers:{"Content-Type":"application/json"},body:o,redirect:"follow"};const a=await(await fetch("https://api.sendpulse.com/oauth/access_token",e)).json();V.value=a.access_token}async function ve(){try{if(!V.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+V.value);var e={method:"GET",headers:o,redirect:"follow"};const r=await(await fetch("https://api.sendpulse.com/addressbooks",e)).json();ie.value=r;for(var n in r)J.value.push({title:`${r[n].name} - ${r[n].id}`,value:r[n].id});J.value.sort((s,p)=>s.title.localeCompare(p.title))}catch(a){console.error(a.message)}}async function he(){try{if(!V.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+V.value);var e={method:"GET",headers:o,redirect:"follow"};const r=await(await fetch("https://api.sendpulse.com/templates/?owner=me",e)).json();de.value=r;for(var n in r)H.value.push({title:`${r[n].name}`,value:r[n].real_id});H.value.sort((s,p)=>s.title.localeCompare(p.title))}catch(a){console.error(a.message)}}async function ge(){try{if(!V.value)return!1;var o=new Headers;o.append("Authorization","Bearer "+V.value);var e={method:"GET",headers:o,redirect:"follow"};const r=await(await fetch("https://api.sendpulse.com/senders",e)).json();ue.value=r;for(var n in r)$.value.push({title:`${r[n].email}`,value:r[n].email});$.value.sort((s,p)=>s.title.localeCompare(p.title))}catch(a){console.error(a.message)}}async function Me(o){console.log("indexP ",o);var e=u.value[o].radios||2,n={method:e,horario:[{value:1,minutoModel:null},{value:2,horaModel:null,minutoModel:null},{value:3,diaModel:null,horaModel:null,minutoModel:null},{value:4,diaModel:null,horaModel:null,mesModel:null,minutoModel:null},{value:5,diaModel:null,horaModel:null,mesModel:null,minutoModel:null}]};return u.value[o].calendariosInputs.forEach((a,r)=>{r!=e-1&&(u.value[o].calendariosInputs[r]=n.horario[r])}),n={method:e,horario:[{value:1,minutoModel:u.value[o].calendariosInputs[0].minutoModel},{value:2,horaModel:u.value[o].calendariosInputs[1].horaModel,minutoModel:u.value[o].calendariosInputs[1].minutoModel},{value:3,diaModel:u.value[o].calendariosInputs[2].diaModel,horaModel:u.value[o].calendariosInputs[2].horaModel,minutoModel:u.value[o].calendariosInputs[2].minutoModel},{value:4,diaModel:u.value[o].calendariosInputs[3].diaModel,horaModel:u.value[o].calendariosInputs[3].horaModel,mesModel:u.value[o].calendariosInputs[3].mesModel,minutoModel:u.value[o].calendariosInputs[3].minutoModel},{value:5,diaModel:u.value[o].calendariosInputs[4].diaModel,horaModel:u.value[o].calendariosInputs[4].horaModel,mesModel:u.value[o].calendariosInputs[4].mesModel,minutoModel:u.value[o].calendariosInputs[4].minutoModel}]},n}const y=i(!1),q=i(""),be=async o=>{y.value=!0,q.value=O.value+o},b=i(!1);i(null);const _e=i(!1),R=i(!1),we=i(""),Ve=async()=>{try{b.value=!1,z.value=!0;var o=new Headers;o.append("Content-Type","application/json");var e={method:"POST",headers:o,redirect:"follow"},n=await fetch(R.value,e);const a=await n.json();a.hasOwnProperty("resp")?a.resp?g.value={message:"Newsletter creado y enviado",type:"success",model:!0}:g.value={message:"Un error se present\xF3: "+a.message,type:"error",model:!0}:g.value={message:"Un error se present\xF3: "+JSON.stringify(a),type:"error",model:!0},z.value=!1}catch(a){return console.error(a.message)}},ye=async o=>{const e=x.value.find(n=>n.id===o);e?e.forzado!=""&&(b.value=!0,we.value="forzado",R.value=e.forzado):alert("El forzado no est\xE1 configurado")},Se=o=>!!x.value.find(n=>n.id===o);return(o,e)=>{const n=$e;return j(),le("section",null,[l(re,{modelValue:m(b),"onUpdate:modelValue":e[2]||(e[2]=a=>te(b)?b.value=a:null),persistent:"",class:"v-dialog-sm"},{default:t(()=>[l(n,{onClick:e[0]||(e[0]=a=>b.value=!m(b))}),l(B,{title:"Forzado"},{default:t(()=>[l(U,null,{default:t(()=>[f(" \xBFDesea enviar el Newsletter ahora? ")]),_:1}),l(U,{class:"d-flex justify-end gap-3 flex-wrap"},{default:t(()=>[l(h,{color:"secondary",variant:"tonal",onClick:e[1]||(e[1]=a=>b.value=!1)},{default:t(()=>[f(" No, enviar ")]),_:1}),l(h,{onClick:Ve},{default:t(()=>[f(" Si, enviar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ke,{modelValue:m(g).model,"onUpdate:modelValue":e[3]||(e[3]=a=>m(g).model=a),location:"top end",variant:"flat",color:m(g).type},{default:t(()=>[f(ne(m(g).message),1)]),_:1},8,["modelValue","color"]),l(A,null,{default:t(()=>[l(M,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:t(()=>[D("div",He,[l(h,{color:"primary",variant:"text",class:"mb-4 d-none",to:{name:"apps-mailing-list"}},{default:t(()=>[f(" Lista de Newsletter ")]),_:1}),l(h,{color:"primary",variant:"text",class:"mb-4",to:{name:"apps-mailing-forzado"}},{default:t(()=>[f(" Enviar Forzado ")]),_:1}),l(h,{color:"primary",class:"mb-4",to:{name:"apps-mailing-tabs-edit"}},{default:t(()=>[f(" Editar newsletter ")]),_:1})])]),_:1})]),_:1}),l(A,{class:"d-flex"},{default:t(()=>[(j(!0),le(ze,null,Ce(m(k),(a,r)=>(j(),L(M,{cols:"6",class:Ne(["container",`item-${a._id}`])},{default:t(()=>[l(B,{class:"mt-5",title:"Editar "+a.nombre},{default:t(()=>[l(U,null,{default:t(()=>[l(Ue,{modelValue:m(F)[r],"onUpdate:modelValue":s=>m(F)[r]=s},{default:t(()=>[l(De,null,{default:t(()=>[l(Ie,null,{default:t(()=>[f("Formulario")]),_:1}),l(Te,null,{default:t(()=>[l(A,null,{default:t(()=>[l(M,{cols:"12",sm:"6",md:"6"},{default:t(()=>[l(I,{modelValue:a.nombre,"onUpdate:modelValue":s=>a.nombre=s,label:"Nombre del Newsletter para SendPulse",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"]),D("small",xe,[l(T,{icon:"mdi-information-outline",size:"13px"}),f(" Nombre como se va a guardar en SendPulse")])]),_:2},1024),l(M,{cols:"12",sm:"6",md:"6"},{default:t(()=>[l(I,{modelValue:a.descripcion,"onUpdate:modelValue":s=>a.descripcion=s,label:"Escribir descripci\xF3n corta",placeholder:"Ayuda dar al correo una descripci\xF3n breve",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(M,{cols:"12",sm:"6",md:"12"},{default:t(()=>[l(I,{modelValue:a.subject,"onUpdate:modelValue":s=>a.subject=s,label:"Escribir el asunto","persistent-hint":"",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(M,{cols:"12",sm:"6",md:"5"},{default:t(()=>[l(I,{modelValue:a.sender_name,"onUpdate:modelValue":s=>a.sender_name=s,label:"Nombre del remitente","persistent-hint":"",autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(M,{cols:"12",sm:"7"},{default:t(()=>[l(Fe,{modelValue:a.sender_email,"onUpdate:modelValue":s=>a.sender_email=s,items:m($),label:"Lista de remitentes disponible"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(M,{cols:"12",sm:"6",md:"12"}),l(M,{cols:"12",sm:"6",md:"12"},{default:t(()=>[m(E)[r]&&a._id!="64f9f5455c4a279b69ff2aca"?(j(),L(Oe,{key:0,density:"default",color:"success",variant:"tonal"},{default:t(()=>[l(T,{icon:"mdi-clock-time-eight-outline"}),f(" "+ne(m(E)[r]),1)]),_:2},1024)):se("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(U,{class:"d-flex justify-end flex-wrap gap-3"},{default:t(()=>[Se(a._id)==!0?(j(),L(h,{key:0,disabled:m(_e),title:"Env\xEDo forzado: "+a.nombre,class:"",onClick:s=>ye(a._id)},{default:t(()=>[f(" Enviar forzado "),l(T,{size:"22",icon:"mdi-email-fast-outline"})]),_:2},1032,["disabled","title","onClick"])):se("",!0),l(h,{onClick:s=>be(a.preview)},{default:t(()=>[f(" Vista previa ")]),_:2},1032,["onClick"]),l(h,{onClick:s=>me(r)},{default:t(()=>[f(" Guardar ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["class"]))),256))]),_:1}),l(re,{modelValue:m(y),"onUpdate:modelValue":e[6]||(e[6]=a=>te(y)?y.value=a:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:t(()=>[l(B,null,{default:t(()=>[D("div",null,[l(Be,{color:"primary"},{default:t(()=>[l(h,{icon:"",variant:"plain",onClick:e[4]||(e[4]=a=>y.value=!1)},{default:t(()=>[l(T,{color:"white",icon:"tabler-x"})]),_:1}),l(Ae,null,{default:t(()=>[f("Vista previa del Newsletter")]),_:1}),l(Le),l(Je,null,{default:t(()=>[l(h,{variant:"text",onClick:e[5]||(e[5]=a=>y.value=!1)},{default:t(()=>[f(" Cerrar ")]),_:1})]),_:1})]),_:1})]),D("iframe",{loading:"lazy",width:"100%",height:"2000px",src:m(q),frameborder:"0"},null,8,Ge)]),_:1})]),_:1},8,["modelValue"])])}}};export{Ze as default};
