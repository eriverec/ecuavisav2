import{M as ge,r as u,R as ye,S as we,U as xe,as as Ye,v as Ve,o as c,x as p,a as t,w as a,b8 as ee,q as d,b7 as De,ba as ae,V as te,e as T,g as A,h as b,aQ as F,aR as P,b2 as le,t as i,a3 as Ie,c as V,aW as j,b as l,F as B,C as L,u as Ce,L as Me,p as D,bD as se,ao as I,ap as C,n as Se,b9 as Ue,a4 as ke,aX as Ne,bd as Re,be as Oe}from"./index.88d3c7f5.js";const M=S=>(Re("data-v-6fc8ff7e"),S=S(),Oe(),S),Te=M(()=>l("br",null,null,-1)),Ae={key:0,class:"date-picker-wrapper",style:{width:"300px"}},Fe=M(()=>l("thead",null,[l("tr",null,[l("th",{scope:"col"},"T\xCDTULO"),l("th",{scope:"col"},"USUARIOS")])],-1)),Pe=["onClick"],je={class:"text-medium-emphasis"},Be={class:"d-flex align-center justify-space-between botonescurrentPage"},Le={style:{display:"flex","flex-wrap":"wrap"}},He={style:{width:"max-content"}},Ee={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},Je=M(()=>l("thead",null,[l("tr",null,[l("th",{scope:"col"},"Nombre"),l("th",{scope:"col"},"Fecha"),l("th",{scope:"col"},"Hora")])],-1)),Qe={class:"text-high-emphasis"},We={class:"text-medium-emphasis"},$e={class:"text-medium-emphasis"},qe={class:"d-flex flex-wrap gap-4"},ze={style:{width:"15rem"}},Xe=M(()=>l("thead",null,[l("tr",null,[l("th",{scope:"col"},"NOMBRE"),l("th",{scope:"col"},"NOTICIAS")])],-1)),Ze=["onClick"],Ge={class:"text-medium-emphasis"},Ke={style:{display:"flex","flex-wrap":"wrap"}},ea={style:{width:"max-content"}},aa=M(()=>l("thead",null,[l("tr",null,[l("th",{scope:"col"},"TITULO")])],-1)),ta={class:"text-high-emphasis"},la={__name:"index",setup(S){const U=u("tab-a"),f=ye.exports.extendMoment(we);f.locale("es",[xe]);const k=8,h=u(1),y=u([]),N=u(!1),H=u(!1),E=u(""),$=u(""),q=u(""),J=u([]),z=u(!1),Q=u(""),oe=u(null);u(!1);const X=u([]),R=u(""),g=u([]),w=u(!1),W=u(!1),Z=u([]),G=u("");u(f().format("DD/MM/YYYY HH:mm:ss").toString()),u(JSON.parse(localStorage.getItem("userData")));async function K(o="",s=""){N.value=!0;var n=[];let e=1,r=1e3;for(;;){const Y=await(await fetch("https://servicio-de-actividad.vercel.app/recomendadas/get/all?"+new URLSearchParams({fechai:o,fechaf:s,limit:r,page:e}))).json();if(Y.length===0)break;n.push(...Y),e+=1}X.value=n;const m=Array.from(n);let _={};for(let x of m)for(let Y of x.data){let O=Y.title,be={title:Y.title,cantidad:1};_.hasOwnProperty(O)&&_[O].userId!==x.userId?_[O].cantidad+=1:_[O]=be}let v=Object.values(_);y.value=v,N.value=!1}const ne=async()=>{let o=f().subtract(7,"days").format("DD-MM-YYYY").toString(),s=f().format("DD-MM-YYYY").toString(),n=f(o,"DD-MM-YYYY").format("YYYY-MM-DD"),e=f(s,"DD-MM-YYYY").format("YYYY-MM-DD");$.value=o,q.value=s,E.value=o+" a "+s,await K(n,e)};Ye(async()=>{ne()});const re=Ve(()=>{const o=(h.value-1)*k,s=o+k;return y.value.slice(o,s)}),ue=()=>{h.value*k<y.value.length&&h.value++},ce=()=>{h.value>1&&h.value--};async function de(o){try{if(o.length>1){console.log("selectedDates",o),h.value=1;let s=f(o[0]).format("YYYY-MM-DD"),n=f(o[1]).format("YYYY-MM-DD");$.value=s,q.value=n,await K(s,n)}}catch(s){console.error(s)}}async function ie(o){Q.value=o;let s=Array.from(X.value),n={};for(let r of s)for(let m of r.data)if(m.title==o){let _={userId:r.userId,first_name:r.first_name,last_name:r.last_name,created_at:r.created_at,fecha:f(r.created_at).format("DD/MM/YYYY"),hora:f(r.created_at).format("HH:mm:ss")},v=r.userId;n.hasOwnProperty(v)||(n[v]=_)}let e=Object.values(n);J.value=e,z.value=!0}async function fe(){H.value=!0,w.value=!0;const s=await(await fetch("https://servicio-de-actividad.vercel.app/recomendadas/get/usuario?searchQuery="+R.value)).json(),n=[];for(let e of s){let r={userId:e.userId,first_name:e.first_name,last_name:e.last_name,created_at:e.created_at,fecha:f(e.created_at).format("DD/MM/YYYY"),hora:f(e.created_at).format("HH:mm:ss"),data:e.data,noticias:e.data.length};n.push(r)}g.value=n,H.value=!1}const _e=o=>{const n=Array.from(g.value).find(e=>e.userId===o);Z.value=n.data,G.value=n.first_name+" "+n.last_name,W.value=!0},ve=()=>{R.value="",g.value=[],w.value=!1,W.value=!1};function me(o){for(var s=typeof o!="object"?JSON.parse(o):o,n="",e=0;e<s.length;e++){var r="";for(var m in s[e])r!=""&&(r+=","),r+=s[e][m];n+=r+`\r
`}return n}function pe(o,s,n){o&&s[0].wylexId!=="wylexId"&&s.unshift(o);var e=JSON.stringify(s),r=me(e),m=n+".csv"||"export.csv",_=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(_,m);else{var v=document.createElement("a");if(v.download!==void 0){var x=URL.createObjectURL(_);v.setAttribute("href",x),v.setAttribute("download",m),v.style.visibility="hidden",document.body.appendChild(v),v.click(),document.body.removeChild(v)}}}async function he(){let o={userId:"userId",first_name:"first_name",last_name:"last_name",created_at:"created_at"},s=J.value.map(({userId:e,first_name:r,last_name:m,created_at:_})=>({userId:e,first_name:r,last_name:m,created_at:_})),n="usuarios_"+Q.value.replace(/[^A-Z0-9]+/ig,"_");ke("export"),pe(o,s,n)}return(o,s)=>{const n=Ne;return c(),p("div",null,[t(De,{modelValue:U.value,"onUpdate:modelValue":s[0]||(s[0]=e=>U.value=e)},{default:a(()=>[t(ee,{value:"tab-a"},{default:a(()=>[d(" Recomendadas ")]),_:1}),t(ee,{value:"tab-b"},{default:a(()=>[d(" Por usuario ")]),_:1})]),_:1},8,["modelValue"]),Te,t(Ue,{modelValue:U.value,"onUpdate:modelValue":s[3]||(s[3]=e=>U.value=e)},{default:a(()=>[t(ae,{value:"tab-a"},{default:a(()=>[t(te,null,{default:a(()=>[t(T,{lg:"6",cols:"12",sm:"6"},{default:a(()=>[t(A,null,{default:a(()=>[t(b,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:a(()=>[t(F,{class:"pb-sm-0 pl-0 pt-0"},{default:a(()=>[t(P,null,{default:a(()=>[d("Notas recomendadas")]),_:1}),t(le,null,{default:a(()=>[d("Un total de "+i(y.value.length)+" registros",1)]),_:1})]),_:1}),N.value?Ie("",!0):(c(),p("div",Ae,[t(n,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:E.value,"onUpdate:modelValue":s[1]||(s[1]=e=>E.value=e),"show-current":"true",onOnChange:de,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])]))]),_:1}),N.value?(c(),V(b,{key:0},{default:a(()=>[d("Cargando datos...")]),_:1})):(c(),V(b,{key:1},{default:a(()=>[t(j,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:a(()=>[Fe,l("tbody",null,[(c(!0),p(B,null,L(Ce(re),e=>(c(),p("tr",{class:Me(["clickable",{active:e._id===oe.value}]),onClick:r=>ie(e.title)},[l("td",null,i(e.title),1),l("td",je,i(e.cantidad),1)],10,Pe))),256))])]),_:1}),l("div",Be,[t(D,{icon:"tabler-arrow-big-left-lines",onClick:ce,disabled:h.value===1},null,8,["disabled"]),d(" P\xE1gina "+i(h.value)+" ",1),t(D,{icon:"tabler-arrow-big-right-lines",onClick:ue,disabled:h.value*k>=y.value.length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),t(T,{lg:"6",cols:"12",sm:"6"},{default:a(()=>[t(se,null,{default:a(()=>[I(t(A,null,{default:a(()=>[t(F,{class:"pb-sm-0"},{default:a(()=>[l("div",Le,[l("div",He,[t(P,null,{default:a(()=>[d("Usuarios de la nota: "+i(Q.value),1)]),_:1})])]),l("div",Ee,[t(D,{color:"success",onClick:he},{default:a(()=>[d(" Exportar ")]),_:1})]),t(j,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:a(()=>[Je,l("tbody",null,[(c(!0),p(B,null,L(J.value,e=>(c(),p("tr",null,[l("td",Qe,i(e.first_name)+" "+i(e.last_name),1),l("td",We,i(e.fecha),1),l("td",$e,i(e.hora),1)]))),256))])]),_:1})]),_:1})]),_:1},512),[[C,z.value]])]),_:1})]),_:1})]),_:1})]),_:1}),t(ae,{value:"tab-b"},{default:a(()=>[t(te,null,{default:a(()=>[t(T,{lg:"6",cols:"12",sm:"6"},{default:a(()=>[t(A,null,{default:a(()=>[t(b,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:a(()=>[t(F,{class:"pb-sm-0 pl-0 pt-0"},{default:a(()=>[t(P,null,{default:a(()=>[d("Notas por usuarios")]),_:1}),t(le,null,{default:a(()=>[d("Un total de "+i(g.value.length)+" registros",1)]),_:1})]),_:1}),l("div",qe,[l("div",ze,[t(Se,{modelValue:R.value,"onUpdate:modelValue":s[2]||(s[2]=e=>R.value=e),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),t(D,{"prepend-icon":"tabler-search",onClick:fe},{default:a(()=>[d(" Buscar ")]),_:1}),t(D,{onClick:ve},{default:a(()=>[d(" Reiniciar ")]),_:1})])]),_:1}),H.value?I((c(),V(b,{key:0},{default:a(()=>[d("Cargando datos...")]),_:1},512)),[[C,w.value]]):g.value.length>0?I((c(),V(b,{key:1},{default:a(()=>[t(j,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:a(()=>[Xe,l("tbody",null,[(c(!0),p(B,null,L(g.value,e=>(c(),p("tr",{class:"clickable",onClick:r=>_e(e.userId)},[l("td",null,i(e.first_name)+" "+i(e.last_name),1),l("td",Ge,i(e.noticias),1)],8,Ze))),256))])]),_:1})]),_:1},512)),[[C,w.value]]):I((c(),V(b,{key:2},{default:a(()=>[d("No se econtraron datos")]),_:1},512)),[[C,w.value]])]),_:1})]),_:1}),t(T,{lg:"6",cols:"12",sm:"6"},{default:a(()=>[t(se,null,{default:a(()=>[I(t(A,null,{default:a(()=>[t(F,{class:"pb-sm-0"},{default:a(()=>[l("div",Ke,[l("div",ea,[t(P,null,{default:a(()=>[d("Noticias del usuario: "+i(G.value),1)]),_:1})])]),t(j,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:a(()=>[aa,l("tbody",null,[(c(!0),p(B,null,L(Z.value,e=>(c(),p("tr",null,[l("td",ta,i(e.title),1)]))),256))])]),_:1})]),_:1})]),_:1},512),[[C,W.value]])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},oa=ge(la,[["__scopeId","data-v-6fc8ff7e"]]);export{oa as default};
