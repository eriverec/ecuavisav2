import{R as De,S as ke,U as Me,bA as G,r as d,bB as Se,v as N,ak as $e,as as le,Q as j,bP as y,o as b,x as C,a as l,w as r,e as J,g as Q,b7 as Te,u as o,i as V,b8 as ie,q as Y,a2 as I,b9 as Pe,ba as oe,aQ as X,p as ne,b as s,b2 as re,t as g,bC as K,aT as Re,aW as Be,F as Fe,C as Ue,aR as Z,aM as Ae,aq as ze,N as Ee,ao as Ne,ap as je,c as ce,bx as de,a3 as L,V as Ie}from"./index.88d3c7f5.js";import{_ as Le}from"./AppDateRange.cbfc1214.js";import{_ as Oe}from"./tabGroupTable.06bf3af4.js";import{V as qe}from"./VTooltip.2d0a8708.js";import{V as He}from"./VPagination.9412c3b8.js";import"./parseISO.d0bde0b5.js";const We={class:"d-flex pr-0",style:{"justify-content":"space-between"}},Ge={class:"descripcion"},Je=s("span",null,"Exportar b\xFAsqueda",-1),Qe=s("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),Xe={class:"px-5 py-2"},Ke={class:"bg-ecuavisa py-4 d-flex gap-4 flex-wrap"},Ze={class:"date-picker-wrappe",style:{"min-width":"90px",width:"auto"}},ea={style:{"min-width":"230px",width:"auto"}},aa={class:"item-limit"},ta=s("label",null,"Mostrar",-1),sa=s("label",null,"registros",-1),la=s("thead",{class:"text-uppercase"},[s("tr",null,[s("th",{scope:"col"}," N "),s("th",{scope:"col"}," T\xEDtulo de P\xE1gina "),s("th",{scope:"col",class:"text-center"}," Evento "),s("th",{scope:"col"}," Nombre de Campa\xF1a "),s("th",{scope:"col",class:"text-left"}," Fecha y hora de evento "),s("th",{scope:"col"}," Link ")])],-1),ia={class:"text-center"},oa={style:{"min-width":"17rem","max-width":"17rem","text-align":"left"}},na={class:"text-center"},ra={key:0},ca={key:1},da={class:"text-center"},ua={class:"text-center",style:{width:"5rem"}},pa=s("tr",null,[s("td",{colspan:"8",class:"text-center text-body-1"}," No data available ")],-1),ma=[pa],fa=s("br",null,null,-1),va={class:"d-flex pr-0",style:{"justify-content":"space-between"}},ha={class:"descripcion"},ba=s("small",{class:"mt-3"},"Informaci\xF3n en porcentajes por campa\xF1a seleccionada",-1),ga={class:"bg-ecuavisa py-4 d-flex gap-4"},_a={style:{"min-width":"230px",width:"auto"}},ya={key:1,class:"px-4"},wa={class:"d-flex pr-0",style:{"justify-content":"space-between"}},xa={class:"descripcion"},Ca=s("small",{class:"mt-3"},"Informe para medir el impacto que obtuvo una campa\xF1a frente a otra u otras campa\xF1as",-1),Va={class:"bg-ecuavisa py-4 d-flex gap-4"},Ya={style:{"min-width":"230px",width:"auto"}},Da={key:1,class:"px-4"},Ua={__name:"index_old",setup(ka){const D=De.exports.extendMoment(ke);D.locale("es",[Me]);const O=G(),f=d({i:O.i,f:O.f,title:"hoy"}),k=d(0),v=d(!1);d(!1);const $=d(!1),ue=d(!1),T=d("Hoy");Se();const w=d(O.limit),P=d(1),R=d(7),pe=d([{title:"Todos los eventos",value:"all"},{title:"Usuarios que vieron la publicidad",value:"preview"},{title:"Usuarios que dieron click en la publicidad",value:"click"}]),_=d(null),h=d(null),M=d(null),q=d([]),B=d([]),S=d([]),ee=d([]),ae=d([]),H=d([]),me=d([]),W=d({title:R.value,value:R.value}),fe=[{title:"10",value:10},{title:"30",value:30},{title:"50",value:50},{title:"100",value:100},{title:"200",value:200}],ve=N(()=>Math.ceil(q.value.length/R.value)),he=a=>{const t=`rgba(${y(a.colors["on-surface"])},${a.variables["medium-emphasis-opacity"]})`,n=`rgba(${y(a.colors["on-surface"])},${a.variables["disabled-opacity"]})`,e=`rgba(${y(String(a.variables["border-color"]))},${a.variables["border-opacity"]})`,i=`rgba(${y(a.colors["on-surface"])},${a.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:t,themeDisabledTextColor:n,themeBorderColor:e,themePrimaryTextColor:i}},F=$e(),{themeBorderColor:Ma,themeDisabledTextColor:te}=he(F.current.value);async function be(){$.value=!0,await ye();let a={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"},t=B.value||[];await _e(a,t,"campaigns_full"),$.value=!1}async function ge(a){for(var t=typeof a!="object"?JSON.parse(a):a,n="",e=0;e<t.length;e++){var i="";for(var u in t[e])i!=""&&(i+=","),i+=t[e][u];n+=i+`\r
`}return n}async function _e(a,t,n){a&&t.unshift(a);var e=JSON.stringify(t),i=await ge(e),u=n+".csv"||"export.csv",m=new Blob([i],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(m,u);else{var c=document.createElement("a");if(c.download!==void 0){var p=URL.createObjectURL(m);c.setAttribute("href",p),c.setAttribute("download",u),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}}async function ye(){B.value=[];let a=1,t=7e3;for(;;){const e=await U({tipo:"all",fechai:f.value.i.format("YYYY-MM-DD"),fechaf:f.value.f.format("YYYY-MM-DD"),limit:t,page:a,exportar:!0});if(e.length===0)break;B.value.push(...e),a+=1}const n=B.value.reduce((e,i)=>(e.push({title:i.title,url:i.url,type:i.type,created_at:i.created_at,user_email:i.firstUser.email,user_last_name:i.firstUser.last_name,user_firstname:i.firstUser.firstname,campaign_idCampaign:i.idCampaign._id,campaign_title:i.idCampaign.title,campaign_position:i.idCampaign.position}),e),[]);return B.value=n,!0}async function U(a={}){try{const{tipo:n="all",fechai:e=D().format("YYYY-MM-DD"),fechaf:i=D().format("YYYY-MM-DD"),limit:u=10,page:m=1,exportar:c=!1}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/events/${n}?fechai=${e}&fechaf=${i}&page=${m}&limit=${u}&idCampaign=&userId=`);const p=await t.json();if(!c)q.value=p.data,me.value=p.data;else return p.data}catch(n){return console.error(n.message)}}async function we(){try{var a=await fetch("https://ads-service.vercel.app/campaigns-historical/campaigns");const t=await a.json();S.value=t.data.reduce((n,e)=>(n.push({value:e._id,title:`${e.campaignTitle} (${e.statusCampaign?"activo":"inactivo"})`}),n),[]),H.value=S.value[0],h.value=S.value[0]}catch(t){return console.error(t.message)}}async function xe(a={}){try{const{idCampaign:n=null}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/chart-1?idCampaign=${n}`);const e=await t.json();ee.value=e.data.reduce((i,u)=>(i.push({preview:u.sumPreview,click:u.sumClick,title:u.campaignData.campaignTitle}),i),[])}catch(n){return console.error(n.message)}}async function Ce(a={}){try{const{idCampaign:n=null}=a,e=n.map(u=>u.value);var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/chart-1?idCampaign=${e}`);const i=await t.json();ae.value=i.data.reduce((u,m)=>(u.push({preview:m.sumPreview,click:m.sumClick,title:m.campaignData.campaignTitle}),u),[])}catch(n){return console.error(n.message)}}le(U),le(we);const se=N(()=>{const a=(P.value-1)*R.value,t=P.value*R.value;return q.value.slice(a,t)});j(async()=>T.value,async()=>{let a=G(T.value);f.value={i:a.i,f:a.f,title:T.value},w.value=a.limit,v.value=!0,await U({fechai:f.value.i.format("YYYY-MM-DD"),fechaf:f.value.f.format("YYYY-MM-DD"),limit:w.value}),v.value=!1}),j(async()=>_.value,async()=>{let a=G(T.value);f.value={i:a.i,f:a.f,title:T.value},w.value=a.limit,v.value=!0,await U({fechai:f.value.i.format("YYYY-MM-DD"),fechaf:f.value.f.format("YYYY-MM-DD"),limit:w.value,tipo:_.value?_.value.value:"all"}),v.value=!1});const Ve=async a=>{let t=a;f.value={i:D(t[0]),f:D(t[1]),title:"Fecha personalizada"},w.value=8e3,v.value=!0,await U({fechai:f.value.i.format("YYYY-MM-DD"),fechaf:f.value.f.format("YYYY-MM-DD"),limit:w.value,tipo:_.value?_.value.value:"all"}),v.value=!1};j(async()=>h.value,async()=>{v.value=!0,await xe({idCampaign:h.value?h.value.value:H.value.value}),v.value=!1}),j(()=>M,async()=>{v.value=!0,await Ce({idCampaign:M.value?M.value:[H.value]}),v.value=!1},{deep:!0});const A=N(()=>{const a=F.current.value.colors,t=F.current.value.variables,n=`rgba(${y(a.success)},0.2)`,e=`rgba(${y(a["on-background"])},${t["high-emphasis-opacity"]})`;a.success;let i=Array.from(ee.value);const u={name:"Device",data:[]},m=[];for(let p in i)u.data.push(i[p].preview),u.data.push(i[p].click);m.push("Impresiones"),m.push("Clicks");const c={chart:{parentHeightOffset:0,type:"donut",events:{dataPointSelection:function(p,x,E){}}},labels:m,colors:["#7365ed","#ff7f50","#EE2E31","#ff6347","#00fa9a","#ffa500","#1D7874","#ff4500","#32cd32","#ff1493","#00fa9a","#ff69b4","#9932cc","#ff8c00","#8b008b","#8a2be2"],stroke:{width:0},dataLabels:{enabled:!0,formatter:function(p,{seriesIndex:x,dataPointIndex:E,w:Ye}){return`${Ye.config.series[x]} ${m[x]}`},textAnchor:"middle",distributed:!1,offsetX:0,offsetY:0,style:{fontSize:"15px",fontFamily:"Helvetica, Arial, sans-serif",fontWeight:"bold",colors:void 0},background:{enabled:!0,foreColor:"#fff",padding:4,borderRadius:2,borderWidth:1,borderColor:"#fff",opacity:1,dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.45}},dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.45}},legend:{position:"bottom",horizontalAlign:"center",offsetX:0,markers:{width:7,height:7},show:!0,labels:{colors:te,useSeriesColors:!1}},tooltip:{},grid:{padding:{top:15,right:-20,left:-20}},states:{hover:{filter:{type:"none"}}},plotOptions:{pie:{donut:{size:"60%",labels:{show:!1,value:{fontSize:"1.375rem",fontFamily:"Public Sans",color:e,fontWeight:600,offsetY:-15,formatter(p){return`${parseInt(p)}%`}},name:{offsetY:20,fontFamily:"Public Sans"},total:{show:!1,showAlways:!1,color:a.success,fontSize:".8125rem",label:"Total",fontFamily:"Public Sans",formatter(){return"184"}}}}}}};return{series:u.data,options:c}}),z=N(()=>{const a=F.current.value.colors,t=F.current.value.variables,n=`rgba(${y(a.success)},0.2)`,e=`rgba(${y(a["on-background"])},${t["high-emphasis-opacity"]})`;a.success;let i=Array.from(ae.value);const m={chart:{parentHeightOffset:0,zoom:{enabled:!1},toolbar:{show:!1},type:"bar",height:350,events:{dataPointSelection:function(c,p,x){}}},colors:["#ff6347","#9932cc","#ff8c00","#8b008b","#8a2be2"],stroke:{show:!0,width:1,colors:["transparent"]},dataLabels:{enabled:!1},xaxis:{categories:i.map(c=>c.title),labels:{colors:te,useSeriesColors:!1}},yaxis:{title:{text:"Interacciones",style:{color:e}}},fill:{opacity:1},tooltip:{y:{formatter:function(c){return c+" Visitas"}},theme:!1,custom:function({series:c,seriesIndex:p,dataPointIndex:x,w:E}){return`<div class="tooltip-content">
            <div class="tooltip-body">
              <div class="tooltip-title">
                ${E.config.xaxis.categories[x]}
              </div>
              <!--<div class="tooltip-subtitle">
                Campa\xF1a
              </div>-->
              <div class="tooltip-data-flex">
                <div class="tooltip-data-title">
                  ${E.config.series[p].name}
                </div>
                <div class="tooltip-data-value">
                  ${c[p][x]}
                </div>
              </div>
            </div>
          </div>`}},legend:{labels:{colors:e,useSeriesColors:!1}},states:{hover:{filter:{type:"none"}}}};return{series:[{name:"Impresiones",data:i.map(c=>c.preview)},{name:"Clicks",data:i.map(c=>c.click)}],options:m}});return(a,t)=>{const n=Le;return b(),C("section",null,[l(Ie,null,{default:r(()=>[l(J,{class:"mt-0",cols:"12",md:"6",lg:"8"},{default:r(()=>[l(Q,{class:"px-2 py-2 elevation-0"},{default:r(()=>[l(Te,{modelValue:o(k),"onUpdate:modelValue":t[0]||(t[0]=e=>V(k)?k.value=e:null),class:""},{default:r(()=>[l(ie,{class:""},{default:r(()=>[Y("An\xE1lisis de campa\xF1as")]),_:1}),l(ie,{class:""},{default:r(()=>[Y("An\xE1lisis agrupada")]),_:1})]),_:1},8,["modelValue"]),l(I),l(Pe,{modelValue:o(k),"onUpdate:modelValue":t[4]||(t[4]=e=>V(k)?k.value=e:null)},{default:r(()=>[l(oe,null,{default:r(()=>[l(X,{class:"header_card_item py-0 pt-4 align-start"},{append:r(()=>[l(ne,{variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:be,loading:o($),disabled:o($)},{default:r(()=>[Je,l(qe,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!o($)},{default:r(()=>[Qe]),_:1},8,["disabled"])]),_:1},8,["loading","disabled"])]),default:r(()=>[s("div",We,[s("div",Ge,[l(re,null,{default:r(()=>[Y("*Mostrando data desde, "+g(o(f).i.format("YYYY-MM-DD"))+" hasta "+g(o(f).f.format("YYYY-MM-DD")),1)]),_:1}),l(re,null,{default:r(()=>[Y("*Este informe muestra un l\xEDmite m\xE1ximo de "+g(o(w))+" registros",1)]),_:1})])])]),_:1}),s("div",Xe,[s("div",Ke,[s("div",Ze,[l(n,{"onGet:dateCR":Ve})]),s("div",ea,[l(K,{clearable:"",density:"compact",disabled:o(v),modelValue:o(_),"onUpdate:modelValue":t[1]||(t[1]=e=>V(_)?_.value=e:null),items:o(pe),variant:"outlined",label:"Buscar por evento","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])]),l(I,{class:"my-5"}),s("div",aa,[ta,l(Re,{style:{"min-width":"90px"},modelValue:o(W),"onUpdate:modelValue":t[2]||(t[2]=e=>V(W)?W.value=e:null),items:fe,"item-title":"title","item-value":"value",label:"","persistent-hint":"","return-object":"","single-line":""},null,8,["modelValue"]),sa]),l(Be,{class:"text-no-wrap invoice-list-table",disabled:o(ue)},{default:r(()=>[la,s("tbody",null,[(b(!0),C(Fe,null,Ue(o(se),(e,i)=>(b(),C("tr",{key:i,style:{height:"3.75rem"}},[s("td",ia,g(i+1),1),s("td",oa,[l(Z,{title:e.title,style:{"font-size":"18px"}},{default:r(()=>[s("small",null,g(e.title),1)]),_:2},1032,["title"])]),s("td",na,[l(Ae,ze({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:r(()=>[e.type=="preview"?(b(),C("span",ra,"Impresi\xF3n")):(b(),C("span",ca,g(e.type),1))]),_:2},1040)]),s("td",da,g(e.idCampaign.title),1),s("td",null,g(o(D)(e.created_at).format("YYYY-MM-DD, HH:mm:ss")),1),s("td",ua,[l(ne,{icon:"",size:"x-small",color:"info",variant:"text",href:e.url,target:"_blank"},{default:r(()=>[l(Ee,{size:"22",icon:"mdi-link-variant"})]),_:2},1032,["href"])])]))),128))]),Ne(s("tfoot",null,ma,512),[[je,!o(se).length]])]),_:1},8,["disabled"]),l(He,{class:"mt-5",modelValue:o(P),"onUpdate:modelValue":t[3]||(t[3]=e=>V(P)?P.value=e:null),length:o(ve),"total-visible":7},null,8,["modelValue","length"]),fa])]),_:1}),l(oe,null,{default:r(()=>[l(Oe,{dataCampaigns:o(S)},null,8,["dataCampaigns"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(J,{class:"mt-0",cols:"12",md:"6",lg:"4"},{default:r(()=>[l(Q,{class:"px-0 py-0 pb-4 v-card--flat v-theme--light v-card--border v-card--density-default v-card--variant-elevated"},{default:r(()=>[l(X,{class:"header_card_item pb-0"},{default:r(()=>[s("div",va,[s("div",ha,[l(Z,null,{default:r(()=>[Y("Gr\xE1ficos de eventos")]),_:1}),ba])]),s("div",ga,[s("div",_a,[l(K,{clearable:"",density:"compact",disabled:o(v),modelValue:o(h),"onUpdate:modelValue":t[5]||(t[5]=e=>V(h)?h.value=e:null),items:o(S),variant:"outlined",label:"Buscar por campa\xF1a","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])]),l(I,{class:"my-5"})]),_:1}),o(A).series.length>0?(b(),ce(o(de),{key:0,options:o(A).options,series:o(A).series,height:475,width:"100%"},null,8,["options","series"])):L("",!0),o(A).series.length<1?(b(),C("div",ya,[Y("No existen datos para esta campa\xF1a "),s("b",null,g(o(h)?o(h).title:""),1)])):L("",!0)]),_:1})]),_:1}),l(J,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:r(()=>[l(Q,{class:"px-0 py-0 pb-4 v-card--flat v-theme--light v-card--border v-card--density-default v-card--variant-elevated"},{default:r(()=>[l(X,{class:"header_card_item pb-0"},{default:r(()=>[s("div",wa,[s("div",xa,[l(Z,null,{default:r(()=>[Y("Comparativa de datos entre campa\xF1as")]),_:1}),Ca])]),s("div",Va,[s("div",Ya,[l(K,{chips:"",clearable:"",density:"compact",disabled:o(v),multiple:"",modelValue:o(M),"onUpdate:modelValue":t[6]||(t[6]=e=>V(M)?M.value=e:null),items:o(S),variant:"outlined",label:"Buscar por campa\xF1a","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])]),l(I,{class:"my-5"})]),_:1}),o(z).series.length>0?(b(),ce(o(de),{key:0,class:"px-5",options:o(z).options,series:o(z).series,height:350,width:"100%"},null,8,["options","series"])):L("",!0),o(z).series.length<1?(b(),C("div",Da,"No est\xE1 existen datos")):L("",!0)]),_:1})]),_:1})]),_:1})])}}};export{Ua as default};
