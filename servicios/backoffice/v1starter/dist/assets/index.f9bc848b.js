import{R as J,S as Q,U as W,r as c,Q as X,as as K,o as O,x as T,a as i,w as m,q as b,t as _,u as s,f as Z,e as aa,g as ea,aQ as ta,b as f,aR as oa,b2 as sa,h as la,aT as ra,i as V,bC as na,p as ca,N as ia,a3 as ua,V as da,bb as fa,aX as ma}from"./index.88d3c7f5.js";import{p as k}from"./parseISO.d0bde0b5.js";const pa={class:"p-0 d-flex flex-column align-items-start"},ha=f("br",null,null,-1),va={class:"d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0 mb-5"},ba=f("small",{class:"mb-2"},"La hora para las fechas ser\xE1n 17:30",-1),ga=f("hr",null,null,-1),Ya={class:"py-3"},ya=f("b",null,"Fecha inicio: ",-1),_a=f("br",null,null,-1),xa=f("b",null,"Fecha final: ",-1),Da={class:"d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},Ma={key:0,class:"px-0 py-1 text-disabled"},Ca={__name:"index",setup(Va){const l=J.exports.extendMoment(Q);l.locale("es",[W]);const E="https://ecuavisa-suscripciones.vercel.app",p=c({message:"Datos guardados",type:"success",model:!1}),h=c(!1);c(!1);const w=l().format("YYYY-MM-DD"),S=l().subtract(1,"days").format("YYYY-MM-DD"),M=c([k(S),k(w)]),g=c("Hoy"),j=c(["Hoy","Ayer","Anteayer"]),n=c({fechai:S+" 17:30:00",fechaf:w+" 17:30:00"}),C=c({idSuscripciones:"idSuscripciones",wylexId:"wylexId",nombres:"nombres",email:"email",apellidos:"apellidos",cedula:"cedula",telefono:"telefono",pais:"pais",ciudad:"ciudad",direccion:"direccion",transaction_id:"transaction_id",authorization_code:"authorization_code",fecha_pago:"fecha_pago",localizacion_usuario:"localizacion_usuario",update_at_billing:"update_at_billing"});function B(a,e,o){a.length>1&&(n.value.fechai=l(a[0]).format("YYYY-MM-DD")+" 17:30:00",n.value.fechaf=l(a[1]).format("YYYY-MM-DD")+" 17:30:00",l(a[0]).format("YYYY-MM-DD")==l(a[1]).format("YYYY-MM-DD")&&(n.value.fechai=l(a[0]).format("YYYY-MM-DD")+" 17:30:00",n.value.fechaf=l(a[1]).subtract(-1,"days").format("YYYY-MM-DD")+" 17:30:00")),a.length==1&&(n.value.fechai=l(a[0]).format("YYYY-MM-DD")+" 17:30:00",n.value.fechaf=l(a[0]).subtract(-1,"days").format("YYYY-MM-DD")+" 17:30:00")}function I(a){let e,o;switch(a){case"Hoy":e=l().subtract(1,"days").startOf("day").format("YYYY-MM-DD"),o=l().endOf("day").format("YYYY-MM-DD");break;case"Ayer":e=l().subtract(2,"days").startOf("day").format("YYYY-MM-DD"),o=l().subtract(1,"days").endOf("day").format("YYYY-MM-DD");break;case"Anteayer":e=l().subtract(3,"days").startOf("day").format("YYYY-MM-DD"),o=l().subtract(2,"days").endOf("day").format("YYYY-MM-DD");break;default:console.log("Selecci\xF3n no v\xE1lida");return}return{fechai:e,fechaf:o}}X(async()=>g.value,async()=>{if(g.value){const a=I(g.value);n.value.fechai=a.fechai+" 17:30:00",n.value.fechaf=a.fechaf+" 17:30:00"}});const x=c([]),L=c(E+"/sistemas/pagos-realizados/eliminatorias-sud-2026"),U=c("transacciones_"),y=c({tamanioActual:0,tamanioTotal:0});function $(a){for(var e=typeof a!="object"?JSON.parse(a):a,o="",t=0;t<e.length;t++){var u="";for(var v in e[t]){u!=""&&(u+=",");var r=e[t][v];typeof r=="string"&&r.includes(",")&&(r=`"${r}"`),u+=r}o+=u+`\r
`}return o}function q(a,e,o){e.unshift(a),console.log("items",e);var t=JSON.stringify(e),u=$(t),v=o+".csv"||"export.csv",r=new Blob([u],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,v);else{var d=document.createElement("a");if(d.download!==void 0){var Y=URL.createObjectURL(r);d.setAttribute("href",Y),d.setAttribute("download",v),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}}function F(a){const e={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00C1:"A",\u00C9:"E",\u00CD:"I",\u00D3:"O",\u00DA:"U",\u00F1:"n",\u00D1:"N"};return a.split("").map(t=>e[t]||t).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-")+"-"}async function z(a=1,e=100,o=1){try{if(!n.value.fechai)return!1;var t=new Headers;t.append("Content-Type","application/json"),t.append("Authorization","Bearer 3CUAVISaNhWVCRNPofjXtWMk1D99LOoFzMf6LfoNlkiN8dGDkd");var u={method:"GET",headers:t,redirect:"follow"},v=await fetch(`${L.value}?page=${a}&limit=${e}&fechai=${n.value.fechai}&fechaf=${n.value.fechaf}&idPaquete=${D.value}`,u);const r=await v.json();return r.resp?r:(p.value={message:"No se pudo recuperar las transacciones, recargue de nuevo.",type:"error",model:!0},h.value=!1,null)}catch(r){return p.value={message:"No se pudo recuperar las transacciones, recargue de nuevo",type:"error",model:!0},console.error(r.message),h.value=!1,null}}function R(a){const e=new Set;return a.filter(o=>e.has(o.transaction_id)?!1:(e.add(o.transaction_id),!0))}async function P(){y.value={tamanioActual:0,tamanioTotal:0},x.value=[];for(var a=1,e=1;;){const u=(await z(e,500,a)).data,v="-";for(var o in u){const r=u[o];let d={};for(let Y in C.value)r.hasOwnProperty(Y)?d[Y]=r[Y]:d[Y]="";x.value.push(d)}if(y.value.tamanioActual=x.value.length,y.value.tamanioTotal=v,e++,u.length<1)break}return!0}async function H(){try{h.value=!0,await P(),h.value=!1;let e=[];e=x.value;var a=`${U.value}`+F(n.value.fechai)+"_hasta_"+F(n.value.fechaf);q(C.value,R(e),a)}catch(e){return console.log(e),p.value={message:"No se pudo recuperar los datos de registros para exportar, recargue de nuevo.",type:"error",model:!0},!1}}const D=c("651c9d012ff9fa09a75e6c16"),N=c([]),A=c(!0),G=async()=>{try{const a=await fa.get("https://ecuavisa-suscripciones.vercel.app/paquete/backoffice/display-all");a.data.resp&&Array.isArray(a.data.data)?N.value=a.data.data:console.error("Formato de respuesta inesperado:",a.data)}catch(a){console.error("Error al obtener los paquetes:",a)}finally{A.value=!1}};return K(async()=>{await G()}),(a,e)=>{const o=ma;return O(),T("section",null,[i(Z,{modelValue:s(p).model,"onUpdate:modelValue":e[0]||(e[0]=t=>s(p).model=t),location:"top end",variant:"flat",timeout:s(p).timeout||2e3,color:s(p).type},{default:m(()=>[b(_(s(p).message),1)]),_:1},8,["modelValue","timeout","color"]),i(da,null,{default:m(()=>[i(aa,{class:"mt-0",cols:"12",md:"6",lg:"6"},{default:m(()=>[i(ea,null,{default:m(()=>[i(ta,null,{default:m(()=>[f("div",pa,[i(oa,null,{default:m(()=>[b(" Bajar datos de pagos exitosos para "),ha,b("eliminatorias sud 2026. ")]),_:1}),i(sa,null,{default:m(()=>[b(" Debes seleccionar la fecha inicial y la fecha final del combo. ")]),_:1})])]),_:1}),i(la,null,{default:m(()=>[f("div",va,[i(ra,{modelValue:s(D),"onUpdate:modelValue":e[1]||(e[1]=t=>V(D)?D.value=t:null),items:s(N),"item-title":"nombre","item-value":"_id",label:"Seleccionar paquete",loading:s(A),class:"mb-5"},null,8,["modelValue","items","loading"]),i(na,{class:"d-none",modelValue:s(g),"onUpdate:modelValue":e[2]||(e[2]=t=>V(g)?g.value=t:null),items:s(j),label:"Seleccione la fecha","menu-props":{maxHeight:"300"},disabled:s(h)},null,8,["modelValue","items","disabled"]),i(o,{label:"Fecha de inicio y fin del curso","prepend-inner-icon":"tabler-calendar",density:"compact",class:"mb-3",modelValue:s(M),"onUpdate:modelValue":e[3]||(e[3]=t=>V(M)?M.value=t:null),"show-current":"true",onOnChange:B,config:{position:"auto right",mode:"range",altFormat:"d F j, Y",dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0,maxDate:new Date}},null,8,["modelValue","config"]),ba,ga,f("small",Ya,[ya,b(" "+_(s(n).fechai),1),_a,xa,b(" "+_(s(n).fechaf),1)])]),f("div",Da,[i(ca,{loading:s(h),disabled:s(h),color:"primary",onClick:H},{default:m(()=>[b(" Descargar datos de facturaci\xF3n "),i(ia,{end:"",icon:"tabler-cloud-download"})]),_:1},8,["loading","disabled"]),s(h)?(O(),T("small",Ma," Exportando "+_(s(y).tamanioActual)+" / "+_(s(y).tamanioTotal)+" registros ",1)):ua("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{Ca as default};
