import{ck as qe,bZ as A,r as c,bH as ge,o as n,x as b,a as l,w as a,e as f,g as S,a2 as R,h as F,b as s,p as P,q as _,aW as E,F as $,C as T,u as i,t as M,N as le,b0 as O,aQ as j,aR as H,l as te,m as oe,V as Q,n as C,bC as ae,i as se,c as U,a3 as D,c7 as ue,bc as we}from"./index.88d3c7f5.js";import{u as Ce}from"./usePeriodosListStore.6f74ec61.js";import{u as Ue}from"./useModulosListStore.d41a78be.js";import{i as De}from"./validators.b5f8ddc5.js";import{V as ke}from"./VSpacer.2a3e77c9.js";const Ae=qe("PaquetesListStore",{actions:{fetchPaquetes(){return A.get("https://ecuavisa-modulos.vercel.app/paquete")},fetchPaquete(x){return new Promise((m,p)=>{A.get(`https://ecuavisa-modulos.vercel.app/paquete/${x}`).then(r=>m(r)).catch(r=>p(r))})},addPaquete(x){return new Promise((m,p)=>{A.post("https://ecuavisa-modulos.vercel.app/paquete",x).then(r=>m(r)).catch(r=>p(r))})},deletePaquete(x){return new Promise((m,p)=>{A.delete(`https://ecuavisa-modulos.vercel.app/paquete/${x}`).then(r=>m(r)).catch(r=>p(r))})},updatePaquete(x,m){return new Promise((p,r)=>{A.put(`https://ecuavisa-modulos.vercel.app/paquete/${x}`,m).then(h=>p(h)).catch(h=>r(h))})}}});const Me={class:"d-flex align-center flex-wrap gap-2"},Ne=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Nombre"),s("th",{scope:"col"},"Periodo"),s("th",{scope:"col"},"M\xF3dulos"),s("th",{scope:"col"},"Acciones")])],-1),Se={class:"d-flex align-center"},Fe={class:"d-flex flex-column"},$e={class:"text-base"},Te={class:"d-flex align-center"},Le={class:"d-flex flex-column"},ze={class:"text-capitalize text-base"},Be={class:"d-flex align-center"},Ie={class:"d-flex"},Re={class:"text-capitalize text-base"},Ee={class:"text-center",style:{width:"5rem"}},Oe=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Nombre"),s("th",{scope:"col"},"Valor")])],-1),je={style:{height:"3.75rem"}},He={class:"d-flex align-center"},Qe={class:"d-flex flex-column"},We={class:"text-base"},Ze=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Nombre"),s("th",{scope:"col"},"Valor")])],-1),Ge={style:{height:"3.75rem"}},Je={class:"d-flex align-center"},Ke={class:"d-flex flex-column"},Xe={class:"text-base"},al={__name:"paquetes",setup(x){const m=c(!1),p=c(!1);c(!1);const r=Ue(),h=Ae(),de=Ce(),q=c([]),W=c([]);c(10);const V=c({}),g=c({nombre:"",idPeriodo:"",modulos:[]}),v=c(""),Z=c(""),y=c([]),L=c([]),z=c([]),B=c([]),N=()=>{h.fetchPaquetes().then(e=>{W.value=e.data}).catch(e=>{console.error(e)})},G=()=>de.fetchPeriodos().then(e=>{y.value=e.data;let o=y.value.map(u=>u.periodo);L.value=o}).catch(e=>{console.error(e)});G();const J=()=>{r.fetchModulosPaquetes().then(e=>{q.value=e.data}).catch(e=>{console.error(e)})};J();const I=e=>{let o=Array.from(e),u=[],t=q.value.map(d=>d.nombre);for(let d=0;d<o.length;d++){let w=q.value.map(k=>k._id).indexOf(o[d].idModulo);w!=-1&&u.push(t[w]+" - "+o[d].valor)}return u},K=e=>{let o=y.value.map(t=>t.periodo),u=y.value.map(t=>t._id).indexOf(e);return o[u]},re=()=>{let e=y.value.map(u=>u._id),o=y.value.map(u=>u.periodo).indexOf(v.value);V.value.idPeriodo=e[o]},ne=()=>{let e=y.value.map(u=>u._id),o=y.value.map(u=>u.periodo).indexOf(v.value);g.value.idPeriodo=e[o]};ge(N);const ie=()=>{N(),J(),G()},ce=()=>{let e=Array.from(V.value.modulos),o=[],u=q.value.map(d=>d.nombre),t=q.value.map(d=>d.tipoDato);for(let d=0;d<e.length;d++){let w=q.value.map(k=>k._id).indexOf(e[d].idModulo);if(w!=-1){let k={idModulo:e[d].idModulo,nombre:u[w],valor:e[d].valor,tipoDato:t[w]};o.push(k)}}console.log("modulosPrimer",o),z.value=o},me=e=>{v.value="",h.fetchPaquete(e).then(o=>{let u=o.data;V.value=u,v.value=K(u.idPeriodo),ce()}).catch(o=>{console.error(o)}),m.value=!0},pe=()=>{let e=[],o=Array.from(z.value);for(let u=0;u<o.length;u++){let t={idModulo:o[u].idModulo,valor:o[u].valor};e.push(t)}console.log("arrayUpdate",e),V.value.modulos=e},ve=e=>{re(),pe(),console.log("updatePaquete",V.value),h.updatePaquete(e,V.value).catch(o=>{console.error(o)}),window.setTimeout(ie,900),m.value=!1},fe=()=>{m.value=!1},X=e=>{m.value=e},_e=()=>{let e=Array.from(q.value),o=[];for(let u=0;u<e.length;u++){let t={idModulo:e[u]._id,nombre:e[u].nombre,valor:"",tipoDato:e[u].tipoDato};o.push(t)}console.log("modulosPrimerNuevo",o),B.value=o},he=()=>{_e(),v.value="",p.value=!0},Ve=()=>{let e=[],o=Array.from(B.value);for(let u=0;u<o.length;u++){let t={idModulo:o[u].idModulo,valor:o[u].valor};e.push(t)}console.log("arrayNew",e),g.value.modulos=e},be=()=>{Ve(),ne(),console.log("nuevoPaquete",g.value),h.addPaquete(g.value).catch(e=>{console.log(e)}),g.value="",p.value=!1,window.setTimeout(N,900)},Pe=()=>{p.value=!1},Y=e=>{p.value=e},xe=e=>{Z.value=e,isPaqueteDeleteVisible.value=!0},ye=()=>{h.deletePaquete(paquetesId.value).catch(e=>{console.error(e)}),window.setTimeout(N,900),Z.value="",isPaqueteDeleteVisible.value=!1},ee=e=>{isPaqueteDeleteVisible.value=e};return(e,o)=>{const u=we;return n(),b("section",null,[l(Q,null,{default:a(()=>[l(f,{cols:"12"},{default:a(()=>[l(S,{title:"Paquetes"},{default:a(()=>[l(R),l(F,{class:"d-flex flex-wrap py-4 gap-4"},{default:a(()=>[l(ke),s("div",Me,[l(P,{"prepend-icon":"tabler-plus",onClick:he},{default:a(()=>[_(" Agregar un Paquete ")]),_:1})])]),_:1}),l(R),l(E,{class:"text-no-wrap"},{default:a(()=>[Ne,s("tbody",null,[(n(!0),b($,null,T(i(W),t=>(n(),b("tr",{key:t._id,style:{height:"3.75rem"}},[s("td",null,[s("div",Se,[s("div",Fe,[s("h6",$e,M(t.nombre),1)])])]),s("td",null,[s("div",Te,[s("div",Le,[s("span",ze,M(K(t.idPeriodo)),1)])])]),s("td",null,[s("div",Be,[s("div",Ie,[(n(!0),b($,null,T(I(t.modulos),d=>(n(),b("span",Re,M(d==I(t.modulos)[0]||I(t.modulos).length==1?d:"; "+d),1))),256))])])]),s("td",Ee,[l(P,{icon:"",size:"x-small",color:"default",variant:"text",onClick:d=>me(t._id)},{default:a(()=>[l(le,{size:"22",icon:"tabler-edit"})]),_:2},1032,["onClick"]),l(P,{icon:"",size:"x-small",color:"error",variant:"text",onClick:d=>xe(t._id)},{default:a(()=>[l(le,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))])]),_:1}),l(R),l(O,{width:e.$vuetify.display.smAndDown?"auto":700,"model-value":i(m),"onUpdate:modelValue":X},{default:a(()=>[l(u,{onClick:o[0]||(o[0]=t=>X(!1))}),l(S,{class:"pa-sm-14 pa-5"},{default:a(()=>[l(j,{class:"text-center"},{default:a(()=>[l(H,{class:"text-h5 mb-3"},{default:a(()=>[_(" Editar el paquete ")]),_:1})]),_:1}),l(F,null,{default:a(()=>[l(te,{class:"mt-6",onSubmit:o[3]||(o[3]=oe(t=>ve(i(V)._id),["prevent"]))},{default:a(()=>[l(Q,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:i(V).nombre,"onUpdate:modelValue":o[1]||(o[1]=t=>i(V).nombre=t),label:"Nombre"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(ae,{label:"Periodo",modelValue:i(v),"onUpdate:modelValue":o[2]||(o[2]=t=>se(v)?v.value=t:null),items:i(L)},null,8,["modelValue","items"])]),_:1}),l(f,{cols:"12"},{default:a(()=>[l(E,{class:"text-no-wrap"},{default:a(()=>[Oe,s("tbody",null,[(n(!0),b($,null,T(i(z),t=>(n(),b("tr",je,[s("td",null,[s("div",He,[s("div",Qe,[s("h6",We,M(t.nombre),1)])])]),s("td",null,[t.tipoDato=="texto"?(n(),U(C,{key:0,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,label:"valor"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),t.tipoDato=="boolean"?(n(),U(ue,{key:1,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,density:"compact",label:"valor"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),t.tipoDato=="numerico"?(n(),U(C,{key:2,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,label:"valor",type:"number",rules:[i(De)]},null,8,["modelValue","onUpdate:modelValue","rules"])):D("",!0)])]))),256))])]),_:1})]),_:1}),l(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[l(P,{type:"submit"},{default:a(()=>[_(" Enviar ")]),_:1}),l(P,{color:"secondary",variant:"tonal",onClick:fe},{default:a(()=>[_(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),l(O,{width:e.$vuetify.display.smAndDown?"auto":700,"model-value":i(p),"onUpdate:modelValue":Y},{default:a(()=>[l(u,{onClick:o[4]||(o[4]=t=>Y(!1))}),l(S,{class:"pa-sm-14 pa-5"},{default:a(()=>[l(j,{class:"text-center"},{default:a(()=>[l(H,{class:"text-h5 mb-3"},{default:a(()=>[_(" Agregar un nuevo paquete ")]),_:1})]),_:1}),l(F,null,{default:a(()=>[l(te,{class:"mt-6",onSubmit:oe(be,["prevent"])},{default:a(()=>[l(Q,null,{default:a(()=>[l(f,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:i(g).nombre,"onUpdate:modelValue":o[5]||(o[5]=t=>i(g).nombre=t),label:"Nombre"},null,8,["modelValue"])]),_:1}),l(f,{cols:"12",md:"6"},{default:a(()=>[l(ae,{label:"Periodo",modelValue:i(v),"onUpdate:modelValue":o[6]||(o[6]=t=>se(v)?v.value=t:null),items:i(L)},null,8,["modelValue","items"])]),_:1}),l(f,{cols:"12"},{default:a(()=>[l(E,{class:"text-no-wrap"},{default:a(()=>[Ze,s("tbody",null,[(n(!0),b($,null,T(i(B),t=>(n(),b("tr",Ge,[s("td",null,[s("div",Je,[s("div",Ke,[s("h6",Xe,M(t.nombre),1)])])]),s("td",null,[t.tipoDato=="texto"?(n(),U(C,{key:0,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,label:"valor"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),t.tipoDato=="boolean"?(n(),U(ue,{key:1,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,density:"compact",label:"valor"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0),t.tipoDato=="numerico"?(n(),U(C,{key:2,modelValue:t.valor,"onUpdate:modelValue":d=>t.valor=d,label:"valor",type:"number"},null,8,["modelValue","onUpdate:modelValue"])):D("",!0)])]))),256))])]),_:1})]),_:1}),l(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[l(P,{type:"submit"},{default:a(()=>[_(" Aceptar ")]),_:1}),l(P,{color:"secondary",variant:"tonal",onClick:Pe},{default:a(()=>[_(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"]),l(O,{width:e.$vuetify.display.smAndDown?"auto":700,"model-value":e.isPaqueteDeleteVisible,"onUpdate:modelValue":ee},{default:a(()=>[l(u,{onClick:o[7]||(o[7]=t=>ee(!1))}),l(S,{class:"pa-sm-14 pa-5"},{default:a(()=>[l(j,{class:"text-center"},{default:a(()=>[l(H,{class:"text-h5 mb-3"},{default:a(()=>[_(" \xBFDesea eliminar el paquete? ")]),_:1})]),_:1}),l(F,null,{default:a(()=>[l(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[l(P,{onClick:ye},{default:a(()=>[_(" Aceptar ")]),_:1}),l(P,{color:"secondary",variant:"tonal",onClick:e.onFormDeletePaqueteReset},{default:a(()=>[_(" Cancelar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"])]),_:1})]),_:1})]),_:1})])}}};export{al as default};
