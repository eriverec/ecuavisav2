import{M as Ge,R as Se,S as Te,U as Ue,r as c,v as je,Q as ee,as as ze,z as Ie,o as d,x as u,a as l,w as t,q as m,t as i,u as s,f as Be,a$ as ae,a_ as le,g as O,h as P,aW as F,F as S,C as T,b as a,p as f,N as M,c as U,a3 as j,i as x,b0 as me,n as pe,b1 as Le,l as Ne,aM as Pe,L as te,V as ve,e as W,aT as _e,$ as Re,aU as $e,aV as Ae,a1 as De,aQ as Ee,aq as qe,aR as Oe,b2 as Fe,b3 as Me,b4 as We,b5 as He,b6 as Qe,b7 as Ke,b8 as fe,b9 as Je,ba as he,bb as se,bc as Xe,bd as Ye,be as Ze}from"./index.88d3c7f5.js";import{V as oe}from"./VAlert.3e8ed100.js";import{V as ea}from"./VPagination.9412c3b8.js";const b=R=>(Ye("data-v-12b186db"),R=R(),Ze(),R),aa=b(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null," Nombres ")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Correo")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Semana")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Tipo")])]),a("th",{scope:"col"},"Acciones")])],-1)),la={key:0},ta={class:"text-sm"},sa={class:"text-sm"},oa={class:"text-base"},na={class:"text-base"},ca={class:"text-center",style:{width:"5rem"}},ra={key:1},da=b(()=>a("tr",null,[a("td",{colspan:"5",class:"text-center"},"No hay datos")],-1)),ia=[da],ua=b(()=>a("label",null,"Buscar el usuario",-1)),ma={class:"d-flex gap-4 align-center mt-2",style:{width:"100%"}},pa={key:0,class:"mt-4"},va=b(()=>a("h3",null,"Usuario seleccionado:",-1)),_a={key:1,style:{height:"50px"},class:"d-flex align-center justify-center"},fa={key:2},ha=b(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"USUARIO"),a("th",{scope:"col"},"CORREO"),a("th",{scope:"col"},"ACCI\xD3N")])],-1)),ya=["onClick"],ba={class:"text-medium-emphasis"},ga={class:"content-form mt-5"},xa={class:"p-0 d-flex flex-column align-items-start"},Va={class:"d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},ka={class:"hoItems d-flex gap-4 mb-5",style:{"max-width":"500px"}},wa=b(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null," Nombres ")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Correo")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Telefono")])]),a("th",{scope:"col"},"Acciones")])],-1)),Ca={key:0},Ga={class:"text-sm"},Sa={class:"text-sm"},Ta={class:"text-base"},Ua={class:"text-center",style:{width:"5rem"}},ja={key:1},za=b(()=>a("tr",null,[a("td",{colspan:"4",class:"text-center"},"No hay datos")],-1)),Ia=[za],Ba=b(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null," Nombres ")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Correo")])]),a("th",{scope:"col",class:"col-cr",title:"click para ordenar"},[a("div",{class:"row-cr"},[a("div",null,"Telefono")])]),a("th",{scope:"col"},"Acciones")])],-1)),La={key:0},Na={class:"text-sm"},Pa={class:"text-sm"},Ra={class:"text-base"},$a={class:"text-center",style:{width:"5rem"}},Aa={key:1},Da=b(()=>a("tr",null,[a("td",{colspan:"4",class:"text-center"},"No hay datos")],-1)),Ea=[Da],qa={__name:"index",setup(R){Se.exports.extendMoment(Te).locale("es",[Ue]);const V=c({message:"Datos guardados",type:"success",model:!1}),h=c(!1);function ye(){h.value=!h.value}const z=c(""),C=c([]),be=c(!1);c(!1);const H=c(!1),$=c([]),I=c(1),Q=c(5),A=c(0),ge=je(()=>Math.ceil(A.value/Q.value)),_=c([]),ne=n=>{n&&n.preventDefault(),$.value[0]=!0,I.value=1,C.value=[],xe()},K=()=>{z.value="",C.value=[],_.value=[]},xe=async()=>{H.value=!0;try{const o=await(await fetch(`https://ads-service.vercel.app/busqueda/user/?s=${z.value}&page=${I.value}&limit=${Q.value}`)).json();o.resp?(C.value=o.data,A.value=o.total):(C.value=[],A.value=0,be.value=!0)}catch(n){console.error("Error al realizar la b\xFAsqueda:",n)}finally{H.value=!1,$.value[0]=!1}},ce=n=>{const o=_.value.findIndex(v=>v._id===n._id);o===-1?_.value.push(n):_.value.splice(o,1)},re=c([]),g=c(null),B=c("diario"),Ve=[{title:"Ganador Diario",value:"diario"},{title:"Ganador Semanal",value:"semanal"}],L=c(!1),J=c([]),de=c([]);async function ie(){try{L.value=!0;const v=await(await fetch("https://servicio-desafios.vercel.app/semana/all/get")).json();var n=Array.from(v.data).filter(e=>e.repechaje==!1);n=n.map(e=>({title:e.titulo,descripcion:e.descripcion,value:e.descripcion.split(" ")[1]})).sort((e,r)=>e.value-r.value),n.push({title:"Ganador final",descripcion:"Ganador final",value:5}),re.value=n,L.value=!1}catch(o){console.error(o.message),L.value=!1}}ee(h,n=>{n||K()}),ee(g,n=>{n==5&&(B.value="diario")});const ue=c([]);c(!1);const D=c(!1),X=async()=>{try{const n=await se.get("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador_v2/ajax/listar_backoffice.php");J.value=n.data.data,de.value=n.data.data;const o=n.data.data.reduce((p,e)=>(p[e.semana]||(p[e.semana]={}),p[e.semana][e.tipo]||(p[e.semana][e.tipo]=[]),p[e.semana][e.tipo].push(e),p),{}),v=[];Object.entries(o).forEach(([p,e])=>{const r=e.hasOwnProperty("semanal")?e.semanal:[],Z=e.hasOwnProperty("diario")?e.diario:[],Ce=p;v.push({ganadores_semanales:r,ganadores_diarios:Z,semana:Ce})}),ue.value=v,E.value=0,N.value[1]=0}catch(n){console.error("Error fetching data:",n)}};c({action:"",semana:"",tipo:"",name:"",last_name:"",email:"",telephone:""});const ke=async()=>{D.value=!0;const n=g.value,o=B.value,v="add";if(n&&_.value.length>0){const p=_.value.map(e=>({name:e.first_name,last_name:e.last_name,email:e.email,action:v,tipo:o,semana:n,telephone:e.phone_number||""}));console.log(p[0]);try{const e=await se.post("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador_v2/ajax/ajaxGanador.php",p[0],{headers:{"Content-Type":"application/json"}});K(),h.value=!1,D.value=!1,V.value={message:"Ganador guardado con \xE9xito",type:"success",model:!0},await X()}catch(e){console.error("Error sending data:",e),V.value={message:"Ocurri\xF3 un error, intente nuevamente.",type:"error",model:!0},D.value=!1}}},E=c(0),G=c(!1),N=c({}),k=c(null),Y=async n=>{if(confirm("\xBFEst\xE1s seguro de que quieres eliminar este ganador?")){G.value=!0,k.value=null;try{const o=await se.post("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador_v2/ajax/ajaxGanador.php",{action:"elim",id:n},{headers:{"Content-Type":"application/json"}});await X(),G.value=!1,y.value=!1,console.log("Ganador eliminado:",o.data)}catch(o){console.error("Error al eliminar ganador:",o),o.value="Hubo un error al eliminar el ganador. Por favor, intenta de nuevo.",G.value=!1}}},w=c(""),q=c([]),y=c(!1);function we(){y.value=!0,w.value||(q.value=[]);const n=w.value.trim().toLowerCase();q.value=J.value.filter(o=>o.name.toLowerCase().includes(n)||o.last_name.toLowerCase().includes(n)||o.email.toLowerCase().includes(n)||o.id.includes(n))}return ee(y,n=>{n||(J.value=de.value,w.value="")}),ze(async()=>{await ie(),await X()}),(n,o)=>{const v=Xe,p=Ie("v-list-item-content");return d(),u("section",null,[l(Be,{modelValue:s(V).model,"onUpdate:modelValue":o[0]||(o[0]=e=>s(V).model=e),location:"top end",variant:"flat",timeout:s(V).timeout||2e3,color:s(V).type},{default:t(()=>[m(i(s(V).message),1)]),_:1},8,["modelValue","timeout","color"]),l(le,{"model-value":s(G),class:"align-center justify-center"},{default:t(()=>[l(ae,{indeterminate:"",size:"64"})]),_:1},8,["model-value"]),l(me,{modelValue:s(y),"onUpdate:modelValue":o[3]||(o[3]=e=>x(y)?y.value=e:null),width:"700"},{default:t(()=>[l(v,{onClick:o[1]||(o[1]=e=>y.value=!s(y))}),l(O,{title:"Resultado de la b\xFAsqueda: "+s(w).trim()},{default:t(()=>[l(P,null,{default:t(()=>[l(F,{class:"text-no-wrap tabla_ganadores table-sm"},{default:t(()=>[aa,s(q).length>0?(d(),u("tbody",la,[(d(!0),u(S,null,T(s(q),e=>(d(),u("tr",{class:"listadoGen",key:e.id,style:{height:"3.75rem"}},[a("td",null,[a("span",ta,i(e.name)+" "+i(e.last_name),1)]),a("td",null,[a("span",sa,i(e.email.toLowerCase()),1)]),a("td",null,[a("span",oa,i(e.semana=="5"?"Ganador final":"Semana "+e.semana),1)]),a("td",null,[a("span",na,i(e.tipo),1)]),a("td",ca,[l(f,{icon:"",size:"x-small",color:"default",variant:"text",onClick:r=>Y(e.id)},{default:t(()=>[l(M,{size:"22",color:"error",icon:"tabler-trash"})]),_:2},1032,["onClick"]),s(k)?(d(),U(oe,{key:0,type:"error",class:"mt-4"},{default:t(()=>[m(i(s(k)),1)]),_:1})):j("",!0)])]))),128))])):(d(),u("tfoot",ra,ia))]),_:1})]),_:1}),l(P,{class:"d-flex justify-end"},{default:t(()=>[l(f,{onClick:o[2]||(o[2]=e=>y.value=!1)},{default:t(()=>[m(" Cerrar ")]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),l(me,{modelValue:s(h),"onUpdate:modelValue":o[10]||(o[10]=e=>x(h)?h.value=e:null),width:"600"},{default:t(()=>[l(v,{onClick:o[4]||(o[4]=e=>h.value=!s(h))}),l(O,{title:"Agregar ganador"},{default:t(()=>[l(P,null,{default:t(()=>[a("div",null,[ua,a("div",ma,[l(pe,{modelValue:s(z),"onUpdate:modelValue":o[5]||(o[5]=e=>x(z)?z.value=e:null),onKeyup:o[6]||(o[6]=Le(e=>ne(e),["enter"])),style:{"max-width":"400px"},label:"Buscar por correo..."},null,8,["modelValue"]),l(f,{loading:s($)[0],disabled:s($)[0],color:"primary",size:"small",icon:"tabler-search",onClick:ne},null,8,["loading","disabled"]),l(f,{color:"secondary",variant:"text",size:"small",onClick:K},{default:t(()=>[l(M,{start:"",icon:"tabler-restore"}),m(" Resetear ")]),_:1})])]),l(Ne,{ref:"form"},{default:t(()=>[s(_).length>0?(d(),u("div",pa,[va,(d(!0),u(S,null,T(s(_),e=>(d(),U(Pe,{key:e._id,class:"ma-1",color:"success",closable:"","onClick:close":r=>ce(e)},{default:t(()=>[m(i(e.last_name+" "+e.first_name),1)]),_:2},1032,["onClick:close"]))),128))])):j("",!0),s(H)?(d(),u("div",_a," Buscando usuarios...")):s(C).length>0&&s(_).length==0?(d(),u("div",fa,[l(F,{style:{width:"100%"},class:"text-no-wrap tableNavegacion mb-5 mt-5",hover:"true"},{default:t(()=>[ha,a("tbody",null,[(d(!0),u(S,null,T(s(C),e=>(d(),u("tr",{key:e._id,class:te({"opacity-50":n.userClicked&&n.userClickedId===e.wylexId}),onClick:r=>ce(e)},[a("td",null,i((e.last_name+" "+e.first_name).length>25?(e.last_name+" "+e.first_name).substring(0,25)+"...":e.last_name+" "+e.first_name),1),a("td",ba,i(e.email),1),a("td",null,[l(f,{color:"success",size:"small"},{default:t(()=>[m(" Seleccionar ")]),_:1})])],10,ya))),128))])]),_:1}),s(A)>s(Q)?(d(),U(ea,{key:0,modelValue:s(I),"onUpdate:modelValue":[o[7]||(o[7]=e=>x(I)?I.value=e:null),n.updatePage],size:"small","total-visible":5,length:s(ge)},null,8,["modelValue","length","onUpdate:modelValue"])):j("",!0)])):j("",!0),a("div",ga,[l(ve,null,{default:t(()=>[l(W,{cols:"12",md:s(g)==5?"12":"7",lg:s(g)==5?"12":"7"},{default:t(()=>[l(_e,{style:{width:"100%"},"no-data-text":"No existen semanas que mostrar","append-icon":"mdi-refresh","onClick:append":ie,disabled:s(L),"item-text":"title","item-value":"value",modelValue:s(g),"onUpdate:modelValue":o[8]||(o[8]=e=>x(g)?g.value=e:null),items:s(re),label:"Seleccionar la semana",class:"mt-2","menu-props":{maxHeight:"400"}},{selection:t(({item:e})=>[a("div",null,i(e.title),1)]),item:t(({item:e,props:r})=>[l(Re,$e(Ae(r)),{default:t(()=>[l(p,null,{default:t(()=>[l(De,null,{default:t(()=>[a("small",null,i(e.raw.descripcion),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["disabled","modelValue","items"])]),_:1},8,["md","lg"]),l(W,{cols:"12",md:"5",lg:"5",class:te(s(g)==5?"d-none":"")},{default:t(()=>[l(_e,{style:{width:"100%"},"no-data-text":"Error intente de nuevo",disabled:s(L),"item-text":"title","item-value":"value",modelValue:s(B),"onUpdate:modelValue":o[9]||(o[9]=e=>x(B)?B.value=e:null),items:Ve,label:"Tipo de ganador",class:"mt-2","menu-props":{maxHeight:"400"}},null,8,["disabled","modelValue"])]),_:1},8,["class"]),l(W,{cols:"12",class:"d-flex gap-4"},{default:t(()=>[l(f,{onClick:ke,disabled:!(s(_).length>0)||s(D)},{default:t(()=>[m(" Guardar ganador ")]),_:1},8,["disabled"])]),_:1})]),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ve,null,{default:t(()=>[l(W,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:t(()=>[l(O,null,{default:t(()=>[l(Ee,null,{append:t(()=>[a("div",Va,[l(f,qe({onClick:ye},n.props,{color:"success"}),{default:t(()=>[m(" Agregar ganador ")]),_:1},16)])]),default:t(()=>[a("div",xa,[l(Oe,null,{default:t(()=>[m(" Ganadores ecuavisados ")]),_:1}),l(Fe,null,{default:t(()=>[m(" Ingresa los ganadores por semana en ecuavisados ")]),_:1})])]),_:1}),l(P,null,{default:t(()=>[a("div",ka,[l(pe,{modelValue:s(w),"onUpdate:modelValue":o[11]||(o[11]=e=>x(w)?w.value=e:null),placeholder:"Buscar...",density:"compact",label:"Buscar por nombre o correo"},null,8,["modelValue"]),l(f,{color:"primary",onClick:we},{default:t(()=>[m(" Buscar ganador ")]),_:1})]),l(Me,{variant:"accordion",modelValue:s(E),"onUpdate:modelValue":o[12]||(o[12]=e=>x(E)?E.value=e:null)},{default:t(()=>[(d(!0),u(S,null,T(s(ue),e=>(d(),U(We,{key:e.semana},{default:t(()=>[l(He,null,{default:t(()=>[m(i(e.semana==5?"Ganador final":"Semana "+e.semana),1)]),_:2},1024),l(Qe,null,{default:t(()=>[l(Ke,{modelValue:s(N)[e.semana],"onUpdate:modelValue":r=>s(N)[e.semana]=r,class:"v-tabs-pill"},{default:t(()=>[l(fe,null,{default:t(()=>[m(i(e.semana==5?"Ganador final":"Ganadores diarios"),1)]),_:2},1024),l(fe,{class:te(e.semana==5?"d-none":"")},{default:t(()=>[m("Ganadores de la semana")]),_:2},1032,["class"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(O,{class:"mt-5"},{default:t(()=>[l(P,null,{default:t(()=>[l(Je,{modelValue:s(N)[e.semana],"onUpdate:modelValue":r=>s(N)[e.semana]=r},{default:t(()=>[l(he,null,{default:t(()=>[l(F,{class:"text-no-wrap tabla_ganadores"},{default:t(()=>[wa,e.ganadores_diarios.length>0?(d(),u("tbody",Ca,[(d(!0),u(S,null,T(e.ganadores_diarios,r=>(d(),u("tr",{class:"listadoGen",key:r.id,style:{height:"3.75rem"}},[a("td",null,[a("span",Ga,i(r.name)+" "+i(r.last_name),1)]),a("td",null,[a("span",Sa,i(r.email.toLowerCase()),1)]),a("td",null,[a("span",Ta,i(r.telephone),1)]),a("td",Ua,[l(f,{icon:"",size:"x-small",color:"default",variant:"text",onClick:Z=>Y(r.id)},{default:t(()=>[l(M,{size:"22",color:"error",icon:"tabler-trash"})]),_:2},1032,["onClick"]),s(k)?(d(),U(oe,{key:0,type:"error",class:"mt-4"},{default:t(()=>[m(i(s(k)),1)]),_:1})):j("",!0),l(le,{"model-value":s(G),class:"align-center justify-center"},{default:t(()=>[l(ae,{indeterminate:"",size:"64"})]),_:1},8,["model-value"])])]))),128))])):(d(),u("tfoot",ja,Ia))]),_:2},1024)]),_:2},1024),l(he,null,{default:t(()=>[l(F,{class:"text-no-wrap tabla_ganadores"},{default:t(()=>[Ba,e.ganadores_semanales.length>0?(d(),u("tbody",La,[(d(!0),u(S,null,T(e.ganadores_semanales,r=>(d(),u("tr",{class:"listadoGen",key:r.id,style:{height:"3.75rem"}},[a("td",null,[a("span",Na,i(r.name)+" "+i(r.last_name),1)]),a("td",null,[a("span",Pa,i(r.email.toLowerCase()),1)]),a("td",null,[a("span",Ra,i(r.telephone),1)]),a("td",$a,[l(f,{icon:"",size:"x-small",color:"default",variant:"text",onClick:Z=>Y(r.id)},{default:t(()=>[l(M,{size:"22",color:"error",icon:"tabler-trash"})]),_:2},1032,["onClick"]),s(k)?(d(),U(oe,{key:0,type:"error",class:"mt-4"},{default:t(()=>[m(i(s(k)),1)]),_:1})):j("",!0),l(le,{"model-value":s(G),class:"align-center justify-center"},{default:t(()=>[l(ae,{indeterminate:"",size:"64"})]),_:1},8,["model-value"])])]))),128))])):(d(),u("tfoot",Aa,Ea))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})])}}},Ha=Ge(qa,[["__scopeId","data-v-12b186db"]]);export{Ha as default};
