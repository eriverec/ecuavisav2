import{M as xe,r as v,v as se,as as Ce,o as c,x as k,a as l,w as s,q as r,p as d,g,aR as T,h as _,aT as oe,bR as q,b0 as B,u as Te,c as y,b8 as Se,N as re,t as S,m as ie,b7 as Ue,F as D,C as $,ba as Le,a3 as E,b,V as O,e as f,n as I,aq as ke,c7 as N,a2 as F,aM as ne,L as W,b9 as Ae,f as Ee,bb as z,bd as Ie,be as Re}from"./index.88d3c7f5.js";import{d as Me}from"./vuedraggable.umd.b90335ae.js";import{V as Y}from"./VSpacer.2a3e77c9.js";import{V as Ge}from"./VAlert.3e8ed100.js";import{V as De}from"./VTooltip.2d0a8708.js";import{V as ue}from"./VTextarea.86fae113.js";const ce=R=>(Ie("data-v-b4311bab"),R=R(),Re(),R),$e=["onSubmit"],Ne={class:"d-flex flex-column gap-3"},ze={key:0},Pe={class:"mb-3"},je=ce(()=>b("label",{class:"text-subtitle-1 mb-2 d-block"},"Secciones y/o subsecciones incluidas",-1)),qe={class:"d-flex flex-wrap gap-2 mb-2"},Be=ce(()=>b("label",{class:"text-subtitle-1 mb-2 d-block"},"Secciones y/o subsecciones excluidas",-1)),Oe={class:"d-flex flex-wrap gap-2 mb-2"},Fe={class:"d-flex gap-4 mt-4"},We={__name:"index",setup(R){const m=v(!1),U=v(null),P=v(""),j=v(""),x=v(0),n=v([]),M="https://estadisticas.ecuavisa.com/sites/gestor/Tools/contenidoLimits/config_contenido.php",V=v({show:!1,selectedType:"Live"}),C=v({show:!1,config:null,previousValue:!1}),h=v({show:!1,index:null}),L=v({show:!1,message:"",color:"success"}),de=[{title:"Visitas an\xF3nimas",switchModel:"activeLimitVisitors",switchLabel:"Activar l\xEDmite para visitantes an\xF3nimos",textModel:"limitVisitors",textLabel:"L\xEDmite de visitas an\xF3nimas"},{title:"Usuarios registrados",switchModel:"activeRegisteredVisitor",switchLabel:"Activar l\xEDmite para usuarios registrados",textModel:"limitRegisteredVisitors",textLabel:"L\xEDmite para usuarios registrados"},{title:"Suscriptores",switchModel:"activeLimitSuscribers",switchLabel:"Activar l\xEDmite de suscriptores",textModel:"limitSuscribers",textLabel:"L\xEDmite para suscriptores"}],A=se(()=>n.value.some(a=>a.switchGlobal&&a.contentType==="Article")),H=se(()=>{const a=n.value.find(t=>t.switchGlobal&&t.contentType==="Article");return a?a.id:null}),J=()=>{const a=new Date,t=`${a.getFullYear()}${(a.getMonth()+1).toString().padStart(2,"0")}${a.getDate().toString().padStart(2,"0")}`,e=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`config_${t}_${e}`},me=()=>({id:J(),name:"Nueva configuraci\xF3n",contentType:"Article",activeLimitVisitors:!1,limitVisitors:0,activeRegisteredVisitor:!1,limitRegisteredVisitors:0,activeLimitSuscribers:!1,limitSuscribers:0,messageToInviteRegister:"",messageToInviteSuscribers:"",switchGlobal:!1,switchSection:!1,include_sections:[],exclude_sections:[],switchUrl:!1,UrlName:""}),pe=()=>{V.value.selectedType=A.value?"Live":"Article",V.value.show=!0},ve=()=>A.value?["Live"]:["Article","Live"],fe=()=>{const a=me();a.contentType=V.value.selectedType,n.value.push(a),x.value=n.value.length-1,V.value.show=!1},K=a=>A.value&&a.contentType==="Article"&&a.id!==H.value,be=a=>a.switchGlobal||A.value&&a.contentType==="Article",Q=a=>{try{return new URL(a),!0}catch{return!1}},Ve=(a,t)=>{a&&t.contentType==="Article"&&(C.value={show:!0,config:t,previousValue:!a})},he=async()=>{const{config:a}=C.value;a&&(a.switchGlobal=!0,await le(n.value.findIndex(t=>t.id===a.id))),C.value.show=!1},we=()=>{const{config:a,previousValue:t}=C.value;a&&(a.switchGlobal=t),C.value.show=!1},ge=async()=>{try{m.value=!0;const a=await z({method:"POST",url:`${M}?action=update`,data:n.value,headers:{Accept:"*","Content-Type":"application/json"}});if(a.data&&a.data.success)w("Orden actualizado correctamente","success");else throw new Error("Error al actualizar el orden")}catch(a){console.error("Error al actualizar el orden:",a),w("Error al actualizar el orden","error")}finally{m.value=!1}},G=a=>a?a.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"",X=(a,t,e)=>{const i=e.target.value;if(i.endsWith(",")){const o=i.slice(0,-1).trim();if(o){const u=n.value[a],p=t==="include"?u.include_sections:u.exclude_sections,te=G(o);p.includes(te)||p.push(te),t==="include"?P.value="":j.value=""}}},Z=(a,t,e)=>{const i=n.value[a],o=e==="include"?i.include_sections:i.exclude_sections,u=o.indexOf(t);u>-1&&o.splice(u,1)},ee=a=>a?typeof a=="string"?[G(a)]:Array.isArray(a)?a.map(t=>typeof t=="string"?G(t):t&&typeof t=="object"&&(t.value||t.title)?G(t.value||t.title):"").filter(t=>t!==""):[]:[],_e=a=>{const t=n.value[a];(!A.value||t.id===H.value||t.contentType!=="Article")&&(h.value={show:!0,index:a})},ye=async()=>{if(h.value.index!==null){try{const a=n.value[h.value.index];if(a.switchGlobal&&a.contentType==="Article"&&!await new Promise(i=>{confirm("Esta es una configuraci\xF3n global. \xBFEst\xE1 seguro de eliminarla?")?i(!0):i(!1)})){h.value.show=!1;return}n.value.splice(h.value.index,1);const t=await z({method:"POST",url:`${M}?action=update`,data:n.value,headers:{Accept:"*","Content-Type":"application/json"}});if(t.data&&t.data.success)w("Configuraci\xF3n eliminada correctamente","success"),x.value>=n.value.length&&(x.value=Math.max(0,n.value.length-1));else throw new Error("Error al eliminar la configuraci\xF3n")}catch(a){w("Error al eliminar la configuraci\xF3n","error"),console.error("Error:",a)}h.value.show=!1}},le=async a=>{var t;m.value=!0,U.value=null;try{const e=n.value[a];if(e.switchGlobal&&e.contentType==="Article"&&n.value.find((u,p)=>p!==a&&u.switchGlobal&&u.contentType==="Article"))throw new Error("Ya existe una configuraci\xF3n global para art\xEDculos");if(e.switchUrl&&!Q(e.UrlName))throw new Error("Por favor ingrese una URL v\xE1lida");const i=await z({method:"POST",url:`${M}?action=update`,data:n.value,headers:{Accept:"*","Content-Type":"application/json"}});if(i.data&&i.data.success)w("Configuraci\xF3n actualizada correctamente","success");else throw new Error(((t=i.data)==null?void 0:t.message)||"Error al actualizar la configuraci\xF3n")}catch(e){console.error("Error al actualizar:",e),U.value=`Error al actualizar la configuraci\xF3n: ${e.message}`,w("Error en la actualizaci\xF3n","error")}finally{m.value=!1}},ae=async()=>{m.value=!0,U.value=null;try{const a=await z({method:"get",url:M,params:{action:"read"}});if(a.data&&a.data.success&&a.data.data){const t=Array.isArray(a.data.data)?a.data.data:[a.data.data];n.value=t.map(e=>({id:e.id||J(),name:e.name||"",contentType:e.contentType||"Article",activeLimitVisitors:e.activeLimitVisitors===!0||e.activeLimitVisitors==="true",limitVisitors:parseInt(e.limitVisitors)||0,activeRegisteredVisitor:e.activeRegisteredVisitor===!0||e.activeRegisteredVisitor==="true",limitRegisteredVisitors:parseInt(e.limitRegisteredVisitors)||0,activeLimitSuscribers:e.activeLimitSuscribers===!0||e.activeLimitSuscribers==="true",limitSuscribers:parseInt(e.limitSuscribers)||0,messageToInviteRegister:e.messageToInviteRegister||"",messageToInviteSuscribers:e.messageToInviteSuscribers||"",switchGlobal:e.switchGlobal===!0||e.switchGlobal==="true",switchSection:e.switchSection===!0||e.switchSection==="true",include_sections:ee(e.include_sections),exclude_sections:ee(e.exclude_sections),switchUrl:e.switchUrl===!0||e.switchUrl==="true",UrlName:e.UrlName||""})),w("Configuraciones cargadas correctamente","success")}else throw new Error("No se recibieron datos v\xE1lidos del servidor")}catch(a){console.error("Error al cargar:",a),U.value=`Error al cargar la configuraci\xF3n: ${a.message}`,w("Error al cargar las configuraciones","error")}finally{m.value=!1}},w=(a,t="success")=>{L.value={show:!0,message:a,color:t}};return Ce(()=>{ae()}),(a,t)=>(c(),k("div",null,[l(d,{color:"primary",class:"mb-4 text-uppercase","prepend-icon":"mdi-plus",onClick:pe},{default:s(()=>[r(" Crear Nueva Regla ")]),_:1}),l(B,{modelValue:V.value.show,"onUpdate:modelValue":t[2]||(t[2]=e=>V.value.show=e),"max-width":"500px"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,{class:"text-uppercase"},{default:s(()=>[r("Crear nueva regla")]),_:1}),l(_,null,{default:s(()=>[l(oe,{modelValue:V.value.selectedType,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value.selectedType=e),label:"Tipo de Contenido",items:ve(),required:""},null,8,["modelValue","items"])]),_:1}),l(q,null,{default:s(()=>[l(Y),l(d,{color:"primary",variant:"text",onClick:fe},{default:s(()=>[r(" Crear ")]),_:1}),l(d,{color:"error",variant:"text",onClick:t[1]||(t[1]=e=>V.value.show=!1)},{default:s(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ue,{modelValue:x.value,"onUpdate:modelValue":t[4]||(t[4]=e=>x.value=e),color:"primary","align-tabs":"start",class:"mb-4"},{default:s(()=>[l(Te(Me),{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),"component-data":{name:"v-tabs-bar"},handle:".drag-handle",onEnd:ge,"item-key":"id",class:"d-flex"},{item:s(({element:e,index:i})=>[(c(),y(Se,{key:e.id,value:i,disabled:K(e),class:"d-flex align-center"},{default:s(()=>[l(re,{class:"drag-handle mr-2 cursor-move",size:"large",icon:"mdi-drag-horizontal"}),r(" "+S(e.name)+" ",1),l(d,{icon:"mdi-delete",size:"small",color:"error",variant:"text",class:"ml-2",onClick:ie(o=>_e(i),["stop"]),disabled:K(e)},null,8,["onClick","disabled"])]),_:2},1032,["value","disabled"]))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(Ae,{modelValue:x.value,"onUpdate:modelValue":t[7]||(t[7]=e=>x.value=e)},{default:s(()=>[(c(!0),k(D,null,$(n.value,(e,i)=>(c(),y(Le,{key:e.id,value:i},{default:s(()=>[l(g,{class:"mt-5",title:e.name},{default:s(()=>[l(_,null,{default:s(()=>[U.value?(c(),y(Ge,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4"},{default:s(()=>[r(S(U.value),1)]),_:1})):E("",!0),b("form",{onSubmit:ie(o=>le(i),["prevent"])},[l(O,null,{default:s(()=>[l(f,{cols:"12",md:"6"},{default:s(()=>[l(I,{modelValue:e.name,"onUpdate:modelValue":o=>e.name=o,label:"Nombre de la configuraci\xF3n del l\xEDmite",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(f,{cols:"12",md:"6"},{default:s(()=>[l(oe,{modelValue:e.contentType,"onUpdate:modelValue":o=>e.contentType=o,label:"Tipo de Contenido",items:["Article","Live"],required:"",disabled:be(e)},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),l(f,{cols:"12"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,{class:"text-h6 font-weight-normal d-flex align-center"},{default:s(()=>[r(" \xBFSer\xE1 un l\xEDmite global? "),l(De,{location:"top"},{activator:s(({props:o})=>[l(re,ke(o,{icon:"mdi-information",color:"primary",class:"ml-2"}),null,16)]),default:s(()=>[r(" Mientras esto se encuentre activo, no se validar\xE1 ninguna regla adicional del mismo tipo de contenido ")]),_:1})]),_:1}),l(_,null,{default:s(()=>[l(N,{modelValue:e.switchGlobal,"onUpdate:modelValue":[o=>e.switchGlobal=o,o=>Ve(o,e)],label:"Activar en todo el sitio"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e.switchGlobal?E("",!0):(c(),y(f,{key:0,cols:"12"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,{class:"text-h6 font-weight-normal"},{default:s(()=>[r(" Configuraci\xF3n por "+S(e.contentType==="Live"?"URL":"Secciones / URL"),1)]),_:2},1024),l(_,null,{default:s(()=>[l(F,{class:"mb-3"}),l(O,null,{default:s(()=>[e.contentType!=="Live"?(c(),y(f,{key:0,cols:"12",md:"6"},{default:s(()=>[b("div",Ne,[l(N,{modelValue:e.switchSection,"onUpdate:modelValue":o=>e.switchSection=o,label:"Por secci\xF3n"},null,8,["modelValue","onUpdate:modelValue"]),e.switchSection?(c(),k("div",ze,[b("div",Pe,[je,b("div",qe,[(c(!0),k(D,null,$(e.include_sections,(o,u)=>(c(),y(ne,{key:u,closable:"",class:"ma-1","onClick:close":p=>Z(i,o,"include")},{default:s(()=>[r(S(o),1)]),_:2},1032,["onClick:close"]))),128))]),l(I,{modelValue:P.value,"onUpdate:modelValue":t[5]||(t[5]=o=>P.value=o),placeholder:"Escribe y agrega una coma (,) al final",onInput:o=>X(i,"include",o),"hide-details":""},null,8,["modelValue","onInput"])]),b("div",null,[Be,b("div",Oe,[(c(!0),k(D,null,$(e.exclude_sections,(o,u)=>(c(),y(ne,{key:u,closable:"",class:"ma-1","onClick:close":p=>Z(i,o,"exclude")},{default:s(()=>[r(S(o),1)]),_:2},1032,["onClick:close"]))),128))]),l(I,{modelValue:j.value,"onUpdate:modelValue":t[6]||(t[6]=o=>j.value=o),placeholder:"Escribe y agrega una coma (,) al final",onInput:o=>X(i,"exclude",o),"hide-details":""},null,8,["modelValue","onInput"])])])):E("",!0)])]),_:2},1024)):E("",!0),l(f,{cols:"12",md:e.contentType==="Live"?12:6,class:W({"text-left":e.contentType==="Live"})},{default:s(()=>[b("div",{class:W(["d-flex flex-column gap-3",{"align-left":e.contentType==="Live"}])},[l(N,{modelValue:e.switchUrl,"onUpdate:modelValue":o=>e.switchUrl=o,label:"Por URL"},null,8,["modelValue","onUpdate:modelValue"]),e.switchUrl?(c(),y(I,{key:0,modelValue:e.UrlName,"onUpdate:modelValue":o=>e.UrlName=o,label:"URL",placeholder:"https://www.ecuavisa.com/ejemplo",rules:[o=>!e.switchUrl||o&&Q(o)||"Por favor ingrese una URL v\xE1lida"],class:W(e.contentType==="Live"?"w-50":"")},null,8,["modelValue","onUpdate:modelValue","rules","class"])):E("",!0)],2)]),_:2},1032,["md","class"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)),(c(),k(D,null,$(de,(o,u)=>l(f,{cols:"12",md:"4",key:u},{default:s(()=>[l(g,null,{default:s(()=>[l(T,{class:"text-h6"},{default:s(()=>[r(S(o.title),1)]),_:2},1024),l(_,null,{default:s(()=>[l(F,{class:"mb-3"}),l(N,{modelValue:e[o.switchModel],"onUpdate:modelValue":p=>e[o.switchModel]=p,label:o.switchLabel},null,8,["modelValue","onUpdate:modelValue","label"]),l(I,{modelValue:e[o.textModel],"onUpdate:modelValue":p=>e[o.textModel]=p,modelModifiers:{number:!0},type:"number",label:o.textLabel,disabled:!e[o.switchModel],min:"0"},null,8,["modelValue","onUpdate:modelValue","label","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1024)),64)),l(f,{cols:"12"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,{class:"text-h6 font-weight-normal"},{default:s(()=>[r(" Configuraci\xF3n HTML a mostrar ")]),_:1}),l(_,null,{default:s(()=>[l(F,{class:"mb-3"}),l(O,null,{default:s(()=>[l(f,{cols:"12",md:"6"},{default:s(()=>[l(ue,{modelValue:e.messageToInviteRegister,"onUpdate:modelValue":o=>e.messageToInviteRegister=o,label:"Mensaje para invitar a registrarse",rows:"4"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(f,{cols:"12",md:"6"},{default:s(()=>[l(ue,{modelValue:e.messageToInviteSuscribers,"onUpdate:modelValue":o=>e.messageToInviteSuscribers=o,label:"Mensaje para invitar a suscribirse",rows:"4"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),b("div",Fe,[l(d,{type:"submit",color:"primary",variant:"tonal",loading:m.value,disabled:m.value,class:"text-uppercase"},{default:s(()=>[r(" Guardar regla ")]),_:1},8,["loading","disabled"]),l(d,{color:"secondary",variant:"tonal",onClick:ae,loading:m.value,disabled:m.value,class:"text-uppercase"},{default:s(()=>[r(" Recargar Datos ")]),_:1},8,["loading","disabled"])])],40,$e)]),_:2},1024)]),_:2},1032,["title"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(B,{modelValue:h.value.show,"onUpdate:modelValue":t[9]||(t[9]=e=>h.value.show=e),"max-width":"500px"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,null,{default:s(()=>[r("Confirmar eliminaci\xF3n")]),_:1}),l(_,null,{default:s(()=>[r(" \xBFEst\xE1 seguro que desea eliminar esta configuraci\xF3n? Esta acci\xF3n no se puede deshacer. ")]),_:1}),l(q,null,{default:s(()=>[l(Y),l(d,{color:"error",variant:"text",onClick:ye},{default:s(()=>[r(" Eliminar ")]),_:1}),l(d,{color:"primary",variant:"text",onClick:t[8]||(t[8]=e=>h.value.show=!1)},{default:s(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:C.value.show,"onUpdate:modelValue":t[10]||(t[10]=e=>C.value.show=e),"max-width":"500px"},{default:s(()=>[l(g,null,{default:s(()=>[l(T,null,{default:s(()=>[r("Confirmar activaci\xF3n global")]),_:1}),l(_,null,{default:s(()=>[r(" Mientras esto se encuentre activo, no se validar\xE1 ninguna regla adicional del mismo tipo de contenido. ")]),_:1}),l(q,null,{default:s(()=>[l(Y),l(d,{color:"primary",variant:"text",onClick:he},{default:s(()=>[r(" Confirmar ")]),_:1}),l(d,{color:"error",variant:"text",onClick:we},{default:s(()=>[r(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ee,{modelValue:L.value.show,"onUpdate:modelValue":t[12]||(t[12]=e=>L.value.show=e),color:L.value.color,timeout:3e3,location:"top end"},{actions:s(()=>[l(d,{color:"white",variant:"text",onClick:t[11]||(t[11]=e=>L.value.show=!1)},{default:s(()=>[r(" Cerrar ")]),_:1})]),default:s(()=>[r(S(L.value.message)+" ",1)]),_:1},8,["modelValue","color"])]))}},Ze=xe(We,[["__scopeId","data-v-b4311bab"]]);export{Ze as default};
