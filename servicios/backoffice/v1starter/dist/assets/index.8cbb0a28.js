import{R as je,U as Ee,r as n,as as Ae,Q as g,v as Ie,z as ie,o as h,x as y,a as l,w as r,q as P,t as p,u as s,f as Re,e as Be,g as ue,h as te,b as o,aT as A,i as x,$ as G,n as de,a2 as W,aU as ce,aV as me,a1 as ve,F as pe,C as fe,aM as _e,p as J,N as $e,a3 as he,aW as qe,X as ze,c as He,d as Ge,ao as ge,ap as ye,V as We,aX as Je}from"./index.88d3c7f5.js";import{a as Qe}from"./formatters.a9a9bf7f.js";import{M as Xe}from"./index.50982b4e.js";import{p as Q}from"./parseISO.d0bde0b5.js";import{V as Ke}from"./VSpacer.2a3e77c9.js";const Ze={class:"AppDateTimePicker-cr my-2"},ea={class:"mx-1 my-2",style:{"min-width":"120px"}},aa={class:"mx-1 my-2",style:{width:"155px"}},ta={class:"mx-1 my-2",style:{width:"145px"}},la={class:"mx-1 my-2",style:{width:"135px"}},sa={class:"mx-1 my-2",style:{"min-width":"115px"}},oa={class:"px-4"},na=o("h3",{class:"pb-3"},"Filtros Activos",-1),ra={key:0,class:"d-flex gap-2 flex-wrap"},ia={class:"text-disabled mr-3"},ua={key:1},da={class:"me-3 d-flex gap-4"},ca={class:"d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},ma={key:0,class:"px-0 py-1 text-disabled"},va=o("thead",null,[o("tr",null,[o("th",{scope:"col"}," Nombres "),o("th",{scope:"col"}," Tel\xE9fono "),o("th",{scope:"col"}," Pa\xEDs "),o("th",{scope:"col"}," Ciudad ")])],-1),pa={key:0},fa={class:"d-flex align-center"},_a={key:1},ha={class:"d-flex flex-column"},ga={class:"text-base"},ya={class:"text-sm text-disabled"},xa={class:"text-base"},ba={class:"text-base"},wa={class:"text-base"},Va=o("tr",null,[o("td",{colspan:"7",class:"text-center"}," No hay datos que mostrar ")],-1),Da=[Va],Ca=o("tr",null,[o("td",{colspan:"7",class:"text-center"}," Cargando datos, por favor espere un momento... ")],-1),Ya=[Ca],Sa={class:"text-sm text-disabled"},Ma={class:"pagination-cr"},Oa={class:"d-flex gap-1"},ka={__name:"index",setup(Fa){const b=je.exports.extendMoment(Xe);b.locale("es",[Ee]),b.tz.setDefault("America/Guayaquil");const _=n({message:"Datos guardados",type:"success",model:!1}),k=b().format("YYYY-MM-DD"),X=b().subtract(5,"days").format("YYYY-MM-DD"),j=n({inicio:X,fin:k}),xe={fechasModel:[Q(X),Q(k)],fechasVModel:[Q(k)],fechasVConfig:{position:"auto right",mode:"single",minDate:Q(k),altFormat:"d F j, Y",dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0},fechai:X,fechaV:k,fechaf:k},E=n(xe),le=n({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",created_at:"created_at",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at_suscriber_course:"created_at_suscriber_course",ciudad:"ciudad",telefono:"telefono",birthDate:"birthDate"}),B=n([]),be=n([]),m=n(1),se=n(10),u=n({page:m.value,limit:se.value,fechai:j.value.inicio,fechaf:j.value.fin,country:"Ecuador",city:"Guayaquil",device:"movil",os:"Linux",browser:"Chrome",order:"1",EC_Seccion:"Noticias"}),we=n({page:"P\xE1gina actual",limit:"L\xEDmite",fechai:"Fecha inicial",fechaf:"Fecha final",country:"Pa\xEDs",city:"Ciudad",device:"Dispositivo",os:"SO",browser:"Navegador",order:"Orden de los registros",EC_Seccion:"Secci\xF3n"});n(500);const M=n(!1),oe=n("https://servicio-de-actividad.vercel.app"),O=n(u.value.country),$=n([]),I=n([]),V=n(null),q=n(null),F=n(u.value.city),D=n([]),K=n([]),C=n(null),z=n(null),N=n(u.value.device),Ve=n(["desktop","movil"]),Y=n(u.value.browser),Z=n(["Chrome","Safari","Firefox","Otro"]),S=n(u.value.os),ee=n(["Windows","Mac OS","Android","Linux","Otro"]),U=n(10);async function w(){try{M.value=!0;var t=new Headers;t.append("Content-Type","application/json");var e={method:"GET",headers:t,redirect:"follow"};const i=new URLSearchParams(Object.fromEntries(Object.entries(u.value).filter(([a,c])=>c!=null&&c!==""&&c!==void 0))).toString();var v=await fetch(`${oe.value}/backoffice/trazabilidad-usuario?${i}`,e);const d=await v.json();if(d.resp)B.value=d.data,be.value=d.data;else return _.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},M.value=!1,!1;return M.value=!1,!0}catch(i){return _.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},M.value=!1,console.error(i.message)}}async function De(){try{var t=new Headers;t.append("Content-Type","application/json");var e={method:"GET",headers:t,redirect:"follow"},v=await fetch("https://servicios-ecuavisa-suscripciones.vercel.app/otros/obtener-paises-ciudades",e);const i=await v.json();return I.value=i,$.value=I.value.map(d=>({title:d.country,value:d.country})),D.value=I.value.find(d=>d.country=="Ecuador").data.map(d=>({title:d.city,value:d.city})),K.value=D.value,!0}catch(i){return _.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(i.message)}}Ae(async()=>{await w(),await De()}),g(U,async()=>{U.value&&(se.value=U.value,m.value=1,u.value.page=m.value,u.value.limit=U.value,await w())});async function Ce(){m.value=1,u.value.page=m.value,await w()}async function Ye(){m.value=m.value+1,u.value.page=m.value,await w()}async function Se(){m.value=m.value-1,u.value.page=m.value,await w()}function Me(){const t=u.value;return Object.keys(t).filter(e=>t[e]).map(e=>({label:we.value[e],value:t[e]}))}const ne=Ie(()=>Me());async function Oe(t,e,v){t.length>1&&(E.value.fechai=b(t[0]).format("DD-MM-YYYY"),E.value.fechaf=b(t[1]).format("DD-MM-YYYY"),j.value.inicio=b(E.value.fechai,"DD-MM-YYYY").format("YYYY-MM-DD"),j.value.fin=b(E.value.fechaf,"DD-MM-YYYY").format("YYYY-MM-DD"),m.value=1,u.value.fechai=j.value.inicio,u.value.fechaf=j.value.fin,u.value.page=m.value,await w())}g(O,async()=>{O.value&&(D.value=I.value.find(t=>t.country==O.value).data.map(t=>({title:t.city,value:t.city})),K.value=D.value,F.value=D.value[0].value)}),g(async()=>V.value,async()=>{const t=I.value.map(e=>({title:e.country,value:e.country}));V.value?$.value=t.filter(e=>e.title.toLowerCase().indexOf(V.value.toLowerCase())>-1||e.value.indexOf(V.value)>-1):$.value=t}),g(q,t=>{t||setTimeout(()=>{V.value=""},1e3)}),g(async()=>C.value,async()=>{const t=K.value;C.value?D.value=t.filter(e=>e.title.toLowerCase().indexOf(C.value.toLowerCase())>-1||e.value.indexOf(C.value)>-1):D.value=t}),g(z,t=>{t||setTimeout(()=>{C.value=""},1e3)}),g(F,async()=>{F.value&&(m.value=1,u.value.country=O.value,u.value.city=F.value,await w())}),g(N,async()=>{N.value&&(N.value=="movil"?(Y.value="Safari",Z.value=["Chrome","Safari","Firefox","Otro"],S.value="Linux",ee.value=["Windows","Mac OS","Android","Linux","Otro"]):(Y.value="Chrome",Z.value=["Chrome","Firefox","Otro"],S.value="Windows",ee.value=["Windows","Mac OS","Linux","Otro"]),m.value=1,u.value.device=N.value)}),g(Y,async()=>{Y.value&&(m.value=1,u.value.browser=Y.value,await w())}),g(S,async()=>{S.value&&(m.value=1,u.value.os=S.value,await w())});const L=n(!1),H=n([]),Fe=n("trazabilidad_usuarios"),R=n({tamanioActual:0,tamanioTotal:0});function Ne(t){for(var e=typeof t!="object"?JSON.parse(t):t,v="",i=0;i<e.length;i++){var d="";for(var a in e[i]){d!=""&&(d+=",");var c=e[i][a];typeof c=="string"&&c.includes(",")&&(c=`"${c}"`),d+=c}v+=d+`\r
`}return v}function Ue(t,e,v){e.unshift(t);var i=JSON.stringify(e),d=Ne(i),a=v+".csv"||"export.csv",c=new Blob([d],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(c,a);else{var f=document.createElement("a");if(f.download!==void 0){var T=URL.createObjectURL(c);f.setAttribute("href",T),f.setAttribute("download",a),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}}function Le(t){const e={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00C1:"A",\u00C9:"E",\u00CD:"I",\u00D3:"O",\u00DA:"U",\u00F1:"n",\u00D1:"N"};return t.split("").map(i=>e[i]||i).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")+"-"+b().format("YYYY-MM-DD-HH-mm-ss")}async function Te(t=1,e=10){try{var v=new Headers;v.append("Content-Type","application/json");var i={method:"GET",headers:v,redirect:"follow"};const a=Object.fromEntries(Object.entries(u.value).filter(([T,ae])=>ae!=null&&ae!==""&&ae!==void 0));a.page=t,a.limit=e;const c=new URLSearchParams(a).toString();var d=await fetch(`${oe.value}/backoffice/trazabilidad-usuario?${c}`,i);const f=await d.json();return f.resp?f:(_.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},L.value=!1,null)}catch(a){return _.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(a.message),L.value=!1,null}}function re(t){const e=new Set;return t.filter(v=>e.has(v.wylexId)?!1:(e.add(v.wylexId),!0))}async function Pe(){R.value={tamanioActual:0,tamanioTotal:0},H.value=[];for(var t=1;;){const i=(await Te(t,500)).data,d="-";for(var e in i){const c=i[e].user||{};let f={};for(let T in le.value)c.hasOwnProperty(T)?f[T]=c[T]:f[T]="";H.value.push(f)}if(R.value.tamanioActual=re(H.value).length,R.value.tamanioTotal=d,t++,i.length<1)break}return!0}async function ke(){try{L.value=!0,await Pe(),L.value=!1;let e=[];e=H.value;var t=`${Fe.value}-`+Le(`${u.value.fechai} hasta ${u.value.fechai}`);Ue(le.value,re(e),t)}catch(e){return console.log(e),_.value={message:"No se pudo recuperar los datos de registros para exportar, recargue de nuevo.",type:"error",model:!0},!1}}return(t,e)=>{const v=Je,i=ie("v-list-item-content"),d=ie("RouterLink");return h(),y("section",null,[l(Re,{modelValue:s(_).model,"onUpdate:modelValue":e[0]||(e[0]=a=>s(_).model=a),location:"top end",variant:"flat",timeout:s(_).timeout||2e3,color:s(_).type},{default:r(()=>[P(p(s(_).message),1)]),_:1},8,["modelValue","timeout","color"]),l(We,null,{default:r(()=>[l(Be,{cols:"12",sm:"12",lg:"12"},{default:r(()=>[l(ue,{class:"mb-4",title:"Filtros"},{default:r(()=>[l(te,{class:"d-flex gap-2 flex-wrap",style:{"align-items":"flex-start"}},{default:r(()=>[o("div",Ze,[l(v,{clearable:"",class:"bg-white",style:{width:"19rem"},label:"Fecha de inicio y fin","prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:s(E).fechasModel,"onUpdate:modelValue":e[1]||(e[1]=a=>s(E).fechasModel=a),"show-current":"true",onOnChange:Oe,config:{position:"auto right",mode:"range",altFormat:"d F j, Y",maxDate:new Date,dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0}},null,8,["modelValue"])]),o("div",ea,[l(A,{label:"Pa\xEDs",class:"bg-white",modelValue:s(O),"onUpdate:modelValue":e[3]||(e[3]=a=>x(O)?O.value=a:null),density:"compact",variant:"outlined","no-data-text":"No existen datos que mostrar",items:s($),menu:s(q),"onUpdate:menu":e[4]||(e[4]=a=>x(q)?q.value=a:null),"menu-props":{maxHeight:"400"}},{"prepend-item":r(()=>[l(G,null,{default:r(()=>[l(i,null,{default:r(()=>[l(de,{modelValue:s(V),"onUpdate:modelValue":e[2]||(e[2]=a=>x(V)?V.value=a:null),clearable:"",placeholder:"Buscar dato"},null,8,["modelValue"])]),_:1})]),_:1}),l(W,{class:"mt-2"})]),selection:r(({item:a})=>[o("div",null,p(a.title),1)]),item:r(({item:a,props:c})=>[l(G,ce(me(c)),{default:r(()=>[l(i,null,{default:r(()=>[l(ve,null,{default:r(()=>[o("p",null,p(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","menu"])]),o("div",aa,[l(A,{label:"Ciudades",class:"bg-white",modelValue:s(F),"onUpdate:modelValue":e[6]||(e[6]=a=>x(F)?F.value=a:null),density:"compact",variant:"outlined","no-data-text":"No existen datos que mostrar",items:s(D),menu:s(z),"onUpdate:menu":e[7]||(e[7]=a=>x(z)?z.value=a:null),"menu-props":{maxHeight:"400"}},{"prepend-item":r(()=>[l(G,null,{default:r(()=>[l(i,null,{default:r(()=>[l(de,{modelValue:s(C),"onUpdate:modelValue":e[5]||(e[5]=a=>x(C)?C.value=a:null),clearable:"",placeholder:"Buscar dato"},null,8,["modelValue"])]),_:1})]),_:1}),l(W,{class:"mt-2"})]),selection:r(({item:a})=>[o("div",null,p(a.title),1)]),item:r(({item:a,props:c})=>[l(G,ce(me(c)),{default:r(()=>[l(i,null,{default:r(()=>[l(ve,null,{default:r(()=>[o("p",null,p(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","menu"])]),o("div",ta,[l(A,{label:"Dispositivos",class:"bg-white",modelValue:s(N),"onUpdate:modelValue":e[8]||(e[8]=a=>x(N)?N.value=a:null),density:"compact",variant:"outlined","no-data-text":"No existen datos que mostrar",items:s(Ve),"menu-props":{maxHeight:"400"}},null,8,["modelValue","items"])]),o("div",la,[l(A,{label:"Navegadores",class:"bg-white",modelValue:s(Y),"onUpdate:modelValue":e[9]||(e[9]=a=>x(Y)?Y.value=a:null),density:"compact",variant:"outlined","no-data-text":"No existen datos que mostrar",items:s(Z),"menu-props":{maxHeight:"400"}},null,8,["modelValue","items"])]),o("div",sa,[l(A,{label:"OS",class:"bg-white",modelValue:s(S),"onUpdate:modelValue":e[10]||(e[10]=a=>x(S)?S.value=a:null),density:"compact",variant:"outlined","no-data-text":"No existen datos que mostrar",items:s(ee),"menu-props":{maxHeight:"400"}},null,8,["modelValue","items"])])]),_:1})]),_:1}),l(ue,{class:"mt-5",title:"Usuarios seg\xFAn el criterio"},{default:r(()=>[o("div",oa,[na,s(ne).length>0?(h(),y("ul",ra,[(h(!0),y(pe,null,fe(s(ne),(a,c)=>(h(),y("li",{key:c},[l(_e,{color:"primary"},{default:r(()=>[P(p(a.label)+": ",1)]),_:2},1024),P(),o("small",ia,p(a.value)+",",1)]))),128))])):(h(),y("p",ua,"No hay filtros activos"))]),l(te,{class:"d-flex py-4 gap-4 flex-wrap",style:{"align-items":"flex-start"}},{default:r(()=>[o("div",da,[l(A,{class:"bg-white",modelValue:s(U),"onUpdate:modelValue":e[11]||(e[11]=a=>x(U)?U.value=a:null),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"])]),l(Ke),o("div",ca,[l(J,{loading:s(L),disabled:s(L),color:"primary",onClick:ke},{default:r(()=>[P(" Descargar "),l($e,{end:"",icon:"tabler-cloud-download"})]),_:1},8,["loading","disabled"]),s(L)?(h(),y("small",ma," Exportando "+p(s(R).tamanioActual)+" / "+p(s(R).tamanioTotal)+" registros ",1)):he("",!0)])]),_:1}),l(W),l(qe,{class:"text-no-wrap"},{default:r(()=>[va,s(M)==!1?(h(),y("tbody",pa,[(h(!0),y(pe,null,fe(s(B),a=>(h(),y("tr",{key:a.user._id,style:{height:"3.75rem"}},[o("td",null,[o("div",fa,[l(ze,{variant:"tonal",color:"success",class:"me-3",size:"38"},{default:r(()=>[a.user.avatar?(h(),He(Ge,{key:0,src:a.user.avatar},null,8,["src"])):(h(),y("span",_a,p(s(Qe)(`${a.user.first_name} ${a.user.last_name}`)),1))]),_:2},1024),o("div",ha,[o("h6",ga,[l(d,{to:{name:"apps-user-view-id",params:{id:a.user.wylexId}},class:"font-weight-medium user-list-name"},{default:r(()=>[P(p(a.user.first_name)+" "+p(a.user.last_name),1)]),_:2},1032,["to"])]),o("span",ya,"@"+p(a.user.email),1)])])]),o("td",null,[o("span",xa,p(a.user.phone_number),1)]),o("td",null,[o("span",ba,p(s(u).country),1)]),o("td",null,[o("span",wa,p(s(u).city),1)])]))),128))])):he("",!0),ge(o("tfoot",null,Da,512),[[ye,!s(B).length&&s(M)==!1]]),ge(o("tfoot",null,Ya,512),[[ye,s(M)]])]),_:1}),l(W),l(te,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:r(()=>[o("span",Sa,p(t.paginationData),1),o("div",Ma,[o("div",Oa,[l(J,{style:{height:"38px"},class:"rounded-1",color:"primary",variant:"tonal",size:"small",disabled:s(m)==1,onClick:Ce},{default:r(()=>[P(" Regresar al inicio ")]),_:1},8,["disabled"]),l(J,{title:"P\xE1gina anterior",icon:"tabler-chevron-left",class:"rounded-1",color:"secondary",variant:"tonal",size:"small",disabled:s(m)<2,onClick:Se},null,8,["disabled"]),l(_e,{style:{height:"38px"},class:"px-4",label:"",color:"primary"},{default:r(()=>[P(p(s(m)),1)]),_:1}),l(J,{title:"Siguiente p\xE1gina",icon:"tabler-chevron-right",class:"rounded-1",color:"secondary",variant:"tonal",size:"small",onClick:Ye,disabled:s(B).length==0},null,8,["disabled"])])])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{ka as default};
