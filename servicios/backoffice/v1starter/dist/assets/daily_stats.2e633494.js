import{M as se,R as oe,S as ne,U as re,r as h,v as P,Q as G,as as le,o as f,x as _,a,w as o,e as I,g as j,aR as A,q as S,N as y,aq as q,a2 as M,h as V,b as d,t as w,u as z,L as F,V as ce,aQ as ie,p as K,a$ as de,c as H,bx as pe,bb as T,bd as ue,be as me}from"./index.88d3c7f5.js";import{V as N}from"./VTooltip.2d0a8708.js";const b=k=>(ue("data-v-6e8d2362"),k=k(),me(),k),fe=b(()=>d("span",null,"Total de clicks en el rango de fechas seleccionado",-1)),he={class:"text-h3 mb-4"},_e={class:"text-caption"},ve={key:1,class:"text-caption text-medium-emphasis"},ge=b(()=>d("span",null,"Pocentaje de n\xFAmero de clics que recibe un anuncio en relaci\xF3n al n\xFAmero de veces que se muestra",-1)),xe={class:"text-h3 mb-4"},ye={class:"text-caption"},we={key:1,class:"text-caption text-medium-emphasis"},be=b(()=>d("span",null,"Total de impresiones en el rango de fechas seleccionado",-1)),ke={class:"text-h3 mb-4"},Ce={class:"text-caption"},Ie={key:1,class:"text-caption text-medium-emphasis"},Se={class:"d-flex flex-column w-100"},Re={class:"d-flex justify-space-between align-center mb-4"},De=b(()=>d("div",{class:"date-picker-wrapper",style:{width:"calc(100% - 48px)"}},null,-1)),je={class:"d-flex gap-2"},Me=b(()=>d("div",{class:"date-picker-wrapper",style:{width:"100%"}},null,-1)),Ve={key:0,class:"text-center py-8"},ze=b(()=>d("div",{class:"mt-4 text-medium-emphasis"},"Cargando estad\xEDsticas...",-1)),Te={key:1,class:"text-center py-8 text-medium-emphasis"},$e={__name:"daily_stats",props:{campaignId:{type:String,required:!0},dateRange:{type:Object,required:!0}},emits:["loading"],setup(k,{emit:O}){const p=k;oe.exports.extendMoment(ne).locale("es",[re]);const $=h(!1);h(null);const C=h({click:[],preview:[]}),U=new Date,Q=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),W=h({start:Q(U),end:Q(U)}),Y=P(()=>{var e,t;return(t=(e=C.value)==null?void 0:e.data)!=null&&t.click?C.value.data.click.reduce((s,n)=>s+n.total,0):0}),E=P(()=>{var e,t;return(t=(e=C.value)==null?void 0:e.data)!=null&&t.preview?C.value.data.preview.reduce((s,n)=>s+n.total,0):0}),J=P(()=>E.value===0?0:Math.round(Y.value/E.value*100)),v=h(null),g=h(null),x=h(null),X=async(e,t)=>{const s=new Date(e),n=new Date(t);s.setMonth(s.getMonth()-1),n.setMonth(n.getMonth()-1);try{const{data:u}=await T.get(`https://ads-service.vercel.app/grafico/stats-diario/${p.campaignId}`,{params:{fechai:D(s),fechaf:D(n),page:1,limit:5e5}});return u.data}catch(u){return console.error("Error fetching previous period data:",u),null}},Z=(e,t)=>{var r,l;if(!(t!=null&&t.data)){v.value=null,g.value=null,x.value=null;return}const s={clicks:((e==null?void 0:e.click)||[]).reduce((i,m)=>i+m.total,0),impressions:((e==null?void 0:e.preview)||[]).reduce((i,m)=>i+m.total,0)},n={clicks:(((r=t.data)==null?void 0:r.click)||[]).reduce((i,m)=>i+m.total,0),impressions:(((l=t.data)==null?void 0:l.preview)||[]).reduce((i,m)=>i+m.total,0)};v.value=n.clicks===0?100:Math.round((s.clicks-n.clicks)/n.clicks*100),x.value=n.impressions===0?100:Math.round((s.impressions-n.impressions)/n.impressions*100);const u=s.impressions>0?s.clicks/s.impressions*100:0,c=n.impressions>0?n.clicks/n.impressions*100:0;g.value=c===0?100:Math.round((u-c)/c*100)},R=h({chart:{height:400,type:"line",zoom:{enabled:!1},toolbar:{show:!1},background:"transparent",fontFamily:"Public Sans, sans-serif"},grid:{show:!0,borderColor:"rgba(200, 200, 200, 0.2)",strokeDashArray:5,xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}},padding:{top:10,right:10,bottom:10,left:10}},stroke:{curve:"smooth",width:3},colors:["#7367F0","#28C76F"],markers:{size:6,strokeColors:"#282b3c",strokeWidth:3,hover:{size:8}},xaxis:{type:"category",categories:[],labels:{style:{colors:"#CBD5E1",fontSize:"12px"},rotate:-45,rotateAlways:!1},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:"#CBD5E1",fontSize:"12px"}},title:{text:"Cantidad",style:{color:"#CBD5E1",fontSize:"13px",fontWeight:500}}},tooltip:{theme:"dark",shared:!0,intersect:!1,y:{formatter:e=>e.toFixed(0)}},legend:{position:"top",horizontalAlign:"left",labels:{colors:"#CBD5E1"},markers:{radius:12,width:12,height:12}}}),B=h([{name:"Clicks",data:[]},{name:"Impresiones",data:[]}]),D=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},L=async()=>{$.value=!0,O("loading",!0);try{const e=await T.get(`https://ads-service.vercel.app/grafico/stats-diario/${p.campaignId}`,{params:{fechai:p.dateRange.start,fechaf:p.dateRange.end,page:1,limit:5e5}});if(e.data.resp&&e.data.data){const t=await X(W.value.start,W.value.end);Z(e.data.data,t),C.value=e.data,ee(e.data.data)}}catch(e){console.error("Error fetching data:",e)}finally{$.value=!1,O("loading",!1)}},ee=e=>{if(!(e!=null&&e.click)||!(e!=null&&e.preview))return;const t=[...new Set([...e.click.map(c=>c.date),...e.preview.map(c=>c.date)])].sort(),s=t.map(c=>{const[r,l,i]=c.split("-");return`${i} ${["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"][parseInt(l)-1]}`}),n=t.map(c=>{const r=e.click.find(l=>l.date===c);return r?r.total:0}),u=t.map(c=>{const r=e.preview.find(l=>l.date===c);return r?r.total:0});B.value=[{name:"Clicks",data:n},{name:"Impresiones",data:u}],R.value={...R.value,xaxis:{...R.value.xaxis,categories:s}}},ae=async()=>{try{const e=await T.get(`https://ads-service.vercel.app/grafico/stats-diario/btn-descargar/${p.campaignId}`,{params:{fechai:p.dateRange.start,fechaf:p.dateRange.end,page:1,limit:5e3}});if(e.data.resp&&e.data.data){const t=e.data.data.map(r=>({created_at_campaign:new Date(r.created_at_campaign).toLocaleString(),type:r.type,wylexId:r.user.wylexId,email:r.user.email,first_name:r.user.first_name,last_name:r.user.last_name})),s=["created_at_campaign","type","wylexId","email","first_name","last_name"],n=[s.join(","),...t.map(r=>s.map(l=>`"${r[l]}"`).join(","))].join(`
`),u=new Blob([n],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(u),c.setAttribute("download",`reporte_general_${D(new Date)}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)}}catch(e){console.error("Error al descargar el reporte detallado:",e)}},te=async()=>{try{const e=await T.get(`https://ads-service.vercel.app/grafico/stats-diario/btn-descargar/${p.campaignId}`,{params:{fechai:p.dateRange.start,fechaf:p.dateRange.end,page:1,limit:5e3}});if(e.data.resp&&e.data.data){const t=e.data.data.reduce((l,i)=>{const m=`${i.user.wylexId}-${i.type}`;return l[m]||(l[m]={wylexId:i.user.wylexId,email:i.user.email,first_name:i.user.first_name,last_name:i.user.last_name,type:i.type,dates:[]}),l[m].dates.push(new Date(i.created_at_campaign).toLocaleString()),l},{}),s=Object.values(t).map(l=>({type:l.type,wylexId:l.wylexId,email:l.email,first_name:l.first_name,last_name:l.last_name,interaction_dates:l.dates.join("; ")})),n=["type","wylexId","email","first_name","last_name","interaction_dates"],u=[n.join(","),...s.map(l=>n.map(i=>`"${l[i]}"`).join(","))].join(`
`),c=new Blob([u],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(c),r.setAttribute("download",`reporte_agrupado_por_tipo_${D(new Date)}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}catch(e){console.error("Error al descargar el reporte agrupado:",e)}};return G(()=>p.campaignId,e=>{e&&L()},{immediate:!0}),G(()=>p.dateRange,e=>{e&&L()},{deep:!0}),le(()=>{p.campaignId&&L()}),(e,t)=>(f(),_("div",null,[a(ce,{class:"px-4 pt-4"},{default:o(()=>[a(I,{cols:"12",md:"4"},{default:o(()=>[a(j,{class:"mb-4 elevation-0 border"},{default:o(()=>[a(A,{class:"py-2 px-4 text-center bg-surface"},{default:o(()=>[S(" CLICKS "),a(N,{location:"top"},{activator:o(({props:s})=>[a(y,q(s,{icon:"mdi-information",size:"x-small",color:"medium-emphasis",class:"ml-1"}),null,16)]),default:o(()=>[fe]),_:1})]),_:1}),a(M),a(V,{class:"d-flex flex-column justify-center align-center pa-6 text-center"},{default:o(()=>[d("h3",he,w(z(Y)),1),v.value!==null?(f(),_("div",{key:0,class:F(["d-flex align-center gap-1",v.value<0?"text-error":"text-success"])},[a(y,{size:"small",icon:v.value<0?"tabler-arrow-down":"tabler-arrow-up"},null,8,["icon"]),d("span",_e,w(Math.abs(v.value))+"% vs mes anterior ",1)],2)):(f(),_("span",ve," Sin datos previos "))]),_:1})]),_:1})]),_:1}),a(I,{cols:"12",md:"4"},{default:o(()=>[a(j,{class:"mb-4 elevation-0 border"},{default:o(()=>[a(A,{class:"py-2 px-4 text-center bg-surface"},{default:o(()=>[S(" CTR "),a(N,{location:"top"},{activator:o(({props:s})=>[a(y,q(s,{icon:"mdi-information",size:"x-small",color:"medium-emphasis",class:"ml-1"}),null,16)]),default:o(()=>[ge]),_:1})]),_:1}),a(M),a(V,{class:"d-flex flex-column justify-center align-center pa-6 text-center"},{default:o(()=>[d("h3",xe,w(z(J))+"%",1),g.value!==null?(f(),_("div",{key:0,class:F(["d-flex align-center gap-1",g.value<0?"text-error":"text-success"])},[a(y,{size:"small",icon:g.value<0?"tabler-arrow-down":"tabler-arrow-up"},null,8,["icon"]),d("span",ye,w(Math.abs(g.value))+"% vs mes anterior ",1)],2)):(f(),_("span",we," Sin datos previos "))]),_:1})]),_:1})]),_:1}),a(I,{cols:"12",md:"4"},{default:o(()=>[a(j,{class:"mb-4 elevation-0 border"},{default:o(()=>[a(A,{class:"py-2 px-4 text-center bg-surface"},{default:o(()=>[S(" IMPRESIONES "),a(N,{location:"top"},{activator:o(({props:s})=>[a(y,q(s,{icon:"mdi-information",size:"x-small",color:"medium-emphasis",class:"ml-1"}),null,16)]),default:o(()=>[be]),_:1})]),_:1}),a(M),a(V,{class:"d-flex flex-column justify-center align-center pa-6 text-center"},{default:o(()=>[d("h3",ke,w(z(E)),1),x.value!==null?(f(),_("div",{key:0,class:F(["d-flex align-center gap-1",x.value<0?"text-error":"text-success"])},[a(y,{size:"small",icon:x.value<0?"tabler-arrow-down":"tabler-arrow-up"},null,8,["icon"]),d("span",Ce,w(Math.abs(x.value))+"% vs mes anterior ",1)],2)):(f(),_("span",Ie," Sin datos previos "))]),_:1})]),_:1})]),_:1})]),_:1}),a(M,{class:"mt-5"}),a(I,{cols:"12"},{default:o(()=>[a(j,{class:"elevation-0"},{default:o(()=>[a(ie,null,{default:o(()=>[d("div",Se,[d("div",Re,[De,d("div",je,[a(K,{variant:"outlined",color:"primary",size:"small","prepend-icon":"tabler-download",onClick:ae},{default:o(()=>[S(" Descarga general ")]),_:1}),a(K,{variant:"outlined",color:"primary",size:"small","prepend-icon":"mdi-account-arrow-down-outline",onClick:te},{default:o(()=>[S(" Descarga Agrupado por tipo ")]),_:1})])]),a(I,{cols:"12",md:"6",class:"px-0"},{default:o(()=>[Me]),_:1})])]),_:1}),$.value?(f(),_("div",Ve,[a(de,{indeterminate:"",color:"primary"}),ze])):(f(),H(V,{key:1},{default:o(()=>[B.value[0].data.length>0?(f(),H(z(pe),{key:0,height:"350",options:R.value,series:B.value},null,8,["options","series"])):(f(),_("div",Te," No hay datos disponibles para el per\xEDodo seleccionado "))]),_:1}))]),_:1})]),_:1})]))}},Pe=se($e,[["__scopeId","data-v-6e8d2362"]]);export{Pe as default};
