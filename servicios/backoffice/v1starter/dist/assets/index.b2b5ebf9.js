import{R as ce,U as de,r as h,Q as H,v as J,as as ue,o as b,x as g,a as n,w as l,e as pe,h as L,b as a,aT as fe,n as me,b1 as he,p as P,q as u,t as d,a3 as j,g as K,aW as ve,F as _e,C as be,u as T,aM as Q,ao as Z,ap as G,a2 as ge,b0 as ye,c as we,Z as xe,$ as x,a0 as A,a1 as C,N as Ae,bR as Ce,V as Ve}from"./index.88d3c7f5.js";import{M as Ne}from"./index.50982b4e.js";import{V as W}from"./VSpacer.2a3e77c9.js";import{V as Me}from"./VPagination.9412c3b8.js";const De=a("h1",null,"Listado de Transaciones Totales",-1),ke={class:"me-3 d-flex gap-4"},Ee={class:"app-user-search-filter d-flex align-top flex-column"},Pe={key:0},je=a("h6",{class:"text-caption text-secondary font-weight-semibold"},"Puedes filtrar por nombre, apellido, email, id de usuario y id de transacci\xF3n",-1),Te=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Nombre"),a("th",{scope:"col"},"Apellido"),a("th",{scope:"col"},"Email"),a("th",{scope:"col"},"ID Transacci\xF3n"),a("th",{scope:"col"},"Banco"),a("th",{scope:"col"},"Tipo Tarjeta"),a("th",{scope:"col"},"Paquete"),a("th",{scope:"col"},"Fecha de Pago"),a("th",{scope:"col"},"Precio con iva"),a("th",{scope:"col"},"Estado"),a("th",{scope:"col"},"Acci\xF3n")])],-1),$e={key:0},Fe=a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon icon-tabler icons-tabler-outline icon-tabler-credit-card-pay"},[a("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),a("path",{d:"M12 19h-6a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v4.5"}),a("path",{d:"M3 10h18"}),a("path",{d:"M16 19h6"}),a("path",{d:"M19 16l3 3l-3 3"}),a("path",{d:"M7.005 15h.005"}),a("path",{d:"M11 15h2"})],-1),Le=a("tr",null,[a("td",{colspan:"11",class:"text-center"},"No hay datos que mostrar")],-1),ze=[Le],Se=a("tr",null,[a("td",{colspan:"11",class:"text-center"},"Cargando datos, por favor espere un momento...")],-1),Be=[Se],Re={class:"text-sm text-disabled"},Ye={class:"d-flex justify-space-between align-center"},Ie={class:"text-5xl mb-2 mt-2"},Ue={style:{width:"120px"},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},qe=a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z"},null,-1),Oe=[qe],He=a("div",{height:"1",class:"mt-3 mb-3",style:{border:"0","border-collapse":"collapse",margin:"0",padding:"0",height:"1px","font-size":"1px","background-color":"rgb(235 235 235 / 20%)","line-height":"1px"}}," \xA0",-1),Je={class:"d-flex justify-space-between align-center"},Ke={class:"d-flex justify-space-between align-center"},Qe={class:"d-flex justify-space-between align-center"},Ze={key:0},Ge={class:"d-flex justify-space-between align-center"},We={class:"d-flex justify-space-between align-center"},na={__name:"index",setup(Xe){const y=ce.exports.extendMoment(Ne);y.locale("es",[de]),y.tz.setDefault("America/Guayaquil");const z={January:"enero",February:"febrero",March:"marzo",April:"abril",May:"mayo",June:"junio",July:"julio",August:"agosto",September:"septiembre",October:"octubre",November:"noviembre",December:"diciembre"},S=h([]),_=h([]),w=h(1),M=h(0),v=h(10),V=h(!1),D=h(""),k=h(!1),f=h(null),E=h(!1),$=function(o){const t={0:"Esperando pago.",1:"Se requiere verificaci\xF3n, consulte la secci\xF3n Verificaci\xF3n.",2:"Pagado parcialmente",3:"Pagado.",4:"En disputa.",5:"Pagado en exceso",6:"Fraude.",7:"Reembolso.",8:"Contracargo",9:"Rechazado por el transportista.",10:"Error del sistema.",11:"Fraude Nuvei.",12:"Lista negra de Nuvei.",13:"Tolerancia del tiempo.",14:"Caducado por Nuvei",15:"Caducado por el transportista.",16:"Rechazado por Nuvei",17:"Abandonado por Nuvei",18:"Abandonado por el cliente",19:"C\xF3digo de autorizaci\xF3n no v\xE1lido.",20:"El c\xF3digo de autorizaci\xF3n expir\xF3.",21:"Fraude Nuvei - Reembolso pendiente.",22:"C\xF3digo de autenticaci\xF3n no v\xE1lido: reembolso pendiente.",23:"El c\xF3digo de autenticaci\xF3n expir\xF3: reembolso pendiente.",24:"Fraude Nuvei: reembolso solicitado.",25:"C\xF3digo de autenticaci\xF3n no v\xE1lido: reembolso solicitado.",26:"El c\xF3digo de autenticaci\xF3n expir\xF3: se solicit\xF3 un reembolso.",27:"Comerciante - Reembolso pendiente.",28:"Comerciante: reembolso solicitado.",29:"Anulado.",30:"Transacci\xF3n asentada (solo Ecuador).",31:"Esperando OTP.",32:"OTP successfully validated.",33:"OTP no validada.",34:"Partial refund.",35:"M\xE9todo 3DS solicitado, esperando continuar.",36:"Desaf\xEDo 3DS solicitado, esperando CRES.",37:"Rechazado por 3DS.",47:"Falla en la validaci\xF3n del CPF.",48:"Autenticado por 3DS"};return t.hasOwnProperty(o)?{estado_suscripcion:o==3?1:0,num_error:o,msj:t[o]}:{estado_suscripcion:0,num_error:o,msj:"No encontrado"}};async function X(o,t){V.value=!0;try{const s=`https://ecuavisa-suscripciones.vercel.app/backoffice/transaction-all?page=${o}&limit=${t}`,r=await(await fetch(s)).json();if(r.resp){var e=[];Array.isArray(r.transacciones_realizadas)&&e.push(...r.transacciones_realizadas.map(c=>({...c,estado:"Realizado"}))),Array.isArray(r.transacciones_fallidas)&&e.push(...r.transacciones_fallidas.map(c=>({...c,estado:"Fallida"}))),e.sort((c,p)=>{const m=c.transaction&&c.created_at?new Date(c.created_at):new Date(0);return(p.transaction&&p.created_at?new Date(p.created_at):new Date(0))-m}),e=I(e),S.value=e,_.value=e,M.value=Math.ceil(e.length/v.value)}else console.log("La respuesta de la API no fue exitosa")}catch(s){console.error("Error al obtener las transacciones:",s)}finally{V.value=!1}}function ee(){const o=D.value.toLowerCase();_.value=S.value.filter(t=>{var i,r,c,p,m;const e=Array.isArray(t.user)?t.user[0]:t.user,s=Array.isArray(t.transaction)?t.transaction[0]:t.transaction;return((i=e==null?void 0:e.first_name)==null?void 0:i.toLowerCase().includes(o))||((r=e==null?void 0:e.last_name)==null?void 0:r.toLowerCase().includes(o))||((c=e==null?void 0:e._id)==null?void 0:c.toLowerCase().includes(o))||((p=e==null?void 0:e.email)==null?void 0:p.toLowerCase().includes(o))||((m=s==null?void 0:s.id)==null?void 0:m.toLowerCase().includes(o))}),w.value=1,M.value=Math.ceil(_.value.length/v.value)}H(v,()=>{w.value=1,M.value=Math.ceil(_.value.length/v.value)}),H(D,ee);const ae=J(()=>{const o=_.value.length?(w.value-1)*v.value+1:0,t=Math.min(o+v.value-1,_.value.length);return`Mostrando ${o} a ${t} de ${_.value.length} registros`}),B=J(()=>{const o=(w.value-1)*v.value,t=o+v.value;return _.value.slice(o,t)});function te(o){f.value=o,E.value=!0}function oe(o){if(!o)return"Fecha no disponible";const t=y(o),e=t.format("MMMM"),s=z[e];return`Pagado el ${t.format("D [de] ")}${s}${t.format(" [de] YYYY")}`}function R(o){if(!o)return"Fecha no disponible";const t=y(o),e=t.format("MMMM"),s=z[e];return`${t.format("D [de] ")}${s}${t.format(" [de] YYYY")}`}function se(){var p;if(!f.value)return;const o=f.value,t=Array.isArray(o.user)?o.user[0]:o.user,e=o.transaction,i=[["Factura"],["N\xFAmero de factura",(e==null?void 0:e.id)||"N/A"],["Fecha de emisi\xF3n",R(o.created_at)],["Fecha de vencimiento",R(o.created_at)],[],["Facturado a"],["Nombre",`${(t==null?void 0:t.first_name)||""} ${(t==null?void 0:t.last_name)||""}`],["Email",(t==null?void 0:t.email)||"N/A"],[],["Descripci\xF3n","Cantidad","Precio unitario","Importe"],[`${((p=o.paquete)==null?void 0:p.nombre)||"N/A"}`,"1",(e==null?void 0:e.amount)||"0.00"],[],["","","Subtotal",(e==null?void 0:e.amount)||"0.00"],["","","Total",(e==null?void 0:e.amount)||"0.00"],["","","Importe debido",`${(e==null?void 0:e.amount)||"0.00"} USD`]].map(m=>m.join(",")).join(`
`),r=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");if(c.download!==void 0){const m=URL.createObjectURL(r);c.setAttribute("href",m),c.setAttribute("download",`factura-${(e==null?void 0:e.id)||"desconocido"}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}const ne={ex:"Exito",ak:"Alkosto",cd:"Codensa",sx:"Sodexo",ol:"Olimpica",ep:"EPM",csd:"Colsubsidio",bbva:"BBVA",cmr:"Falabella",cn:"Carnet",cs:"Credisensa",so:"Solidario",up:"Union Pay",el:"Elo",jc:"JCB",au:"Aura",hpc:"Hipercard",vi:"Visa",mc:"Mastercard",ax:"American Express",di:"Diners",dc:"Discover",ms:"Maestro"},N=h([]),Y=o=>ne[o]||o||"N/A",I=o=>{const t=new Set;return o.filter(s=>{const i=s.transaction.id;return t.has(i)?!1:(t.add(i),!0)})};async function le(){k.value=!0,N.value=[];let o=1;const t=500;try{for(;;){const s=`https://ecuavisa-suscripciones.vercel.app/backoffice/transaction-all?page=${o}&limit=${t}`,r=await(await fetch(s)).json();if(!r.resp||!r.transacciones_realizadas.length&&!r.transacciones_fallidas.length)break;N.value=I(N.value.concat(r.transacciones_realizadas,r.transacciones_fallidas)),o++}const e=re(N.value);ie(e,"transacciones.csv")}catch(e){console.error("Error al descargar el CSV:",e)}finally{k.value=!1}}function re(o){const t=["Nombre","Apellido","Email","ID Transacci\xF3n","Banco","Tipo Tarjeta","Paquete","Fecha de Pago","Precio con IVA","Estado"],e=o.map(s=>{var c,p,m;const i=Array.isArray(s.user)?s.user[0]:s.user,r=s.transaction;return[(i==null?void 0:i.first_name)||"N/A",(i==null?void 0:i.last_name)||"N/A",(i==null?void 0:i.email)||"N/A",(r==null?void 0:r.id)||"N/A",((c=s.card_details)==null?void 0:c.bank_name)||"N/A",Y((p=s.card_details)==null?void 0:p.type.toLowerCase()),((m=s.paquete)==null?void 0:m.nombre)||"N/A",s.created_at?y(s.created_at).format("DD-MM-YYYY HH:mm:ss"):"N/A",(r==null?void 0:r.amount)||"N/A",$(r==null?void 0:r.status_detail).msj]});return[t,...e].map(s=>s.join(",")).join(`
`)}function ie(o,t){const e=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(s.download!==void 0){const i=URL.createObjectURL(e);s.setAttribute("href",i),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}return ue(()=>{X(1,1e4)}),(o,t)=>(b(),g("section",null,[n(Ve,null,{default:l(()=>[n(pe,{cols:"12",sm:"12",lg:"12"},{default:l(()=>[De,n(L,{class:"d-flex py-4 gap-4 px-0 flex-wrap",style:{"align-items":"flex-start"}},{default:l(()=>[a("div",ke,[n(fe,{class:"bg-white",modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"]),n(me,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=e=>D.value=e),label:"Buscar...","prepend-inner-icon":"mdi-magnify","single-line":"","hide-details":"",onKeyup:he(o.buscarUsuarios,["enter"]),style:{width:"300px"}},null,8,["modelValue","onKeyup"])]),n(W),a("div",Ee,[n(P,{onClick:le,variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",loading:k.value},{default:l(()=>[u(" Exportar datos ")]),_:1},8,["loading"]),k.value?(b(),g("small",Pe,"Descargando "+d(N.value.length)+" registros",1)):j("",!0)])]),_:1}),je,n(K,{class:"mt-1"},{default:l(()=>[n(ve,{class:"text-no-wrap"},{default:l(()=>[Te,V.value?j("",!0):(b(),g("tbody",$e,[(b(!0),g(_e,null,be(T(B),e=>{var s,i,r,c,p,m,F,U,q,O;return b(),g("tr",{key:e._id,style:{height:"3.75rem"}},[a("td",null,d((Array.isArray(e.user)?(s=e.user[0])==null?void 0:s.first_name:(i=e.user)==null?void 0:i.first_name)||"N/A"),1),a("td",null,d((Array.isArray(e.user)?(r=e.user[0])==null?void 0:r.last_name:(c=e.user)==null?void 0:c.last_name)||"N/A"),1),a("td",null,d((Array.isArray(e.user)?(p=e.user[0])==null?void 0:p.email:(m=e.user)==null?void 0:m.email)||"N/A"),1),a("td",null,d(((F=e.transaction)==null?void 0:F.id)||"N/A"),1),a("td",null,d(((U=e.card_details)==null?void 0:U.bank_name)||"N/A"),1),a("td",null,d(Y((q=e.card_details)==null?void 0:q.type.toLowerCase())),1),a("td",null,d(((O=e.paquete)==null?void 0:O.nombre)||"N/A"),1),a("td",null,d(e.created_at?T(y)(e.created_at).format("DD-MM-YYYY HH:mm:ss"):"N/A"),1),a("td",null,"$"+d(e.transaction.amount),1),a("td",null,[n(Q,{color:e.transaction.status_detail=="3"?"success":"error"},{default:l(()=>[u(d($(e.transaction.status_detail).msj),1)]),_:2},1032,["color"])]),a("td",null,[n(P,{onClick:ea=>te(e),variant:"plain",color:"info",size:"small"},{default:l(()=>[Fe]),_:2},1032,["onClick"])])])}),128))])),Z(a("tfoot",null,ze,512),[[G,!T(B).length&&!V.value]]),Z(a("tfoot",null,Be,512),[[G,V.value]])]),_:1}),n(ge),n(L,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:l(()=>[a("span",Re,d(T(ae)),1),n(Me,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),size:"small","total-visible":5,length:M.value},null,8,["modelValue","length"])]),_:1})]),_:1}),n(ye,{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=e=>E.value=e),"max-width":"500px"},{default:l(()=>[f.value?(b(),we(K,{key:0},{default:l(()=>[n(L,null,{default:l(()=>[n(xe,null,{default:l(()=>[n(x,null,{default:l(()=>{var e;return[a("div",Ye,[a("div",null,[n(A,null,{default:l(()=>[u("Detalles de la transacci\xF3n")]),_:1}),a("h2",Ie,"$"+d(((e=f.value.transaction)==null?void 0:e.amount)||"N/A"),1),n(C,null,{default:l(()=>{var s;return[u(d(oe((s=f.value.transaction)==null?void 0:s.payment_date)),1)]}),_:1}),n(P,{class:"mt-3",color:"secondary",variant:"tonal",onClick:se,size:"small"},{default:l(()=>[u(" Descargar Factura "),n(Ae,{end:"",icon:"tabler-arrow-down"})]),_:1})]),a("div",null,[(b(),g("svg",Ue,Oe))])])]}),_:1}),He,n(x,null,{default:l(()=>[a("div",Je,[n(A,null,{default:l(()=>[u("Estado")]),_:1}),n(C,null,{default:l(()=>[n(Q,{color:f.value.transaction.status_detail===3?"success":"error"},{default:l(()=>[u(d($(f.value.transaction.status_detail).msj),1)]),_:1},8,["color"])]),_:1})])]),_:1}),n(x,null,{default:l(()=>[a("div",Ke,[n(A,null,{default:l(()=>[u("ID")]),_:1}),n(C,null,{default:l(()=>{var e;return[u(d(((e=f.value.transaction)==null?void 0:e.id)||"N/A"),1)]}),_:1})])]),_:1}),n(x,null,{default:l(()=>[a("div",Qe,[n(A,null,{default:l(()=>[u("Producto")]),_:1}),n(C,null,{default:l(()=>{var e;return[u(d(((e=f.value.paquete)==null?void 0:e.nombre)||"N/A"),1)]}),_:1})])]),_:1}),f.value.user?(b(),g("div",Ze,[n(x,null,{default:l(()=>[a("div",Ge,[n(A,null,{default:l(()=>[u("Nombres")]),_:1}),n(C,null,{default:l(()=>{var e,s;return[u(d((e=f.value.user)==null?void 0:e.first_name)+" "+d((s=f.value.user)==null?void 0:s.last_name),1)]}),_:1})])]),_:1}),n(x,null,{default:l(()=>[a("div",We,[n(A,null,{default:l(()=>[u("Email")]),_:1}),n(C,null,{default:l(()=>{var e;return[u(d((e=f.value.user)==null?void 0:e.email),1)]}),_:1})])]),_:1})])):j("",!0)]),_:1})]),_:1}),n(Ce,null,{default:l(()=>[n(W),n(P,{color:"blue darken-1",text:"",onClick:t[3]||(t[3]=e=>E.value=!1)},{default:l(()=>[u("Cerrar")]),_:1})]),_:1})]),_:1})):j("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}};export{na as default};
