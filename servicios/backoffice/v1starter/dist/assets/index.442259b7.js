import{M as oe,r as i,v as ne,as as re,o as r,x as c,a as s,w as o,h as q,aR as ie,q as v,b2 as de,c as h,Z as ce,b3 as ue,F as E,C as U,b4 as ve,b5 as pe,t as m,b6 as me,b as l,n as M,b0 as _e,p as k,aq as fe,g as G,b1 as he,N as K,l as ge,aM as ye,a3 as I,aW as H,L as ke,u as Ve,a_ as be,a$ as xe,f as Q,bb as j,bc as Ce,bd as we,be as Te}from"./index.88d3c7f5.js";import{V as $e}from"./VPagination.9412c3b8.js";import{V as Ee}from"./VAlert.3e8ed100.js";const _=V=>(we("data-v-70ec56df"),V=V(),Te(),V),Ue={key:0},Ie={class:"headerOpciones my-3"},Se={class:"hoItems"},Ne={class:"d-flex gap-4 align-center"},Pe={key:0,class:"mt-4"},ze=_(()=>l("h3",null,"Usuarios seleccionados para guardar:",-1)),Le={key:1,style:{height:"400px"},class:"d-flex align-center justify-center"},Be={key:2},De=_(()=>l("thead",null,[l("tr",null,[l("th",{scope:"col"},"USUARIO"),l("th",{scope:"col"},"CORREO")])],-1)),qe=["onClick"],je={class:"text-medium-emphasis"},Oe={key:0},Re=_(()=>l("div",{class:"row-cr"},[l("div",null," Nombres ")],-1)),We=[Re],Ae=_(()=>l("div",{class:"row-cr"},[l("div",null,"Correo")],-1)),Fe=[Ae],Me=_(()=>l("div",{class:"row-cr"},[l("div",null,"Telefono")],-1)),Ge=[Me],Ke=_(()=>l("th",{scope:"col"},"Acciones",-1)),He={key:0},Qe=_(()=>l("tr",null,[l("td",{colspan:"5"},[l("p",null,"No hay datos para mostrar")])],-1)),Ze=[Qe],Je={key:1},Xe={class:"text-sm"},Ye={class:"text-sm"},ea={class:"text-base"},aa={class:"text-center",style:{width:"5rem"}},la={__name:"index",setup(V){const p=i([]),S=i([]),b=i(""),g=i(!1),N=i(""),x=i(!1),C=i(null),Z=i({id:"",name:"",surname:"",email:"",telephone:""}),J=i(""),X=async()=>{try{const t=await j.get("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador/ganador/listar_backoffice.php");p.value=t.data,S.value=p.value.map(e=>e.name),S.value.length>0&&(J.value=S.value[0])}catch(t){console.error("Error fetching data:",t)}},O=t=>{if(!b.value)return t;const e=b.value.toLowerCase();return t.filter(n=>n.name.toLowerCase().includes(e)||n.surname.toLowerCase().includes(e)||n.email.toLowerCase().includes(e)||n.id.includes(e))},Y=t=>{N.value=t},ee=async()=>{const t=p.value.find(e=>e.name===N.value);if(t&&u.value.length>0){const e=u.value.map(n=>({id:n.wylexId,name:n.first_name,surname:n.last_name,email:n.email,telephone:n.phone||""}));t.winners=[...t.winners,...e];try{const n=await j.post("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador/ganador/add.php",p.value,{headers:{"Content-Type":"application/json"}});W(),g.value=!1,z.value=!0}catch(n){console.error("Error sending data:",n)}Z.value={id:"",name:"",surname:"",email:"",telephone:""}}},ae=async(t,e)=>{if(confirm("\xBFEst\xE1s seguro de que quieres eliminar este ganador?")){const n=p.value.find(d=>d.name===t);x.value=!0,C.value=null;try{if(n){n.winners=n.winners.filter(d=>d.id!==e);try{const d=await j.post("https://estadisticas.ecuavisa.com/sites/gestor/Tools/ecuavisados/ganador/ganador/add.php",p.value,{headers:{"Content-Type":"application/json"}})}catch(d){console.error("Error al eliminar ganador:",d)}}x.value=!1}catch(d){console.error("Error al eliminar ganador:",d),C.value="Hubo un error al eliminar el ganador. Por favor, intenta de nuevo.",x.value=!1}}},w=i(""),f=i([]),P=i(!1),z=i(!1),L=i(!1),T=i([]),y=i(1),B=i(5),$=i(0),le=ne(()=>Math.ceil($.value/B.value)),u=i([]),R=t=>{t&&t.preventDefault(),T.value[0]=!0,y.value=1,f.value=[],A()},W=()=>{w.value="",f.value=[],u.value=[]},A=async()=>{L.value=!0;try{const e=await(await fetch(`https://ads-service.vercel.app/busqueda/user/?s=${w.value}&page=${y.value}&limit=${B.value}`)).json();e.resp?(f.value=e.data,$.value=e.total):(f.value=[],$.value=0,P.value=!0)}catch(t){console.error("Error al realizar la b\xFAsqueda:",t)}finally{L.value=!1,T.value[0]=!1}},F=t=>{const e=u.value.findIndex(n=>n._id===t._id);e===-1?u.value.push(t):u.value.splice(e,1)},te=t=>{y.value=t,A()};return re(()=>{X()}),(t,e)=>{const n=Ce;return r(),c("section",null,[s(G,{class:"mt-5"},{default:o(()=>[s(q,null,{default:o(()=>[s(ie,null,{default:o(()=>[v(" Listado de ganadores ")]),_:1}),s(de,null,{default:o(()=>[v("Gesti\xF3n de los ganadores por semana")]),_:1}),p.value.length==0?(r(),c("div",Ue,"Cargando...")):(r(),h(ce,{key:1,class:"card-list mt-4"},{default:o(()=>[s(ue,{variant:"accordion"},{default:o(()=>[(r(!0),c(E,null,U(p.value,(d,se)=>(r(),h(ve,{key:se},{default:o(()=>[s(pe,{class:"text-uppercase text-primary"},{default:o(()=>[v(m(d.name),1)]),_:2},1024),s(me,null,{default:o(()=>[l("div",Ie,[l("div",Se,[s(M,{style:{width:"200px"},modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),s(_e,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),width:"500"},{activator:o(({props:a})=>[s(k,fe({onClick:D=>Y(d.name)},a,{color:"success"}),{default:o(()=>[v(" Agregar ganador ")]),_:2},1040,["onClick"])]),default:o(()=>[s(n,{onClick:e[1]||(e[1]=a=>g.value=!g.value)}),s(G,{title:`Agregar ganador de la ${N.value}`},{default:o(()=>[s(q,null,{default:o(()=>[l("div",Ne,[s(M,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),onKeyup:e[3]||(e[3]=he(a=>R(a),["enter"])),style:{"max-width":"400px"},label:"Buscar..."},null,8,["modelValue"]),s(k,{loading:T.value[0],disabled:T.value[0],color:"primary",size:"small",icon:"tabler-search",onClick:R},null,8,["loading","disabled"]),s(k,{color:"secondary",variant:"text",size:"small",onClick:W},{default:o(()=>[s(K,{start:"",icon:"tabler-restore"}),v(" Resetear ")]),_:1})]),s(ge,{ref_for:!0,ref:"form"},{default:o(()=>[u.value.length>0?(r(),c("div",Pe,[ze,(r(!0),c(E,null,U(u.value,a=>(r(),h(ye,{key:a._id,class:"ma-1",color:"success",closable:"","onClick:close":D=>F(a)},{default:o(()=>[v(m(a.last_name+" "+a.first_name),1)]),_:2},1032,["onClick:close"]))),128))])):I("",!0),L.value?(r(),c("div",Le," Cargando...")):f.value.length>0?(r(),c("div",Be,[s(H,{style:{width:"100%"},class:"text-no-wrap tableNavegacion mb-5 mt-5",hover:"true"},{default:o(()=>[De,l("tbody",null,[(r(!0),c(E,null,U(f.value,a=>(r(),c("tr",{key:a._id,class:ke({"opacity-50":t.userClicked&&t.userClickedId===a.wylexId}),onClick:D=>F(a)},[l("td",null,m((a.last_name+" "+a.first_name).length>25?(a.last_name+" "+a.first_name).substring(0,25)+"...":a.last_name+" "+a.first_name),1),l("td",je,m(a.email),1)],10,qe))),128))])]),_:1}),$.value>B.value?(r(),h($e,{key:0,modelValue:y.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>y.value=a),te],size:"small","total-visible":5,length:Ve(le)},null,8,["modelValue","length"])):I("",!0)])):I("",!0)]),_:1},512)]),_:1}),s(q,{class:"d-flex justify-end"},{default:o(()=>[u.value.length===0?(r(),c("div",Oe)):(r(),h(k,{key:1,size:"small",onClick:ee,disabled:u.value.length===0},{default:o(()=>[v("Guardar")]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["title"])]),_:2},1032,["modelValue"])]),s(H,{class:"text-no-wrap tabla_ganadores"},{default:o(()=>[l("thead",null,[l("tr",null,[l("th",{scope:"col",class:"col-cr",title:"click para ordenar",onClick:e[6]||(e[6]=a=>t.sortTable("first_name"))},We),l("th",{scope:"col",class:"col-cr",title:"click para ordenar",onClick:e[7]||(e[7]=a=>t.sortTable("provider"))},Fe),l("th",{scope:"col",class:"col-cr",title:"click para ordenar",onClick:e[8]||(e[8]=a=>t.sortTable("created_at"))},Ge),Ke])]),O(d.winners).length==0?(r(),c("tfoot",He,Ze)):(r(),c("tbody",Je,[(r(!0),c(E,null,U(O(d.winners),a=>(r(),c("tr",{class:"listadoGen",key:a.id,style:{height:"3.75rem"}},[l("td",null,[l("span",Xe,m(a.name),1)]),l("td",null,[l("span",Ye,m(a.email),1)]),l("td",null,[l("span",ea,m(a.telephone),1)]),l("td",aa,[s(k,{icon:"",size:"x-small",color:"default",variant:"text",onClick:D=>ae(d.name,a.id)},{default:o(()=>[s(K,{size:"22",color:"error",icon:"tabler-trash"})]),_:2},1032,["onClick"]),C.value?(r(),h(Ee,{key:0,type:"error",class:"mt-4"},{default:o(()=>[v(m(C.value),1)]),_:1})):I("",!0),s(be,{"model-value":x.value,class:"align-center justify-center"},{default:o(()=>[s(xe,{indeterminate:"",size:"64"})]),_:1},8,["model-value"])])]))),128))]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}))]),_:1})]),_:1}),s(Q,{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=d=>P.value=d),location:"top",color:"error"},{default:o(()=>[v(" No se han encontrado resultados ")]),_:1},8,["modelValue"]),s(Q,{modelValue:z.value,"onUpdate:modelValue":e[10]||(e[10]=d=>z.value=d),location:"top",color:"success"},{default:o(()=>[v(" Informaci\xF3n guardada con \xE9xito ")]),_:1},8,["modelValue"])])}}},na=oe(la,[["__scopeId","data-v-70ec56df"]]);export{na as default};
