import{M as Ie,R as Ne,S as Ae,U as ke,r as h,v as te,as as He,o as Y,x as M,a as o,w as n,q as b,t as p,u as m,f as Re,e as O,g as U,h as T,aQ as Q,aR as q,b2 as Oe,i as ae,a3 as Ue,b as u,n as Pe,p as C,c as P,aW as le,F as B,C as L,L as se,bD as oe,ao as ne,ap as re,a2 as Be,V as Le,a4 as Ee,aX as $e,bd as je,be as ze}from"./index.88d3c7f5.js";/* empty css                                                                       */import{V as ie,a as ce}from"./VTimelineItem.36b36f8a.js";const ue=I=>(je("data-v-7851bff3"),I=I(),ze(),I),Je={key:0,class:"date-picker-wrapper",style:{width:"300px"}},Qe={style:{width:"20rem"}},qe=ue(()=>u("thead",null,[u("tr",null,[u("th",{scope:"col"},"T\xCDTULO DE P\xC1GINA"),u("th",{scope:"col"},"VISITAS")])],-1)),We=["onClick"],Ge={class:"text-medium-emphasis"},Xe={class:"d-flex align-center justify-space-between botonescurrentPage",id:"target"},Ze={style:{display:"flex","flex-wrap":"wrap"}},Ke={style:{width:"max-content"}},et={style:{"margin-left":"auto","margin-top":"1rem","margin-bottom":"1rem"}},tt=ue(()=>u("thead",null,[u("tr",null,[u("th",{scope:"col"},"Nombre"),u("th",{scope:"col"},"Fecha"),u("th",{scope:"col"},"Cantidad"),u("th",{scope:"col"},"Hora")])],-1)),at=["onClick"],lt={class:"text-high-emphasis"},st={class:"text-medium-emphasis"},ot={class:"text-medium-emphasis"},nt={class:"text-medium-emphasis"},rt={class:"d-flex justify-space-between align-center flex-wrap"},it={class:"text-base font-weight-semibold me-1"},ct={class:"d-flex justify-space-between align-center"},ut={class:"d-flex justify-space-between align-center flex-wrap"},dt={class:"text-base font-weight-semibold me-1"},ft={class:"mt-0 mb-0"},mt={style:{"font-size":"10px","font-style":"italic"}},ht={__name:"notas-loultimo",setup(I){const D=Ne.exports.extendMoment(Ae);D.locale("es",[ke]);const W=h(""),G=h(""),N=h(""),A=h(!1),k=h([]),w=h([]),g=h(1),H=8,E=h([]),de=te(()=>w.value.length),$=h(""),j=h([]),z=h(!1),X=h([]),fe=h(""),J=h([]),R=h(!1),Z=h(""),x=h(""),K=h(null),ee=h(null);h(D().format("DD/MM/YYYY HH:mm:ss").toString()),h(JSON.parse(localStorage.getItem("userData")));const F=h({message:"Datos guardados",type:"success",model:!1});async function me(s="",a=""){A.value=!0;const r=[];var e=new Headers;e.append("Content-Type","application/json");var d=JSON.stringify({fechai:s,fechaf:a}),c={method:"POST",headers:e,body:d,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/seccion/full/Lo-ultimo",c).then(t=>t.json()).then(t=>{let l=Array.from(t.data);l.forEach(i=>{E.value.push(i)});for(const i of l)for(const f of i.navigationRecord){let _={title:f.title,url:f.url};r.push(_)}}).catch(t=>{F.value={message:"No se pudo recuperar los registros de lo \xFAltimo, por favor intente nuevamente.",type:"error",timeout:4e3,model:!0},console.error(t)});const v=r.reduce((t,l)=>{var i=t.findIndex(f=>f.title==l.title||f.url==l.url);return i===-1?t.push({url:l.url,title:l.title,count:1}):t[i].count++,t},[]);k.value=Array.from(v),k.value.sort((t,l)=>l.count-t.count),w.value=Array.from(v),w.value.sort((t,l)=>l.count-t.count),A.value=!1}async function he(s){try{if(s.length>1){g.value=1;let a=D(s[0]).format("MM/DD/YYYY"),r=D(s[1]).format("MM/DD/YYYY");W.value=a,G.value=r,await me(a,r)}}catch(a){console.error(a)}}const ve=te(()=>{const s=(g.value-1)*H,a=s+H;return w.value.slice(s,a)}),pe=()=>{g.value*H<w.value.length&&g.value++},_e=()=>{g.value>1&&g.value--},Ye=()=>{let s=D().subtract(7,"days").format("DD-MM-YYYY").toString(),a=D().format("DD-MM-YYYY").toString();W.value=s,G.value=a,N.value=s+" a "+a};He(async()=>{Ye()});const ge=()=>{if(x.value!==""){g.value=1;const s=x.value.endsWith("/")?x.value.replace(/\/$/,"").trim():x.value.trim(),a=k.value.filter(r=>r.url.trim().includes(s));w.value=a}},De=()=>{g.value=1,x.value="",R.value=!1,z.value=!1,w.value=k.value},ye=s=>{$.value=s,K.value=s,R.value=!1,setTimeout(()=>{document.getElementById("target").scrollIntoView({behavior:"smooth"})},100);const a=E.value.map(({first_name:t,last_name:l,navigationRecord:i})=>({first_name:t,last_name:l,navigationRecord:i})),r=[];for(let t of a)for(let l of t.navigationRecord)if(l.title===s||l.url===s){var e=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],d=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let i=D(l.fecha,e,!0).format("DD/MM/YYYY"),f=l.hora.split(":");if(f[2].indexOf(" ")>=0){let S=f[2].split(" ");f[2]=S[0]}let _=f[0]+":"+f[1]+":"+f[2],y=i+" "+_,V=D(y,d,!0).format();if(t.first_name!==void 0&&t.last_name!==void 0&&t.first_name!==null&&t.last_name!==null&&t.first_name!==""&&t.last_name!==""){let S={first_name:t.first_name,last_name:t.last_name,url:l.url,title:l.title,fecha:i,fechaRaw:l.fecha,fullFecha:V,hora:_,horaRaw:l.hora};r.push(S)}}let c={};r.forEach(t=>{let l=t.first_name+"-"+t.last_name;c.hasOwnProperty(l)?(new Date(t.fullFecha)>new Date(c[l].fullFecha)&&(c[l]=t),c[l].cantidad=(c[l].cantidad||1)+1):(t.cantidad=1,c[l]=t)});let v=Object.values(c);v.sort((t,l)=>{var i=new Date(t.fullFecha),f=new Date(l.fullFecha);return f-i}),j.value=v.slice(0,25),X.value=j.value.map(({first_name:t,last_name:l,fecha:i,hora:f,cantidad:_,title:y,url:V})=>({first_name:t,last_name:l,fecha:i,hora:f,cantidad:_,title:y,url:V})),z.value=!0,fe.value=s};function be(s){for(var a=typeof s!="object"?JSON.parse(s):s,r="",e=0;e<a.length;e++){var d="";for(var c in a[e])d!=""&&(d+=","),d+=a[e][c];r+=d+`\r
`}return r}function we(s,a,r){s&&a[0].wylexId!=="wylexId"&&a.unshift(s);var e=JSON.stringify(a),d=be(e),c=r+".csv"||"export.csv",v=new Blob([d],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(v,c);else{var t=document.createElement("a");if(t.download!==void 0){var l=URL.createObjectURL(v);t.setAttribute("href",l),t.setAttribute("download",c),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}async function xe(){let s={first_name:"first_name",last_name:"last_name",fecha:"fecha",hora:"hora",cantidad:"cantidad",title:"title",url:"url"},a=[];a=Array.from(X.value);let r="lo_ultimo_ultimos_usuarios_"+$.value.replace(/[^A-Z0-9]+/ig,"_");Ee("export-notasLoultimo"),we(s,a,r)}function Me(s){const a=[];let r=null;return s.forEach((e,d)=>{d===0||e.title!==s[d-1].title?(r={title:e.title,url:e.url,fecha:e.fecha,hora:e.hora,fullFecha:e.fullFecha,data:[e]},a.push(r)):r.data.push(e)}),a}var Ve=function(s={}){const{data:a,index:r}=s;var e=[],d=J.value,c=d.length;for(var v in a){const t=`${a[v].fecha} ${a[v].hora}`,l=Se({fecha:t,indice:v,indiceDelTotal:r,dataTotal:d,tamanioTotal:c,dataActual:a,objectoActual:null}),i=`${l.tiempoTranscurrido}`;e.push({title:i,fechai:l.fechai,fechaf:l.fechaf})}return e};const Fe=(s,a)=>{ee.value=s;const r=E.value.map(({first_name:t,last_name:l,navigationRecord:i})=>({first_name:t,last_name:l,navigationRecord:i})),e=[];Z.value=s+" "+a;let d=s+" "+a;for(let t of r)if(t.first_name+" "+t.last_name==d)for(let i of t.navigationRecord){var c=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","M/D/YYYY","D/M/YYYY"],v=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let f=D(i.fecha,c,!0).format("DD/MM/YYYY"),_=i.hora.split(":");if(_[2].indexOf(" ")>=0){let Ce=_[2].split(" ");_[2]=Ce[0]}let y=_[0]+":"+_[1]+":"+_[2],V=f+" "+y,S=D(V,v,!0).format(),Te={first_name:t.first_name,last_name:t.last_name,url:i.url,title:i.title,fecha:f,fechaRaw:i.fecha,fullFecha:S,hora:y};e.push(Te)}e.sort((t,l)=>{var i=new Date(l.fullFecha),f=new Date(t.fullFecha);return f-i}),J.value=Me(e),R.value=!0};var Se=function(s={}){const{fecha:a,indice:r,dataActual:e,dataTotal:d,indiceDelTotal:c,tamanioTotal:v,objectoActual:t=null}=s,l=JSON.stringify(e),i=JSON.parse(l);if(i.length-1>r){const y=i[r*1+1],V=`${y.fecha} ${y.hora}`;return getTranscursoDeFechas(V,a,i[r],y)}var f={},_=null;return v-1>c&&(f=d[c*1+1],_=`${f.fecha} ${f.hora}`),v-1==c&&i.length-1==r?{tiempoTranscurrido:"Fin de la navegaci\xF3n",fechai:a,fechaf:null,tipo:""}:getTranscursoDeFechas(_,a,d[c],d[c*1+1])};return(s,a)=>{const r=$e;return Y(),M("section",null,[o(Re,{modelValue:m(F).model,"onUpdate:modelValue":a[0]||(a[0]=e=>m(F).model=e),location:"top end",variant:"flat",timeout:m(F).timeout||2e3,color:m(F).type},{default:n(()=>[b(p(m(F).message),1)]),_:1},8,["modelValue","timeout","color"]),o(Le,null,{default:n(()=>[o(O,{lg:"12",cols:"12"},{default:n(()=>[o(U,null,{default:n(()=>[o(T,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:n(()=>[o(Q,{class:"pb-sm-0"},{default:n(()=>[o(q,null,{default:n(()=>[b("P\xE1ginas m\xE1s vistas")]),_:1}),o(Oe,null,{default:n(()=>[b("Un total de "+p(m(de))+" registros",1)]),_:1})]),_:1}),m(A)?Ue("",!0):(Y(),M("div",Je,[o(r,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:m(N),"onUpdate:modelValue":a[1]||(a[1]=e=>ae(N)?N.value=e:null),"show-current":"true",onOnChange:he,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])),o(O,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:n(()=>[u("div",Qe,[o(Pe,{modelValue:m(x),"onUpdate:modelValue":a[2]||(a[2]=e=>ae(x)?x.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),o(C,{"prepend-icon":"tabler-search",onClick:ge},{default:n(()=>[b(" Buscar ")]),_:1}),o(C,{onClick:De},{default:n(()=>[b(" Reiniciar ")]),_:1})]),_:1})]),_:1}),m(A)?(Y(),P(T,{key:0},{default:n(()=>[b("Cargando datos...")]),_:1})):(Y(),P(T,{key:1},{default:n(()=>[o(le,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:n(()=>[qe,u("tbody",null,[(Y(!0),M(B,null,L(m(ve),e=>(Y(),M("tr",{class:se(["clickable",{active:e.title===m(K)}]),onClick:d=>ye(e.title||e.url)},[u("td",null,p(e.title?e.title:e.url),1),u("td",Ge,p(e.count),1)],10,We))),256))])]),_:1}),u("div",Xe,[o(C,{icon:"tabler-arrow-big-left-lines",onClick:_e,disabled:m(g)===1},null,8,["disabled"]),b(" P\xE1gina "+p(m(g))+" ",1),o(C,{icon:"tabler-arrow-big-right-lines",onClick:pe,disabled:m(g)*H>=m(w).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),o(O,{lg:"6",cols:"12",sm:"6"},{default:n(()=>[o(oe,null,{default:n(()=>[ne(o(U,null,{default:n(()=>[o(Q,{class:"pb-sm-0"},{default:n(()=>[u("div",Ze,[u("div",Ke,[o(q,null,{default:n(()=>[b("\xDAltimas visitas a la p\xE1gina "+p(m($)),1)]),_:1})]),u("div",et,[o(C,{color:"success",onClick:xe},{default:n(()=>[b(" Exportar ")]),_:1})])]),o(le,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:n(()=>[tt,u("tbody",null,[(Y(!0),M(B,null,L(m(j),e=>(Y(),M("tr",{key:e.first,class:se(["clickable",{active:e.first_name===m(ee)}]),onClick:d=>Fe(e.first_name,e.last_name,e.first)},[u("td",lt,p(e.first_name)+" "+p(e.last_name),1),u("td",st,p(e.fecha),1),u("td",ot,p(e.cantidad),1),u("td",nt,p(e.hora),1)],10,at))),128))])]),_:1})]),_:1})]),_:1},512),[[re,m(z)]])]),_:1})]),_:1}),o(O,{lg:"6",cols:"12",sm:"6"},{default:n(()=>[o(oe,null,{default:n(()=>[ne(o(U,null,{default:n(()=>[o(Q,null,{default:n(()=>[o(q,null,{default:n(()=>[b("Actividad del usuario "+p(m(Z)),1)]),_:1})]),_:1}),o(T,null,{default:n(()=>[o(ie,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:n(()=>[(Y(!0),M(B,null,L(m(J),(e,d)=>(Y(),P(ce,{"dot-color":"primary",size:"x-small"},{default:n(()=>[u("div",rt,[u("h4",it,p(e.title||e.url),1)]),o(U,{class:"",variant:"text"},{default:n(()=>[o(T,null,{default:n(()=>[u("div",ct,[o(ie,{side:"end",align:"start","truncate-line":"both",density:"compact",class:"v-timeline-density-compact timeline-2"},{default:n(()=>[(Y(!0),M(B,null,L(m(Ve)({data:e.data,index:d}),(c,v)=>(Y(),P(ce,{"dot-color":"info",size:"x-small"},{default:n(()=>[u("div",ut,[u("h4",dt,p(c.fechai),1)]),u("p",ft,p(c.title),1),o(Be),u("small",mt,p(c.fechai)+" "+p(c.fechaf?"hasta "+c.fechaf:""),1)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[re,m(R)]])]),_:1})]),_:1})]),_:1})])}}},Yt=Ie(ht,[["__scopeId","data-v-7851bff3"]]);export{Yt as default};
