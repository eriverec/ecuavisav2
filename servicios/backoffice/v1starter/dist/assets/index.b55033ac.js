import{r as i,I as Pe,v as q,as as He,z as Oe,o as d,x as w,a as e,w as l,g as F,h as I,c as b,a$ as Ie,N as E,b as s,t as T,a3 as P,bw as Ue,a_ as Ae,u as f,p as h,a2 as ne,Z as ue,F as L,C as Z,$ as De,a0 as Je,q as c,a1 as qe,b8 as K,b7 as Fe,ba as Q,V as Y,e as z,aT as Le,b3 as Me,b4 as $e,b5 as Re,aM as de,c7 as ee,b6 as je,aW as Be,n as ae,aq as ce,b9 as We,aX as Ge}from"./index.88d3c7f5.js";import{l as U}from"./lodash.ef907739.js";import Xe from"./StatusWidgetRadio.754e0f1a.js";import{V as Ze}from"./VBadge.0df54a63.js";import{V as Ke}from"./VNavigationDrawer.44422f4c.js";import{V as A}from"./VTooltip.2d0a8708.js";import{V as Qe}from"./VTextarea.86fae113.js";const Ye={class:"text-h6 guarda white--text mb-2"},ea={key:2,class:"text-body-2 guarda white--text mb-4 text-opacity-70"},aa={class:"custom-heading d-flex align-center justify-space-between"},la=s("div",null,[s("h6",{class:"text-h6 py-4 pl-4"}," Usuarios activos en configuraci\xF3n "),s("span",{class:"text-body-1"})],-1),oa={style:{padding:"1rem"}},ta=s("span",{class:"ms-4"},"Online",-1),sa={style:{padding:"1rem",border:"1px solid rgba(var(--v-theme-on-background), var(--v-disabled-opacity))","border-radius":"7px"}},ra={scope:"col",class:"d-flex gap-4 pb-4"},ia=s("tr",null,[s("th",{scope:"col",style:{width:"300px"}},"T\xEDtulo"),s("th",{scope:"col",style:{width:"170px"}},"Hora de inicio"),s("th",{scope:"col",style:{width:"170px"}},"Hora de fin"),s("th",{scope:"col",class:"d-flex gap-4 pb-4"})],-1),na={class:"py-4"},ua={class:"py-4"},da={class:"py-4"},ca={class:"py-4"},va={class:"d-flex gap-4 py-4"},ma={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},pa=s("span",null,"Este titular aparecer\xE1 en lugar del t\xEDtulo del programa sobre el reproductor",-1),fa={style:{width:"650px","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-3"},ga=s("span",null,"Este texto es el que aparece en el indicador que parpadea sobre el header",-1),ba={style:{display:"flex",margin:"1rem"}},ha={style:{"margin-left":"2rem"}},ya={class:"d-inline-block"},_a=s("div",null,[s("span",null,"Estado del player: ")],-1),Va={style:{"margin-left":"2rem"}},xa={style:{width:"100%","margin-top":"1rem","margin-bottom":"1rem"},class:"d-flex flex-row gap-2"},wa={class:"d-inline-block"},za={key:2,class:"d-inline-block boton-fija"},Oa={__name:"index",setup(Ea){const k=i("");i(!1);const ve=i(!1),u=i({estado:!1,titulo:"",label:""}),H=i({estado:!1,titulo:"",label:""}),M=i([]),$=i({value:"",estadoHtml:!1}),me=Pe(),R=i(!1),O=i("tab-detalles"),C=i(""),p=i([]),j=i([]),le=i(!1),D=i(null),v=i(!1),g=i(""),y=i(0);i(!1);const pe=i(""),fe=i(!1),_=i({value:"",estadoHtml:!1}),B=[{title:"Lunes",value:1},{title:"Martes",value:2},{title:"Mi\xE9rcoles",value:3},{title:"Jueves",value:4},{title:"Viernes",value:5},{title:"S\xE1bado",value:6},{title:"Domingo",value:0}],ge=async()=>{try{const a=await(await fetch("https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_radio.js")).text(),m=a.indexOf("{"),r=a.lastIndexOf("}"),t=a.substring(m,r+1);return JSON.parse(t)}catch(o){return console.error("Error cargando configuraci\xF3n:",o),null}},be=({step:o,progress:a})=>{switch(y.value=a,o){case 1:g.value="Guardando actualizaci\xF3n...",k.value="";break;case 2:g.value="Verificando cambios...",k.value="Esto puede tardar varios segundos";break;case 3:g.value="Finalizando actualizaci\xF3n...",k.value="";break}},oe=q(()=>!U.exports.isEqual(p.value,M.value)),te=q(()=>!U.exports.isEqual(u.value.estado,H.value.estado)||!U.exports.isEqual(u.value.titulo,H.value.titulo)||!U.exports.isEqual(u.value.label,H.value.label)),se=q(()=>!U.exports.isEqual(_.value.value,$.value.value)),he=async o=>{try{o.forzado&&(H.value=JSON.parse(JSON.stringify(o.forzado))),Array.isArray(o.horarios)&&(M.value=JSON.parse(JSON.stringify(o.horarios))),o.html&&($.value=JSON.parse(JSON.stringify(o.html))),g.value="Actualizaci\xF3n completada con \xE9xito",k.value="",y.value=100,await new Promise(a=>setTimeout(a,2e3)),v.value=!1}catch(a){console.error("Error actualizando datos locales:",a),re(a)}},ye=()=>{v.value=!1,le.value=!1,W(),g.value="La actualizaci\xF3n est\xE1 tomando m\xE1s tiempo de lo esperado",console.warn("Timeout en la actualizaci\xF3n")},re=o=>{v.value=!1,le.value=!1,g.value="Error en la actualizaci\xF3n",console.error("Error en la actualizaci\xF3n:",o),W()};async function W(){var o,a,m;R.value=!0;try{const r=await ge();if(!r)throw new Error("No se pudo cargar la configuraci\xF3n");console.log("Configuraci\xF3n cargada:",r),ve.value=((o=r.forzado)==null?void 0:o.estado)||!1,u.value=r.forzado||{estado:!1,titulo:"",label:""},H.value=JSON.parse(JSON.stringify(u.value)),p.value=Array.isArray(r.horarios)?[...r.horarios]:[],j.value=Array.isArray(r.horarios)?[...r.horarios]:[],M.value=JSON.parse(JSON.stringify(p.value)),pe.value=((a=r.html)==null?void 0:a.value)||"",fe.value=((m=r.html)==null?void 0:m.estadoHtml)||!1,_.value=r.html||{value:"",estadoHtml:!1},$.value=JSON.parse(JSON.stringify(_.value))}catch(r){console.error("Error al obtener configuraci\xF3n:",r)}R.value=!1}const _e=o=>({data_string:{html:{value:o.html.value||"",estadoHtml:o.html.estadoHtml||!1},forzado:{estado:o.forzado.estado||!1,titulo:o.forzado.titulo||"",label:o.forzado.label||""},horarios:o.horarios||[]}});async function G(o){try{const a=_e(o);if(!(await fetch("https://servicio-github-dynamic.vercel.app/live-web/radio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error("Error en la respuesta del servidor");return!0}catch(a){return console.error("Error al enviar datos:",a),!1}}async function Ve(){var o;v.value=!0,y.value=0,g.value="Iniciando actualizaci\xF3n...";try{const a={html:_.value,forzado:u.value,horarios:p.value};await G(a)?(o=D.value)==null||o.startMonitoring():v.value=!1}catch(a){console.error("Error al enviar:",a),v.value=!1}}async function xe(){var o;v.value=!0,y.value=0,g.value="Iniciando actualizaci\xF3n de player forzado...";try{const a={html:_.value,forzado:u.value,horarios:j.value};await G(a)?(o=D.value)==null||o.startMonitoring():v.value=!1}catch(a){console.error("Error al enviar datos de player:",a),v.value=!1}}async function we(){var o;v.value=!0,y.value=0,g.value="Actualizando c\xF3digo del reproductor...";try{const a={html:_.value,forzado:u.value,horarios:j.value};await G(a)?(o=D.value)==null||o.startMonitoring():v.value=!1}catch(a){console.error("Error al enviar nuevo c\xF3digo del reproductor:",a),v.value=!1}}const X=q(()=>{if(p.value&&p.value.length>0){const o=p.value.map(a=>a.dia);return B.filter(a=>!o.includes(a.value))}return B});function ze(o){const a=B.find(m=>o===m.value);return a?a.title:""}const Ee=()=>{if(C.value){let o={dia:C.value,estadoDia:!0,horas:[{tituloPrograma:"",estadoHorario:!0,inicio:"12:00",fin:"14:00"}]};p.value.push(o),C.value=""}},ke=o=>{p.value.splice(o,1)},Ce=o=>{let a={tituloPrograma:"",estadoHorario:!0,inicio:"12:00",fin:"14:00"};p.value[o].horas.push(a)},Ne=(o,a)=>{p.value[o].horas.splice(a,1)},Se=()=>{let o=localStorage.getItem("role");o!=="administrador"&&o!=="webmaster"&&me.push({path:"/pages/errors/not-authorized"})},J=i(!1),ie=localStorage.getItem("role"),N=i([]),Te=()=>{let a=JSON.parse(localStorage.getItem("userData")).email;const r=new Pusher("69f5e107f97ef8dcc25f",{cluster:"us2",forceTLS:!0,channelAuthorization:{paramsProvider:()=>({param1:a}),endpoint:"https://pusher-auth-mocha.vercel.app/pusher/auth"}}).subscribe("presence-configuracion");r.bind("pusher:subscription_succeeded",()=>r.members.each(t=>N.value.push({email:t.id}))),r.bind("pusher:member_added",t=>{N.value.push({email:t.id})}),r.bind("pusher:member_removed",t=>{const n=Array.from(N.value).findIndex(S=>S.email===t.id);n!==-1&&N.value.splice(n,1)})};return He(async()=>{console.log("Componente montado, iniciando carga...");try{await W(),console.log("Configuraci\xF3n cargada correctamente"),Te(),Se()}catch(o){console.error("Error en la inicializaci\xF3n:",o)}}),(o,a)=>{const m=Oe("PerfectScrollbar"),r=Ge;return d(),w("section",null,[e(Ae,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),class:"align-center justify-center",persistent:""},{default:l(()=>[e(F,{color:"primary",width:"300"},{default:l(()=>[e(I,{class:"text-center"},{default:l(()=>[y.value<100?(d(),b(Ie,{key:0,indeterminate:"",color:"white",class:"mb-4"})):(d(),b(E,{key:1,icon:"tabler-check",color:"white",size:"32",class:"mb-4"})),s("div",Ye,T(g.value),1),k.value?(d(),w("div",ea,T(k.value),1)):P("",!0),e(Ue,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),color:"white",height:"8",rounded:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Xe,{ref_key:"statusMonitor",ref:D,"asset-url":"https://cdn-ecuavisa.pages.dev/envivo/assets-dynamic/envivo_radio.js","poll-interval":2e3,"max-attempts":30,onProgress:be,onSuccess:he,onTimeout:ye,onError:re},null,512),f(ie)=="administrador"?(d(),b(h,{key:0,icon:"",size:"small",class:"app-custom-toggler rounded-s-lg rounded-0",style:{"z-index":"1001"},onClick:a[2]||(a[2]=t=>J.value=!0)},{default:l(()=>[e(E,{icon:"tabler-users"})]),_:1})):P("",!0),f(ie)=="administrador"?(d(),b(Ke,{key:1,modelValue:J.value,"onUpdate:modelValue":a[4]||(a[4]=t=>J.value=t),temporary:"",location:"end",width:"400",scrim:!1,class:"app-customizer"},{default:l(()=>[s("div",aa,[la,e(h,{icon:"",variant:"text",color:"secondary",size:"x-small",onClick:a[3]||(a[3]=t=>J.value=!1)},{default:l(()=>[e(E,{icon:"tabler-x",size:"20"})]),_:1})]),e(ne),s("div",oa,[e(m,{tag:"ul",options:{wheelPropagation:!1}},{default:l(()=>[e(ue,{lines:"two",border:""},{default:l(()=>[(d(!0),w(L,null,Z(N.value,(t,V)=>(d(),w(L,{key:t.email},[e(De,null,{default:l(()=>[e(Je,null,{default:l(()=>[c(T(t.email),1)]),_:2},1024),e(qe,{class:"mt-1"},{default:l(()=>[e(Ze,{dot:"",location:"start center","offset-x":"2",color:"success",class:"me-3"},{default:l(()=>[ta]),_:1})]),_:1})]),_:2},1024),V!==N.value.length-1?(d(),b(ne,{key:0})):P("",!0)],64))),128))]),_:1})]),_:1})])]),_:1},8,["modelValue"])):P("",!0),e(Fe,{modelValue:O.value,"onUpdate:modelValue":a[5]||(a[5]=t=>O.value=t),class:"v-tabs-pill"},{default:l(()=>[e(K,{value:"tab-config"},{default:l(()=>[c("Configuraci\xF3n de Horarios")]),_:1}),e(K,{value:"tab-forzado"},{default:l(()=>[c("Player Forzado")]),_:1}),e(K,{value:"tab-embed"},{default:l(()=>[c("C\xF3digo del reproductor")]),_:1})]),_:1},8,["modelValue"]),e(We,{modelValue:O.value,"onUpdate:modelValue":a[12]||(a[12]=t=>O.value=t)},{default:l(()=>[e(Q,{value:"tab-config"},{default:l(()=>[e(F,{class:"mt-5",title:"Configuraci\xF3n de los horarios"},{default:l(()=>[R.value?(d(),b(I,{key:0},{default:l(()=>[c(" Cargando configuraci\xF3n... ")]),_:1})):(d(),b(I,{key:1,class:"py-4 gap-0 w-100"},{default:l(()=>[e(Y,null,{default:l(()=>[e(z,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[e(z,{cols:"4"},{default:l(()=>[e(Le,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=t=>C.value=t),items:f(X),disabled:f(X).length===0,label:"D\xEDa de la semana"},null,8,["modelValue","items","disabled"])]),_:1}),e(z,{cols:"6",class:"d-flex gap-4"},{default:l(()=>[e(h,{color:"primary",onClick:a[7]||(a[7]=t=>Ee()),disabled:f(X).length===0||!C.value},{default:l(()=>[c(" A\xF1adir d\xEDa ")]),_:1},8,["disabled"])]),_:1})]),_:1}),e(z,{cols:"12"},{default:l(()=>[e(ue,{class:"card-list"},{default:l(()=>[e(Me,{variant:"accordion",multiple:""},{default:l(()=>[(d(!0),w(L,null,Z(p.value,(t,V)=>(d(),b($e,{key:V},{default:l(()=>[e(Re,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:l(()=>[s("h3",null,T(ze(t.dia)),1),e(de,{color:t.estadoDia?"success":"warning",class:"mr-4"},{default:l(()=>[c(T(t.estadoDia?"Activo":"Inactivo"),1)]),_:2},1032,["color"]),e(ee,{modelValue:t.estadoDia,"onUpdate:modelValue":n=>t.estadoDia=n,color:"success",label:t.estadoDia?"D\xEDa activo":"D\xEDa inactivo"},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),e(je,{class:"d-flex flex-wrap justify-space-between"},{default:l(()=>[s("div",sa,[e(Be,{class:"w-full"},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",ra,[e(h,{color:"primary",onClick:n=>Ce(V)},{default:l(()=>[c(" A\xF1adir hora ")]),_:2},1032,["onClick"]),e(h,{style:{"margin-left":"0.5rem"},color:"error",onClick:n=>ke(V)},{default:l(()=>[c(" Eliminar d\xEDa ")]),_:2},1032,["onClick"])])]),ia]),s("tbody",null,[(d(!0),w(L,null,Z(t.horas.sort((n,S)=>n.inicio.localeCompare(S.inicio)),(n,S)=>(d(),w("tr",{key:S},[s("td",na,[e(ae,{modelValue:n.tituloPrograma,"onUpdate:modelValue":x=>n.tituloPrograma=x,label:"T\xEDtulo del horario",placeholder:"Escriba el t\xEDtulo...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ua,[e(r,{modelValue:n.inicio,"onUpdate:modelValue":x=>n.inicio=x,label:"Hora Inicio",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",da,[e(r,{modelValue:n.fin,"onUpdate:modelValue":x=>n.fin=x,label:"Hora Fin",config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ca,[s("div",va,[e(ee,{modelValue:n.estadoHorario,"onUpdate:modelValue":x=>n.estadoHorario=x,color:"success",label:n.estadoHorario?"Horario activo":"Horario inactivo"},null,8,["modelValue","onUpdate:modelValue","label"]),t.horas.length>1?(d(),b(h,{key:0,color:"error",onClick:x=>Ne(V,S)},{default:l(()=>[e(E,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):P("",!0)])])]))),128))])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1}),e(Q,{value:"tab-forzado"},{default:l(()=>[e(F,{class:"mt-5",title:"Player Forzado",subtitle:"Para transmisiones emergentes, este m\xF3dulo permitir\xE1 activar el reproductor de forma forzada"},{default:l(()=>[e(I,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(Y,null,{default:l(()=>[e(z,{cols:"8"},{default:l(()=>[s("div",ma,[e(ae,{modelValue:u.value.titulo,"onUpdate:modelValue":a[8]||(a[8]=t=>u.value.titulo=t),label:"T\xEDtulo sobre el player",placeholder:"Escriba el t\xEDtulo que mostrar\xE1 sobre el reproductor...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(A,{location:"top"},{activator:l(({props:t})=>[e(E,ce(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[pa]),_:1})]),s("div",fa,[e(ae,{modelValue:u.value.label,"onUpdate:modelValue":a[9]||(a[9]=t=>u.value.label=t),label:"Texto del Indicador",placeholder:"Escriba el texto que deseas en el indicador parpadeante...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"]),e(A,{location:"top"},{activator:l(({props:t})=>[e(E,ce(t,{size:"30",icon:"tabler-alert-circle"}),null,16)]),default:l(()=>[ga]),_:1})])]),_:1}),e(z,{cols:"4",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",ba,[s("div",null,[e(ee,{modelValue:u.value.estado,"onUpdate:modelValue":a[10]||(a[10]=t=>u.value.estado=t),color:"success",label:u.value.estado?"Activo":"Inactivo"},null,8,["modelValue","label"])]),s("div",ha,[s("div",ya,[e(h,{color:"primary",onClick:xe,disabled:!f(te)},{default:l(()=>[c(" ENVIAR ")]),_:1},8,["disabled"]),e(A,{activator:"parent",location:"top","open-on-hover":!f(te)},{default:l(()=>[c(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])])])]),_:1}),e(z,{cols:"12",style:{display:"flex","align-items":"center"}},{default:l(()=>[_a,s("div",Va,[e(de,{color:u.value.estado?"success":"warning",class:"mr-4"},{default:l(()=>[c(T(u.value.estado?"Activo":"Inactivo"),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,{value:"tab-embed"},{default:l(()=>[e(F,{class:"mt-5",title:"Embed player",subtitle:"Proporciona el c\xF3digo HTML del reproductor que presentar\xE1 embebido en la seccion de audio"},{default:l(()=>[e(I,{class:"py-4 gap-0 w-100"},{default:l(()=>[e(Y,null,{default:l(()=>[e(z,{cols:"12",style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},{default:l(()=>[s("div",xa,[e(Qe,{modelValue:_.value.value,"onUpdate:modelValue":a[11]||(a[11]=t=>_.value.value=t),label:"C\xF3digo",placeholder:"Escriba el c\xF3digo html del reproductor...",class:"ms-0 me-1 chat-list-search","auto-grow":""},null,8,["modelValue"])]),s("div",wa,[e(h,{color:"primary",class:"text-uppercase",onClick:we,disabled:!f(se)},{default:l(()=>[c(" ENVIAR ")]),_:1},8,["disabled"]),e(A,{activator:"parent",location:"top","open-on-hover":!f(se)},{default:l(()=>[c(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),O.value==="tab-config"?(d(),w("div",za,[e(h,{rounded:"pill",color:"success",onClick:Ve,disabled:!f(oe)},{default:l(()=>[e(E,{size:"30",icon:"tabler-device-floppy"})]),_:1},8,["disabled"]),e(A,{activator:"parent",location:"top","open-on-hover":!f(oe)},{default:l(()=>[c(" No hay cambios que guardar ")]),_:1},8,["open-on-hover"])])):P("",!0)])}}};export{Oa as default};
