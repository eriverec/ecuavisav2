import{l as w}from"./lodash.ef907739.js";import{r as u,bz as x}from"./index.88d3c7f5.js";const E={__name:"StatusWidgetRadio",props:{assetUrl:{type:String,required:!0},pollInterval:{type:Number,default:2e3},maxAttempts:{type:Number,default:30}},emits:["progress","success","error","timeout"],setup(g,{expose:m,emit:t}){const a=g,l=u(null),n=u(0),o=u(null),i=async r=>{try{const s=await fetch(r);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const c=await s.text(),p=c.indexOf("{"),f=c.lastIndexOf("}");if(p===-1||f===-1)throw new Error("No se encontr\xF3 el objeto de configuraci\xF3n");const d=c.substring(p,f+1);try{return JSON.parse(d)}catch{return new Function(`return ${d}`)()}}catch(s){throw s}},v=async()=>{n.value=0;try{l.value=await i(a.assetUrl),t("progress",{step:1,message:"Guardando cambios...",progress:33}),o.value=setInterval(async()=>{if(n.value++,t("progress",{step:2,message:"Verificando cambios...",progress:66}),n.value>a.maxAttempts){e(),t("timeout");return}try{const r=await i(a.assetUrl);w.exports.isEqual(l.value,r)||(e(),t("progress",{step:3,message:"Cambios verificados",progress:100}),t("success",r))}catch(r){e(),t("error",r)}},a.pollInterval)}catch(r){t("error",r)}},e=()=>{o.value&&(clearInterval(o.value),o.value=null)};return x(()=>{e()}),m({startMonitoring:v,stopMonitoring:e}),()=>{}}};export{E as default};
