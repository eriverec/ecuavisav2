import{M as W,r as _,as as G,v as H,o as f,c as b,w as o,a as l,e as j,g as A,h as y,aR as D,q as m,u,aW as F,b as a,x as C,F as E,C as L,t as p,a2 as K,p as k,bD as X,ao as Y,aQ as O,ap as Z,a3 as ee,V as te,bd as ae,be as se}from"./index.88d3c7f5.js";const U=g=>(ae("data-v-c6897bcc"),g=g(),se(),g),oe=U(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"T\xEDtulo"),a("th",{scope:"col"},"Usuarios suscritos")])],-1)),le=["onClick"],re={class:"px-4 py-4"},ne={class:"px-2"},ue={style:{display:"flex","flex-wrap":"wrap"}},ie={style:{"margin-right":"auto"}},ce={style:{"margin-left":"auto"}},de=U(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Nombre"),a("th",{scope:"col"},"Email"),a("th",{scope:"col"},"N\xFAmero de tel\xE9fono")])],-1)),_e={__name:"index",setup(g){const x=_([]);_([]);const h=_(1),V=_(10),S=_(1),I=_(!0),B=_(!1),N=_(""),w=_([]),T=_(!0);async function M(){return await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/sendpulse/mirrorAutores.php").then(e=>e.json()).then(e=>e)}async function P(){return await fetch("https://ecuavisa-temas.vercel.app/temas/full").then(e=>e.json()).then(e=>e)}async function R(){I.value=!0;const s=await M(),e=await P(),t=[];for(let n in s){let c=s[n].listid,d={titulo:s[n].titulo,usuarios:[]};for(let r in e){let i=e[r].usuario.Temas.find(v=>v.idMeta==c);if(i){let v={nombre:e[r].usuario.name,id:e[r].usuario.id,tema:i};d.usuarios.push(v)}}t.push(d)}x.value=t,I.value=!1}G(R);const $=H(()=>{const s=(h.value-1)*V.value,e=s+V.value;let t=x.value.slice(s,e);return S.value=Math.ceil(x.value.length/V.value),t});async function z(s){T.value=!0;let e=Object.create(s);N.value=e.titulo;let t=Array.from(e.usuarios);const n=[];for(let c in t){let d=t[c].id;if(d){const r=await fetch(`https://data.mongodb-api.com/app/backoffice1-usyys/endpoint/id?id=${d}`).then(v=>v.json()).catch(v=>console.log(v));let i={wylexId:r.wylexId,created_at:r.created_at,first_name:r.first_name,last_name:r.last_name,phone_number:r.phone_number,email:r.email,site:r.site};n.push(i)}}w.value=n,B.value=!0,T.value=!1}function J(s){for(var e=typeof s!="object"?JSON.parse(s):s,t="",n=0;n<e.length;n++){var c="";for(var d in e[n])c!=""&&(c+=","),c+=e[n][d];t+=c+`\r
`}return t}function q(s,e,t){s&&e[0].wylexId!=="wylexId"&&e.unshift(s);var n=JSON.stringify(e),c=J(n),d=t+".csv"||"export.csv",r=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,d);else{var i=document.createElement("a");if(i.download!==void 0){var v=URL.createObjectURL(r);i.setAttribute("href",v),i.setAttribute("download",d),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}}function Q(){let s={wylexId:"wylexId",created_at:"created",first_name:"first_name",last_name:"last_name",phone_number:"phone_number",email:"email",site:"site"},e=[];e=Array.from(w.value);let t="users_"+N.value.replace(/ /g,"_");q(s,e,t)}return(s,e)=>(f(),b(te,null,{default:o(()=>[l(j,{cols:"12"},{default:o(()=>[l(A,null,{default:o(()=>[l(y,null,{default:o(()=>[l(D,null,{default:o(()=>[m("Newsletter")]),_:1}),u(I)?(f(),b(y,{key:0},{default:o(()=>[m("Cargando datos...")]),_:1})):(f(),b(y,{key:1},{default:o(()=>[l(F,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:o(()=>[oe,a("tbody",null,[(f(!0),C(E,null,L(u($),t=>(f(),C("tr",{class:"clickable",onClick:n=>z(t)},[a("td",null,p(t.titulo),1),a("td",null,p(t.usuarios.length),1)],8,le))),256))])]),_:1}),l(K),a("div",re,[l(k,{disabled:u(h)===1,onClick:e[0]||(e[0]=t=>h.value-=1),size:"small",color:"primary"},{default:o(()=>[m(" Anterior ")]),_:1},8,["disabled"]),a("span",ne,p(u(h))+" de "+p(u(S))+" de un total de "+p(u(x).length)+" registros",1),l(k,{disabled:u(h)===u(S),onClick:e[1]||(e[1]=t=>h.value+=1),size:"small",color:"primary"},{default:o(()=>[m(" Siguiente ")]),_:1},8,["disabled"])])]),_:1}))]),_:1})]),_:1})]),_:1}),l(j,{cols:"12"},{default:o(()=>[l(X,null,{default:o(()=>[u(w).length>0?Y((f(),b(A,{key:0},{default:o(()=>[l(O,{class:"pb-sm-0"},{default:o(()=>[a("div",ue,[a("div",ie,[l(D,null,{default:o(()=>[m("Usuarios suscritos a "+p(u(N)),1)]),_:1})]),a("div",ce,[l(k,{color:"primary",onClick:Q},{default:o(()=>[m(" Exportar ")]),_:1})])])]),_:1}),l(O,{class:"pb-sm-0"},{default:o(()=>[u(T)?(f(),b(y,{key:0},{default:o(()=>[m("Cargando usuarios...")]),_:1})):(f(),b(y,{key:1},{default:o(()=>[l(F,{class:"text-no-wrap tableNavegacion mb-5"},{default:o(()=>[de,a("tbody",null,[(f(!0),C(E,null,L(u(w),t=>(f(),C("tr",null,[a("td",null,p(t.first_name)+" "+p(t.last_name),1),a("td",null,p(t.email),1),a("td",null,p(t.phone_number),1)]))),256))])]),_:1})]),_:1}))]),_:1})]),_:1},512)),[[Z,u(B)]]):ee("",!0)]),_:1})]),_:1})]),_:1}))}},pe=W(_e,[["__scopeId","data-v-c6897bcc"]]);export{pe as default};
