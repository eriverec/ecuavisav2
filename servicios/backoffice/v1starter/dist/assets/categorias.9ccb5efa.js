import{R as ae,S as le,U as se,ak as ce,r as d,as as ue,v as B,o as O,x as N,a,w as s,e as V,b as l,u as i,i as P,aT as pe,p as T,q as b,V as E,bx as fe,ao as me,ap as ve,aR as oe,t as m,aW as z,F as J,C as re,h as q,bP as j,aX as _e,I as he,bH as be,b7 as ge,b8 as X,g as G,b9 as xe,ba as Z,n as k,aM as ye,N as we,a2 as ee,b0 as Ve,aQ as te,l as Ce,m as Se,c7 as Ie,a4 as Te,bc as De}from"./index.88d3c7f5.js";import{u as Ue}from"./useCategoriasListStore.d4fa8b94.js";const Oe={class:"date-picker-wrapper",style:{width:"100%"}},Ne=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"Nombre"),l("th",{scope:"col"},"Email"),l("th",{scope:"col"},"N\xFAmero de tel\xE9fono")])],-1),$e={__name:"ChartInteresesAnalytics",setup(ie){const D=ae.exports.extendMoment(le);D.locale("es",[se]);const L=e=>{const r=`rgba(${j(e.colors["on-surface"])},${e.variables["medium-emphasis-opacity"]})`,t=`rgba(${j(e.colors["on-surface"])},${e.variables["disabled-opacity"]})`,o=`rgba(${j(String(e.variables["border-color"]))},${e.variables["border-opacity"]})`,p=`rgba(${j(e.colors["on-surface"])},${e.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:r,themeDisabledTextColor:t,themeBorderColor:o,themePrimaryTextColor:p}},u=ce(),g=d([]),x=d([]),{themeBorderColor:C,themeDisabledTextColor:S}=L(u.current.value),n=d([]),_=d(""),A=d(!1),y=d("");async function W(){await fetch("https://sugerencias-ecuavisa.vercel.app/interes/all").then(e=>e.json()).then(e=>{let r=e.data.filter(t=>t.estado==!0&&t.users_suscribed>0);g.value=r})}ue(async()=>{await W()});const Y=e=>{e.length>1&&(n.value=e)},$=B(()=>{let e,r=Array.from(n.value);if(r.length>0){let f=new Date(r[0]),h=new Date(r[1]);e=Array.from(g.value).filter(w=>{let F=new Date(w.created_at);return F.getTime()>=f.getTime()&&F.getTime()<=h.getTime()})}else e=Array.from(g.value);const t={data:[]},o=[];for(let f in e){let h=parseInt(e[f].users_suscribed);t.data.push(h+1),o.push(e[f].title)}return{series:[t],options:{chart:{parentHeightOffset:0,toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{borderRadius:8,barHeight:"60%",horizontal:!0}},grid:{borderColor:C,xaxis:{lines:{show:!1}},padding:{top:-10}},yaxis:{labels:{style:{colors:S}}},xaxis:{axisBorder:{show:!1},axisTicks:{color:C},categories:o,labels:{style:{colors:S}}}},intereses:o}});async function H(e){let t=g.value.filter(o=>o.title==e)[0].interesId;await fetch("https://sugerencias-ecuavisa.vercel.app/interes/group/usuario?"+new URLSearchParams({interesId:t})).then(o=>o.json()).then(o=>{x.value=o.data}),A.value=!0}const R=()=>{n.value=[],_.value=""};function I(e){for(var r=typeof e!="object"?JSON.parse(e):e,t="",o=0;o<r.length;o++){var p="";for(var f in r[o])p!=""&&(p+=","),p+=r[o][f];t+=p+`\r
`}return t}function M(e,r,t){e&&r[0].wylexId!=="wylexId"&&r.unshift(e);var o=JSON.stringify(r),p=I(o),f=t+".csv"||"export.csv",h=new Blob([p],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(h,f);else{var v=document.createElement("a");if(v.download!==void 0){var w=URL.createObjectURL(h);v.setAttribute("href",w),v.setAttribute("download",f),v.style.visibility="hidden",document.body.appendChild(v),v.click(),document.body.removeChild(v)}}}async function c(){let e={userId:"userId",interesId:"interesId",meta_existe:"meta_existe",created_at:"created",first_name:"first_name",last_name:"last_name",phone_number:"phone_number",email:"email",site:"site"},r=[];r=Array.from(x.value);let t="users_"+y.value.replace(/ /g,"_"),o=D().format("DD/MM/YYYY HH:mm:ss").toString(),p=JSON.parse(localStorage.getItem("userData"));if(p.email!=="admin@demo.com"){var f=new Headers;f.append("Content-Type","application/json");var h=JSON.stringify({usuario:p.email,pagina:"interesesSugerencias-listaIntereses-estadisticas",accion:"export",fecha:o}),v={method:"POST",headers:f,body:h,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",v).then(w=>{}).catch(w=>console.log("error",w))}M(e,r,t)}return(e,r)=>{const t=_e;return O(),N(J,null,[a(E,{style:{display:"flex","flex-wrap":"wrap","row-gap":"0.1em","padding-top":"5px"}},{default:s(()=>[a(V,{cols:"4"},{default:s(()=>[l("div",Oe,[a(t,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:i(_),"onUpdate:modelValue":r[0]||(r[0]=o=>P(_)?_.value=o:null),"show-current":"true",onOnChange:Y,config:{mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date}},null,8,["modelValue","config"])])]),_:1}),a(V,{cols:"3"},{default:s(()=>[a(pe,{style:{width:"100%"},modelValue:i(y),"onUpdate:modelValue":[r[1]||(r[1]=o=>P(y)?y.value=o:null),H],items:i($).intereses,label:"Intereses"},null,8,["modelValue","items"])]),_:1}),a(V,{cols:"5",style:{display:"flex","flex-wrap":"wrap","column-gap":"0.2em","row-gap":"0.2em"}},{default:s(()=>[a(T,{color:"primary",onClick:R,disabled:e.isExportLoading},{default:s(()=>[b(" Reinciar filtro ")]),_:1},8,["disabled"]),a(T,{color:"primary",onClick:c},{default:s(()=>[b(" Exportar ")]),_:1})]),_:1})]),_:1}),a(i(fe),{type:"bar",height:"400",options:i($).options,series:i($).series},null,8,["options","series"]),me(a(q,null,{default:s(()=>[a(oe,null,{default:s(()=>[b("Usuarios suscritos a "+m(i(y)),1)]),_:1}),a(z,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:s(()=>[Ne,l("tbody",null,[(O(!0),N(J,null,re(i(x),o=>(O(),N("tr",null,[l("td",null,m(o.first_name)+" "+m(o.last_name),1),l("td",null,m(o.email),1),l("td",null,m(o.phone_number),1)]))),256))])]),_:1})]),_:1},512),[[ve,i(A)]])],64)}}};const Fe={style:{display:"flex"}},Pe={style:{width:"30%"},class:"d-flex gap-1 px-0 position-relative"},Ae=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"ID"),l("th",{scope:"col"},"Nombre del inter\xE9s"),l("th",{scope:"col"},"Descripci\xF3n"),l("th",{scope:"col"},"Publicado"),l("th",{scope:"col"},"Acciones")])],-1),Re={style:{height:"3.5rem"}},je={class:"d-flex align-left"},Le={class:"d-flex flex-column"},Ye={class:"text-base"},He={class:"d-flex align-left"},Me={class:"d-flex flex-column"},ke={class:"text-base"},Be={class:"d-flex align-left"},Ee={class:"d-flex flex-column"},ze={class:"text-base"},Je={class:"d-flex align-left"},qe={class:"d-flex flex-column"},We={class:"text-center",style:{width:"5rem"}},Ke={class:"px-4 py-4"},Qe={class:"px-2"},Xe=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"Id"),l("th",{scope:"col"},"Text")])],-1),Ge={style:{height:"3.75rem"}},Ze={class:"d-flex align-center"},et={class:"d-flex flex-column"},tt={class:"d-flex align-center"},at={class:"d-flex flex-column"},ot={__name:"categorias",setup(ie){const D=ae.exports.extendMoment(le);D.locale("es",[se]);const L=Ue(),u=d([]);d([]);const g=d(!1);d(!1),d(!1);const x=d(1),C=d(10);var S=d(1);const n=d({});d([]),d([]),d([]);const _=d("tab-lista");d(D().format("DD/MM/YYYY HH:mm:ss").toString()),d(JSON.parse(localStorage.getItem("userData")));const A=he(),y=()=>{L.fetchCategorias().then(c=>{u.value=c.data}).catch(c=>{console.error(c)})};be(y),(()=>{let c=localStorage.getItem("role");c!=="administrador"&&c!=="webmaster"&&A.push({path:"/pages/errors/not-authorized"})})(),S.value=B(()=>Math.ceil(u.value.length/C.value));const Y=c=>{n.value=Object.create(c),g.value=!0};async function $(c){var F;let e=D().format("DD/MM/YYYY HH:mm:ss").toString(),r=[];r=Array.from(u.value);let t=r.map(U=>U.id).indexOf(c),o;n.value.publicado==!0?o={id:u.value[t].id,vn:u.value[t].vn,vid:u.value[t].vid,__text:u.value[t].__text,picImg:n.value.picImg,feedUrl:u.value[t].feedUrl,description:n.value.description,publicado:n.value.publicado,fechaPublicado:e}:o={id:u.value[t].id,vn:u.value[t].vn,vid:u.value[t].vid,__text:u.value[t].__text,picImg:n.value.picImg,feedUrl:u.value[t].feedUrl,description:n.value.description,publicado:n.value.publicado,fechaPublicado:(F=r[t])!=null&&F.fechaPublicado?r[t].fechaPublicado:""};let p=n.value,f=Object.create(r[t]);console.log(p),r[t]=o,Te("editar",{id:f.id,...p});var h=new Headers;h.append("Content-Type","application/json");var v=JSON.stringify(r),w={method:"POST",headers:h,body:v,redirect:"follow"};await fetch("https://getmetadatos-service.vercel.app/send",w).then(U=>U.text()).then(async U=>{var K=new Headers;K.append("Content-Type","application/json");var ne=JSON.stringify({tipo:"intereses",id:f.id,accion:"update",campos:p,fecha:e,usuario:""}),de={method:"POST",headers:K,body:ne,redirect:"follow"};return await fetch("https://servicio-logs.vercel.app/send",de).then(Q=>{}).catch(Q=>console.log("error",Q)),y(),g.value=!1,!0}).catch(U=>console.log("error",U))}const H=()=>{n.value={},g.value=!1,window.setTimeout(y,300)},R=c=>{c===!1&&window.setTimeout(y,300),g.value=c},I=d("");var M=B(()=>{var c=u.value.filter(o=>o.__text.toLowerCase().includes(I.value.toLowerCase())||o.id.toLowerCase().includes(I.value.toLowerCase()));const e=(x.value-1)*C.value,r=e+C.value;var t=c.slice(e,r);return S.value=Math.ceil(c.length/C.value),t});return(c,e)=>{const r=De;return O(),N("section",null,[a(E,null,{default:s(()=>[a(V,{class:"mt-6",cols:"12",md:"12",lg:"12"},{default:s(()=>[a(ge,{modelValue:i(_),"onUpdate:modelValue":e[0]||(e[0]=t=>P(_)?_.value=t:null),class:"v-tabs-pill"},{default:s(()=>[a(X,{value:"tab-lista"},{default:s(()=>[b("Listado")]),_:1}),a(X,{value:"tab-estadistica"},{default:s(()=>[b("Estad\xEDsticas")]),_:1})]),_:1},8,["modelValue"]),a(G,{class:"mt-5",title:"Intereses"},{default:s(()=>[a(xe,{modelValue:i(_),"onUpdate:modelValue":e[9]||(e[9]=t=>P(_)?_.value=t:null)},{default:s(()=>[a(Z,{value:"tab-lista"},{default:s(()=>[a(q,{class:"py-4 gap-0 w-100"},{default:s(()=>[l("div",Fe,[l("div",Pe,[a(k,{modelValue:i(I),"onUpdate:modelValue":e[1]||(e[1]=t=>P(I)?I.value=t:null),pattern:"\\d*",placeholder:"Buscar por id o por nombre...",class:"ms-0 me-1 chat-list-search"},null,8,["modelValue"])])])]),_:1}),a(z,{class:"text-no-wrap p-10"},{default:s(()=>[Ae,l("tbody",null,[(O(!0),N(J,null,re(i(M),t=>(O(),N("tr",Re,[l("td",null,[l("div",je,[l("div",Le,[l("h6",Ye,m(t.id),1)])])]),l("td",null,[l("div",He,[l("div",Me,[l("h6",ke,m(t.__text),1)])])]),l("td",null,[l("div",Be,[l("div",Ee,[l("h6",ze,m(t.description),1)])])]),l("td",null,[l("div",Je,[l("div",qe,[a(ye,{color:t.publicado==!0?"success":"warning",class:"mr-4"},{default:s(()=>[b(m(t.publicado==!0?"Activo":"Inactivo"),1)]),_:2},1032,["color"])])])]),l("td",We,[a(T,{icon:"",size:"x-small",color:"default",variant:"text",onClick:o=>Y(t)},{default:s(()=>[a(we,{size:"22",icon:"tabler-edit"})]),_:2},1032,["onClick"])])]))),256))])]),_:1}),a(ee),l("div",Ke,[a(T,{disabled:i(x)===1,onClick:e[2]||(e[2]=t=>x.value-=1),size:"small",color:"primary"},{default:s(()=>[b(" Anterior ")]),_:1},8,["disabled"]),l("span",Qe,m(i(x))+" de "+m(i(S))+" de un total de "+m(i(u).length)+" registros",1),a(T,{disabled:i(x)===i(S),onClick:e[3]||(e[3]=t=>x.value+=1),size:"small",color:"primary"},{default:s(()=>[b(" Siguiente ")]),_:1},8,["disabled"])]),a(Ve,{width:c.$vuetify.display.smAndDown?"auto":700,"model-value":i(g),"onUpdate:modelValue":R},{default:s(()=>[a(r,{onClick:e[4]||(e[4]=t=>R(!1))}),a(G,{class:"pa-sm-14 pa-5"},{default:s(()=>[a(te,{class:"text-center"},{default:s(()=>[a(oe,{class:"text-h5 mb-3"},{default:s(()=>[b(" Editar la categor\xEDa ")]),_:1})]),_:1}),a(q,null,{default:s(()=>[a(z,{class:"text-no-wrap"},{default:s(()=>[Xe,l("tbody",null,[l("tr",Ge,[l("td",null,[l("div",Ze,[l("div",et,m(i(n).id),1)])]),l("td",null,[l("div",tt,[l("div",at,m(i(n).__text),1)])])])])]),_:1}),a(ee),a(Ce,{class:"mt-6",onSubmit:e[8]||(e[8]=Se(t=>$(i(n).id),["prevent"]))},{default:s(()=>[a(E,{class:"d-flex flex-wrap justify-center gap-4"},{default:s(()=>[a(V,{cols:"8"},{default:s(()=>[a(k,{modelValue:i(n).description,"onUpdate:modelValue":e[5]||(e[5]=t=>i(n).description=t),label:"Nueva descripci\xF3n"},null,8,["modelValue"])]),_:1}),a(V,{cols:"8"},{default:s(()=>[a(k,{modelValue:i(n).picImg,"onUpdate:modelValue":e[6]||(e[6]=t=>i(n).picImg=t),label:"Nueva imgUrl"},null,8,["modelValue"])]),_:1}),a(V,{cols:"12",md:"6"},{default:s(()=>[a(Ie,{modelValue:i(n).publicado,"onUpdate:modelValue":e[7]||(e[7]=t=>i(n).publicado=t),density:"compact",label:"Publicado"},null,8,["modelValue"])]),_:1}),a(V,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:s(()=>[a(T,{type:"submit"},{default:s(()=>[b(" Enviar ")]),_:1}),a(T,{color:"secondary",variant:"tonal",onClick:H},{default:s(()=>[b(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"])]),_:1}),a(Z,{value:"tab-estadistica"},{default:s(()=>[a(te,null,{default:s(()=>[a($e)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}};export{ot as default};
