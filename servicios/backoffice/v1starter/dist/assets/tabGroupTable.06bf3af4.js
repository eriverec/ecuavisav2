import{R as de,S as pe,U as me,r as i,bA as H,bB as ve,v as J,ak as fe,Q as S,o as B,x as U,a as o,w as u,e as ge,g as he,aQ as _e,p as N,u as r,b as l,b2 as Q,q as k,t as h,bC as W,i as F,a2 as be,aW as ye,F as Ye,C as we,aR as Ce,aM as A,aq as K,ao as De,ap as xe,V as Ve,bP as O}from"./index.88d3c7f5.js";import{_ as Me}from"./AppDateRange.cbfc1214.js";import{V as X}from"./VTooltip.2d0a8708.js";import{V as ke}from"./VPagination.9412c3b8.js";const $e={class:"d-flex pr-0",style:{"justify-content":"space-between"}},Se={class:"descripcion"},Oe=l("span",null,"Exportar b\xFAsqueda",-1),Te=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),Re={class:"px-5 py-2"},Ee={class:"bg-ecuavisa py-4 d-flex gap-4 flex-wrap"},Pe={class:"date-picker-wrappe",style:{"min-width":"90px",width:"auto"}},qe={style:{"min-width":"230px",width:"auto"}},Be={style:{"min-width":"230px",width:"auto"}},Ue=l("thead",{class:"text-uppercase"},[l("tr",null,[l("th",{scope:"col"}," N "),l("th",{scope:"col"}," T\xEDtulo de P\xE1gina "),l("th",{scope:"col",class:"text-center"}," Impresiones "),l("th",{scope:"col",class:"text-center"}," Click "),l("th",{scope:"col"}," Nombre de Campa\xF1a "),l("th",{scope:"col"}," Link/Descargar ")])],-1),Ne={class:"text-center"},Fe={style:{"min-width":"17rem","max-width":"17rem","text-align":"left"}},Ae={class:"text-center"},Ge={class:"text-center"},Ie={class:"text-center",style:{width:"5rem"}},Le=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),je=l("tr",null,[l("td",{colspan:"8",class:"text-center text-body-1"}," No hay datos que mostrar ")],-1),ze=[je],Ke={__name:"tabGroupTable",props:{dataCampaigns:Object},setup(Z){const ee=Z,_=de.exports.extendMoment(pe);_.locale("es",[me]);const C=i([]),T=i(!1),ae=async(t,a)=>{if(T.value)return alert("Existe una descarga en curso, espere a que termine"),!1;T.value=!0,C.value[t]=!0,await z({title_page:a});let e={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"},s=w.value||[];await j(e,s,"campaigns_user_full"),T.value=!1,C.value[t]=!1},R=H(),p=i({i:R.i,f:R.f,title:"hoy"});i(0);const f=i(!1);i(!1);const D=i(!1),te=i(!1),E=i("Hoy");ve();const b=i(R.limit),x=i(1),y=i(7);i([{title:"Todos los eventos",value:"all"},{title:"Usuarios que vieron la publicidad",value:"preview"},{title:"Usuarios que dieron click en la publicidad",value:"click"}]);const Y=i(null),le=i([{title:"Ordenar por Impresiones DESC",value:1},{title:"Ordenar por Impresiones ASC",value:2},{title:"Ordenar por clicks DESC",value:3},{title:"Ordenar por clicks ASC",value:4},{title:"Ordenar por nombre de p\xE1gina DESC",value:5},{title:"Ordenar por nombre de p\xE1gina ASC",value:6}]);function G(t){switch(t){case 1:return(a,e)=>e.preview-a.preview;case 2:return(a,e)=>a.preview-e.preview;case 3:return(a,e)=>e.click-a.click;case 4:return(a,e)=>a.click-e.click;case 5:return(a,e)=>a.title>e.title?1:-1;case 6:return(a,e)=>e.title>a.title?1:-1;default:return null}}const v=i(null);i(null);const g=i([]),w=i([]);i([]),i([]),i([]),i([]);const I=i([]),$=i({title:y.value,value:y.value}),se=J(()=>Math.ceil(g.value.length/y.value)),ie=t=>{const a=`rgba(${O(t.colors["on-surface"])},${t.variables["medium-emphasis-opacity"]})`,e=`rgba(${O(t.colors["on-surface"])},${t.variables["disabled-opacity"]})`,s=`rgba(${O(String(t.variables["border-color"]))},${t.variables["border-opacity"]})`,c=`rgba(${O(t.colors["on-surface"])},${t.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:a,themeDisabledTextColor:e,themeBorderColor:s,themePrimaryTextColor:c}},oe=fe();ie(oe.current.value);const L=J(()=>{const t=(x.value-1)*y.value,a=x.value*y.value;return g.value.slice(t,a)});async function re(){if(g.value.length<1)return alert("No hay registros que exportar"),!1;D.value=!0,await z();let t={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"},a=w.value||[];await j(t,a,"campaigns_full"),D.value=!1}async function ne(t){for(var a=typeof t!="object"?JSON.parse(t):t,e="",s=0;s<a.length;s++){var c="";for(var d in a[s])c!=""&&(c+=","),c+=a[s][d];e+=c+`\r
`}return e}async function j(t,a,e){t&&a.unshift(t);var s=JSON.stringify(a),c=await ne(s),d=e+".csv"||"export.csv",n=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,d);else{var m=document.createElement("a");if(m.download!==void 0){var V=URL.createObjectURL(n);m.setAttribute("href",V),m.setAttribute("download",d),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)}}}async function z(t={}){const{title_page:a=""}=t;w.value=[];let e=1,s=7e3;for(;;){const d=await ce({tipo:"all",fechai:p.value.i.format("YYYY-MM-DD"),fechaf:p.value.f.format("YYYY-MM-DD"),limit:s,page:e,idCampaign:v.value.value,exportar:!0,title_page:a});if(d.length===0)break;w.value.push(...d),e+=1}const c=w.value.reduce((d,n)=>(d.push({title:n.title,url:n.url,type:n.type,created_at:n.created_at,user_email:n.firstUser.email,user_last_name:n.firstUser.last_name,user_firstname:n.firstUser.firstname,campaign_idCampaign:n.idCampaign._id,campaign_title:n.idCampaign.title,campaign_position:n.idCampaign.position}),d),[]);return w.value=c,!0}async function ce(t={}){try{const{title_page:e="",idCampaign:s=null,tipo:c="all",fechai:d=_().format("YYYY-MM-DD"),fechaf:n=_().format("YYYY-MM-DD"),limit:m=10,page:V=1,exportar:M=!1}=t;var a=await fetch(`https://ads-service.vercel.app/campaigns-historical/events/${c}?fechai=${d}&fechaf=${n}&page=${V}&limit=${m}&idCampaign=${s}&userId=&title_page=${e}`);const q=await a.json();if(!M)g.value=q.data,I.value=q.data;else return q.data}catch(e){return console.error(e.message)}}async function P(t={}){try{const{idCampaign:e="",tipo:s="all",fechai:c=_().format("YYYY-MM-DD"),fechaf:d=_().format("YYYY-MM-DD"),limit:n=10,page:m=1,exportar:V=!1}=t;var a=await fetch(`https://ads-service.vercel.app/campaigns-historical/group/page/${e}?fechai=${c}&fechaf=${d}&page=${m}&limit=${n}&type=${s}&userId=`);const M=await a.json();if(!V)g.value=M.data,I.value=M.data;else return M.data}catch(e){return console.error(e.message)}}S(async()=>E.value,async()=>{let t=H(E.value);p.value={i:t.i,f:t.f,title:E.value},b.value=t.limit,v.value&&(f.value=!0,await P({fechai:p.value.i.format("YYYY-MM-DD"),fechaf:p.value.f.format("YYYY-MM-DD"),limit:b.value,idCampaign:v.value.value}),f.value=!1)}),S(async()=>v.value,async()=>{f.value=!0,await P({fechai:p.value.i.format("YYYY-MM-DD"),fechaf:p.value.f.format("YYYY-MM-DD"),limit:b.value,idCampaign:v.value.value}),f.value=!1});const ue=async t=>{let a=t;p.value={i:_(a[0]),f:_(a[1]),title:"Fecha personalizada"},b.value=8e3,v.value&&(f.value=!0,await P({fechai:p.value.i.format("YYYY-MM-DD"),fechaf:p.value.f.format("YYYY-MM-DD"),limit:b.value,idCampaign:v.value.value}),f.value=!1)};return S(async()=>$.value,async()=>{if($.value,$.value){const t=$.value.value;y.value=t}}),S(async()=>Y.value,async()=>{const t=g.value;if(Y.value){const e=Y.value.value,s=[...t].sort(G(e));g.value=s}else{const a=[...t].sort(G(1));g.value=a}}),(t,a)=>(B(),U("section",null,[o(Ve,null,{default:u(()=>[o(ge,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:u(()=>[o(he,{class:"px-2 py-0"},{default:u(()=>[o(_e,{class:"header_card_item py-0 pt-4 align-start"},{append:u(()=>[o(N,{variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:re,loading:r(D),disabled:r(D)},{default:u(()=>[Oe,o(X,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!r(D)},{default:u(()=>[Te]),_:1},8,["disabled"])]),_:1},8,["loading","disabled"])]),default:u(()=>[l("div",$e,[l("div",Se,[o(Q,null,{default:u(()=>[k("*Mostrando data desde, "+h(r(p).i.format("YYYY-MM-DD"))+" hasta "+h(r(p).f.format("YYYY-MM-DD")),1)]),_:1}),o(Q,null,{default:u(()=>[k("*Este informe muestra un l\xEDmite m\xE1ximo de "+h(r(b))+" registros",1)]),_:1})])])]),_:1}),l("div",Re,[l("div",Ee,[l("div",Pe,[o(Me,{"onGet:dateCR":ue})]),l("div",qe,[o(W,{clearable:"",density:"compact",disabled:r(f),modelValue:r(v),"onUpdate:modelValue":a[0]||(a[0]=e=>F(v)?v.value=e:null),items:ee.dataCampaigns,variant:"outlined",label:"Buscar por campa\xF1a","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])]),l("div",Be,[o(W,{clearable:"",density:"compact",disabled:r(f),modelValue:r(Y),"onUpdate:modelValue":a[1]||(a[1]=e=>F(Y)?Y.value=e:null),items:r(le),variant:"outlined",label:"Ordenar registros","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])]),o(be,{class:"my-5"}),o(ye,{class:"text-no-wrap invoice-list-table",disabled:r(te)},{default:u(()=>[Ue,l("tbody",null,[(B(!0),U(Ye,null,we(r(L),(e,s)=>(B(),U("tr",{key:s,style:{height:"3.75rem"}},[l("td",Ne,h(s+1),1),l("td",Fe,[o(Ce,{class:"px-0",title:e.title,style:{"font-size":"18px"}},{default:u(()=>[l("small",null,h(e.title),1)]),_:2},1032,["title"])]),l("td",Ae,[o(A,K({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:u(()=>[k(h(e.preview),1)]),_:2},1040)]),l("td",Ge,[o(A,K({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:u(()=>[k(h(e.click),1)]),_:2},1040)]),l("td",null,[o(A,{color:"success"},{default:u(()=>[k(h(e.idCampaign.title),1)]),_:2},1024)]),l("td",Ie,[o(N,{href:e.url,target:"_blank",variant:"text",color:"info",icon:"mdi-link-variant"},null,8,["href"]),o(N,{title:"Descargar usuarios que interactuaron en esta p\xE1gina",variant:"text",loading:r(C)[s],disabled:r(C)[s],color:"warning",icon:"mdi-account-arrow-down-outline",onClick:c=>ae(s,e.title)},null,8,["loading","disabled","onClick"]),o(X,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!r(C)[s]},{default:u(()=>[Le]),_:2},1032,["disabled"])])]))),128))]),De(l("tfoot",null,ze,512),[[xe,!r(L).length]])]),_:1},8,["disabled"]),o(ke,{class:"mt-5",modelValue:r(x),"onUpdate:modelValue":a[2]||(a[2]=e=>F(x)?x.value=e:null),length:r(se),"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1})]))}};export{Ke as _};
