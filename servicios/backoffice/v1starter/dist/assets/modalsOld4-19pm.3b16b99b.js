import{r as y,as as k,o as C,x as b,a as t,w as l,q as u,f as j,h,b as r,p as f,g,F as S,C as D,c as P,b4 as B,b5 as M,t as N,c7 as O,b6 as $,V as z,e as c,n as A,bC as v,N as F,b3 as L}from"./index.88d3c7f5.js";import{V as q}from"./VTextarea.86fae113.js";const H={class:"mr-2 mb-2"},R={class:"text-uppercase"},G={class:"demo-space-x"},J={class:"d-flex",style:{"justify-content":"flex-end"}},X={__name:"modalsOld4-19pm",setup(K){const i=y([]),d=y(!1),p=y([]),U=async()=>{try{const a=await(await fetch("https://ecuavisa-suscripciones.vercel.app/otros/obtener-paises-ciudades")).json();p.value=a}catch(s){console.error("Error fetching countries and cities:",s)}},x=s=>{i.value[s].selectedCity||m(s)},m=s=>{const a=i.value[s].selectedCountry;if(a&&typeof a=="object"){const e=p.value.find(n=>n.countryCode===a.countryCode);e&&(i.value[s].availableCities=e.data,i.value[s].selectedCity||(i.value[s].selectedCity=null))}else i.value[s].availableCities=[],i.value[s].selectedCity=null},V=async()=>{try{const a=await(await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/suscripciones/modalondemand/v2/getData.php")).json();i.value=a.modals.map(e=>{var n;return{estado:e.estado==="true",titulo:e.titulo,contenido:e.contenido,url:e.url||[],selectedCountry:e.paisCode?{country:e.pais,countryCode:e.paisCode}:null,selectedCity:e.ciudad?{city:e.ciudad,countryCode:(n=e.city)==null?void 0:n.countryCode}:null,availableCities:[]}})}catch(s){console.error("Error fetching data:",s)}};k(()=>{U(),V()});const w=()=>{i.value.push({estado:!1,titulo:"",contenido:"",url:[],selectedCountry:null,selectedCity:null,availableCities:[]})},E=s=>{confirm("\xBFEst\xE1s seguro de que deseas eliminar este modal")&&(i.value.splice(s,1),setTimeout(async()=>{await _()},500))},_=async()=>{const s={key:"modalondemand",modals:i.value.map(a=>{var e,n,o;return{estado:a.estado?"true":"false",titulo:a.titulo,contenido:a.contenido,url:a.url,paisCode:((e=a.selectedCountry)==null?void 0:e.countryCode)||"",pais:((n=a.selectedCountry)==null?void 0:n.country)||"",ciudad:((o=a.selectedCity)==null?void 0:o.city)||"",city:a.selectedCity?{city:a.selectedCity.city,countryCode:a.selectedCity.countryCode}:null}})};try{const e=await(await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/suscripciones/modalondemand/v2/index.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();e.success?(d.value=!0,V()):console.error("Error actualizando:",e.error)}catch(a){console.error("Error updating data:",a)}},T=s=>s?"Activo":"Inactivo";return(s,a)=>(C(),b("div",null,[t(j,{timeout:2e3,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),color:"success",transition:"scale-transition",location:"top end"},{default:l(()=>[u(" Datos actualizados correctamente ")]),_:1},8,["modelValue"]),t(g,{class:"mt-5 card",title:"Modal Omdemand",subtitle:"Ecuavisa"},{default:l(()=>[t(h,null,{default:l(()=>[r("div",H,[t(f,{onClick:w,color:"primary"},{default:l(()=>[u(" Agregar ")]),_:1})])]),_:1})]),_:1}),t(L,{class:"mt-5 mb-5"},{default:l(()=>[(C(!0),b(S,null,D(i.value,(e,n)=>(C(),P(B,{key:n,value:n},{default:l(()=>[t(M,null,{default:l(()=>[r("span",R,N(e.titulo||`Modal ${n+1}`),1),t(O,{class:"mx-5",modelValue:e.estado,"onUpdate:modelValue":o=>e.estado=o,inset:"",label:T(e.estado)},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),t($,null,{default:l(()=>[t(g,{flat:""},{default:l(()=>[t(h,null,{default:l(()=>[t(z,{id:"modal"},{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(A,{label:"Titulo",modelValue:e.titulo,"onUpdate:modelValue":o=>e.titulo=o},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(c,{cols:"12"},{default:l(()=>[t(q,{label:"Contenido del modal",type:"text",modelValue:e.contenido,"onUpdate:modelValue":o=>e.contenido=o},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(c,{cols:"12"},{default:l(()=>[r("div",G,[t(v,{class:"listUrls",modelValue:e.url,"onUpdate:modelValue":o=>e.url=o,multiple:"",chips:"",items:e.url,variant:"outlined",label:"URLS"},null,8,["modelValue","onUpdate:modelValue","items"])])]),_:2},1024),t(c,{cols:"6"},{default:l(()=>[t(v,{label:"Pa\xEDs",chips:"",modelValue:e.selectedCountry,"onUpdate:modelValue":[o=>e.selectedCountry=o,o=>m(n)],items:p.value,"item-title":"country","item-value":"countryCode","hide-no-data":!1,"menu-props":{maxHeight:"300"},"return-object":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(c,{cols:"6"},{default:l(()=>[t(v,{label:"Ciudad",chips:"",modelValue:e.selectedCity,"onUpdate:modelValue":[o=>e.selectedCity=o,o=>x(n)],items:e.availableCities,"item-title":"city","item-value":"city","hide-no-data":!1,"menu-props":{maxHeight:"300"},disabled:!e.selectedCountry,"return-object":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),t(c,{cols:"2"},{default:l(()=>[t(f,{color:"error",variant:"text",onClick:o=>E(n)},{default:l(()=>[t(F,{start:"",icon:"tabler-trash"}),u("Eliminar ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),r("div",J,[t(f,{onClick:_,color:"success",variant:"tonal"},{default:l(()=>[u(" Guardar ")]),_:1})])]))}};export{X as default};
