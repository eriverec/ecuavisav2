import{M as Ve,ak as ke,R as Pe,S as Ce,U as Oe,r as d,v as X,as as He,o as _,c as k,w as s,a as n,e as oe,g as R,h as M,aQ as H,aR as I,q as w,b as a,n as Se,u as r,i as ie,p as S,a3 as ce,aW as G,x as F,F as U,C as E,t as u,bD as K,ao as Z,ap as j,V as Ne,aX as Te,bd as Ae,be as Be}from"./index.88d3c7f5.js";import{V as Re,a as Ie}from"./VTimelineItem.36b36f8a.js";const ee=N=>(Ae("data-v-46d663cf"),N=N(),Be(),N),Ue={class:"d-flex align-center flex-wrap gap-2"},Ee={style:{width:"15rem"}},qe=ee(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Nombre"),a("th",{scope:"col"},"Email")])],-1)),Le=["onClick"],ze={class:"text-medium-emphasis"},Je={class:"d-flex align-center justify-space-between botonescurrentPage"},$e={style:{display:"flex","flex-wrap":"wrap"}},Qe={style:{width:"max-content"}},We=ee(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"P\xE1gina"),a("th",{scope:"col"},"Cantidad")])],-1)),Xe=["onClick"],Ge={class:"text-high-emphasis"},Ke={class:"text-medium-emphasis"},Ze={class:"d-flex align-center justify-space-between botonescurrentPage"},je={class:"date-picker-wrapper",style:{width:"300px"}},ea={class:"d-flex justify-space-between align-center flex-wrap"},aa={class:"text-base font-weight-semibold me-1"},ta={class:"mb-1"},la={style:{display:"flex","flex-wrap":"wrap"}},sa={style:{width:"max-content"}},na=ee(()=>a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Pa\xEDs"),a("th",{scope:"col"},"Dispositivo"),a("th",{scope:"col"},"Fecha"),a("th",{scope:"col"},"Hora")])],-1)),oa={class:"clickable"},ia={class:"text-high-emphasis"},ca={class:"text-medium-emphasis"},ra={class:"text-medium-emphasis"},da={class:"text-medium-emphasis"},ua={__name:"indexOld",setup(N){ke();const V=Pe.exports.extendMoment(Ce);V.locale("es",[Oe]);const q=d([]),L=d(!1),z=d(!1),y=8,x=d(1),b=d(1),T=d(""),J=d([]);X(()=>P.value.length);const $=d(!1),re=d(""),ae=d(""),de=d([]),A=d(""),B=d(""),P=d([]),C=d(""),te=d([]),O=d([]),le=d(!1),Q=d(""),W=d(""),ue=d(V().format("DD/MM/YYYY HH:mm:ss").toString()),se=d(JSON.parse(localStorage.getItem("userData")));async function fe(){L.value=!0,z.value=!1;var c=new Headers;c.append("Content-Type","application/json");var i=JSON.stringify({query:B.value}),p={method:"POST",headers:c,body:i,redirect:"follow"};await fetch("https://servicio-de-actividad.vercel.app/actividad/full/extra",p).then(e=>e.json()).then(e=>{let f=e.data;q.value=e.data;let Y={};f.forEach(t=>{let h=t.first_name+"-"+t.last_name;Y.hasOwnProperty(h)?Y[h].cantidad=(Y[h].cantidad||1)+1:(t.cantidad=1,Y[h]=t)});let l=Object.values(Y);P.value=l,L.value=!1,z.value=!0}).catch(e=>e)}const he=X(()=>{const c=(x.value-1)*y,i=c+y;return P.value.slice(c,i)}),me=()=>{x.value*y<P.value.length&&x.value++},pe=()=>{x.value>1&&x.value--},ve=(c,i)=>{T.value="";const p=q.value.map(({first_name:o,last_name:m,country:v,navigationRecord:g})=>({first_name:o,last_name:m,country:v,navigationRecord:g})),e=[];A.value=c+" "+i;let f=c+" "+i;for(let o of p)if(o.first_name+" "+o.last_name==f)for(let v of o.navigationRecord){var Y=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","D/M/YYYY"],l=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let g=V(v.fecha,Y,!0).format("DD/MM/YYYY"),D=v.hora.split(":");if(D[2].indexOf(" ")>=0){let Fe=D[2].split(" ");D[2]=Fe[0]}let ne=D[0]+":"+D[1]+":"+D[2],xe=g+" "+ne,be=V(xe,l,!0).format(),Me={first_name:o.first_name,last_name:o.last_name,url:v.url,title:v.title,fecha:g,fechaRaw:v.fecha,fullFecha:be,hora:ne,country:o.country};e.push(Me)}e.sort((o,m)=>{var v=new Date(o.fullFecha),g=new Date(m.fullFecha);return g-v});let t={};e.forEach(o=>{let m=o.title;o.country!==void 0&&o.country!==null&&o.country!==""&&(t.hasOwnProperty(m)?t[m].cantidad=(t[m].cantidad||1)+1:(o.cantidad=1,t[m]=o))});let h=Object.values(t);h.sort((o,m)=>m.cantidad-o.cantidad),C.value=h,J.value=e.slice(0,10),te.value=e,$.value=!0},_e=c=>{if(c.length>1){let i=c[0].toString(),p=c[1].toString();i===p&&(p=new Date(new Date(i).getTime()+60*60*24*1e3)),Q.value=i,W.value=p;let e=te.value.filter(l=>new Date(l.fullFecha)>=new Date(i)&&new Date(l.fullFecha)<=new Date(p));J.value=e.slice(0,10);let f={};e.forEach(l=>{let t=l.title;l.country!==void 0&&l.country!==null&&l.country!==""&&(f.hasOwnProperty(t)?f[t].cantidad=(f[t].cantidad||1)+1:(l.cantidad=1,f[t]=l))});let Y=Object.values(f);Y.sort((l,t)=>t.cantidad-l.cantidad),C.value=Y}},Ye=X(()=>{const c=(b.value-1)*y,i=c+y;return C.value.slice(c,i)}),ge=()=>{b.value*y<C.value.length&&b.value++},De=()=>{b.value>1&&b.value--};async function we(c){if(se.value.email!=="admin@demo.com"){var i=new Headers;i.append("Content-Type","application/json");var p=JSON.stringify(c),e={method:"POST",headers:i,body:p,redirect:"follow"};await fetch("https://servicio-logs.vercel.app/accion",e).then(f=>{}).catch(f=>console.log("error",f))}}He(async()=>{await we({usuario:se.value.email,pagina:"trazabilidad-users",fecha:ue.value})});const ye=c=>{ae.value=c;let i=[];for(let l of q.value)l.first_name+" "+l.last_name==A.value&&i.push(l);const p=i.map(({device:l,country:t,navigationRecord:h})=>({device:l,country:t,navigationRecord:h})),e=[];for(let l of p)for(let t of l.navigationRecord)if(t.title===c||t.url===c){var f=["DD/MM/YYYY","DD/M/YYYY","M/DD/YYYY","YYYY-MM-DD","DD-MM-YYYY","D/M/YYYY"],Y=["DD/MM/YYYY HH:mm:ss","DD/MM/YYYY H:mm:ss","DD/MM/YYYY H:mm:ss a","DD/MM/YYYY HH:mm:ss a"];let h=V(t.fecha,f,!0).format("DD/MM/YYYY"),o=t.hora.split(":");if(o[2].indexOf(" ")>=0){let D=o[2].split(" ");o[2]=D[0]}let m=o[0]+":"+o[1]+":"+o[2],v=h+" "+m,g=V(v,Y,!0).format();if(l.country!==void 0&&l.country!==null&&l.country!==""){let D={device:l.device,country:l.country,url:t.url,title:t.title,fecha:h,fechaRaw:t.fecha,fullFecha:g,hora:m,horaRaw:t.hora};e.push(D)}}if(e.sort((l,t)=>{var h=new Date(l.fullFecha),o=new Date(t.fullFecha);return o-h}),Q.value&&W.value){let l=e.filter(t=>new Date(t.fullFecha)>=new Date(Q.value)&&new Date(t.fullFecha)<=new Date(W.value));O.value=l.slice(0,25)}else O.value=e.slice(0,25);de.value=O.value.map(({first_name:l,last_name:t,fecha:h,hora:o,cantidad:m,title:v,url:g})=>({first_name:l,last_name:t,fecha:h,hora:o,cantidad:m,title:v,url:g})),le.value=!0,re.value=c};return(c,i)=>{const p=Te;return _(),k(Ne,null,{default:s(()=>[n(oe,{lg:"6",cols:"12",sm:"6"},{default:s(()=>[n(R,null,{default:s(()=>[n(M,{class:"d-flex flex-wrap justify-space-between gap-4"},{default:s(()=>[n(H,{class:"pb-sm-0"},{default:s(()=>[n(I,null,{default:s(()=>[w("Trazabilidad usuarios")]),_:1})]),_:1}),a("div",Ue,[a("div",Ee,[n(Se,{modelValue:r(B),"onUpdate:modelValue":i[0]||(i[0]=e=>ie(B)?B.value=e:null),placeholder:"Buscar...",density:"compact"},null,8,["modelValue"])]),n(S,{"prepend-icon":"tabler-search",onClick:fe},{default:s(()=>[w(" Buscar ")]),_:1})])]),_:1}),r(L)?(_(),k(M,{key:0},{default:s(()=>[w("Cargando datos...")]),_:1})):ce("",!0),r(z)?(_(),k(M,{key:1},{default:s(()=>[n(G,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:s(()=>[qe,a("tbody",null,[(_(!0),F(U,null,E(r(he),e=>(_(),F("tr",{class:"clickable",onClick:f=>ve(e.first_name,e.last_name)},[a("td",null,u(e.first_name)+" "+u(e.last_name),1),a("td",ze,u(e.email),1)],8,Le))),256))])]),_:1}),a("div",Je,[n(S,{icon:"tabler-arrow-big-left-lines",onClick:pe,disabled:r(x)===1},null,8,["disabled"]),w(" P\xE1gina "+u(r(x))+" ",1),n(S,{icon:"tabler-arrow-big-right-lines",onClick:me,disabled:r(x)*y>=r(P).length},null,8,["disabled"])])]),_:1})):ce("",!0)]),_:1}),n(K,null,{default:s(()=>[Z(n(R,{style:{"margin-top":"1rem"}},{default:s(()=>[n(H,{class:"pb-sm-0"},{default:s(()=>[a("div",$e,[a("div",Qe,[n(I,null,{default:s(()=>[w("P\xE1ginas m\xE1s visitadas de "+u(r(A)),1)]),_:1})])]),n(M,null,{default:s(()=>[n(G,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:s(()=>[We,a("tbody",null,[(_(!0),F(U,null,E(r(Ye),e=>(_(),F("tr",{class:"clickable",onClick:f=>ye(e.title||e.url)},[a("td",Ge,u(e.title?e.title:e.url),1),a("td",Ke,u(e.cantidad),1)],8,Xe))),256))])]),_:1}),a("div",Ze,[n(S,{icon:"tabler-arrow-big-left-lines",onClick:De,disabled:r(b)===1},null,8,["disabled"]),w(" P\xE1gina "+u(r(b))+" ",1),n(S,{icon:"tabler-arrow-big-right-lines",onClick:ge,disabled:r(b)*y>=r(C).length},null,8,["disabled"])])]),_:1})]),_:1})]),_:1},512),[[j,r($)]])]),_:1})]),_:1}),n(oe,{lg:"6",cols:"12",sm:"6"},{default:s(()=>[n(K,null,{default:s(()=>[Z(n(R,null,{default:s(()=>[n(H,null,{default:s(()=>[n(I,null,{default:s(()=>[w("Actividad del usuario "+u(r(A)),1)]),_:1})]),_:1}),n(H,null,{default:s(()=>[a("div",je,[n(p,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:r(T),"onUpdate:modelValue":i[1]||(i[1]=e=>ie(T)?T.value=e:null),"show-current":"true",onOnChange:_e,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",maxDate:new Date,reactive:!0}},null,8,["modelValue","config"])])]),_:1}),n(M,null,{default:s(()=>[n(Re,{density:"compact",align:"start","truncate-line":"both",class:"v-timeline-density-compact"},{default:s(()=>[(_(!0),F(U,null,E(r(J),e=>(_(),k(Ie,{"dot-color":"primary",size:"x-small"},{default:s(()=>[a("div",ea,[a("h4",aa,u(e.title||e.url),1)]),a("p",ta,u(e.fecha)+" "+u(e.hora),1)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},512),[[j,r($)]])]),_:1}),n(K,null,{default:s(()=>[Z(n(R,{style:{"margin-top":"1rem"}},{default:s(()=>[n(H,{class:"pb-sm-0"},{default:s(()=>[a("div",la,[a("div",sa,[n(I,null,{default:s(()=>[w("\xDAltimas visitas a la p\xE1gina "+u(r(ae)),1)]),_:1})])]),r(O).length==0?(_(),k(M,{key:0},{default:s(()=>[w("No existen datos")]),_:1})):(_(),k(M,{key:1},{default:s(()=>[n(G,{class:"text-no-wrap tableNavegacion mb-5"},{default:s(()=>[na,a("tbody",null,[(_(!0),F(U,null,E(r(O),e=>(_(),F("tr",oa,[a("td",ia,u(e.country),1),a("td",ca,u(e.device),1),a("td",ra,u(e.fecha),1),a("td",da,u(e.hora),1)]))),256))])]),_:1})]),_:1}))]),_:1})]),_:1},512),[[j,r(le)]])]),_:1})]),_:1})]),_:1})}}},ma=Ve(ua,[["__scopeId","data-v-46d663cf"]]);export{ma as default};
