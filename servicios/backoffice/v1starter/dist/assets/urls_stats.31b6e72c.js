import{R as ue,S as pe,U as me,r as i,bA as W,bB as ge,v as K,ak as fe,Q as Y,o as P,x as q,a as n,w as u,e as ve,g as he,aQ as _e,p as N,u as p,b as l,b2 as X,q as S,t as h,bC as be,i as U,aT as ye,a2 as Ce,aW as xe,F as we,C as Re,aR as Ve,aM as B,aq as Z,ao as De,ap as ke,V as Ye,bP as O}from"./index.88d3c7f5.js";import{V as ee}from"./VTooltip.2d0a8708.js";import{V as Se}from"./VPagination.9412c3b8.js";const $e={class:"d-flex pr-0",style:{"justify-content":"space-between"}},Oe={class:"descripcion"},Ee=l("span",null,"Exportar b\xFAsqueda",-1),Me=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),Te={class:"px-5 py-2"},Pe={class:"bg-ecuavisa py-4 d-flex gap-4 flex-wrap"},qe={style:{"min-width":"230px",width:"auto"}},Ne={class:"item-limit"},Ue=l("thead",{class:"text-uppercase"},[l("tr",null,[l("th",{scope:"col"}," N "),l("th",{scope:"col"}," T\xEDtulo de P\xE1gina "),l("th",{scope:"col",class:"text-center"}," Impresiones "),l("th",{scope:"col",class:"text-center"}," Click "),l("th",{scope:"col"}," Nombre de Campa\xF1a "),l("th",{scope:"col"}," Link/Descargar ")])],-1),Be={class:"text-center"},je={style:{"min-width":"17rem","max-width":"17rem","text-align":"left"}},Ae={class:"text-center"},Fe={class:"text-center"},Ie={class:"text-center",style:{width:"5rem"}},Le=l("span",null,"Esta acci\xF3n traer\xE1 todos los registros de la b\xFAsqueda y la carga puede demorar hasta 12 minutos, espere por favor",-1),ze=l("tr",null,[l("td",{colspan:"8",class:"text-center text-body-1"}," No hay datos que mostrar ")],-1),Ge=[ze],We={__name:"urls_stats",props:{dataCampaigns:Object,dateRange:{type:Object,required:!0}},setup(E){const r=E,w=ue.exports.extendMoment(pe);w.locale("es",[me]);const R=i([]),M=i(!1),ae=async(a,t)=>{var e,s;if(!((e=r.dateRange)!=null&&e.start)||!((s=r.dateRange)!=null&&s.end)){console.error("Rango de fechas no v\xE1lido");return}if(M.value)return alert("Existe una descarga en curso, espere a que termine"),!1;if(!r.dataCampaigns||!r.dataCampaigns[0])return alert("No hay campa\xF1a seleccionada para exportar"),!1;M.value=!0,R.value[a]=!0;try{await j({title_page:t,fechai:r.dateRange.start,fechaf:r.dateRange.end});const o={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"};let d=b.value||[];await G(o,d,"campaigns_user_full")}catch(o){console.error("Error en load:",o)}finally{M.value=!1,R.value[a]=!1}};async function te(){var a,t;if(!((a=r.dateRange)!=null&&a.start)||!((t=r.dateRange)!=null&&t.end)){console.error("Rango de fechas no v\xE1lido");return}if(g.value.length<1)return alert("No hay registros que exportar"),!1;if(!r.dataCampaigns||!r.dataCampaigns[0])return alert("No hay campa\xF1a seleccionada para exportar"),!1;D.value=!0;try{await j({fechai:r.dateRange.start,fechaf:r.dateRange.end});const e={pagina:"title",url:"url",type:"type",created_at:"created_at",user_email:"user_email",user_last_name:"user_last_name",user_firstname:"user_firstname",campaign_idCampaign:"campaign_idCampaign",campaign_title:"campaign_title",campaign_position:"campaign_position"};let s=b.value||[];await G(e,s,"campaigns_full")}finally{D.value=!1}}async function j(a={}){const{title_page:t=""}=a;b.value=[];let e=1,s=7e3;try{for(;;){if(!r.dataCampaigns||!r.dataCampaigns[0]){console.error("No hay campa\xF1a seleccionada");break}const d=await de({tipo:"all",fechai:r.dateRange.start,fechaf:r.dateRange.end,limit:s,page:e,idCampaign:r.dataCampaigns[0].value,exportar:!0,title_page:t});if(!d||d.length===0)break;b.value.push(...d),e+=1}const o=b.value.reduce((d,c)=>{var m,f,v,x,J,Q;return d.push({title:c.title,url:c.url,type:c.type,created_at:c.created_at,user_email:((m=c.firstUser)==null?void 0:m.email)||"",user_last_name:((f=c.firstUser)==null?void 0:f.last_name)||"",user_firstname:((v=c.firstUser)==null?void 0:v.firstname)||"",campaign_idCampaign:((x=c.idCampaign)==null?void 0:x._id)||"",campaign_title:((J=c.idCampaign)==null?void 0:J.title)||"",campaign_position:((Q=c.idCampaign)==null?void 0:Q.position)||""}),d},[]);return b.value=o,!0}catch(o){return console.error("Error en exportarDataAudit:",o),!1}}const A=async()=>{var a,t;if(!((a=r.dateRange)!=null&&a.start)||!((t=r.dateRange)!=null&&t.end)){console.error("Rango de fechas no v\xE1lido");return}V.value=!0;try{await H({fechai:r.dateRange.start,fechaf:r.dateRange.end,limit:$.value,idCampaign:r.dataCampaigns[0].value})}catch(e){console.error("Error al cargar datos:",e)}finally{V.value=!1}},se=W(),b=i([]);i(0);const V=i(!1);i(!1);const D=i(!1);i(!1);const T=i("Hoy");ge();const $=i(se.limit),k=i(1),y=i(7);i([{title:"Todos los eventos",value:"all"},{title:"Usuarios que vieron la publicidad",value:"preview"},{title:"Usuarios que dieron click en la publicidad",value:"click"}]);const C=i(null),le=i([{title:"Ordenar por Impresiones DESC",value:1},{title:"Ordenar por Impresiones ASC",value:2},{title:"Ordenar por clicks DESC",value:3},{title:"Ordenar por clicks ASC",value:4},{title:"Ordenar por nombre de p\xE1gina DESC",value:5},{title:"Ordenar por nombre de p\xE1gina ASC",value:6}]);function F(a){switch(a){case 1:return(t,e)=>e.preview-t.preview;case 2:return(t,e)=>t.preview-e.preview;case 3:return(t,e)=>e.click-t.click;case 4:return(t,e)=>t.click-e.click;case 5:return(t,e)=>t.title>e.title?1:-1;case 6:return(t,e)=>e.title>t.title?1:-1;default:return null}}const I=i(null);i(null);const g=i([]);i([]),i([]),i([]),i([]),i([]);const L=i([]),_=i({title:y.value,value:y.value}),re=[{title:"7",value:7},{title:"30",value:30},{title:"50",value:50},{title:"100",value:100},{title:"200",value:200}],ie=K(()=>Math.ceil(g.value.length/y.value)),oe=a=>{const t=`rgba(${O(a.colors["on-surface"])},${a.variables["medium-emphasis-opacity"]})`,e=`rgba(${O(a.colors["on-surface"])},${a.variables["disabled-opacity"]})`,s=`rgba(${O(String(a.variables["border-color"]))},${a.variables["border-opacity"]})`,o=`rgba(${O(a.colors["on-surface"])},${a.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:t,themeDisabledTextColor:e,themeBorderColor:s,themePrimaryTextColor:o}},ne=fe();oe(ne.current.value);const z=K(()=>{const a=(k.value-1)*y.value,t=k.value*y.value;return g.value.slice(a,t)});async function ce(a){for(var t=typeof a!="object"?JSON.parse(a):a,e="",s=0;s<t.length;s++){var o="";for(var d in t[s])o!=""&&(o+=","),o+=t[s][d];e+=o+`\r
`}return e}async function G(a,t,e){a&&t.unshift(a);var s=JSON.stringify(t),o=await ce(s),d=e+".csv"||"export.csv",c=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(c,d);else{var m=document.createElement("a");if(m.download!==void 0){var f=URL.createObjectURL(c);m.setAttribute("href",f),m.setAttribute("download",d),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)}}}async function de(a={}){try{const{title_page:e="",idCampaign:s=null,tipo:o="all",fechai:d=w().format("YYYY-MM-DD"),fechaf:c=w().format("YYYY-MM-DD"),limit:m=10,page:f=1,exportar:v=!1}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/events/${o}?fechai=${d}&fechaf=${c}&page=${f}&limit=${m}&idCampaign=${s}&userId=&title_page=${e}`);const x=await t.json();if(!v)g.value=x.data,L.value=x.data;else return x.data}catch(e){return console.error(e.message)}}async function H(a={}){try{const{idCampaign:e="",tipo:s="all",fechai:o=w().format("YYYY-MM-DD"),fechaf:d=w().format("YYYY-MM-DD"),limit:c=10,page:m=1,exportar:f=!1}=a;var t=await fetch(`https://ads-service.vercel.app/campaigns-historical/group/page/${e}?fechai=${o}&fechaf=${d}&page=${m}&limit=${c}&type=${s}&userId=`);const v=await t.json();if(!f)g.value=v.data,L.value=v.data;else return v.data}catch(e){return console.error(e.message)}}return Y(async()=>T.value,async()=>{let a=W(T.value);fecha.value={i:a.i,f:a.f,title:T.value},$.value=a.limit,I.value&&(V.value=!0,await H({fechai:fecha.value.i.format("YYYY-MM-DD"),fechaf:fecha.value.f.format("YYYY-MM-DD"),limit:$.value,idCampaign:I.value.value}),V.value=!1)}),Y(()=>r.dataCampaigns,{immediate:!0,handler(a){a&&a.length>0&&A()}}),Y(()=>r.dateRange,()=>{r.dataCampaigns&&r.dataCampaigns.length>0&&A()},{deep:!0}),Y(async()=>_.value,async()=>{if(_.value,_.value){const a=_.value.value;y.value=a}}),Y(async()=>C.value,async()=>{const a=g.value;if(C.value){const e=C.value.value,s=[...a].sort(F(e));g.value=s}else{const t=[...a].sort(F(1));g.value=t}}),(a,t)=>(P(),q("section",null,[n(Ye,null,{default:u(()=>[n(ve,{class:"mt-0",cols:"12",md:"12",lg:"12"},{default:u(()=>[n(he,{class:"px-0 py-0",flat:"",elevation:"0"},{default:u(()=>[n(_e,{class:"header_card_item py-0 pt-4 align-start"},{append:u(()=>[n(N,{variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:te,loading:p(D),disabled:p(D)},{default:u(()=>[Ee,n(ee,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!p(D)},{default:u(()=>[Me]),_:1},8,["disabled"])]),_:1},8,["loading","disabled"])]),default:u(()=>[l("div",$e,[l("div",Oe,[n(X,null,{default:u(()=>[S("*Mostrando data desde, "+h(E.dateRange.start)+" hasta "+h(E.dateRange.end),1)]),_:1}),n(X,null,{default:u(()=>[S("*Este informe muestra un l\xEDmite m\xE1ximo de "+h(p($))+" registros",1)]),_:1})])])]),_:1}),l("div",Te,[l("div",Pe,[l("div",qe,[n(be,{clearable:"",density:"compact",disabled:p(V),modelValue:p(C),"onUpdate:modelValue":t[0]||(t[0]=e=>U(C)?C.value=e:null),items:p(le),variant:"outlined",label:"Ordenar registros","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])]),l("div",Ne,[n(ye,{style:{"min-width":"90px"},modelValue:p(_),"onUpdate:modelValue":t[1]||(t[1]=e=>U(_)?_.value=e:null),items:re,"item-title":"title","item-value":"value",label:"Escoge cuantos registros mostrar:","persistent-hint":"","return-object":"","single-line":""},null,8,["modelValue"])])]),n(Ce,{class:"my-5"}),n(xe,{class:"text-no-wrap invoice-list-table custom-dark-table"},{default:u(()=>[Ue,l("tbody",null,[(P(!0),q(we,null,Re(p(z),(e,s)=>(P(),q("tr",{key:s,style:{height:"3.75rem"}},[l("td",Be,h(s+1),1),l("td",je,[n(Ve,{class:"px-0",title:e.title,style:{"font-size":"18px"}},{default:u(()=>[l("small",null,h(e.title),1)]),_:2},1032,["title"])]),l("td",Ae,[n(B,Z({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:u(()=>[S(h(e.preview),1)]),_:2},1040)]),l("td",Fe,[n(B,Z({label:""},{status:"Paid",chip:{color:"success"}},{size:"small"}),{default:u(()=>[S(h(e.click),1)]),_:2},1040)]),l("td",null,[n(B,{color:"success"},{default:u(()=>[S(h(e.idCampaign.title),1)]),_:2},1024)]),l("td",Ie,[n(N,{href:e.url,target:"_blank",variant:"text",color:"info",icon:"mdi-link-variant"},null,8,["href"]),n(N,{title:"Descargar usuarios que interactuaron en esta p\xE1gina",variant:"text",loading:p(R)[s],disabled:p(R)[s],color:"warning",icon:"mdi-account-arrow-down-outline",onClick:o=>ae(s,e.title)},null,8,["loading","disabled","onClick"]),n(ee,{"open-on-click":"","open-on-hover":!1,location:"top",activator:"parent","no-click-animation":"",disabled:!p(R)[s]},{default:u(()=>[Le]),_:2},1032,["disabled"])])]))),128))]),De(l("tfoot",null,Ge,512),[[ke,!p(z).length]])]),_:1}),n(Se,{class:"mt-5",modelValue:p(k),"onUpdate:modelValue":t[2]||(t[2]=e=>U(k)?k.value=e:null),length:p(ie),"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1})]))}};export{We as default};
