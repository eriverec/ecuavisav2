import{r as C,as as N,o as f,x as w,a as t,w as s,q as d,f as A,h as T,b as c,p as h,g as E,F as B,C as q,c as v,b4 as $,b5 as z,aM as I,t as H,c7 as V,b6 as L,V as p,e as r,n as _,bC as b,a3 as k,N as O,b3 as R}from"./index.88d3c7f5.js";import{V as G}from"./VTextarea.86fae113.js";const J={class:"mr-2 mb-2"},K={class:"text-uppercase"},Q={class:"demo-space-x"},W=c("span",{class:"text-disabled text-sm"},"Selecciona el pa\xEDs y la ciudad donde se mostrar\xE1 el modal a los usuarios.",-1),X=c("span",{class:"text-disabled text-sm"},"Puedes seleccionar el horario en el que se mostrar\xE1 el modal.",-1),Y={class:"gap-5"},Z=c("span",{class:"text-disabled text-sm"},"El modal permanece fija en web",-1),ee={class:"d-flex",style:{"justify-content":"flex-end"}},oe={__name:"modals",setup(te){const n=C([]),y=C(!1),m=C([]),F=async()=>{try{const i=await(await fetch("https://ecuavisa-suscripciones.vercel.app/otros/obtener-paises-ciudades")).json();m.value=i}catch(o){console.error("Error fetching countries and cities:",o)}},P=o=>{const i=n.value[o];i.selectedCountry&&(!i.availableCities||i.availableCities.length===0)&&g(o)},g=o=>{const i=n.value[o].selectedCountry;if(i&&typeof i=="object"){const e=m.value.find(l=>l.countryCode===i.countryCode);e&&(n.value[o].availableCities=e.data,n.value[o].selectedCities=n.value[o].selectedCities.filter(l=>l.countryCode===i.countryCode))}else n.value[o].availableCities=[],n.value[o].selectedCities=[]},x=async()=>{try{const i=await(await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/suscripciones/modalondemand/v2/getData.php")).json();n.value=i.modals.map(e=>{const l={estado:e.estado==="true",region:e.region==="true",persistencia:e.persistencia==="true",estadoHorario:e.estadoHorario==="true",titulo:e.titulo,hInicio:e.hInicio,hFin:e.hFin,contenido:e.contenido,url:e.url||[],selectedCountry:e.paisCode?{country:e.pais,countryCode:e.paisCode}:null,selectedCities:[],availableCities:[]};if(l.selectedCountry){const a=m.value.find(u=>u.countryCode===l.selectedCountry.countryCode);a&&(l.availableCities=a.data,e.cities&&Array.isArray(e.cities)&&(l.selectedCities=e.cities.map(u=>a.data.find(S=>S.city===u.city)||u)))}return l})}catch(o){console.error("Error fetching data:",o)}};N(async()=>{await F(),await x()});const j=()=>{n.value.push({estado:!1,region:!1,estadoHorario:!1,persistencia:!1,titulo:"",hInicio:"",hFin:"",contenido:"",url:[],selectedCountry:null,selectedCities:[],availableCities:[]})},D=o=>{confirm("\xBFEst\xE1s seguro de que deseas eliminar este modal")&&(n.value.splice(o,1),setTimeout(async()=>{await U()},500))},U=async()=>{if(n.value.filter(e=>e.region?!e.selectedCountry||e.selectedCities.length===0:!1).length>0){alert("Por favor complete los campos de Pa\xEDs y Ciudad en los modales que tienen regi\xF3n activada");return}const i={key:"modalondemand",modals:n.value.map(e=>{var l,a;return{estado:e.estado?"true":"false",region:e.region?"true":"false",persistencia:e.persistencia?"true":"false",estadoHorario:e.estadoHorario?"true":"false",titulo:e.titulo,hInicio:e.hInicio,hFin:e.hFin,contenido:e.contenido,url:e.url,paisCode:((l=e.selectedCountry)==null?void 0:l.countryCode)||"",pais:((a=e.selectedCountry)==null?void 0:a.country)||"",cities:e.selectedCities.map(u=>({city:u.city,countryCode:u.countryCode}))}})};try{const l=await(await fetch("https://estadisticas.ecuavisa.com/sites/gestor/Tools/suscripciones/modalondemand/v2/index.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();l.success?(y.value=!0,x()):console.error("Error actualizando:",l.error)}catch(e){console.error("Error updating data:",e)}},M=o=>o?"Activo":"Inactivo";return(o,i)=>(f(),w("div",null,[t(A,{timeout:2e3,modelValue:y.value,"onUpdate:modelValue":i[0]||(i[0]=e=>y.value=e),color:"success",transition:"scale-transition",location:"top end"},{default:s(()=>[d(" Datos actualizados correctamente ")]),_:1},8,["modelValue"]),t(E,{class:"mt-5 card",title:"Modal Omdemand",subtitle:"Ecuavisa"},{default:s(()=>[t(T,null,{default:s(()=>[c("div",J,[t(h,{onClick:j,color:"primary"},{default:s(()=>[d(" Agregar ")]),_:1})])]),_:1})]),_:1}),t(R,{class:"mt-5 mb-5"},{default:s(()=>[(f(!0),w(B,null,q(n.value,(e,l)=>(f(),v($,{key:l,value:l},{default:s(()=>[t(z,null,{default:s(()=>[c("span",K,[t(I,{class:"mr-2",variant:"outlined",color:"primary"},{default:s(()=>[d(H(`Modal ${l+1}`),1)]),_:2},1024),d(" "+H(e.titulo||"T\xEDtulo"),1)]),t(V,{class:"mx-5",modelValue:e.estado,"onUpdate:modelValue":a=>e.estado=a,inset:"",label:M(e.estado)},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),t(L,null,{default:s(()=>[t(E,{flat:""},{default:s(()=>[t(T,null,{default:s(()=>[t(p,{id:"modal"},{default:s(()=>[t(r,{cols:"12"},{default:s(()=>[t(_,{label:"Titulo",modelValue:e.titulo,"onUpdate:modelValue":a=>e.titulo=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"12"},{default:s(()=>[t(G,{rows:"10",label:"Contenido del modal",type:"text",modelValue:e.contenido,"onUpdate:modelValue":a=>e.contenido=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"12"},{default:s(()=>[c("div",Q,[t(b,{class:"listUrls","closable-chips":"","clear-icon":"tabler-circle-x",modelValue:e.url,"onUpdate:modelValue":a=>e.url=a,multiple:"",chips:"",items:e.url,variant:"outlined",label:"URLS"},null,8,["modelValue","onUpdate:modelValue","items"])])]),_:2},1024),t(r,{cols:"12"},{default:s(()=>[t(V,{class:"",modelValue:e.region,"onUpdate:modelValue":a=>e.region=a,inset:"",label:"Regi\xF3n"},null,8,["modelValue","onUpdate:modelValue"]),W]),_:2},1024)]),_:2},1024),e.region?(f(),v(p,{key:0},{default:s(()=>[t(r,{cols:"6"},{default:s(()=>[t(b,{label:"Pa\xEDs",chips:"",modelValue:e.selectedCountry,"onUpdate:modelValue":[a=>e.selectedCountry=a,a=>g(l)],items:m.value,"item-title":"country","item-value":"countryCode","hide-no-data":!1,"menu-props":{maxHeight:"300"},"return-object":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(r,{cols:"6"},{default:s(()=>[t(b,{label:"Ciudad","closable-chips":"","clear-icon":"tabler-circle-x",chips:"",multiple:"",modelValue:e.selectedCities,"onUpdate:modelValue":[a=>e.selectedCities=a,a=>P(l)],items:e.availableCities,"item-title":"city","item-value":"city","hide-no-data":!1,"menu-props":{maxHeight:"300"},disabled:!e.selectedCountry,"return-object":"",clearable:""},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024)]),_:2},1024)):k("",!0),t(p,{class:"mt-5"},{default:s(()=>[t(r,{cols:"12"},{default:s(()=>[t(V,{class:"displaynex",modelValue:e.estadoHorario,"onUpdate:modelValue":a=>e.estadoHorario=a,inset:"",label:"Horario"},null,8,["modelValue","onUpdate:modelValue"]),X]),_:2},1024)]),_:2},1024),e.estadoHorario?(f(),v(p,{key:1,class:"pt-4"},{default:s(()=>[t(r,{cols:"3"},{default:s(()=>[t(_,{modelValue:e.hInicio,"onUpdate:modelValue":a=>e.hInicio=a,label:"Hora de inicio",type:"time",suffix:"Tiempo"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"3"},{default:s(()=>[t(_,{modelValue:e.hFin,"onUpdate:modelValue":a=>e.hFin=a,label:"Hora de fin",type:"time",suffix:"Tiempo"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):k("",!0),t(p,{class:"mt-5"},{default:s(()=>[t(r,{cols:"12"},{default:s(()=>[c("div",Y,[t(V,{class:"displaynex",modelValue:e.persistencia,"onUpdate:modelValue":a=>e.persistencia=a,inset:"",label:"Persistencia"},null,8,["modelValue","onUpdate:modelValue"]),Z])]),_:2},1024)]),_:2},1024),t(p,null,{default:s(()=>[t(r,{cols:"2"},{default:s(()=>[t(h,{color:"error",variant:"text",onClick:a=>D(l)},{default:s(()=>[t(O,{start:"",icon:"tabler-trash"}),d("Eliminar ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),c("div",ee,[t(h,{onClick:U,color:"success",variant:"tonal"},{default:s(()=>[d(" Guardar ")]),_:1})])]))}};export{oe as default};
