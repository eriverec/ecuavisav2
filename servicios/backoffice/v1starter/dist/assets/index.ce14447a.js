import{r as l,as as Q,Q as J,o as t,x as m,a as s,w as e,e as E,g as z,aR as G,q as i,b2 as H,c as f,h as w,b as h,aT as A,a3 as v,p as K,t as j,aM as D,V as L}from"./index.88d3c7f5.js";const W={class:"d-flex align-center gap-4"},X={key:0,class:"d-flex align-center gap-4 mt-5"},Y={class:"d-flex d-none align-center mt-5"},Z={class:"d-flex gap-3 justify-center align-start flex-column mt-4"},ee={class:"text-h5 font-bold"},ae={key:1,class:"gap-3 d-flex justify-center align-center"},te={key:0},se={key:0},oe={__name:"index",setup(le){const I="https://api.sendpulse.com/oauth/access_token",U="c79f7382012df0ea4c6fa37afec6374e",P="164551af334e1ec93e1b3099afd93a88",x=l([]),o=l(null),y=l(!1),R=l([]),_=l(null),d=l("0"),C=l(""),c=l(""),V=l(""),b=async()=>(await(await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"client_credentials",client_id:U,client_secret:P})})).json()).access_token;Q(async()=>{const n=await(await fetch("https://api.sendpulse.com/campaigns?order=desc",{headers:{Authorization:`Bearer ${await b()}`}})).json();x.value=n.slice(0,10).map(a=>({id:a.id,title:a.name})),J(o,async()=>{if(o.value){const a=o.value,g=await(await fetch(`https://api.sendpulse.com/campaigns/${a}`,{headers:{Authorization:`Bearer ${await b()}`}})).json();R.value=g.statistics.general.map(r=>({code:r.code,title:r.explain}))}})});const q=async()=>{var B,N;y.value=!0;const u=_.value,a=await(await fetch(`https://api.sendpulse.com/campaigns/${o.value}`,{headers:{Authorization:`Bearer ${await b()}`}})).json(),k=((B=a.statistics.general.find(p=>p.code===u))==null?void 0:B.count)||0,g=((N=a.statistics.general.find(p=>p.code===u))==null?void 0:N.explain)||0;C.value=g,console.log("selectedExplain",g);const r=a.all_email_qty||0,F=k/r*100;console.log(k/r);const T=F;c.value=T,console.log("resultT",c.value);function M(p){const S=Number.parseFloat(p).toFixed(2),[$,O]=S.split(".");return O==="00"?$==="0"?"El valor inial es 0":`${$}`:`${S}`}d.value=M(T),V.value=d.value>=0&&d.value<=8?"Es aceptable, cuanto m\xE1s bajo, mejor":"No es bueno, cuanto m\xE1s bajo, mejor",console.log(d.value),console.log(V.value),y.value=!1};return(u,n)=>(t(),m("div",null,[s(L,{class:"align-center"},{default:e(()=>[s(E,{sm:"7",cols:"12"},{default:e(()=>[s(z,null,{default:e(()=>[s(G,null,{default:e(()=>[i("Churnrate")]),_:1}),s(H,null,{default:e(()=>[i('Una tasa de abandono buena o "aceptable" es del 2% al 8%')]),_:1}),x.value.length>1?(t(),f(w,{key:0},{default:e(()=>[h("div",W,[s(A,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=a=>o.value=a),items:x.value,"item-text":"title","item-value":"id",style:{width:"480px",flex:"none"},density:"compact",label:"Selecciona una campa\xF1a"},null,8,["modelValue","items"])]),o.value?(t(),m("div",X,[s(A,{modelValue:_.value,"onUpdate:modelValue":n[1]||(n[1]=a=>_.value=a),items:R.value,"item-text":"title","item-value":"code",style:{width:"480px",flex:"none"},density:"compact",label:"Selecciona la estadistica"},null,8,["modelValue","items"])])):v("",!0),h("div",Y,[_.value?(t(),f(K,{key:0,onClick:q},{default:e(()=>[i("Calcular")]),_:1})):v("",!0)])]),_:1})):(t(),f(w,{key:1},{default:e(()=>[i("Cargando...")]),_:1}))]),_:1})]),_:1}),s(E,{sm:"5",cols:"12"},{default:e(()=>[C.value?(t(),f(z,{key:0},{default:e(()=>[s(w,null,{default:e(()=>[h("div",Z,[h("span",ee,"Resultado de la tasa de abandono de "+j(C.value)+" (Churnrate)",1),y.value?(t(),f(D,{key:0,size:"large"},{default:e(()=>[i("Calculando...")]),_:1})):(t(),m("div",ae,[s(D,{color:`${c.value>=0&&c.value<=8?"success":"error"}`,size:"large"},{default:e(()=>[i(j(d.value)+" ",1),c.value!=0?(t(),m("span",te,"%")):v("",!0)]),_:1},8,["color"]),c.value!=0?(t(),m("span",se,j(V.value),1)):v("",!0)]))])]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1})]))}};export{oe as default};
