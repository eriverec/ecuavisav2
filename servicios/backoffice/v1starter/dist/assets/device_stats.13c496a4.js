import{M as A,r as p,Q as D,as as N,o as v,x as m,b,a as c,w as h,N as I,q as $,p as C,a$ as O,c as T,u as L,bx as q,bb as R,bd as F,be as M}from"./index.88d3c7f5.js";import{V as U}from"./VTooltip.2d0a8708.js";const E=u=>(F("data-v-9b722ff0"),u=u(),M(),u),P={class:"stats-container"},Q={class:"d-flex align-center justify-space-between mb-6"},Y=E(()=>b("div",{class:"date-picker-wrapper",style:{width:"calc(100% - 48px)"}},null,-1)),G={class:"d-flex justify-center align-center gap-6 mb-6"},H={key:0,class:"text-center py-8"},J=E(()=>b("div",{class:"mt-4"},"Cargando estad\xEDsticas...",-1)),K={key:1},W={key:1,class:"text-center py-8"},X={__name:"device_stats",props:{campaignId:{type:String,required:!0},dateRange:{type:Object,required:!0}},emits:["loading"],setup(u,{emit:S}){const n=u,y=p(!1),w=p(!1),i=p(!0),l=p(!0),k=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},V=new Date;p({start:k(V),end:k(V)});const B=async()=>{w.value=!0;try{const e=await R.get(`https://ads-service.vercel.app/grafico/stats-diario/btn-descargar/${n.campaignId}`,{params:{fechai:n.dateRange.start,fechaf:n.dateRange.end,page:1,limit:5e3}});if(e.data.resp&&e.data.data){const t=e.data.data.map(s=>({cliente:s.cliente,created_at_campaign:new Date(s.created_at_campaign).toLocaleString(),type:s.type,wylexId:s.user.wylexId,email:s.user.email,first_name:s.user.first_name,last_name:s.user.last_name,phone_number:s.user.phone_number||""})),o=["cliente","created_at_campaign","type","wylexId","email","first_name","last_name","phone_number"],_=[o.join(","),...t.map(s=>o.map(f=>`"${s[f]}"`).join(","))].join(`
`),j=new Blob([_],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),r=k(new Date);a.href=URL.createObjectURL(j),a.setAttribute("download",`stats_dispositivos_${r}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}}catch(e){console.error("Error al descargar los datos:",e)}finally{w.value=!1}},d=p({series:[],options:{chart:{type:"donut",height:400},labels:[],colors:["#7367F0","#28C76F","#EA5455"],legend:{position:"bottom",horizontalAlign:"center"},plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"Total",formatter:function(e){return e.globals.seriesTotals.reduce((t,o)=>t+o,0)}}}}}},dataLabels:{enabled:!0,formatter:function(e,t){return t.w.config.series[t.seriesIndex]}},tooltip:{y:{formatter:function(e){return e+" interacciones"}}}}}),z=e=>{const t={desktop:{clicks:0,views:0},movil:{clicks:0,views:0}};Object.keys(e).forEach(a=>{var r,s;(r=e[a])!=null&&r.click&&(t[a].clicks=e[a].click.reduce((f,x)=>f+x.total,0)),(s=e[a])!=null&&s.preview&&(t[a].views=e[a].preview.reduce((f,x)=>f+x.total,0))});const o=[],_=[];return Object.keys(t).forEach(a=>{let r=0,s=`${a.charAt(0).toUpperCase()+a.slice(1)} (`;i.value&&l.value?(r=t[a].clicks+t[a].views,s+=`${t[a].views} vistas, ${t[a].clicks} clicks)`):i.value?(r=t[a].clicks,s+=`${t[a].clicks} clicks)`):l.value&&(r=t[a].views,s+=`${t[a].views} vistas)`),r>0&&(o.push(r),_.push(s))}),{series:o,labels:_}},g=async()=>{y.value=!0,S("loading",!0);try{const e=await R.get(`https://ads-service.vercel.app/grafico/stats-dispositivos/${n.campaignId}`,{params:{fechai:n.dateRange.start,fechaf:n.dateRange.end,page:1,limit:5e5}});if(e.data.resp&&e.data.data){const{series:t,labels:o}=z(e.data.data);d.value={...d.value,series:t,options:{...d.value.options,labels:o}}}}catch(e){console.error("Error fetching device stats:",e)}finally{y.value=!1,S("loading",!1)}};return D(()=>n.dateRange,e=>{e&&g()},{deep:!0}),D(()=>n.campaignId,e=>{e&&g()},{immediate:!0}),D([i,l],()=>{if(!i.value&&!l.value){l.value=!0;return}g()}),N(()=>{n.campaignId&&g()}),(e,t)=>(v(),m("div",P,[b("div",Q,[Y,c(C,{icon:"",variant:"text",size:"large",loading:w.value,onClick:B,class:"download-btn"},{default:h(()=>[c(I,{icon:"tabler-download",size:"24",color:"grey-darken-1"}),c(U,{activator:"parent",location:"top"},{default:h(()=>[$("Descargar datos")]),_:1})]),_:1},8,["loading"])]),b("div",G,[c(C,{variant:"text",color:i.value?"primary":"grey",onClick:t[0]||(t[0]=o=>i.value=!i.value),class:"filter-btn"},{default:h(()=>[c(I,{icon:i.value?"tabler-mouse-filled":"tabler-mouse",size:"20",class:"me-2"},null,8,["icon"]),$(" Clicks ")]),_:1},8,["color"]),c(C,{variant:"text",color:l.value?"primary":"grey",onClick:t[1]||(t[1]=o=>l.value=!l.value),class:"filter-btn"},{default:h(()=>[c(I,{icon:l.value?"tabler-eye-filled":"tabler-eye",size:"20",class:"me-2"},null,8,["icon"]),$(" Impresiones ")]),_:1},8,["color"])]),y.value?(v(),m("div",H,[c(O,{indeterminate:"",color:"primary"}),J])):(v(),m("div",K,[d.value.series.length>0?(v(),T(L(q),{key:0,options:d.value.options,series:d.value.series,height:400,width:"100%"},null,8,["options","series"])):(v(),m("div",W," No hay datos disponibles para el per\xEDodo seleccionado "))]))]))}},te=A(X,[["__scopeId","data-v-9b722ff0"]]);export{te as default};
