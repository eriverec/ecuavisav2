import{r as n,v as me,as as pe,o,x as g,a as t,w as l,e as w,f as fe,u as a,q as f,t as b,g as z,aR as X,aQ as v,b as u,n as P,i as I,b1 as Y,p as D,c as i,aW as Z,F as K,C as F,a3 as m,h as C,a2 as ee,l as ve,m as _e,V as L}from"./index.88d3c7f5.js";/* empty css              */import{V as he}from"./VPagination.9412c3b8.js";import{V as ye,a as ge}from"./VRadioGroup.4905b4ef.js";const be={class:"d-flex gap-4 mt-2"},Ve=u("thead",null,[u("tr",null,[u("th",{scope:"col"},"Nombre"),u("th",{scope:"col"},"Id de regla")])],-1),ke=["onClick"],we={class:"text-medium-emphasis"},xe={class:"text-medium-emphasis"},Ce=u("h3",null,"Seleccione el usuario que respondera la trivia",-1),Ue={class:"d-flex mt-2 gap-4"},Te=u("thead",null,[u("tr",null,[u("th",{scope:"col"},"Usuario"),u("th",{scope:"col"},"Correo")])],-1),Se=["onClick"],Ne={class:"text-medium-emphasis"},je={class:"text-medium-emphasis"},qe=u("h3",null,"Preguntas de la trivia",-1),Ee=u("h5",null,"Seleccione la opci\xF3n correcta:",-1),Re={key:2,cols:"12"},Ke={__name:"form",setup($e){const V=n([]),p=n(!1),q=n(!1),U=n(""),M=n(!1),E=n(!1),A=n(""),H=n(""),_=n({}),R=n({}),h=n({message:"Datos guardados",type:"success",model:!1}),y=n(1),$=n(100),G=n(0),ae=me(()=>Math.ceil(G.value/$.value)),le=r=>{y.value=r,Q()},J=async()=>{p.value=!0;try{const s=await(await fetch(`https://ecuavisa-desafio-trivias.vercel.app/trivia/all/get?page=${y.value}&limit=${$.value}`)).json();s.resp?V.value=s.data:(V.value=[],console.log("no hay nada para mostrar"))}catch(r){console.error("Error al realizar la b\xFAsqueda:",r)}finally{p.value=!1}};pe(async()=>{await J()});const te=async()=>{E.value=!1,M.value=!1,U.value="",y.value=1,_.value=null,await J()},O=()=>{E.value=!1,y.value=1,Q(),M.value=!0},Q=async()=>{p.value=!0;try{const s=await(await fetch(`https://ecuavisa-desafio-trivias.vercel.app/trivia/search/name?nombre=${U.value}&page=${y.value}&limit=${$.value}`)).json();s.resp?V.value=s.data:(V.value=[],console.log("no hay nada para mostrar"))}catch(r){console.error("Error al realizar la b\xFAsqueda:",r)}finally{p.value=!1}},se=async(r,s)=>{H.value=r,_.value=null,R.value=null,A.value=s,E.value=!0,q.value=!0;try{const d=await(await fetch(`https://ecuavisa-desafio-trivias.vercel.app/trivia/get/${r}`)).json();if(d.resp&&d.data){const c=d.data;let x=Array.from(c.preguntas);R.value=c;let W=x.map(j=>({...j,respuesta:""}));_.value=W}else _.value=null,R.value=null}catch(e){console.error("Error al obtener detalles de la trivia:",e),_.value=null,R.value=null}finally{q.value=!1}};function oe(r){for(let s=0;s<r.length;s++){let e=r[s];for(let d in e)if(e.hasOwnProperty(d)){if(d==="opciones"){if(!e[d].every(c=>c.trim()!==""))return!1}else if(e[d].trim()==="")return!1}}return!0}async function re(){let r=_.value;if(!oe(r))return h.value={message:"Debe llenar todos los campos",type:"error",model:!0},!1;if(!N.value.id)return h.value={message:"Debe seleccionar un usuario",type:"error",model:!0},!1;let s=r.map(({pregunta:de,respuesta:ce})=>({pregunta:de,respuesta:ce}));var e=new Headers;e.append("Content-Type","application/json");let d={idTrivia:H.value,idUsuario:N.value.id,respuesta:s};var c=JSON.stringify(d),x={method:"POST",headers:e,body:c,redirect:"follow"};const j=await(await fetch("https://ecuavisa-desafio-trivias.vercel.app/triviaUsuario/create",x)).json();if(j.resp)h.value={message:"Respuestas enviadas correctamente",type:"success",model:!0};else return h.value={message:j.mensaje,type:"error",model:!0},console.error(j.error),!1}const B=n(""),T=n(!1),S=n([]),k=n(!1),N=n({id:null,usuario:""});async function ue(){T.value=!0,k.value=!0,await ne(),k.value=!1}const ne=async()=>{try{const s=await(await fetch(`https://ads-service.vercel.app/busqueda/user/?s=${B.value}`)).json();s.resp?S.value=s.data.slice(0,5):(S.value=[],console.log("no hay nada para mostrar"))}catch(r){console.error("Error al realizar la b\xFAsqueda:",r)}finally{}};function ie(r,s,e){N.value={id:r,usuario:s+" "+e}}return(r,s)=>(o(),g("section",null,[t(L,null,{default:l(()=>[t(w,{cols:"12",sm:"12",lg:"12"},{default:l(()=>[t(fe,{modelValue:a(h).model,"onUpdate:modelValue":s[0]||(s[0]=e=>a(h).model=e),location:"top end",variant:"flat",timeout:a(h).timeout||2e3,color:a(h).type},{default:l(()=>[f(b(a(h).message),1)]),_:1},8,["modelValue","timeout","color"]),t(z,{class:"mt-4"},{default:l(()=>[t(X,{class:"pt-4 pl-6"},{default:l(()=>[f("Buscar trivia a completar")]),_:1}),t(v,null,{default:l(()=>[u("div",be,[t(P,{modelValue:a(U),"onUpdate:modelValue":s[1]||(s[1]=e=>I(U)?U.value=e:null),onKeyup:Y(O,["enter"]),style:{"max-width":"400px"},label:"Buscar..."},null,8,["modelValue","onKeyup"]),t(D,{loading:a(p),disabled:a(p),color:"primary",size:"small",icon:"tabler-search",onClick:O},null,8,["loading","disabled"]),t(D,{disabled:a(p),color:"primary",size:"small",icon:"tabler-refresh",onClick:te},null,8,["disabled"])])]),_:1}),a(p)?(o(),i(v,{key:0},{default:l(()=>[f(" Cargando datos... ")]),_:1})):!a(p)&&a(V).length>0?(o(),i(v,{key:1},{default:l(()=>[t(Z,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:l(()=>[Ve,u("tbody",null,[(o(!0),g(K,null,F(a(V),e=>(o(),g("tr",{onClick:d=>se(e._id,e.nombre),class:"clickable"},[u("td",we,b(e.nombre),1),u("td",xe,b(e.idRegla),1)],8,ke))),256))])]),_:1}),a(G)>a($)?(o(),i(he,{key:0,modelValue:a(y),"onUpdate:modelValue":[s[2]||(s[2]=e=>I(y)?y.value=e:null),le],size:"small","total-visible":5,length:a(ae),class:"mb-4"},null,8,["modelValue","length"])):m("",!0)]),_:1})):m("",!0),!a(p)&&a(V).length===0?(o(),i(v,{key:2},{default:l(()=>[f(" No se han encontrado datos ")]),_:1})):m("",!0)]),_:1})]),_:1}),a(E)?(o(),i(w,{key:0,cols:"12",sm:"12",lg:"12"},{default:l(()=>[a(q)?(o(),i(z,{key:0,class:"mt-4"},{default:l(()=>[t(v,null,{default:l(()=>[f(" Cargando datos... ")]),_:1})]),_:1})):!a(q)&&a(_).length>0?(o(),i(z,{key:1,class:"mt-4"},{default:l(()=>[t(X,{class:"pt-4 pl-6"},{default:l(()=>[f("Completar "+b(a(A)),1)]),_:1}),t(v,{style:{"margin-bottom":"-1rem"}},{default:l(()=>[Ce]),_:1}),t(v,null,{default:l(()=>[u("div",Ue,[t(P,{modelValue:a(B),"onUpdate:modelValue":s[3]||(s[3]=e=>I(B)?B.value=e:null),onKeyup:Y(O,["enter"]),style:{"max-width":"400px"},label:"Buscar usuario..."},null,8,["modelValue","onKeyup"]),t(D,{loading:a(k),disabled:a(k),color:"primary",size:"small",icon:"tabler-search",onClick:ue},null,8,["loading","disabled"]),t(P,{class:"ml-6",modelValue:a(N).usuario,"onUpdate:modelValue":s[4]||(s[4]=e=>a(N).usuario=e),style:{"max-width":"400px"},label:"Usuario seleccionado",readonly:""},null,8,["modelValue"])]),a(T)==!0&&a(k)==!0?(o(),i(C,{key:0,class:"mt-2"},{default:l(()=>[f(" Cargando datos... ")]),_:1})):a(S).length>0&&a(T)==!0&&a(k)==!1?(o(),i(C,{key:1,class:"mt-2"},{default:l(()=>[t(Z,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:l(()=>[Te,u("tbody",null,[(o(!0),g(K,null,F(a(S),e=>(o(),g("tr",{onClick:d=>ie(e.wylexId,e.first_name,e.last_name),class:"clickable"},[u("td",Ne,b(e.first_name+" "+e.last_name),1),u("td",je,b(e.email),1)],8,Se))),256))])]),_:1})]),_:1})):m("",!0),a(T)==!0&&a(k)==!1&&a(S).length==0?(o(),i(C,{key:2,class:"mt-2"},{default:l(()=>[f(" No existen usuarios que coincidan con la busqueda ")]),_:1})):m("",!0),a(T)==!0?(o(),i(ee,{key:3,class:"mt-4"})):m("",!0)]),_:1}),t(v,{style:{"margin-bottom":"-2rem","margin-top":"-1rem"}},{default:l(()=>[qe]),_:1}),t(v,null,{default:l(()=>[t(C,null,{default:l(()=>[t(ve,{class:"mt-6",onSubmit:_e(re,["prevent"])},{default:l(()=>[t(L,{class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[t(L,null,{default:l(()=>[(o(!0),g(K,null,F(a(_),(e,d)=>(o(),i(w,{cols:"12",class:"w-100"},{default:l(()=>[t(C,null,{default:l(()=>[t(w,{cols:"12"},{default:l(()=>[u("h4",null,b(d+1)+". "+b(e.pregunta),1)]),_:2},1024),e.tipo=="opciones"||e.tipo=="votacion"?(o(),i(w,{key:0,cols:"12"},{default:l(()=>[Ee]),_:1})):m("",!0),e.tipo=="texto"?(o(),i(w,{key:1,cols:"12"},{default:l(()=>[t(P,{modelValue:e.respuesta,"onUpdate:modelValue":c=>e.respuesta=c,label:"Respuesta",placeholder:"Escriba la respuesta correcta"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)):m("",!0),e.tipo=="opciones"||e.tipo=="votacion"?(o(),g("div",Re,[t(C,{class:"text-center ml-4 my-4"},{default:l(()=>[t(ye,{modelValue:e.respuesta,"onUpdate:modelValue":c=>e.respuesta=c},{default:l(()=>[(o(!0),g(K,null,F(e.opciones,(c,x)=>(o(),i(ge,{label:e.opciones[x],value:e.opciones[x]},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)])):m("",!0)]),_:2},1024),d!=a(_).length-1?(o(),i(ee,{key:0,class:"mt-6"})):m("",!0)]),_:2},1024))),256))]),_:1}),t(w,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[t(D,{type:"submit"},{default:l(()=>[f(" Enviar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})):(o(),i(z,{key:2,class:"mt-4"},{default:l(()=>[t(v,null,{default:l(()=>[f(" No se han encontrado datos ")]),_:1})]),_:1}))]),_:1})):m("",!0)]),_:1})]))}};export{Ke as default};
