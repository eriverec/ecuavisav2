import{R as Ie,U as Ne,r,Q as $,v as ke,as as je,z as he,o as b,x as D,a as t,w as u,q as z,t as f,u as a,f as Ee,e as J,h as _e,b as s,aT as ae,i as T,$ as H,n as ne,a2 as ie,aU as ge,aV as ye,a1 as xe,c as de,a3 as A,p as W,V as ce,N as le,g as Le,aW as ze,F as Ae,C as Be,X as Oe,d as Re,Y as He,Z as Pe,ao as be,ap as we,a4 as qe,aX as Ge}from"./index.88d3c7f5.js";import{a as Je}from"./formatters.a9a9bf7f.js";import{M as We}from"./index.50982b4e.js";import{V as Xe}from"./VSpacer.2a3e77c9.js";import{V as Qe}from"./VPagination.9412c3b8.js";import{p as te}from"./parseISO.d0bde0b5.js";const Ze=s("h1",null,"Exportaci\xF3n de usuarios suscritos a un curso",-1),Ke={class:"me-3 d-flex gap-4"},ea={class:"app-user-search-filter d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},aa={key:0,style:{curso:"pointer"},class:"px-0 py-p m-0"},la={key:1,style:{curso:"pointer"},class:"px-0 py-p m-0"},ta={key:2,style:{curso:"pointer"},class:"px-0 py-p m-0"},oa={key:0,class:"px-0 py-1 text-disabled"},sa={key:0,class:"text-disabled"},ua={key:1,class:"text-disabled"},ra=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Nombres "),s("th",{scope:"col"}," Fecha de nacimiento "),s("th",{scope:"col"}," Tel\xE9fono "),s("th",{scope:"col"}," Fecha de registro "),s("th",{scope:"col"}," Ciudad "),s("th",{scope:"col"}," Acciones ")])],-1),na={key:0},ia={class:"d-flex align-center"},da={key:1},ca={class:"d-flex flex-column"},va={class:"text-base"},fa={class:"text-sm text-disabled"},pa={class:"text-base"},ma={class:"text-base"},ha={class:"text-base"},_a={class:"text-base"},ga={class:"text-center",style:{width:"5rem"}},ya=s("tr",null,[s("td",{colspan:"7",class:"text-center"}," No hay datos que mostrar ")],-1),xa=[ya],ba=s("tr",null,[s("td",{colspan:"7",class:"text-center"}," Cargando datos, por favor espere un momento... ")],-1),wa=[ba],Va={class:"text-sm text-disabled"},Ua={__name:"index",setup(Ya){const w=Ie.exports.extendMoment(We);w.locale("es",[Ne]),w.tz.setDefault("America/Guayaquil");const g=r("Fecha");r(null);const k=r(0);r(0);const B=r([]),i=r(1),X=r(0),h=r(10),d=r(null),M=r(""),oe=r(""),Q=r(null),se=r(!0),U=r(""),j=r(!1),E=r(null),O=r({loading:!1,disabled:!1}),S=r(null),Z=r(null),y=r(null),K=r(!1),F=r([]),ue=r([]),I=r(!1),R=w().format("YYYY-MM-DD"),re=w().subtract(30,"days").format("YYYY-MM-DD"),p=r({inicio:re,fin:R}),x=r({message:"Datos guardados",type:"success",model:!1}),P=r(""),L=r("curso_fecha"),ve=r({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",created_at:"created_at",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at_suscriber_course:"created_at_suscriber_course",ciudad:"ciudad",telefono:"telefono",birthDate:"birthDate"}),fe={fechasModel:[te(re),te(R)],fechasVModel:[te(R)],fechasVConfig:{position:"auto right",mode:"single",minDate:te(R),altFormat:"d F j, Y",dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0},fechai:re,fechaV:R,fechaf:R},C=r(fe);$(i,async()=>{i.value>X.value&&(i.value=X.value),await V(i.value,h.value,p.value.inicio,p.value.fin,d.value)}),$(h,async()=>{i.value=1,await V(i.value,h.value,p.value.inicio,p.value.fin,d.value)});const Ve=ke(()=>{const o=B.value.length?i.value*h.value:0;return B.value.length+i.value*h.value,k.value<h.value?`Mostrandos ${k.value} de ${k.value} registros `:`Mostrando ${o} de ${k.value} registros `});je(async()=>{await Ye()});async function pe(o=1,l=10,n=null){try{if(K.value=!0,!d.value)return F.value=[],y.value=null,K.value=!1,[];var m=new Headers;m.append("Content-Type","application/json");var c={method:"GET",headers:m,redirect:"follow"},e=await fetch(`https://servicio-elearning.vercel.app/curso/videos/${d.value}`,c);const v=await e.json();F.value=v.data.reduce((_,N)=>(_.push({title:`${N.titulo}`,value:N._id}),_),[]),ue.value=F.value,K.value=!1}catch(v){return console.error(v.message)}}async function V(o=1,l=10,n,m,c,e=""){try{if(!c)return!1;if(!y.value&&g.value=="Video")return x.value={message:"No se pudo seleccionar el video.",type:"error",model:!0},!1;I.value=!0;var v=new Headers;v.append("Content-Type","application/json");var _={method:"GET",headers:v,redirect:"follow"};g.value=="Fecha"&&(P.value=`https://servicio-elearning.vercel.app/grafico/exportar/usuarios/registrados?fechai=${n}&fechaf=${m}&idCurso=${c}&search=${e}`,L.value="curso_fecha",console.log(1)),g.value=="Curso"&&(L.value="curso_todos",P.value=`https://servicio-elearning.vercel.app/grafico/exportar/usuarios/all-registrados?idCurso=${c}&search=${e}`,console.log(2)),g.value=="Video"&&(L.value="curso_video",P.value=`https://servicio-elearning.vercel.app/grafico/exportar/usuarios/all-registrados-video?idCurso=${c}&idVideo=${y.value}`,console.log(3));var N=await fetch(`${P.value}&page=${o}&limit=${l}`,_);const Y=await N.json();if(Y.resp)B.value=Y.data,k.value=Y.total,X.value=Math.ceil(Y.total/Y.limit);else return x.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},I.value=!1,!1;I.value=!1}catch(Y){return x.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},I.value=!1,console.error(Y.message)}}async function Ye(o=1,l=10){try{se.value=!0;var n=new Headers;n.append("Content-Type","application/json");var m={method:"GET",headers:n,redirect:"follow"},c=await fetch("https://servicio-elearning.vercel.app/curso/all?limit=200&page=1",m);const e=await c.json();M.value=e.data.reduce((v,_)=>(v.push({title:`${_.titulo}`,value:_._id}),v),[]),oe.value=M.value,d.value=M.value[0].value,await pe(),se.value=!1}catch(e){return x.value={message:"No se pudo recuperar los cursos, recargue de nuevo.",type:"error",model:!0},console.error(e.message)}}$(async()=>U.value,async()=>{U.value?M.value=oe.value.filter(o=>o.title.toLowerCase().indexOf(U.value.toLowerCase())>-1||o.value.indexOf(U.value)>-1):M.value=oe.value}),$(Q,o=>{o||setTimeout(()=>{U.value=""},1e3)}),$(d,async()=>{d.value&&(i.value=1,await V(i.value,h.value,p.value.inicio,p.value.fin,d.value)),await pe()});const ee=r(!0);async function Me(o,l,n){o.length>1&&(y.value=null,ee.value=!0,i.value=1,C.value.fechai=w(o[0]).format("DD-MM-YYYY"),C.value.fechaf=w(o[1]).format("DD-MM-YYYY"),p.value.inicio=w(C.value.fechai,"DD-MM-YYYY").format("YYYY-MM-DD"),p.value.fin=w(C.value.fechaf,"DD-MM-YYYY").format("YYYY-MM-DD"),await V(i.value,h.value,p.value.inicio,p.value.fin,d.value)),o.length==2&&(y.value=null,C.value.fechasVConfig.minDate=o[1],C.value.fechasVModel=[o[1]],ee.value=!0),o.length==0&&(ee.value=!1,await V(i.value,h.value,null,null,d.value))}const q=r({tamanioActual:0,tamanioTotal:0}),G=r([]);async function Ce(o=1,l=10,n,m,c,e=""){try{if(!c)return!1;var v=new Headers;v.append("Content-Type","application/json");var _={method:"GET",headers:v,redirect:"follow"},N=await fetch(`${P.value}&page=${o}&limit=${l}`,_);const Y=await N.json();return Y.resp?Y:(x.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},j.value=!1,null)}catch(Y){return x.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(Y.message),j.value=!1,null}}function De(o){const l=new Set;return o.filter(n=>l.has(n.wylexId)?!1:(l.add(n.wylexId),!0))}async function Fe(){if(!d.value)return x.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},!1;q.value={tamanioActual:0,tamanioTotal:0},G.value=[];for(var o=1;;){const l=await Ce(o,500,p.value.inicio,p.value.fin,d.value,E.value||""),n=l.data,m=l.total;if(n.forEach(c=>{let e={};for(let v in ve.value)c.hasOwnProperty(v)?e[v]=c[v]:e[v]="";G.value.push(e)}),q.value.tamanioActual=G.value.length,q.value.tamanioTotal=m,G.value.sort((c,e)=>w(e.created_at,"DD/MM/YYYY-HH:mm:ss").diff(w(c.created_at,"DD/MM/YYYY-HH:mm:ss"))),o++,n.length<1)break}return!0}function $e(o){for(var l=typeof o!="object"?JSON.parse(o):o,n="",m=0;m<l.length;m++){var c="";for(var e in l[m])c!=""&&(c+=","),c+=l[m][e];n+=c+`\r
`}return n}function Te(o,l,n){o&&l[0].wylexId!=="wylexId"&&l.unshift(o);var m=JSON.stringify(l),c=$e(m),e=n+".csv"||"export.csv",v=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(v,e);else{var _=document.createElement("a");if(_.download!==void 0){var N=URL.createObjectURL(v);_.setAttribute("href",N),_.setAttribute("download",e),_.style.visibility="hidden",document.body.appendChild(_),_.click(),document.body.removeChild(_)}}}function me(o){const l={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00C1:"A",\u00C9:"E",\u00CD:"I",\u00D3:"O",\u00DA:"U",\u00F1:"n",\u00D1:"N"};return o.split("").map(m=>l[m]||m).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")+"-"+w().format("YYYY-MM-DD-HH-mm-ss")}async function Ue(){try{if(B.value.length<1)return x.value={message:"No hay datos que exportar.",type:"error",model:!0},!1;j.value=!0,await Fe(),j.value=!1;let l=[];l=G.value;var o=`${L.value}-`;(L.value=="curso_fecha"||L.value=="curso_todos")&&(o+=me(M.value.filter(n=>d.value.includes(n.value))[0].title)),L.value=="curso_video"&&(o+=me(F.value.filter(n=>y.value==n.value)[0].title)),qe("descarga-completa"),Te(ve.value,De(l),o)}catch(l){return console.log(l),x.value={message:"No se pudo recuperar los datos de usuario, recargue de nuevo.",type:"error",model:!0},!1}}const Se=async o=>{const l=E.value||"";i.value=1,O.value={loading:!0,disabled:!0},l?await V(i.value,h.value,p.value.inicio,p.value.fin,d.value,l):await V(i.value,h.value,p.value.inicio,p.value.fin,d.value,""),O.value={loading:!1,disabled:!1}};return $(E,async()=>{E.value||(i.value=1,O.value={loading:!0,disabled:!0},await V(i.value,h.value,p.value.inicio,p.value.fin,d.value,""),O.value={loading:!1,disabled:!1})}),$(async()=>S.value,async()=>{S.value?F.value=ue.value.filter(o=>o.title.toLowerCase().indexOf(S.value.toLowerCase())>-1||o.value.indexOf(S.value)>-1):F.value=ue.value}),$(Z,o=>{o||setTimeout(()=>{S.value=""},1e3)}),$(y,async()=>{i.value=1,y.value?await V(i.value,h.value,null,null,d.value):ee.value?(C.value.fechasModel=fe.fechasModel,await V(i.value,h.value,p.value.inicio,p.value.fin,d.value)):await V(i.value,h.value,null,null,d.value)}),$(g,async()=>{i.value=1,g.value&&(g.value=="Video"&&F.value.length>0&&(y.value=F.value[0].value),await V(i.value,h.value,p.value.inicio,p.value.fin,d.value))}),(o,l)=>{const n=he("v-list-item-content"),m=Ge,c=he("RouterLink");return b(),D("section",null,[t(Ee,{modelValue:a(x).model,"onUpdate:modelValue":l[0]||(l[0]=e=>a(x).model=e),location:"top end",variant:"flat",timeout:a(x).timeout||2e3,color:a(x).type},{default:u(()=>[z(f(a(x).message),1)]),_:1},8,["modelValue","timeout","color"]),t(ce,null,{default:u(()=>[t(J,{cols:"12",sm:"12",lg:"12"},{default:u(()=>[Ze,t(_e,{class:"d-flex py-4 gap-4 px-0 flex-wrap",style:{"align-items":"flex-start"}},{default:u(()=>[s("div",Ke,[t(ae,{class:"bg-white",modelValue:a(h),"onUpdate:modelValue":l[1]||(l[1]=e=>T(h)?h.value=e:null),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"]),t(ae,{label:"Exportar por","item-text":"title","item-value":"value",class:"bg-white",density:"compact",modelValue:a(g),"onUpdate:modelValue":l[2]||(l[2]=e=>T(g)?g.value=e:null),variant:"outlined",items:["Fecha","Curso","Video"]},null,8,["modelValue"]),t(ae,{style:{width:"16rem"},class:"bg-white",menu:a(Q),"onUpdate:menu":l[4]||(l[4]=e=>T(Q)?Q.value=e:null),"no-data-text":"No existen curso que mostrar",disabled:a(se),"item-text":"title","item-value":"value",modelValue:a(d),"onUpdate:modelValue":l[5]||(l[5]=e=>T(d)?d.value=e:null),items:a(M),chips:"",label:"Seleccionar el m\xF3dulo para el curso","menu-props":{maxHeight:"400"}},{"prepend-item":u(()=>[t(H,null,{default:u(()=>[t(n,null,{default:u(()=>[t(ne,{modelValue:a(U),"onUpdate:modelValue":l[3]||(l[3]=e=>T(U)?U.value=e:null),clearable:"",placeholder:"Buscar curso"},null,8,["modelValue"])]),_:1})]),_:1}),t(ie,{class:"mt-2"})]),selection:u(({item:e})=>[s("div",null,f(e.title),1)]),item:u(({item:e,props:v})=>[t(H,ge(ye(v)),{default:u(()=>[t(n,null,{default:u(()=>[t(xe,null,{default:u(()=>[s("p",null,"_id: "+f(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"]),a(g)=="Video"?(b(),de(ae,{key:0,style:{width:"17rem"},class:"bg-white",menu:a(Z),"onUpdate:menu":l[7]||(l[7]=e=>T(Z)?Z.value=e:null),"item-text":"title","item-value":"value",modelValue:a(y),"onUpdate:modelValue":l[8]||(l[8]=e=>T(y)?y.value=e:null),items:a(F),chips:"",attach:"",label:"Videos del curso seleccionado","no-data-text":"No existen videos que mostrar",disabled:a(K),"menu-props":{maxHeight:"300"}},{"prepend-item":u(()=>[t(H,null,{default:u(()=>[t(n,null,{default:u(()=>[t(ne,{modelValue:a(S),"onUpdate:modelValue":l[6]||(l[6]=e=>T(S)?S.value=e:null),clearable:"",placeholder:"Buscar video"},null,8,["modelValue"])]),_:1})]),_:1}),t(ie,{class:"mt-2"})]),selection:u(({item:e})=>[s("div",null,f(e.title)+" - "+f(e.value),1)]),item:u(({item:e,props:v})=>[t(H,ge(ye(v)),{default:u(()=>[t(n,null,{default:u(()=>[t(xe,null,{default:u(()=>[s("p",null,"_id: "+f(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","modelValue","items","disabled"])):A("",!0),a(g)=="Fecha"?(b(),de(m,{key:1,clearable:"",class:"bg-white",style:{width:"19rem"},label:"Fecha de inicio y fin del curso","prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:a(C).fechasModel,"onUpdate:modelValue":l[9]||(l[9]=e=>a(C).fechasModel=e),"show-current":"true",onOnChange:Me,config:{position:"auto right",mode:"range",altFormat:"d F j, Y",maxDate:new Date,dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0}},null,8,["modelValue"])):A("",!0)]),t(Xe),s("div",ea,[t(W,{loading:a(j),disabled:a(j)||a(I),variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",onClick:Ue},{default:u(()=>[a(g)=="Fecha"?(b(),D("span",aa,"Exportar b\xFAsqueda")):A("",!0),a(g)=="Curso"?(b(),D("span",la,"Exportar curso")):A("",!0),a(g)=="Video"?(b(),D("span",ta,"Exportar b\xFAsqueda")):A("",!0)]),_:1},8,["loading","disabled"]),a(j)?(b(),D("small",oa," Exportando "+f(a(q).tamanioActual)+" / "+f(a(q).tamanioTotal)+" registros ",1)):A("",!0)])]),_:1}),t(ce,{class:"pb-3 d-none"},{default:u(()=>[t(J,{cols:"12",sm:"2",lg:"2"},{default:u(()=>[t(ce,null,{default:u(()=>[t(J,{cols:"10",sm:"10",lg:"10"},{default:u(()=>[t(ne,{class:"bg-white",modelValue:a(E),"onUpdate:modelValue":l[10]||(l[10]=e=>T(E)?E.value=e:null),label:"Buscar....",type:"text",clearable:""},null,8,["modelValue"])]),_:1}),t(J,{cols:"2",sm:"2",lg:"2"},{default:u(()=>[t(W,{loading:a(O).loading,disabled:a(O).disabled,title:"Buscar usuario",block:"",onClick:Se},{default:u(()=>[t(le,{size:25,icon:"tabler-search"})]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t(J,{cols:"3",sm:"3",lg:"3"})]),_:1}),a(y)?(b(),D("small",ua,[z("Se ha filtrado usuarios del curso "),s("b",null,f(a(d)&&a(M).length>0?a(M).filter(e=>a(d).includes(e.value))[0].title:""),1),z(" , sobre el video de "),s("b",null,f(a(F).filter(e=>a(y)==e.value)[0].title),1),z(" con un total de "+f(a(k))+" registros ",1)])):(b(),D("small",sa,[z("Se ha filtrado usuarios del curso "),s("b",null,f(a(d)&&a(M).length>0?a(M).filter(e=>a(d).includes(e.value))[0].title:""),1),z(" , desde "+f(a(C).fechai)+" hasta "+f(a(C).fechaf)+" con un total de "+f(a(k))+" registros ",1)])),t(Le,{class:"mt-1"},{default:u(()=>[t(ze,{class:"text-no-wrap"},{default:u(()=>[ra,a(I)==!1?(b(),D("tbody",na,[(b(!0),D(Ae,null,Be(a(B),e=>(b(),D("tr",{key:e._id,style:{height:"3.75rem"}},[s("td",null,[s("div",ia,[t(Oe,{variant:"tonal",color:"success",class:"me-3",size:"38"},{default:u(()=>[e.avatar?(b(),de(Re,{key:0,src:e.avatar},null,8,["src"])):(b(),D("span",da,f(a(Je)(`${e.first_name} ${e.last_name}`)),1))]),_:2},1024),s("div",ca,[s("h6",va,[t(c,{to:{name:"apps-user-view-id",params:{id:e.wylexId}},class:"font-weight-medium user-list-name"},{default:u(()=>[z(f(e.first_name)+" "+f(e.last_name),1)]),_:2},1032,["to"])]),s("span",fa,"@"+f(e.email),1)])])]),s("td",null,[s("span",pa,f(e.birthDate),1)]),s("td",null,[s("span",ma,f(e.telefono),1)]),s("td",null,[s("span",ha,f(a(w)(e.created_at_suscriber_course).format("YYYY-MM-DD HH:mm:ss")),1)]),s("td",null,[s("span",_a,f(e.ciudad),1)]),s("td",ga,[t(W,{icon:"",size:"x-small",color:"default",variant:"text",to:{name:"apps-user-view-id",params:{id:e.wylexId}}},{default:u(()=>[t(le,{size:"22",icon:"tabler-eye"})]),_:2},1032,["to"]),t(W,{disabled:"true",icon:"",size:"x-small",color:"default",variant:"text"},{default:u(()=>[t(le,{size:"22",icon:"tabler-trash"})]),_:1}),t(W,{disabled:"true",icon:"",size:"x-small",color:"default",variant:"text"},{default:u(()=>[t(le,{size:"22",icon:"tabler-dots-vertical"}),t(He,{activator:"parent"},{default:u(()=>[t(Pe,null,{default:u(()=>[t(H,{title:"View",to:{name:"apps-user-view-id",params:{id:e.wylexId}}},null,8,["to"]),t(H,{title:"Suspend",href:"javascript:void(0)"})]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))])):A("",!0),be(s("tfoot",null,xa,512),[[we,!a(B).length&&a(I)==!1]]),be(s("tfoot",null,wa,512),[[we,a(I)]])]),_:1}),t(ie),t(_e,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:u(()=>[s("span",Va,f(a(Ve)),1),t(Qe,{modelValue:a(i),"onUpdate:modelValue":l[11]||(l[11]=e=>T(i)?i.value=e:null),size:"small","total-visible":5,length:a(X)},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{Ua as default};
