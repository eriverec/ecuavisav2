import{r as s,v as Z,as as N,o as r,x as p,a as t,w as o,q as i,f as S,g as I,aR as ee,bR as ae,p as m,b0 as le,e as $,h as z,b as n,m as te,n as oe,bC as se,t as A,F as U,C as M,c as T,u as P,S as ne,bU as re,X as Y,a3 as ie,V as ue}from"./index.88d3c7f5.js";import{V as de}from"./VFileInput.692026a8.js";import{V as ce}from"./VSlideGroupItem.ca4927bd.js";import{V as pe}from"./VPagination.9412c3b8.js";const me=["onSubmit"],ve=n("br",null,null,-1),fe=n("br",null,null,-1),ge=n("br",null,null,-1),_e={style:{display:"flex","justify-content":"flex-end"}},he={class:"mb-3"},be={class:"font-weight-medium text-base text-subtitle-2"},Ve={key:0},ye={key:1,class:"list_items_registros"},xe={class:"d-flex justify-space-between"},ke={class:"text-sm text-disabled"},we={style:{width:"110px",height:"94px",position:"relative"},class:"d-flex flex-column justify-center align-center rounded me-6"},Te={__name:"index",setup(Ee){const v=s("");s("");const F=s([]);let _=[];const h=s(!1),b=s(!1),V=s(!1),y=s(""),x=s([]),k=s(""),w=s(""),j=s(""),d=s(!1),f=s(1),E=s(6),C=s(0),B=s(0),q=Z(()=>Math.ceil(C.value/E.value)),H=a=>{f.value=a,c()},L=a=>{j.value=a,d.value=!0};async function G(){try{const e=await(await fetch("https://servicio-desafios.vercel.app/desafios")).json();x.value=e.data}catch(a){console.error("Error al obtener los desaf\xEDos:",a)}}N(G);const O=a=>{const e=x.value.find(l=>l.tituloDesafio===a);e&&(k.value=e._id,w.value=e.tituloDesafio,console.log(k.value))},J=[a=>!a||!a.length||a[0].size<15e5||"\xA1El tama\xF1o del avatar debe ser inferior a 1.5 MB!"],g=s([]),D=s(!0),R="https://phpstack-1011861-4362286.cloudwaysapps.com/uploads";async function c(){try{const e=await(await fetch(`https://servicio-niveles-puntuacion.vercel.app/historico/all?&page=${f.value}&limit=${E.value}`)).json();F.value=e.data.sort((l,u)=>new Date(u.created_at)-new Date(l.created_at)),C.value=e.total,B.value=e.total,D.value=!1}catch(a){console.error("Error al obtener el historial:",a),D.value=!1}}N(c);const X=async()=>{const a=j.value;try{(await fetch("https://servicio-niveles-puntuacion.vercel.app/historico/delete-file/",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({ruta_archivo:a})})).ok?(console.log("Imagen eliminada exitosamente"),console.log(a),c()):console.error("Error al eliminar la imagen")}catch(e){console.error("Error en la solicitud:",e)}d.value=!1},K=async a=>{try{(await fetch(`https://servicio-niveles-puntuacion.vercel.app/historico/delete/${a}`,{method:"DELETE"})).ok?(console.log("Registro eliminado exitosamente"),V.value=!0,c()):console.error("Error al eliminar el registro")}catch(e){console.error("Error en la solicitud:",e)}};function Q(a){const e=a.target.files;_=Array.from(e)}async function W(){const a=new FormData;a.append("userId",v.value),a.append("idRegla",k.value),a.append("retoAssignment",w.value),a.append("reference","app-live-10min"),a.append("provider","app web nevera"),console.log(w.value),g.value[0]=!0,_.forEach(e=>{a.append("files",e)});try{(await fetch("https://servicio-niveles-puntuacion.vercel.app/historico/create",{method:"POST",body:a})).ok?(console.log("Datos enviados exitosamente"),h.value=!0,v.value="",y.value="",_=[],c()):(console.error("Error al enviar datos"),b.value=!0)}catch(e){console.error("Error en la solicitud:",e)}finally{g.value[0]=!1}}return(a,e)=>(r(),p(U,null,[t(S,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),location:"top",color:"success"},{default:o(()=>[i(" Enviado! ")]),_:1},8,["modelValue"]),t(S,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value=l),location:"top",color:"success"},{default:o(()=>[i(" Registro eliminado! ")]),_:1},8,["modelValue"]),t(S,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),location:"top",color:"error"},{default:o(()=>[i(" Error al enviar datos ")]),_:1},8,["modelValue"]),t(le,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=l=>d.value=l),"max-width":"500"},{default:o(()=>[t(I,null,{default:o(()=>[t(ee,null,{default:o(()=>[i("\xBFEst\xE1s seguro de eliminar la imagen?")]),_:1}),t(ae,null,{default:o(()=>[t(m,{text:"",onClick:X},{default:o(()=>[i("S\xED")]),_:1}),t(m,{color:"red darken-1",text:"",onClick:e[3]||(e[3]=l=>d.value=!1)},{default:o(()=>[i("No")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ue,null,{default:o(()=>[t($,{cols:"12",md:"12",lg:"12"},{default:o(()=>[t(I,{title:"Formulario de im\xE1genes",class:"card_form"},{default:o(()=>[t(z,null,{default:o(()=>[n("form",{onSubmit:te(W,["prevent"])},[t(oe,{"prepend-icon":"tabler-user",label:"ID del Usuario",id:"userId",modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value=l),type:"text",required:""},null,8,["modelValue"]),ve,t(se,{label:"Desafios","prepend-icon":"tabler-list",modelValue:y.value,"onUpdate:modelValue":[e[6]||(e[6]=l=>y.value=l),O],items:x.value.map(l=>l.tituloDesafio)},null,8,["modelValue","items"]),fe,t(de,{rules:J,accept:"image/png, image/jpeg, image/webp",label:"Sube tus im\xE1genes",type:"file",multiple:"",onChange:Q,required:""}),ge,n("div",_e,[t(m,{variant:"tonal",type:"submit",loading:g.value[0],disabled:g.value[0],color:"success"},{default:o(()=>[i(" Enviar ")]),_:1},8,["loading","disabled"])])],40,me)]),_:1})]),_:1})]),_:1}),t($,{cols:"12",md:"12",lg:"12"},{default:o(()=>[n("h2",he,[i("Listado "),n("p",be," Un total de "+A(B.value)+" registros ",1)]),D.value?(r(),p("div",Ve,"Cargando...")):(r(),p("div",ye,[(r(!0),p(U,null,M(F.value,l=>(r(),T(I,{class:"mb-4",title:l.retoAssignment,subtitle:P(ne)(l.created_at).format("D/M/YYYY - HH:mm"),key:l._id},{default:o(()=>[t(z,null,{default:o(()=>[n("div",xe,[n("span",ke,A(),1)]),t(re,{"show-arrows":"",mandatory:""},{default:o(()=>[(r(!0),p(U,null,M(l.files,u=>(r(),T(ce,{key:u},{default:o(()=>[n("div",we,[t(Y,{rounded:"",size:"88",color:"default",variant:"tonal",class:"text-disabled"},{default:o(()=>[n("div",null,[t(Y,{size:100,image:R+u,class:"me-3 items-img"},null,8,["image"])])]),_:2},1024),t(m,{class:"btn_delete_img",icon:"tabler-x",size:"x-small",color:"secondary",onClick:Ce=>L(R+u)},null,8,["onClick"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),t(m,{icon:"tabler-trash",block:"",color:"error",class:"rounded-t-0 btn_delete_item",onClick:u=>K(l._id)},null,8,["onClick"])]),_:2},1032,["title","subtitle"]))),128))])),C.value>E.value?(r(),T(pe,{key:2,modelValue:f.value,"onUpdate:modelValue":[e[7]||(e[7]=l=>f.value=l),H],size:"small","total-visible":4,length:P(q)},null,8,["modelValue","length"])):ie("",!0)]),_:1})]),_:1})],64))}};export{Te as default};
