import{y as q,M as K,bv as Q,u,R as W,S as H,U as J,ak as X,v as R,r as x,Q as Z,as as ee,o as F,c as z,w as a,a as e,e as c,aR as se,q as h,aT as ae,b as i,x as M,t as w,a3 as B,V as U,n as O,bx as te,N as v,p as $,L as oe,bb as V,bd as le,be as ne,g as re,h as ie}from"./index.88d3c7f5.js";const k=g=>(le("data-v-fdaca5d8"),g=g(),ne(),g),ce={class:"d-inline-flex align-items-center"},de=k(()=>i("span",{class:"text-h5 mr-2"},"Estad\xEDsticas de:",-1)),ue={key:0,class:"text-h5",style:{color:"#7367f0"}},me={class:"text-h6 mb-4"},pe={key:0,class:"text-subtitle-2"},ve=k(()=>i("div",{class:"text-h6 mb-4"},"Detalles por Tipo de Usuario",-1)),fe={class:"stat-card"},_e=k(()=>i("div",{class:"text-caption mb-1"},"An\xF3nimos",-1)),be={class:"text-h6 mb-2"},he={class:"stat-card"},ge=k(()=>i("div",{class:"text-caption mb-1"},"Registrados",-1)),ye={class:"text-h6 mb-2"},xe={class:"stat-card"},we=k(()=>i("div",{class:"text-caption mb-1"},"Suscritos",-1)),Fe={class:"text-h6 mb-2"},Ue=q({name:"EstadisticasUsertype"}),ke=Object.assign(Ue,{setup(g){Q(s=>({"3f5ed47e":u(d)?"#424242":"#e0e0e0","5c419fd9":u(d)?"#FFFFFF":"#000000"}));const y=W.exports.extendMoment(H);y.locale("es",[J]);const T=X(),d=R(()=>T.current.value.dark),r=x({anonimos:0,registrados:0,suscritos:0,totalUsuariosUnicos:0}),o=x({start:y().startOf("month").format("YYYY-MM-DD"),end:y().format("YYYY-MM-DD")}),D=x([]),l=x(null),Y=x(0),I=R(()=>({chart:{type:"pie",height:350,foreColor:d.value?"#FFFFFF":"#000000",background:"transparent",fontFamily:"Public Sans, sans-serif",animations:{enabled:!0,speed:300,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},labels:["An\xF3nimos","Registrados","Suscritos"],colors:["#969696","#2927B9","#FCD206"],legend:{position:"bottom",labels:{colors:d.value?"#FFFFFF":"#000000"},fontFamily:"Public Sans, sans-serif",fontSize:"14px"},stroke:{width:0},dataLabels:{enabled:!0,formatter:s=>`${Math.round(s)}%`,textAnchor:"middle",distributed:!0,offsetY:0,style:{fontSize:"18px",fontFamily:"Public Sans, sans-serif",fontWeight:"600",colors:[d.value?"#FFFFFF":"#000000"]},background:{enabled:!1,dropShadow:{enabled:!1}},dropShadow:{enabled:!1}},tooltip:{enabled:!0,theme:d.value?"dark":"light",style:{fontSize:"14px",fontFamily:"Public Sans, sans-serif"},y:{formatter:function(s,{seriesIndex:t}){return`${[r.value.anonimos,r.value.registrados,r.value.suscritos][t]} usuarios`}}},plotOptions:{pie:{dataLabels:{offset:-20}}},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]})),P=R(()=>{const s=r.value.anonimos+r.value.registrados+r.value.suscritos;return s===0?[0,0,0]:[r.value.anonimos/s*100,r.value.registrados/s*100,r.value.suscritos/s*100]}),j=async()=>{try{const s=await V.get("https://estadisticas.ecuavisa.com/sites/gestor/Tools/contenidoLimits/config_contenido.php");s.data.success&&s.data.data&&(D.value=s.data.data,D.value.length>0&&(l.value=D.value[0],await E()))}catch(s){console.error("Error al cargar las reglas:",s)}},E=async()=>{var s,t,n,f,_,m,p,A;if(!!((s=l.value)!=null&&s.id))try{const G=`https://restriccion-contenido.vercel.app/content-access/config/${l.value.id}?startDate=${o.value.start}&endDate=${o.value.end}`,S=await V.get(G);if(S.data.resp&&((t=S.data.data)==null?void 0:t.metricasPorTipoUsuario)){const b=S.data.data.metricasPorTipoUsuario;r.value={anonimos:((n=b.anonimo)==null?void 0:n.usuariosUnicos)||0,registrados:((f=b.registrado)==null?void 0:f.usuariosUnicos)||0,suscritos:((_=b.suscrito)==null?void 0:_.usuariosUnicos)||0,totalUsuariosUnicos:(((m=b.anonimo)==null?void 0:m.usuariosUnicos)||0)+(((p=b.registrado)==null?void 0:p.usuariosUnicos)||0)+(((A=b.suscrito)==null?void 0:A.usuariosUnicos)||0)},Y.value+=1}}catch(L){console.error("Error al obtener datos:",L)}},C=async s=>{var t;if(!!((t=l.value)!=null&&t.id))try{const f=`https://restriccion-contenido.vercel.app/content-access/config/${l.value.id}/tipo/${s}?format=csv&startDate=${o.value.start}&endDate=${o.value.end}`,_=await V.get(f,{responseType:"blob"}),m=window.URL.createObjectURL(new Blob([_.data])),p=document.createElement("a");p.href=m,p.setAttribute("download",`datos_${s}_${l.value.id}_${o.value.start}_${o.value.end}.csv`),document.body.appendChild(p),p.click(),document.body.removeChild(p)}catch(n){console.error("Error al descargar datos:",n)}},N=async()=>{var s;if(!!((s=l.value)!=null&&s.id))try{const n=`https://restriccion-contenido.vercel.app/content-access/config/${l.value.id}/todos?format=csv&startDate=${o.value.start}&endDate=${o.value.end}`,f=await V.get(n,{responseType:"blob"}),_=window.URL.createObjectURL(new Blob([f.data])),m=document.createElement("a");m.href=_,m.setAttribute("download",`todos_los_datos_${l.value.id}_${o.value.start}_${o.value.end}.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(t){console.error("Error al descargar todos los datos:",t)}};return Z([o,l],()=>{var s;(s=l.value)!=null&&s.id&&E()},{deep:!0}),ee(async()=>{await j()}),(s,t)=>(F(),z(U,null,{default:a(()=>[e(c,{cols:"12",class:"mb-6"},{default:a(()=>[e(se,{class:"text-h6 pb-2"},{default:a(()=>[h(" Escoge regla de L\xEDmite de contenido ")]),_:1}),e(ae,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=n=>l.value=n),items:D.value,"item-title":"name","item-value":"id","return-object":"",class:"mb-4","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",class:"mb-6 d-flex align-items-center justify-content-center py-3 px-3 bg-light"},{default:a(()=>[i("div",ce,[de,l.value?(F(),M("div",ue,w(l.value.name),1)):B("",!0)])]),_:1}),e(c,{cols:"12",class:"mb-6"},{default:a(()=>[e(U,null,{default:a(()=>[e(c,{cols:"12",sm:"6"},{default:a(()=>[e(O,{modelValue:o.value.start,"onUpdate:modelValue":t[1]||(t[1]=n=>o.value.start=n),label:"Fecha Inicio",type:"date",max:o.value.end},null,8,["modelValue","max"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:a(()=>[e(O,{modelValue:o.value.end,"onUpdate:modelValue":t[2]||(t[2]=n=>o.value.end=n),label:"Fecha Fin",type:"date",min:o.value.start,max:u(y)().format("YYYY-MM-DD")},null,8,["modelValue","min","max"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12"},{default:a(()=>[e(U,null,{default:a(()=>[e(c,{cols:"12",md:"6"},{default:a(()=>[i("div",me,[h(" Distribuci\xF3n de Usuarios "),l.value?(F(),M("div",pe,w(l.value.name),1)):B("",!0)]),(F(),z(u(te),{key:Y.value,type:"pie",options:u(I),series:u(P),height:"350"},null,8,["options","series"]))]),_:1}),e(c,{cols:"12",md:"6"},{default:a(()=>[ve,e(U,null,{default:a(()=>[e(c,{cols:"12",sm:"4"},{default:a(()=>[i("div",fe,[e(v,{icon:"mdi-account-outline",size:"x-large",class:"mb-2",color:"#969696"}),_e,i("div",be,w(r.value.anonimos),1),e($,{size:"small",variant:"flat",color:u(d)?"grey-darken-3":"grey-lighten-3",class:"download-btn",onClick:t[3]||(t[3]=n=>C("anonimo"))},{default:a(()=>[e(v,{icon:"mdi-download",size:"small",class:"me-1"}),h(" Descargar ")]),_:1},8,["color"])])]),_:1}),e(c,{cols:"12",sm:"4"},{default:a(()=>[i("div",he,[e(v,{icon:"mdi-account",size:"x-large",class:"mb-2",color:"#2927B9"}),ge,i("div",ye,w(r.value.registrados),1),e($,{size:"small",variant:"flat",color:u(d)?"grey-darken-3":"grey-lighten-3",class:"download-btn",onClick:t[4]||(t[4]=n=>C("registrado"))},{default:a(()=>[e(v,{icon:"mdi-download",size:"small",class:"me-1"}),h(" Descargar ")]),_:1},8,["color"])])]),_:1}),e(c,{cols:"12",sm:"4"},{default:a(()=>[i("div",xe,[e(v,{icon:"mdi-star",size:"x-large",class:"mb-2",color:"#FCD206"}),we,i("div",Fe,w(r.value.suscritos),1),e($,{size:"small",variant:"flat",color:u(d)?"grey-darken-3":"grey-lighten-3",class:"download-btn",onClick:t[5]||(t[5]=n=>C("suscrito"))},{default:a(()=>[e(v,{icon:"mdi-download",size:"small",class:"me-1"}),h(" Descargar ")]),_:1},8,["color"])])]),_:1})]),_:1}),e($,{block:"",color:u(d)?"white":"primary",class:oe([u(d)?"text-primary":"text-white","mt-6"]),onClick:N},{default:a(()=>[e(v,{icon:"mdi-download",class:"me-2"}),h(" DESCARGAR TODOS ")]),_:1},8,["color","class"])]),_:1})]),_:1})]),_:1})]),_:1}))}}),De=K(ke,[["__scopeId","data-v-fdaca5d8"]]),Ve={__name:"index",setup(g){return(y,T)=>(F(),z(U,null,{default:a(()=>[e(c,{cols:"12"},{default:a(()=>[e(re,null,{default:a(()=>[e(ie,null,{default:a(()=>[e(De)]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Ve as default};
