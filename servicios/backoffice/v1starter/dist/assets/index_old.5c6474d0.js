import{r as u,as as Fe,v as je,o as d,x as h,a as e,w as a,b8 as de,q as c,u as s,i as m,b7 as qe,ba as ce,f as Pe,t as f,b0 as K,h as $,a$ as De,V as Z,e as v,g as J,aR as L,b as o,p as x,c as w,aQ as U,aW as ee,F as O,C as A,N as ie,a3 as R,l as Te,m as Ee,n as ae,aT as pe,b9 as Ne,bc as Ue,aX as Ie}from"./index.88d3c7f5.js";import Se from"./descuentos.5ffc5d6f.js";/* empty css              */import{V as me}from"./VCheckbox.50e352e3.js";const $e={class:"d-flex flex-wrap gap-4 mt-10"},Je=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"Nombre"),o("th",{scope:"col"},"Valor"),o("th",{scope:"col"},"Fecha inicio"),o("th",{scope:"col"},"Fecha fin"),o("th",{scope:"col"},"Acciones")])],-1),Oe=["onClick"],Ae={class:"text-medium-emphasis"},ze={class:"text-medium-emphasis"},Be={class:"text-medium-emphasis"},Le={class:"text-medium-emphasis"},Re={class:"text-medium-emphasis"},Ye={class:"d-flex align-center justify-space-between botonescurrentPage"},He=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"Id"),o("th",{scope:"col"},"Nombre")])],-1),We={class:"text-medium-emphasis"},Me={class:"text-medium-emphasis"},Ge=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"Id"),o("th",{scope:"col"},"Nombre")])],-1),Qe={class:"text-medium-emphasis"},Xe={class:"text-medium-emphasis"},Ke=o("div",{class:"mb-6"},"Asignar excepciones",-1),oa={__name:"index_old",setup(Ze){const z=u([]),Y=u(!1),i=u(!1),le=u([]),H=u([]),I=u(!1),W=u(""),M=u([]),N=u("tab-cupones");async function G(){try{Y.value=!0;const t=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/get/all")).json();z.value=t.data,Y.value=!1}catch(r){console.error(r.message)}}async function ve(r,t){try{i.value=!0,W.value=t;const n=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/paquetes/full/"+r)).json();le.value=n.data;const V=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/excepcion/full/"+r)).json();H.value=V.data,I.value=!0,i.value=!1}catch(p){console.error(p.message)}}async function te(){try{const t=await(await fetch("https://ecuavisa-modulos.vercel.app/paquete")).json();let p=Array.from(t.data),n=[];for(const l of p){let V={title:l.nombre,value:l._id};n.push(V)}M.value=n}catch(r){console.error(r.message)}}Fe(async()=>{await G()});const B=8,C=u(1),fe=je(()=>{const r=(C.value-1)*B,t=r+B;return z.value.slice(r,t)}),_e=()=>{C.value*B<z.value.length&&C.value++},be=()=>{C.value>1&&C.value--},Ve=[{title:"Porcentaje",value:"percent"},{title:"D\xF3lares",value:"dollars"}],j=u(!1),S=u(""),y=u(""),g=u([]),k=u([]),q=u(0),P=u(""),D=u(""),T=u(""),E=u(""),_=u({message:"Datos guardados",type:"success",model:!1}),b=u("Full"),se=u(!1),ge=["Personalizado","Full"];function ye(){k.value=[],b.value==="Personalizado"?(g.value=[],se.value=!0):b.value==="Full"&&(g.value="full",se.value=!1)}function Q(){y.value="",g.value=[],k.value=[],q.value=0,P.value="",D.value="",T.value="",E.value="",b.value="Full"}function oe(){Q(),j.value=!1}async function he(){i.value=!0,Q(),await te(),S.value="add",j.value=!0,i.value=!1}const ue=u("");async function xe(r){i.value=!0,Q(),await te(),S.value="edit";const n=(await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/get/id/"+r)).json()).data;ue.value=n._id,y.value=n.nombre,n.paquetes!=="full"&&n.paquetes.length>0?b.value="Personalizado":n.paquetes=="full"&&(b.value="Full"),g.value=n.paquetes,k.value=n.excepciones,q.value=n.discount,P.value=n.type,D.value=n.helper,T.value=n.dateIni,E.value=n.dateEnd,i.value=!1,j.value=!0}async function we(){let r=y.value;if(!r||r=="")return _.value={message:"Debe a\xF1adir un nombre",type:"error",model:!0},!1;var t=new Headers;if(t.append("Content-Type","application/json"),b.value=="Full"&&(g.value="full"),i.value=!0,S.value==="add"){let l={nombre:y.value,paquetes:g.value,excepciones:k.value,discount:q.value,type:P.value,helper:D.value,dateIni:T.value,dateEnd:E.value};console.log(l);var p=JSON.stringify(l),n={method:"POST",headers:t,body:p,redirect:"follow"};const X=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/create",n)).json();if(X.resp)_.value={message:"Cup\xF3n creado correctamente",type:"success",model:!0};else return _.value={message:X.mensaje,type:"error",model:!0},console.error(X.error),!1}else if(S.value==="edit"){let l={id:ue.value,nombre:y.value,paquetes:g.value,excepciones:k.value,discount:q.value,type:P.value,helper:D.value,dateIni:T.value,dateEnd:E.value};var p=JSON.stringify(l),n={method:"PUT",headers:t,body:p,redirect:"follow"};const re=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/update",n)).json();re.resp?_.value={message:"Cup\xF3n editado correctamente",type:"success",model:!0}:_.value={message:re.mensaje,type:"error",model:!0}}i.value=!1,await G(),I.value=!1,j.value=!1}const F=u(!1),ne=u("");function Ce(r){i.value=!0,F.value=!0,ne.value=r,i.value=!1}async function ke(){i.value=!0;var r={method:"DELETE",redirect:"follow"};const p=await(await fetch("https://ecuavisa-cupones.vercel.app/cupon/delete/"+ne.value,r)).json();p.resp?_.value={message:"Cup\xF3n eliminado correctamente",type:"success",model:!0}:_.value={message:p.mensaje,type:"error",model:!0},await G(),I.value=!1,F.value=!1,i.value=!1}return(r,t)=>{const p=Ue,n=Ie;return d(),h("section",null,[e(qe,{modelValue:s(N),"onUpdate:modelValue":t[0]||(t[0]=l=>m(N)?N.value=l:null),class:"v-tabs-pill"},{default:a(()=>[e(de,{value:"tab-cupones"},{default:a(()=>[c("Cupones")]),_:1}),e(de,{value:"tab-descuentos"},{default:a(()=>[c("Descuentos")]),_:1})]),_:1},8,["modelValue"]),e(Ne,{class:"mt-4",modelValue:s(N),"onUpdate:modelValue":t[16]||(t[16]=l=>m(N)?N.value=l:null)},{default:a(()=>[e(ce,{value:"tab-cupones"},{default:a(()=>[e(Pe,{modelValue:s(_).model,"onUpdate:modelValue":t[1]||(t[1]=l=>s(_).model=l),location:"top end",variant:"flat",color:s(_).type},{default:a(()=>[c(f(s(_).message),1)]),_:1},8,["modelValue","color"]),e(K,{modelValue:s(i),"onUpdate:modelValue":t[2]||(t[2]=l=>m(i)?i.value=l:null),width:"300"},{default:a(()=>[e($,{class:"pt-3 text-center"},{default:a(()=>[e(De,{indeterminate:"",color:"primary"})]),_:1})]),_:1},8,["modelValue"]),e(Z,null,{default:a(()=>[e(v,{cols:"12",sm:"12",lg:"12"},{default:a(()=>[e(J,null,{default:a(()=>[e(L,{class:"pt-4 pl-6"},{default:a(()=>[c("Lista de cupones")]),_:1}),e($,{style:{"margin-bottom":"-2rem"}},{default:a(()=>[o("div",$e,[e(x,{"prepend-icon":"tabler-user-plus",color:"success",variant:"tonal",class:"ml-auto",onClick:he},{default:a(()=>[c(" Crear cup\xF3n ")]),_:1})])]),_:1}),s(Y)?(d(),w(U,{key:0},{default:a(()=>[c(" Cargando datos... ")]),_:1})):(d(),w(U,{key:1},{default:a(()=>[e(ee,{class:"text-no-wrap tableNavegacion mb-5",hover:"true"},{default:a(()=>[Je,o("tbody",null,[(d(!0),h(O,null,A(s(fe),l=>(d(),h("tr",{onClick:V=>ve(l._id,l.nombre),class:"clickable"},[o("td",Ae,f(l.nombre),1),o("td",ze,f(l.helper),1),o("td",Be,f(l.dateIni),1),o("td",Le,f(l.dateEnd),1),o("td",Re,[e(x,{color:"success",variant:"text",icon:"",onClick:V=>xe(l._id)},{default:a(()=>[e(ie,{size:"22",icon:"tabler-edit"})]),_:2},1032,["onClick"]),e(x,{icon:"",color:"error",variant:"text",onClick:V=>Ce(l._id)},{default:a(()=>[e(ie,{size:"22",icon:"tabler-trash"})]),_:2},1032,["onClick"])])],8,Oe))),256))])]),_:1}),o("div",Ye,[e(x,{icon:"tabler-arrow-big-left-lines",onClick:be,disabled:s(C)===1},null,8,["disabled"]),c(" P\xE1gina "+f(s(C))+" ",1),e(x,{icon:"tabler-arrow-big-right-lines",onClick:_e,disabled:s(C)*B>=s(z).length},null,8,["disabled"])])]),_:1}))]),_:1})]),_:1}),s(I)?(d(),w(v,{key:0,cols:"6",sm:"12",lg:"6",class:"container"},{default:a(()=>[e(J,null,{default:a(()=>[e(L,{class:"pt-4 pl-6"},{default:a(()=>[c("Paquetes de "+f(s(W)),1)]),_:1}),e(U,null,{default:a(()=>[e(ee,{class:"text-no-wrap tableNavegacion mb-5"},{default:a(()=>[He,o("tbody",null,[(d(!0),h(O,null,A(s(le),l=>(d(),h("tr",null,[o("td",We,f(l._id),1),o("td",Me,f(l.nombre),1)]))),256))])]),_:1})]),_:1})]),_:1})]),_:1})):R("",!0),s(I)?(d(),w(v,{key:1,cols:"6",sm:"12",lg:"6",class:"container"},{default:a(()=>[e(J,null,{default:a(()=>[e(L,{class:"pt-4 pl-6"},{default:a(()=>[c("Excepciones de "+f(s(W)),1)]),_:1}),s(H).length===0?(d(),w(U,{key:0},{default:a(()=>[c(" No existen excepciones para mostrar. ")]),_:1})):(d(),w(U,{key:1},{default:a(()=>[e(ee,{class:"text-no-wrap tableNavegacion mb-5"},{default:a(()=>[Ge,o("tbody",null,[(d(!0),h(O,null,A(s(H),l=>(d(),h("tr",null,[o("td",Qe,f(l._id),1),o("td",Xe,f(l.nombre),1)]))),256))])]),_:1})]),_:1}))]),_:1})]),_:1})):R("",!0)]),_:1}),e(K,{modelValue:s(j),"onUpdate:modelValue":t[12]||(t[12]=l=>m(j)?j.value=l:null),persistent:"","no-click-animation":"","max-width":"800"},{default:a(()=>[e(p,{onClick:oe}),e(J,{class:"pa-sm-14 pa-5"},{default:a(()=>[e(U,{class:"text-center"},{default:a(()=>[e(L,{class:"text-h5 mb-3"},{default:a(()=>[c(f(s(S)==="add"?"Crear un cup\xF3n":"Editar "+s(y)),1)]),_:1})]),_:1}),e($,null,{default:a(()=>[e(Te,{class:"mt-6",onSubmit:Ee(we,["prevent"])},{default:a(()=>[e(Z,{class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[e(Z,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(ae,{modelValue:s(y),"onUpdate:modelValue":t[3]||(t[3]=l=>m(y)?y.value=l:null),label:"Nombre"},null,8,["modelValue"])]),_:1}),e(v,{cols:"6"},{default:a(()=>[e(ae,{modelValue:s(q),"onUpdate:modelValue":t[4]||(t[4]=l=>m(q)?q.value=l:null),label:"Descuento",typer:"number"},null,8,["modelValue"])]),_:1}),e(v,{cols:"6"},{default:a(()=>[e(ae,{modelValue:s(D),"onUpdate:modelValue":t[5]||(t[5]=l=>m(D)?D.value=l:null),label:"Helper"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(pe,{modelValue:s(P),"onUpdate:modelValue":t[6]||(t[6]=l=>m(P)?P.value=l:null),label:"Tipo",items:Ve},null,8,["modelValue"])]),_:1}),e(v,{cols:"6"},{default:a(()=>[e(n,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:s(T),"onUpdate:modelValue":t[7]||(t[7]=l=>m(T)?T.value=l:null),"show-current":"true",label:"Fecha inicio",config:{position:"auto right",altFormat:"F j, Y",dateFormat:"m-d-Y",reactive:!0}},null,8,["modelValue","config"])]),_:1}),e(v,{cols:"6"},{default:a(()=>[e(n,{"prepend-inner-icon":"tabler-calendar",density:"compact",modelValue:s(E),"onUpdate:modelValue":t[8]||(t[8]=l=>m(E)?E.value=l:null),"show-current":"true",label:"Fecha fin",config:{position:"auto right",altFormat:"F j, Y",dateFormat:"m-d-Y",reactive:!0}},null,8,["modelValue","config"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(pe,{class:"mb-6",modelValue:s(b),"onUpdate:modelValue":[t[9]||(t[9]=l=>m(b)?b.value=l:null),ye],label:"Asignar paquetes",items:ge},null,8,["modelValue"]),s(b)=="Personalizado"?(d(!0),h(O,{key:0},A(s(M),l=>(d(),w(v,{style:{"margin-top":"-1.5rem"},cols:"6"},{default:a(()=>[e(me,{modelValue:s(g),"onUpdate:modelValue":t[10]||(t[10]=V=>m(g)?g.value=V:null),label:l.title,value:l.value},null,8,["modelValue","label","value"])]),_:2},1024))),256)):R("",!0)]),_:1}),s(b)=="Full"?(d(),w(v,{key:0,style:{"margin-top":"-2rem"},cols:"12"},{default:a(()=>[Ke,(d(!0),h(O,null,A(s(M),l=>(d(),w(v,{style:{"margin-top":"-1.5rem"},cols:"6"},{default:a(()=>[e(me,{modelValue:s(k),"onUpdate:modelValue":t[11]||(t[11]=V=>m(k)?k.value=V:null),label:l.title,value:l.value},null,8,["modelValue","label","value"])]),_:2},1024))),256))]),_:1})):R("",!0)]),_:1}),e(v,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[e(x,{type:"submit"},{default:a(()=>[c(" Guardar ")]),_:1}),e(x,{color:"secondary",variant:"tonal",onClick:oe},{default:a(()=>[c(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:s(F),"onUpdate:modelValue":t[15]||(t[15]=l=>m(F)?F.value=l:null),persistent:"",class:"v-dialog-sm"},{default:a(()=>[e(p,{onClick:t[13]||(t[13]=l=>F.value=!s(F))}),e(J,{title:"Eliminar registro"},{default:a(()=>[e($,null,{default:a(()=>[c(" \xBFDesea eliminar el cup\xF3n? ")]),_:1}),e($,{class:"d-flex justify-end gap-3 flex-wrap"},{default:a(()=>[e(x,{color:"secondary",variant:"tonal",onClick:t[14]||(t[14]=l=>F.value=!1)},{default:a(()=>[c(" No, Cerrar ")]),_:1}),e(x,{onClick:ke},{default:a(()=>[c(" Si, eliminar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ce,{value:"tab-descuentos"},{default:a(()=>[e(Se)]),_:1})]),_:1},8,["modelValue"])])}}};export{oa as default};
