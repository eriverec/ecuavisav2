import{M as L,r as i,v as M,Q as B,as as P,o as q,x as F,a as t,w as l,q as y,t as g,f as J,h as A,b as f,N as V,g as G,V as Q,e as m,aT as U,aM as R,X,bC as $,u as H,n as K,p as W,m as Y,l as Z,bd as ee,be as ae}from"./index.88d3c7f5.js";const te=p=>(ee("data-v-349db0fb"),p=p(),ae(),p),se={class:"d-flex align-center mb-4"},le=te(()=>f("div",{class:"text-h6"}," Total de usuarios seg\xFAn criterios ",-1)),oe={class:"text-h4 font-weight-bold"},ie={__name:"CampaignEditByCriteria",props:{campaignData:{type:Object,required:!0}},emits:["update"],setup(p,{emit:k}){var T,S,E,j,D;const c=p,n=i(!1),o=i(((T=c.campaignData.criterial)==null?void 0:T.country)||""),d=i(((E=(S=c.campaignData.criterial)==null?void 0:S.city)==null?void 0:E.split(","))||[]),r=i(((D=(j=c.campaignData.criterial)==null?void 0:j.dispositivo)==null?void 0:D.split(","))||["todos"]),b=i(""),u=i({show:!1,text:"",color:"success"}),_=i([]),v=i([]),h=i([]),N=[{title:"Todos los dispositivos",value:"todos",avatar:"mdi-devices"},{title:"Escritorio",value:"desktop",avatar:"mdi-laptop-chromebook"},{title:"M\xF3vil",value:"movil",avatar:"mdi-cellphone-android"}],O=M(()=>{if(!v.value.length)return[];const s=b.value.toLowerCase();return v.value.filter(e=>e.toLowerCase().includes(s)||e==="Todas las ciudades")}),w=i(0),z=async()=>{try{n.value=!0;const e=await(await fetch("https://ecuavisa-suscripciones.vercel.app/otros/obtener-paises-ciudades")).json();h.value=e,_.value=e.map(a=>({title:a.country,value:a.country}))}catch(s){console.error("Error al cargar pa\xEDses:",s),u.value={show:!0,text:"Error al cargar pa\xEDses",color:"error"}}finally{n.value=!1}},C=()=>{if(!o.value||!h.value.length){v.value=[];return}const s=h.value.find(e=>e.country===o.value);s&&(v.value=["Todas las ciudades",...s.data.map(e=>e.city)])},x=async()=>{try{n.value=!0;const s={criterio:["dispositivos","trazabilidads"],pais:o.value||-1,ciudad:d.value.includes("Todas las ciudades")?-1:d.value.join(","),dispositivo:r.value.includes("todos")?null:r.value.join(",")},a=await(await fetch("https://ads-service.vercel.app/campaign/v2/usuarios/get/user/total",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();a.resp&&(w.value=a.total)}catch(s){console.error("Error al obtener total de usuarios:",s),u.value={show:!0,text:"Error al obtener total de usuarios",color:"error"}}finally{n.value=!1}},I=async()=>{try{const s={...c.campaignData,criterial:{...c.campaignData.criterial,country:o.value||-1,city:d.value.includes("Todas las ciudades")?-1:d.value.join(","),dispositivo:r.value.includes("todos")?null:r.value.join(",")}},a=await(await fetch(`https://ads-service.vercel.app/campaign/update/${c.campaignData._id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();if(a.resp)u.value={show:!0,text:"Criterios actualizados exitosamente",color:"success"},k("update");else throw new Error(a.error||"Error al actualizar")}catch{u.value={show:!0,text:"Error al guardar los cambios",color:"error"}}};return B(o,()=>{d.value=[],C()}),B([o,d,r],()=>{(o.value||r.value.length>0)&&x()},{deep:!0}),P(()=>{z(),o.value&&C(),x()}),(s,e)=>(q(),F("div",null,[t(J,{modelValue:u.value.show,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.show=a),color:u.value.color,timeout:3e3},{default:l(()=>[y(g(u.value.text),1)]),_:1},8,["modelValue","color"]),t(G,{class:"mb-4"},{default:l(()=>[t(A,null,{default:l(()=>[f("div",se,[t(V,{size:"32",icon:"mdi-account-group",color:"primary",class:"me-2"}),f("div",null,[le,f("div",oe,g(w.value),1)])])]),_:1})]),_:1}),t(Z,{onSubmit:Y(I,["prevent"])},{default:l(()=>[t(Q,null,{default:l(()=>[t(m,{cols:"12",md:"6"},{default:l(()=>[t(U,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),items:N,label:"Dispositivos",multiple:"",chips:"","item-title":"title","item-value":"value"},{selection:l(({item:a})=>[t(R,null,{default:l(()=>[t(X,{start:""},{default:l(()=>[t(V,{icon:a.raw.avatar},null,8,["icon"])]),_:2},1024),y(" "+g(a.title),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1}),t(m,{cols:"12",md:"6"},{default:l(()=>[t(U,{modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value=a),items:_.value,label:"Pa\xEDs",loading:n.value,"item-title":"title","item-value":"value",clearable:""},null,8,["modelValue","items","loading"])]),_:1}),t(m,{cols:"12",md:"12"},{default:l(()=>[t($,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),items:H(O),label:"Ciudades",multiple:"",chips:"","closable-chips":"",disabled:!o.value,loading:n.value},{"prepend-inner":l(()=>[t(V,{size:"18",icon:"mdi-magnify",class:"me-2"})]),input:l(()=>[t(K,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),placeholder:"Buscar ciudad...","hide-details":"",density:"compact",disabled:!o.value},null,8,["modelValue","disabled"])]),_:1},8,["modelValue","items","disabled","loading"])]),_:1}),t(m,{cols:"12",class:"d-flex justify-end"},{default:l(()=>[t(W,{id:"guardacrit",type:"submit",color:"primary",class:"d-none",loading:n.value,disabled:!o.value&&r.value.includes("todos")},{default:l(()=>[y(" Guardar criterios ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]))}},de=L(ie,[["__scopeId","data-v-349db0fb"]]);export{de as default};
