import{r as l,R as Te,U as Se,bA as Ae,bB as qe,as as $e,Q as ee,ak as De,v as Me,bP as y,o as D,c as ce,w as i,b as _,a as r,bC as We,u as c,i as se,h as we,bx as Ie,x as j,g as ve,z as je,q as I,t as $,f as Pe,V as be,e as X,aR as xe,N as te,aT as Oe,$ as ne,n as Ye,a2 as _e,aU as ze,aV as ke,a1 as ge,Z as Le,F as me,C as Ne,X as Be,bw as Re,p as ue,a3 as Ce,a0 as He,a4 as Ge,S as Xe,aQ as Ue,aX as Je}from"./index.88d3c7f5.js";import{_ as Ze}from"./elearning_grafico_1.56c6ae21.js";import{M as Ee}from"./index.50982b4e.js";import{a as ye}from"./apexcharts.common.8ef5f801.js";/* empty css              */import"./VSlideGroupItem.ca4927bd.js";const Qe={class:"mt-n4 me-n2 d-flex align-center"},Ke={class:"date-picker-wrapper",style:{"min-width":"200px",width:"auto","max-width":"100%"}},et={key:1,class:"py-4"},tt={__name:"elearning_grafico_curso_por_dia",setup(Ve){const w=l(!1),x=Te.exports.extendMoment(Ee);x.tz.setDefault("America/Guayaquil"),x.locale("es",[Se]);const P=b=>x.tz(b,"America/Guayaquil");l("tab-lista"),l([]);const O=l([]);l([]),l(!1),l(1);const G=l(15),g=l(!1),F=Ae();l({i:F.i,f:F.f,title:"hoy"});const A=l({i:F.i,f:F.f,title:"hoy"});l("Hoy");const C=l("Hoy"),q=qe(),ae=l(F.limit);l("0"),l("");const J=l("");l(""),l([]),l([]),l([]);const oe=[{title:"Ordenar ASC por nombre de usuario",value:1},{title:"Ordenar DESC por nombre de usuario",value:2},{title:"Ordenar ASC por fecha de registro",value:3},{title:"Ordenar DESC por fecha de registro",value:4},{title:"Ordenar ASC por tiempo de permanencia",value:5},{title:"Ordenar DESC por tiempo de permanencia",value:6}];l({title:G.value,value:G.value}),l(oe),l([{title:"Agrupar por p\xE1gina",value:1}]),$e(async()=>{g.value=!0,w.value=!1,await Y({fechai:A.value.i.format("YYYY-MM-DD"),fechaf:A.value.f.format("YYYY-MM-DD")}),g.value=!1,w.value=!0}),ee(async()=>C.value,async()=>{let b=Ae(C.value);A.value={i:b.i,f:b.f,title:C.value},ae.value=b.limit,g.value=!0,w.value=!1,await Y({fechai:A.value.i.format("YYYY-MM-DD"),fechaf:A.value.f.format("YYYY-MM-DD")}),g.value=!1,J.value=null,w.value=!0});const Z=b=>{const T=`rgba(${y(b.colors["on-surface"])},${b.variables["medium-emphasis-opacity"]})`,R=`rgba(${y(b.colors["on-surface"])},${b.variables["disabled-opacity"]})`,E=`rgba(${y(String(b.variables["border-color"]))},${b.variables["border-opacity"]})`,H=`rgba(${y(b.colors["on-surface"])},${b.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:T,themeDisabledTextColor:R,themeBorderColor:E,themePrimaryTextColor:H}},N=De();Z(N.current.value);async function Y(b={}){try{const{fechai:R=x().format("YYYY-MM-DD"),fechaf:E=x().format("YYYY-MM-DD")}=b;var T=await fetch(`https://servicio-elearning.vercel.app/grafico/estudiantes/ultimos_registros?fechai=${R}&?fechaf=${E}`);const H=await T.json();H.resp&&(O.value=H.data)}catch(R){return console.error(R.message)}}function V(){return x().add(1,"day").format("YYYY-MM-DD")}const B=Me(()=>{const b=N.current.value.colors,T=N.current.value.variables,R=`rgba(${y(b.success)},0.2)`,E=`rgba(${y(b["on-background"])},${T["high-emphasis-opacity"]})`;b.success;let H=Array.from(O.value);const z={};H.forEach(k=>{k.data.forEach(M=>{z[M.curso]||(z[M.curso]={name:M.curso,data:[]}),z[M.curso].data.push([x(k.fecha).valueOf(),M.totalRegistrados])})});const U=Object.values(z);C.value=="Hoy"&&U.forEach(k=>{const M=V();k.data.push([x(M).valueOf(),0])}),U.length<1&&U.push({name:"",data:[[1716354e6,0],[17164404e5,0]]});const W={chart:{parentHeightOffset:0,type:"area",stacked:!1,height:350,zoom:{enabled:!1},toolbar:{show:!1}},dataLabels:{enabled:!0},colors:["#173F5F","#00fa9a","#7365ed","#ff69b4","#000f08","#32cd32","#136f63","#ffd700","#ff4500","#ff0000","#ff8c00","#ffff00","#8b4513","#0000ff","#8a2be2","#ffa500","#ffd800","#ff1493","#9932cc","#ff8c00","#8b008b","#8a2be2"],fill:{type:"gradient",gradient:{shadeIntensity:1,inverseColors:!1,opacityFrom:.45,opacityTo:.05,stops:[20,100,100,100]}},yaxis:{title:{text:"Cantidad de usuarios registrados",style:{color:E,useSeriesColors:!1}},labels:{style:{colors:E,useSeriesColors:!1},offsetX:0,formatter:function(k){return k.toFixed(0)}},axisBorder:{show:!1},axisTicks:{show:!1}},xaxis:{type:"datetime",tickAmount:U[0].data.length-1,labels:{style:{colors:E,useSeriesColors:!1},rotate:-15,rotateAlways:!0,formatter:function(k,M){return P(M).format("DD MMM YYYY")}}},tooltip:{shared:!0},legend:{labels:{colors:E,useSeriesColors:!1},position:"top",horizontalAlign:"right",offsetX:-10}};return{series:U,options:W}});return(b,T)=>(D(),ce(ve,{title:"Usuarios registrados",subtitle:"Mira los usuarios registrados, cursos y logros"},{append:i(()=>[_("div",Qe,[_("div",Ke,[r(We,{disabled:c(g),modelValue:c(C),"onUpdate:modelValue":T[0]||(T[0]=R=>se(C)?C.value=R:null),items:c(q),variant:"outlined",label:"Fecha","persistent-hint":"","hide-selected":"",hint:""},null,8,["disabled","modelValue","items"])])])]),default:i(()=>[r(we,null,{default:i(()=>[c(w)?(D(),ce(c(Ie),{key:0,options:c(B).options,series:c(B).series,height:475,width:"100%"},null,8,["options","series"])):(D(),j("div",et," Cargando datos... "))]),_:1})]),_:1}))}};const at={class:"ps-5"},ot={key:1,class:"py-4"},st={class:"d-flex flex-wrap gap-3"},rt={class:"d-flex pe-5 flex-column justify-content-end"},lt={class:"me-2",style:{width:"6.875rem"}},nt={class:"text-disabled"},it={title:"Usuarios que vieron el video"},ut={class:"d-flex flex-column"},ct={key:0,class:"px-0 py-1 text-disabled"},dt={__name:"elearning_grafico_por_video",setup(Ve){const w=l(!1),x=Te.exports.extendMoment(Ee),P=l(!1);x.tz.setDefault("America/Guayaquil"),x.locale("es",[Se]);const O=l([]),G=l(!1),g=l({message:"Datos guardados",type:"success",model:!1});l("tab-lista");const F=l(null),A=l({modulo:{titulo:""}});l(!1);const C=l(!1),q=l(0);$e(async()=>{setTimeout(function(){P.value=!0},1e3),await R(),C.value=!0,w.value=!1,await ae(),C.value=!1,w.value=!0});const ae=async(e="664e32d4fa50c162c4a2e5c8")=>{try{const o=await(await fetch("https://servicio-elearning.vercel.app/grafico/get-web-registered/"+e)).json();F.value=o.data,q.value=o.totalCurso,await M()}catch(t){return alert("Existe un error, intente nuevamente"),console.error(t),null}},J=e=>{const t=`rgba(${y(e.colors["on-surface"])},${e.variables["medium-emphasis-opacity"]})`,o=`rgba(${y(e.colors["on-surface"])},${e.variables["disabled-opacity"]})`,a=`rgba(${y(String(e.variables["border-color"]))},${e.variables["border-opacity"]})`,s=`rgba(${y(e.colors["on-surface"])},${e.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:t,themeDisabledTextColor:o,themeBorderColor:a,themePrimaryTextColor:s}},oe=De();J(oe.current.value);const Z=Me(()=>{const e=oe.current.value.colors,t=oe.current.value.variables,o=`rgba(${y(e.success)},0.2)`,a=`rgba(${y(e["on-background"])},${t["high-emphasis-opacity"]})`,s=J(oe.current.value).themeDisabledTextColor;e.success;let n=A.value.videos;const u={name:"Device",data:[]},d=[];for(let S in n){const L=n[S];let Fe=parseInt(L.usuarios);u.data.push(Fe),d.push(L.titulo_video)}const h={chart:{parentHeightOffset:0,type:"donut"},labels:d,colors:["#173F5F","#00fa9a","#7365ed","#ff69b4","#000f08","#32cd32","#136f63","#ffd700","#ff4500","#ff0000","#ff8c00","#ffff00","#8b4513","#0000ff","#8a2be2","#ffa500","#ffd800","#ff1493","#9932cc","#ff8c00","#8b008b","#8a2be2"],stroke:{width:0},dataLabels:{enabled:!0,formatter(S){return`${parseInt(S)}%`}},responsive:[{breakpoint:1350,options:{chart:{height:480},legend:{position:"bottom",width:"100%"}}}],legend:{position:"right",horizontalAlign:"left",offsetX:0,width:190,markers:{width:7,height:7},show:!0,formatter:function(S,L){return[S," <br> ",`<div style="font-size:17px;color:${a}">${L.w.globals.series[L.seriesIndex]} <small style="font-size:13px">usuarios</small></div>`]},labels:{colors:s,useSeriesColors:!1}},tooltip:{theme:!1,custom:function({series:S,seriesIndex:L,dataPointIndex:Fe,w:Ft}){return`
        <div class="tooltip-content">
          <div class="tooltip-body">
            <div class="tooltip-title">
              Video
            </div>
            <div class="tooltip-subtitle">
              Usuarios que vieron el video
            </div>
            <div class="tooltip-data-flex">
              <div class="tooltip-data-value">
                ${S[L]} usuarios
              </div>
            </div>
          </div>
        </div>`}},grid:{padding:{top:15,right:-20,left:-20}},states:{hover:{filter:{type:"none"}}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!1,value:{fontSize:"1.375rem",fontFamily:"Public Sans",color:a,fontWeight:600,offsetY:-15,formatter(S){return`${parseInt(S)}%`}},name:{offsetY:20,fontFamily:"Public Sans"},total:{show:!1,showAlways:!1,color:e.success,fontSize:".8125rem",label:"Total",fontFamily:"Public Sans",formatter(){return"184"}}}}}}};return{series:u.data,options:h}}),N=l(null),Y=l(!0),V=l(null),B=l(""),b=l(""),T=l("");async function R(e=1,t=10){try{Y.value=!0;var o=new Headers;o.append("Content-Type","application/json");var a={method:"GET",headers:o,redirect:"follow"},s=await fetch("https://servicio-elearning.vercel.app/curso/all?limit=200&page=1",a);const n=await s.json();B.value=n.data.reduce((u,d)=>(u.push({title:`${d.titulo}`,value:d._id}),u),[]),b.value=B.value,V.value=B.value[0].value,Y.value=!1}catch(n){return g.value={message:"No se pudo recuperar los cursos, recargue de nuevo.",type:"error",model:!0},console.error(n.message)}}ee(async()=>T.value,async()=>{T.value?B.value=b.value.filter(e=>e.title.toLowerCase().indexOf(T.value.toLowerCase())>-1||e.value.indexOf(T.value)>-1):B.value=b.value}),ee(N,e=>{e||setTimeout(()=>{T.value=""},1e3)});const E=l(null),H=l(!1),z=l(null),U=l(""),W=l(""),k=l("");async function M(){try{H.value=!0;const e=F.value;U.value=e.modulos.reduce((t,o)=>(t.push({title:`${o.titulo}`,value:o._id}),t),[]),W.value=U.value,z.value=U.value[0].value,H.value=!1}catch(e){return g.value={message:"No se pudo recuperar los cursos, recargue de nuevo.",type:"error",model:!0},console.error(e.message),null}}ee(async()=>k.value,async()=>{k.value?U.value=W.value.filter(e=>e.title.toLowerCase().indexOf(k.value.toLowerCase())>-1||e.value.indexOf(k.value)>-1):U.value=W.value}),ee(N,e=>{e||setTimeout(()=>{T.value=""},1e3)});async function Q(e){const t=F.value.modulos.filter(n=>n._id==e)[0],o=t.videos;let a=q.value*1;o.forEach(n=>{const u=n.usuarios/a*100;n.porcentaje=parseFloat(u).toFixed(2)}),o.sort((n,u)=>u.porcentaje-n.porcentaje);const s={titulo:t.titulo,_id:t._id};return A.value={modulo:s,videos:o},!0}ee(async()=>z.value,async()=>{!P.value||(w.value=!1,z.value&&F.value&&await Q(z.value),await new Promise(e=>setTimeout(e,1e3)),w.value=!0)}),ee(async()=>V.value,async()=>{!P.value||V.value&&(C.value=!0,w.value=!1,await ae(V.value),C.value=!1,w.value=!0)});const K=l({tamanioActual:0,tamanioTotal:0}),de=l("https://servicio-elearning.vercel.app/grafico/exportar/usuarios/all-registrados-video"),fe=l("curso_video");l("Video");const re=l([]),pe=l({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",created_at:"created_at",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at_suscriber_course:"created_at_suscriber_course",created_at_video_view:"created_at_video_view",ciudad:"ciudad",telefono:"telefono",birthDate:"birthDate"});async function ie(e=1,t=10,o,a,s,n,u=""){try{if(!s)return!1;var d=new Headers;d.append("Content-Type","application/json");var h={method:"GET",headers:d,redirect:"follow"},S=await fetch(`${de.value}?idCurso=${s}&idVideo=${n}&page=${e}&limit=${t}`,h);const L=await S.json();return L.resp?L:(g.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},null)}catch(L){return g.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(L.message),null}}async function le(e){K.value={tamanioActual:0,tamanioTotal:0},re.value=[];for(var t=1;;){const o=await ie(t,500,"","",V.value,e,""),a=o.data,s=o.total;if(a.forEach(n=>{let u={};for(let d in pe.value)n.hasOwnProperty(d)?u[d]=n[d]:u[d]="";re.value.push(u)}),K.value.tamanioActual=re.value.length,K.value.tamanioTotal=s,re.value.sort((n,u)=>x(u.created_at,"DD/MM/YYYY-HH:mm:ss").diff(x(n.created_at,"DD/MM/YYYY-HH:mm:ss"))),t++,a.length<1)break}return!0}function he(e){const t={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00C1:"A",\u00C9:"E",\u00CD:"I",\u00D3:"O",\u00DA:"U",\u00F1:"n",\u00D1:"N"};return e.split("").map(a=>t[a]||a).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")+"-"+x().format("YYYY-MM-DD-HH-mm-ss")}function p(e,t,o){e&&t[0].wylexId!=="wylexId"&&t.unshift(e);var a=JSON.stringify(t),s=v(a),n=o+".csv"||"export.csv",u=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(u,n);else{var d=document.createElement("a");if(d.download!==void 0){var h=URL.createObjectURL(u);d.setAttribute("href",h),d.setAttribute("download",n),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}}function v(e){for(var t=typeof e!="object"?JSON.parse(e):e,o="",a=0;a<t.length;a++){var s="";for(var n in t[a])s!=""&&(s+=","),s+=t[a][n];o+=s+`\r
`}return o}function m(e){const t=new Set;return e.filter(o=>t.has(o.wylexId)?!1:(t.add(o.wylexId),!0))}async function f(e,t,o){try{O.value[e]=!0,G.value=!0,await le(t);let s=[];s=re.value;var a=`${fe.value}-`;fe.value=="curso_video"&&(a+=he(o)),Ge("descarga-completa-usuarios-cursos-video"),p(pe.value,m(s),a),O.value[e]=!1,G.value=!1}catch(s){return console.log(s),g.value={message:"No se pudo recuperar los datos de usuario, recargue de nuevo.",type:"error",model:!0},O.value[e]=!1,G.value=!1,!1}}return(e,t)=>{const o=je("v-list-item-content");return D(),j(me,null,[r(Pe,{modelValue:c(g).model,"onUpdate:modelValue":t[0]||(t[0]=a=>c(g).model=a),location:"top end",variant:"flat",timeout:c(g).timeout||2e3,color:c(g).type},{default:i(()=>[I($(c(g).message),1)]),_:1},8,["modelValue","timeout","color"]),r(ve,{class:"v-col-12 pb-5 pt-5"},{default:i(()=>[r(be,{class:"pb-5"},{default:i(()=>[r(X,{cols:"12",md:"5"},{default:i(()=>[_("div",at,[r(xe,{class:"ps-0 pb-0"},{default:i(()=>[I("An\xE1lisis para el m\xF3dulo:")]),_:1}),_("small",null,$(c(A).modulo.titulo),1),c(w)?(D(),ce(c(Ie),{key:0,options:c(Z).options,series:c(Z).series,height:275,width:"100%"},null,8,["options","series"])):(D(),j("div",ot," Cargando datos... "))])]),_:1}),r(X,{cols:"12",md:"7"},{default:i(()=>[r(xe,{class:"ps-0 pb-4"},{default:i(()=>[I(" Filtros "),r(te,{size:"20",icon:"tabler-filter"})]),_:1}),_("div",st,[r(Oe,{style:{width:"16rem"},class:"bg-white",menu:c(N),"onUpdate:menu":t[2]||(t[2]=a=>se(N)?N.value=a:null),"no-data-text":"No existen curso que mostrar",disabled:c(Y),"item-text":"title","item-value":"value",modelValue:c(V),"onUpdate:modelValue":t[3]||(t[3]=a=>se(V)?V.value=a:null),items:c(B),chips:"",label:"Seleccionar el curso","menu-props":{maxHeight:"400"}},{"prepend-item":i(()=>[r(ne,null,{default:i(()=>[r(o,null,{default:i(()=>[r(Ye,{modelValue:c(T),"onUpdate:modelValue":t[1]||(t[1]=a=>se(T)?T.value=a:null),clearable:"",placeholder:"Buscar curso"},null,8,["modelValue"])]),_:1})]),_:1}),r(_e,{class:"mt-2"})]),selection:i(({item:a})=>[_("div",null,$(a.title),1)]),item:i(({item:a,props:s})=>[r(ne,ze(ke(s)),{default:i(()=>[r(o,null,{default:i(()=>[r(ge,null,{default:i(()=>[_("p",null,"_id: "+$(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"]),r(Oe,{style:{width:"16rem"},class:"bg-white",menu:c(E),"onUpdate:menu":t[5]||(t[5]=a=>se(E)?E.value=a:null),"no-data-text":"No existen m\xF3dulo que mostrar",disabled:c(H),"item-text":"title","item-value":"value",modelValue:c(z),"onUpdate:modelValue":t[6]||(t[6]=a=>se(z)?z.value=a:null),items:c(U),chips:"",label:"Seleccionar el m\xF3dulo","menu-props":{maxHeight:"400"}},{"prepend-item":i(()=>[r(ne,null,{default:i(()=>[r(o,null,{default:i(()=>[r(Ye,{modelValue:c(k),"onUpdate:modelValue":t[4]||(t[4]=a=>se(k)?k.value=a:null),clearable:"",placeholder:"Buscar m\xF3dulo"},null,8,["modelValue"])]),_:1})]),_:1}),r(_e,{class:"mt-2"})]),selection:i(({item:a})=>[_("div",null,$(a.title),1)]),item:i(({item:a,props:s})=>[r(ne,ze(ke(s)),{default:i(()=>[r(o,null,{default:i(()=>[r(ge,null,{default:i(()=>[_("p",null,"_id: "+$(a.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"])]),_("small",null,"Este curso tiene un total de "+$(c(q))+" usuarios registrados.",1),r(Le,{class:"mt-2",lines:"two",border:""},{default:i(()=>[(D(!0),j(me,null,Ne(c(A).videos,(a,s)=>(D(),j(me,{key:a.value},[r(ne,null,{prepend:i(()=>[r(Be,{color:"success",variant:"tonal",class:"px-2"},{default:i(()=>[r(te,{size:"50",icon:"tabler-video"})]),_:1})]),append:i(()=>[_("div",rt,[_("div",lt,[r(Re,{"model-value":a.porcentaje,color:"success",height:"8","rounded-bar":"",rounded:""},null,8,["model-value"])]),_("span",nt,[I($(a.porcentaje)+"% ",1),_("small",it,[I("("),r(te,{size:"13",icon:"tabler-users"}),I(" "+$(a.usuarios)+")",1)])])]),_("div",ut,[r(ue,{size:"small",loading:c(O)[s],disabled:c(G),onClick:n=>f(s,a.value,a.titulo_video)},{default:i(()=>[I(" Descargar ")]),_:2},1032,["loading","disabled","onClick"]),c(O)[s]?(D(),j("small",ct," Exportando "+$(c(K).tamanioActual)+" / "+$(c(K).tamanioTotal)+" registros ",1)):Ce("",!0)])]),default:i(()=>[r(He,{style:{width:"86%"}},{default:i(()=>[I($(a.titulo_video),1)]),_:2},1024),r(ge,{class:"mt-1"},{default:i(()=>[_("small",null,$(c(A).modulo.titulo),1)]),_:1})]),_:2},1024),s!==c(A).videos.length-1?(D(),ce(_e,{key:0})):Ce("",!0)],64))),128))]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};const ft={class:"ps-5"},pt={key:1,class:"py-4"},vt={class:"d-flex flex-wrap gap-3"},mt={key:0},ht=_("b",null,"M\xF3dulo: ",-1),bt={key:1},_t={class:"d-flex pe-5 flex-column justify-content-end"},gt={class:"me-2",style:{width:"6.875rem"}},yt={key:0,class:"text-disabled"},wt={title:"Usuarios que vieron el video"},xt={key:1,class:"text-disabled"},Ct={title:"Usuarios que vieron el video"},Tt={class:"d-flex flex-column"},St={key:0,class:"px-0 py-1 text-disabled"},$t={__name:"elearning_grafico_test",setup(Ve){const w=l(!1),x=Te.exports.extendMoment(Ee),P=l(!1);x.tz.setDefault("America/Guayaquil"),x.locale("es",[Se]);const O=l([]),G=l(!1),g=l({message:"Datos guardados",type:"success",model:!1});l("tab-lista"),l(null),l({modulo:{titulo:""}}),l(!1);const F=l(!1),A=l(0),C=l(0);$e(async()=>{setTimeout(function(){P.value=!0},1e3),await R(),F.value=!0,w.value=!1,await q(),await U(),F.value=!1,w.value=!0});const q=async(p="664e32d4fa50c162c4a2e5c8")=>{try{const m=await(await fetch("https://servicio-elearning.vercel.app/grafico/get-group-test/"+p)).json();C.value=m.data,A.value=m.totalCurso}catch(v){return alert("Existe un error, intente nuevamente"),console.error(v),null}},ae=p=>{const v=`rgba(${y(p.colors["on-surface"])},${p.variables["medium-emphasis-opacity"]})`,m=`rgba(${y(p.colors["on-surface"])},${p.variables["disabled-opacity"]})`,f=`rgba(${y(String(p.variables["border-color"]))},${p.variables["border-opacity"]})`,e=`rgba(${y(p.colors["on-surface"])},${p.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:v,themeDisabledTextColor:m,themeBorderColor:f,themePrimaryTextColor:e}},J=De();ae(J.current.value);const oe=Me(()=>{const p=J.current.value.colors,v=J.current.value.variables,m=`rgba(${y(p.success)},0.2)`,f=`rgba(${y(p["on-background"])},${v["high-emphasis-opacity"]})`,e=ae(J.current.value).themeDisabledTextColor;p.success;let t=C.value;const o={name:"Device",data:[]},a=[];for(let n in t){const u=t[n];if(u.hasOwnProperty("cuestionario")){let d=parseInt(u.cuestionario.distinctUsuariosCount);o.data.push(d),a.push(u.titulo)}else{let d=0;o.data.push(d),a.push(u.titulo)}}const s={chart:{parentHeightOffset:0,type:"donut"},labels:a,colors:["#173F5F","#00fa9a","#7365ed","#ff69b4","#000f08","#32cd32","#136f63","#ffd700","#ff4500","#ff0000","#ff8c00","#ffff00","#8b4513","#0000ff","#8a2be2","#ffa500","#ffd800","#ff1493","#9932cc","#ff8c00","#8b008b","#8a2be2"],stroke:{width:0},dataLabels:{enabled:!0,formatter(n){return`${parseInt(n)}%`}},responsive:[{breakpoint:1350,options:{chart:{height:480},legend:{position:"bottom",width:"100%"}}}],legend:{position:"right",horizontalAlign:"left",offsetX:0,width:310,markers:{width:7,height:7},show:!0,formatter:function(n,u){return[n," <br> ",`<div style="font-size:17px;color:${f}">${u.w.globals.series[u.seriesIndex]} <small style="font-size:13px">usuarios en el cual <b>${C.value[u.seriesIndex].cuestionario.noAprobados}</b> usuario(s) no pas\xF3</small></div>`]},labels:{colors:e,useSeriesColors:!1}},tooltip:{theme:!1,custom:function({series:n,seriesIndex:u,dataPointIndex:d,w:h}){return`
        <div class="tooltip-content">
          <div class="tooltip-body">
            <div class="tooltip-title">
              Video
            </div>
            <div class="tooltip-subtitle">
              Usuarios que vieron el video
            </div>
            <div class="tooltip-data-flex">
              <div class="tooltip-data-value">
                ${n[u]} usuarios
              </div>
            </div>
          </div>
        </div>`}},grid:{padding:{top:15,right:-20,left:-20}},states:{hover:{filter:{type:"none"}}},plotOptions:{pie:{donut:{size:"70%",labels:{show:!1,value:{fontSize:"1.375rem",fontFamily:"Public Sans",color:f,fontWeight:600,offsetY:-15,formatter(n){return`${parseInt(n)}%`}},name:{offsetY:20,fontFamily:"Public Sans"},total:{show:!1,showAlways:!1,color:p.success,fontSize:".8125rem",label:"Total",fontFamily:"Public Sans",formatter(){return"184"}}}}}}};return{series:o.data,options:s}}),Z=l(null),N=l(!0),Y=l(null),V=l(""),B=l(""),b=l(""),T=l("");async function R(p=1,v=10){try{N.value=!0;var m=new Headers;m.append("Content-Type","application/json");var f={method:"GET",headers:m,redirect:"follow"},e=await fetch("https://servicio-elearning.vercel.app/curso/all?limit=200&page=1",f);const t=await e.json();V.value=t.data.reduce((o,a)=>(o.push({title:`${a.titulo}`,value:a._id}),o),[]),B.value=V.value,Y.value=V.value[0].value,T.value=V.value[0].title,N.value=!1}catch(t){return g.value={message:"No se pudo recuperar los cursos, recargue de nuevo.",type:"error",model:!0},console.error(t.message)}}ee(async()=>b.value,async()=>{b.value?V.value=B.value.filter(p=>p.title.toLowerCase().indexOf(b.value.toLowerCase())>-1||p.value.indexOf(b.value)>-1):V.value=B.value}),ee(Z,p=>{p||setTimeout(()=>{b.value=""},1e3)}),l(null),l(!1),l(null);const E=l(""),H=l(""),z=l("");ee(async()=>z.value,async()=>{z.value?E.value=H.value.filter(p=>p.title.toLowerCase().indexOf(z.value.toLowerCase())>-1||p.value.indexOf(z.value)>-1):E.value=H.value}),ee(Z,p=>{p||setTimeout(()=>{b.value=""},1e3)});async function U(){let p=A.value*1;C.value.forEach(m=>{if(m.hasOwnProperty("cuestionario")){const f=m.cuestionario.distinctUsuariosCount/p*100;m.porcentaje=parseFloat(f).toFixed(2)}else m.porcentaje=0}),C.value.sort((m,f)=>f.porcentaje-m.porcentaje);const v=V.value.find(m=>m.value==Y.value);return T.value=v,!0}ee(async()=>Y.value,async()=>{!P.value||Y.value&&(F.value=!0,w.value=!1,await q(Y.value),await U(),F.value=!1,w.value=!0)});const W=l({tamanioActual:0,tamanioTotal:0}),k=l("https://servicio-elearning.vercel.app/grafico/get-all-users-test"),M=l("curso_test");l("Video");const Q=l([]),K=l({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",created_at:"created_at",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at_test:"created_at_test",ciudad:"ciudad",telefono:"telefono",birthDate:"birthDate",puntosNecesarios:"puntosNecesarios",maxPuntajeTotal:"puntaje_maximo_obtenido",paso_test:"paso_test"});async function de(p=1,v=10,m,f,e,t=""){try{if(!e)return!1;var o=new Headers;o.append("Content-Type","application/json");var a={method:"GET",headers:o,redirect:"follow"},s=await fetch(`${k.value}/${e}?page=${p}&limit=${v}`,a),n=await s.json(),u=n.data;for(var d in n.data)n.data[d].hasOwnProperty("user")?(n.data[d].created_at_test=u[d].created_at,Object.entries(n.data[d].user).forEach(([h,S])=>{n.data[d][h]=S}),n.data[d].paso_test=n.data[d].puntosNecesarios<n.data[d].maxPuntajeTotal):(Object.entries(K.value).forEach(([h,S])=>{h=="wylexId"?n.data[d][h]=n.data[d].idUsuario:n.data[d][h]="-"}),n.data[d].paso_test=!1,n.data[d].created_at_test="");return n.resp?n:(g.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},null)}catch(h){return g.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},console.error(h.message),null}}async function fe(p){W.value={tamanioActual:0,tamanioTotal:0},Q.value=[];for(var v=1;;){const m=await de(v,500,"","",p,""),f=m.data,e=m.total;if(f.forEach(t=>{let o={};for(let a in K.value)t.hasOwnProperty(a)?o[a]=t[a]:o[a]="";Q.value.push(o)}),W.value.tamanioActual=Q.value.length,W.value.tamanioTotal=e,Q.value.sort((t,o)=>x(o.created_at,"DD/MM/YYYY-HH:mm:ss").diff(x(t.created_at,"DD/MM/YYYY-HH:mm:ss"))),v++,f.length<1)break}return!0}function re(p){const v={\u00E1:"a",\u00E9:"e",\u00ED:"i",\u00F3:"o",\u00FA:"u",\u00C1:"A",\u00C9:"E",\u00CD:"I",\u00D3:"O",\u00DA:"U",\u00F1:"n",\u00D1:"N"};return p.split("").map(f=>v[f]||f).join("").toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")+"-"+x().format("YYYY-MM-DD-HH-mm-ss")}function pe(p,v,m){p&&v[0].wylexId!=="wylexId"&&v.unshift(p);var f=JSON.stringify(v),e=ie(f),t=m+".csv"||"export.csv",o=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,t);else{var a=document.createElement("a");if(a.download!==void 0){var s=URL.createObjectURL(o);a.setAttribute("href",s),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}}function ie(p){for(var v=typeof p!="object"?JSON.parse(p):p,m="",f=0;f<v.length;f++){var e="";for(var t in v[f])e!=""&&(e+=","),e+=v[f][t];m+=e+`\r
`}return m}function le(p){const v=new Set;return p.filter(m=>v.has(m.wylexId)?!1:(v.add(m.wylexId),!0))}async function he(p,v,m){try{O.value[p]=!0,G.value=!0,await fe(v);let e=[];e=Q.value;var f=`${M.value}-`;M.value=="curso_test"&&(f+=re(m)),Ge("descarga-completa-usuarios-cursos-test"),pe(K.value,le(e),f),O.value[p]=!1,G.value=!1}catch(e){return console.log(e),g.value={message:"No se pudo recuperar los datos de usuario, recargue de nuevo.",type:"error",model:!0},O.value[p]=!1,G.value=!1,!1}}return(p,v)=>{const m=je("v-list-item-content");return D(),j(me,null,[r(Pe,{modelValue:c(g).model,"onUpdate:modelValue":v[0]||(v[0]=f=>c(g).model=f),location:"top end",variant:"flat",timeout:c(g).timeout||2e3,color:c(g).type},{default:i(()=>[I($(c(g).message),1)]),_:1},8,["modelValue","timeout","color"]),r(ve,{class:"v-col-12 pb-5 pt-5"},{default:i(()=>[r(be,{class:"pb-5"},{default:i(()=>[r(X,{cols:"12",md:"6"},{default:i(()=>[_("div",ft,[r(xe,{class:"ps-0 pb-0"},{default:i(()=>[I("An\xE1lisis de cursos sobre los test:")]),_:1}),_("small",null,$(c(T).title),1),c(w)?(D(),ce(c(Ie),{key:0,options:c(oe).options,series:c(oe).series,height:275,width:"100%"},null,8,["options","series"])):(D(),j("div",pt," Cargando datos... "))])]),_:1}),r(X,{cols:"12",md:"6"},{default:i(()=>[r(xe,{class:"ps-0 pb-4"},{default:i(()=>[I(" Filtros "),r(te,{size:"20",icon:"tabler-filter"})]),_:1}),_("div",vt,[r(Oe,{style:{width:"16rem"},class:"bg-white",menu:c(Z),"onUpdate:menu":v[2]||(v[2]=f=>se(Z)?Z.value=f:null),"no-data-text":"No existen curso que mostrar",disabled:c(N),"item-text":"title","item-value":"value",modelValue:c(Y),"onUpdate:modelValue":v[3]||(v[3]=f=>se(Y)?Y.value=f:null),items:c(V),chips:"",label:"Seleccionar el curso","menu-props":{maxHeight:"400"}},{"prepend-item":i(()=>[r(ne,null,{default:i(()=>[r(m,null,{default:i(()=>[r(Ye,{modelValue:c(b),"onUpdate:modelValue":v[1]||(v[1]=f=>se(b)?b.value=f:null),clearable:"",placeholder:"Buscar curso"},null,8,["modelValue"])]),_:1})]),_:1}),r(_e,{class:"mt-2"})]),selection:i(({item:f})=>[_("div",null,$(f.title),1)]),item:i(({item:f,props:e})=>[r(ne,ze(ke(e)),{default:i(()=>[r(m,null,{default:i(()=>[r(ge,null,{default:i(()=>[_("p",null,"_id: "+$(f.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"])]),_("small",null,"Este curso tiene un total de "+$(c(A))+" usuarios registrados.",1),r(Le,{class:"mt-2",lines:"two",border:""},{default:i(()=>[(D(!0),j(me,null,Ne(c(C),(f,e)=>(D(),j(me,{key:f.idcuestionario},[r(ne,null,{prepend:i(()=>[r(Be,{color:"success",variant:"tonal",class:"px-2"},{default:i(()=>[r(te,{size:"50",icon:"tabler-file-typography"})]),_:1})]),append:i(()=>[_("div",_t,[_("div",gt,[r(Re,{"model-value":f.porcentaje,color:"success",height:"8","rounded-bar":"",rounded:""},null,8,["model-value"])]),f.hasOwnProperty("cuestionario")?(D(),j("span",yt,[I($(f.porcentaje)+"% ",1),_("small",wt,[I("("),r(te,{size:"13",icon:"tabler-users"}),I(" "+$(f.cuestionario.distinctUsuariosCount||0)+")",1)])])):(D(),j("span",xt,[I("0% "),_("small",Ct,[I("("),r(te,{size:"13",icon:"tabler-users"}),I(" 0 )")])]))]),_("div",Tt,[r(ue,{size:"small",loading:c(O)[e],disabled:c(G),onClick:t=>he(e,f.idcuestionario,f.titulo)},{default:i(()=>[I(" Descargar ")]),_:2},1032,["loading","disabled","onClick"]),c(O)[e]?(D(),j("small",St," Exportando "+$(c(W).tamanioActual)+" / "+$(c(W).tamanioTotal)+" registros ",1)):Ce("",!0)])]),default:i(()=>[r(ge,{class:"mt-0"},{default:i(()=>[f.modulo?(D(),j("small",mt,[ht,I($(f.modulo.titulo),1)])):(D(),j("small",bt,"Test final del curso"))]),_:2},1024),r(He,{style:{width:"86%"}},{default:i(()=>[I($(f.titulo),1)]),_:2},1024)]),_:2},1024),e!==c(C).length-1?(D(),ce(_e,{key:0})):Ce("",!0)],64))),128))]),_:1})]),_:1})]),_:1})]),_:1})],64)}}},Dt={class:"mt-n4 me-n2"},Vt=_("div",{class:"mt-6",id:"chartTopCursosInscritos"},null,-1),Ot={class:"mt-n4 me-n2"},Yt={class:"date-picker-wrapper",style:{width:"100%"}},zt={key:0,class:"mt-6",id:"chartTopVideosVistos"},kt={key:1,class:"text-center mt-6"},Mt={class:"mt-n4 me-n2"},It={class:"date-picker-wrapper",style:{width:"100%"}},Et=_("div",{class:"mt-6",id:"chartTopCursosVistos"},null,-1),Bt={__name:"estudiantes",setup(Ve){const w=De(),x=e=>{const t=`rgba(${y(e.colors["on-surface"])},${e.variables["medium-emphasis-opacity"]})`,o=`rgba(${y(e.colors["on-surface"])},${e.variables["disabled-opacity"]})`,a=`rgba(${y(String(e.variables["border-color"]))},${e.variables["border-opacity"]})`,s=`rgba(${y(e.colors["on-surface"])},${e.variables["high-emphasis-opacity"]})`;return{themeSecondaryTextColor:t,themeDisabledTextColor:o,themeBorderColor:a,themePrimaryTextColor:s}},P=w.current.value.colors,O=w.current.value.variables;`${y(P.primary)}${O["dragged-opacity"]}`,`${y(P["on-background"])}${O["high-emphasis-opacity"]}`,`${y(String(O["border-color"]))}${O["border-opacity"]}`,`${y(P["on-surface"])}${O["disabled-opacity"]}`;const G=`rgba(${y(P.success)},0.2)`,g=`rgba(${y(P["on-background"])},${O["high-emphasis-opacity"]})`;P.success;const F=Te.exports.extendMoment(Xe);F.locale("es",[Se]);const A=l("mes"),C=l([]),q=l([]),ae=l([]),J=l({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",country:"country",city:"city",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os"});async function oe(){const t=await(await fetch("https://servicio-elearning.vercel.app/grafico/students/curso")).json();C.value=t.data}async function Z(){const t=await(await fetch("https://servicio-elearning.vercel.app/grafico/videos_completados")).json();q.value=t.data}async function N(){const t=await(await fetch("https://servicio-elearning.vercel.app/grafico/cursos_completados")).json();ae.value=t.data}function Y(e,t,o){e.hasOwnProperty(t)&&(e[o]=e[t],delete e[t])}async function V(e){try{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e,mode:"user"})},a=await(await fetch("https://data.mongodb-api.com/app/backoffice1-usyys/endpoint/users/users_details/full/ids",t)).json(),s=["_id","wylexId","site","site_id","email","first_name","last_name","avatar","country","city","phone_prefix","phone_number","gender","birth_date","identification_type","identification_number","newsletter_opt_in","provider","platform","created_in_os"];return a.data.map(u=>{Y(u,"userId","wylexId"),Y(u,"birthDate","birth_date"),Y(u,"telefono","phone_number"),Y(u,"ciudad","city");const d={};return s.forEach(h=>{d[h]=u.hasOwnProperty(h)?u[h]:""}),d})}catch(t){return console.error("Error al obtener los datos de los usuarios:",t)}}function B(e){for(var t=typeof e!="object"?JSON.parse(e):e,o="",a=0;a<t.length;a++){var s="";for(var n in t[a])s!=""&&(s+=","),s+=t[a][n];o+=s+`\r
`}return o}function b(e,t,o){e&&t[0].wylexId!=="wylexId"&&t.unshift(e);var a=JSON.stringify(t),s=B(a),n=o+".csv"||"export.csv",u=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(u,n);else{var d=document.createElement("a");if(d.download!==void 0){var h=URL.createObjectURL(u);d.setAttribute("href",h),d.setAttribute("download",n),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}}$e(async()=>{await oe(),await Z(),await N(),R(),U(),de(),p()});var T;function R(){const e=E(C.value,A.value),t={series1:"#ff9f43",series2:"#7367f0",series3:"#28c76f",series4:"#d86055"},{themeSecondaryTextColor:o,themeBorderColor:a,themeDisabledTextColor:s}=x(w.current.value),n={chart:{toolbar:{show:!1},type:"bar",height:250},legend:{markers:{offsetX:-3},labels:{colors:o}},colors:[t.series1,t.series2,t.series3,t.series4],plotOptions:{bar:{borderRadius:1,startingShape:"rounded",columnWidth:"32%",borderRadius:4,distributed:!0,dataLabels:{position:"center"}}},dataLabels:{enabled:!0,offsetY:-25,style:{fontSize:"15px",colors:[o],fontWeight:"600",fontFamily:"Public Sans"}},series:[{name:"Estudiantes",data:e.map(u=>parseInt(u.value))}],grid:{show:!0,padding:{top:0,bottom:0,left:-10,right:-10}},xaxis:{labels:{style:{colors:s}},categories:e.map(u=>u.label)},yaxis:{axisBorder:{show:!1},axisTicks:{color:a},crosshairs:{stroke:{color:a}},labels:{offsetX:-15,style:{colors:s},min:0,max:6e4,tickAmount:6,formatter:function(u){return u.toFixed(0)}}}};T=new ye(document.querySelector("#chartEstudiantes"),n),T.render()}function E(e,t){let o=[];if(t==="mes"){const a=e.reduce((s,n)=>{const u=new Date(n.created_at).getMonth();return s[u]=(s[u]||0)+1,s},{});o=Object.keys(a).map(s=>({label:H(parseInt(s)),value:a[s]}))}else if(t==="curso"){const a=e.reduce((s,n)=>(n.cursoId.forEach(u=>{s[u.idCurso.titulo]=(s[u.idCurso.titulo]||0)+1}),s),{});o=Object.keys(a).map(s=>({label:s,value:a[s]}))}else if(t==="categoria"){const a=e.reduce((s,n)=>(n.cursoId.forEach(u=>{s[u.categoria]=(s[u.categoria]||0)+1}),s),{});o=Object.keys(a).map(s=>({label:s,value:a[s]}))}return o}function H(e){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e]}var z;function U(){const e=E(C.value,"curso").slice(0,5);e.sort((n,u)=>u.value-n.value);const{themeSecondaryTextColor:t,themePrimaryTextColor:o,themeDisabledTextColor:a}=x(w.current.value),s={chart:{parentHeightOffset:0,height:380,type:"donut",events:{dataPointSelection:function(n,u,d){}}},colors:["#7365ed","#ff7f50","#EE2E31","#ff6347","#00fa9a","#ffa500","#1D7874","#ff4500","#32cd32","#ff1493","#00fa9a","#ff69b4","#9932cc","#ff8c00","#8b008b","#8a2be2"],stroke:{width:0},dataLabels:{enabled:!0,textAnchor:"middle",distributed:!1,offsetX:0,offsetY:0,style:{fontSize:"15px",fontFamily:"Helvetica, Arial, sans-serif",fontWeight:"bold",colors:void 0},background:{enabled:!0,foreColor:"#fff",padding:4,borderRadius:2,borderWidth:1,borderColor:"#fff",opacity:1,dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.45}},dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.45}},legend:{position:"bottom",horizontalAlign:"center",offsetX:0,markers:{width:7,height:7},show:!0,labels:{colors:a,useSeriesColors:!1}},tooltip:{},grid:{padding:{top:15,right:-20,left:-20}},states:{hover:{filter:{type:"none"}}},plotOptions:{pie:{donut:{size:"60%",labels:{show:!1,value:{fontSize:"1.375rem",fontFamily:"Public Sans",color:g,fontWeight:600,offsetY:-15,formatter(n){return`${parseInt(n)}%`}},name:{offsetY:20,fontFamily:"Public Sans"},total:{show:!1,showAlways:!1,color:P.success,fontSize:".8125rem",label:"Total",fontFamily:"Public Sans",formatter(){return"184"}}}}}},series:e.map(n=>parseInt(n.value)),labels:e.map(n=>n.label)};z=new ye(document.querySelector("#chartTopCursosInscritos"),s),z.render()}function W(){const e=E(C.value,"curso").slice(0,5);e.sort((s,n)=>n.value-s.value);let t="data:text/csv;charset=utf-8,";t+=`Curso,Estudiantes
`,e.forEach(s=>{t+=`${s.label.replace(/,/g,"")},${s.value}
`});const o=encodeURI(t),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download","cursos_mas_tomados.csv"),document.body.appendChild(a),a.click()}const k=l([]);var M;function Q(e){const t={};return e.forEach(o=>{o.videosCompletados.forEach(a=>{t[a._id]=(t[a._id]||0)+1})}),Object.keys(t).map(o=>({label:e.find(a=>a.videosCompletados.find(s=>s._id===o)).videosCompletados.find(a=>a._id===o).titulo,value:t[o]}))}const K=l(!1);function de(e=null,t=null){var o;if(e!=null&&t!=null?(console.log(t),o=q.value.map(h=>({...h,videosCompletados:h.videosCompletados.filter(S=>{console.log("video.created_at ",S.created_at);const L=new Date(S.created_at);return console.log("createdAt ",L),L>=e&&L<=t})})).filter(h=>h.videosCompletados.length>0)):o=q.value,o.length==0){K.value=!0,M=null;return}k.value=o;const a=Q(o).slice(0,15);a.sort((h,S)=>S.value-h.value);const s={series1:"#fdd835",series2:"#00d4bd",series3:"#826bf8",series4:"#32baff",series5:"#ffa1a1"},{themeSecondaryTextColor:n,themePrimaryTextColor:u}=x(w.current.value),d={chart:{type:"donut",height:500},colors:[s.series1,s.series2,s.series3,s.series4],legend:{width:250,markers:{offsetX:-3},labels:{colors:n}},series:a.map(h=>parseInt(h.value)),labels:a.map(h=>h.label),plotOptions:{pie:{donut:{labels:{show:!1,name:{fontSize:"1.5rem"},value:{fontSize:"1.5rem",color:n},total:{show:!0,fontSize:"1.5rem",color:u}}}}},dataLabels:{enabled:!0,offsetY:-25,style:{fontSize:"13px",colors:[n],fontWeight:"500",fontFamily:"Public Sans"}},responsive:[{breakpoint:992,options:{chart:{height:380},legend:{position:"bottom"}}},{breakpoint:576,options:{chart:{height:200},legend:{show:!1},plotOptions:{pie:{donut:{labels:{show:!0,name:{fontSize:"1rem"},value:{fontSize:"1rem"},total:{fontSize:"1rem"}}}}}}}]};M?M.updateOptions(d):(M=new ye(document.querySelector("#chartTopVideosVistos"),d),M.render())}function fe(){const e=Q(q.value).slice(0,5);e.sort((s,n)=>n.value-s.value);let t="data:text/csv;charset=utf-8,";t+=`Video,Veces_visto
`,e.forEach(s=>{t+=`${s.label.replace(/,/g,"")},${s.value}
`});const o=encodeURI(t),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download","videos_mas_vistos.csv"),document.body.appendChild(a),a.click()}async function re(){const e=k.value.map(o=>o.userId);var t=await V([...new Set(e)]);b(J.value,t,"usuarios_videos_completados")}function pe(e,t,o){if(e.length>1){var a=new Date(e[0]),s=new Date(e[1]);de(a,s)}}const ie=l([]);var le;function he(e){const t={};return e.forEach(o=>{t[o.cursoId]=(t[o.cursoId]||0)+1}),Object.keys(t).map(o=>({label:e.find(a=>a.cursoId===o).tituloCurso,value:t[o]}))}function p(e=null,t=null){var o;e!=null&&t!=null?(console.log("fechaf ",t),o=ae.value.filter(h=>{const S=new Date(F(h.created_at,"YYYY-MM-DD").startOf("day").toDate());return console.log("conversion de created_at ",S),S>=e&&S<=t})):o=ae.value,ie.value=o;const a=he(o).slice(0,5);a.sort((h,S)=>S.value-h.value);const s={series1:"#fdd835",series2:"#00d4bd",series3:"#826bf8",series4:"#32baff",series5:"#ffa1a1"},{themeSecondaryTextColor:n,themePrimaryTextColor:u}=x(w.current.value),d={chart:{type:"donut",height:500},colors:[s.series1,s.series2,s.series3,s.series4],legend:{width:250,markers:{offsetX:-3},labels:{colors:n}},series:a.map(h=>parseInt(h.value)),labels:a.map(h=>h.label),plotOptions:{pie:{donut:{labels:{show:!1,name:{fontSize:"1.5rem"},value:{fontSize:"1.5rem",color:n},total:{show:!0,fontSize:"1.5rem",color:u}}}}},dataLabels:{enabled:!0,offsetY:-25,style:{fontSize:"13px",colors:[n],fontWeight:"500",fontFamily:"Public Sans"}},responsive:[{breakpoint:992,options:{chart:{height:380},legend:{position:"bottom"}}},{breakpoint:576,options:{chart:{height:200},legend:{show:!1},plotOptions:{pie:{donut:{labels:{show:!0,name:{fontSize:"1rem"},value:{fontSize:"1rem"},total:{fontSize:"1rem"}}}}}}}]};le?le.updateOptions(d):(le=new ye(document.querySelector("#chartTopCursosVistos"),d),le.render())}function v(){const e=Q(ie.value).slice(0,5);e.sort((s,n)=>n.value-s.value);let t="data:text/csv;charset=utf-8,";t+=`Cursos,Veces_finalizado
`,e.forEach(s=>{t+=`${s.label.replace(/,/g,"")},${s.value}
`});const o=encodeURI(t),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download","cursos_finalizados.csv"),document.body.appendChild(a),a.click()}async function m(){const e=ie.value.map(o=>o.userId);var t=await V(e);b(J.value,t,"usuarios_cursos_completados")}function f(e,t,o){if(e.length>1){var a=new Date(e[0]),s=new Date(e[1]);p(a,s)}}return(e,t)=>{const o=Je;return D(),ce(be,null,{default:i(()=>[r(X,{cols:"12",md:"8"},{default:i(()=>[r(Ze)]),_:1}),r(X,{cols:"12",md:"4"},{default:i(()=>[r(ve,{title:"Cursos m\xE1s tomados",subtitle:"Cursos demandados: aprendizaje popular en acci\xF3n"},{append:i(()=>[_("div",Dt,[r(ue,{icon:"",size:"x-small",variant:"plain",color:"default"},{default:i(()=>[r(te,{size:"22",color:"success",icon:"tabler-download",onClick:W})]),_:1})])]),default:i(()=>[r(we,{class:""},{default:i(()=>[Vt]),_:1})]),_:1})]),_:1}),r(X,{cols:"12",md:"6"},{default:i(()=>[r(ve,{title:"Videos m\xE1s vistos",subtitle:"Top v\xEDdeos en popularidad"},{append:i(()=>[_("div",Ot,[r(ue,{icon:"",size:"x-small",variant:"plain",color:"default"},{default:i(()=>[r(te,{size:"22",color:"success",icon:"tabler-download",onClick:fe})]),_:1}),r(ue,{icon:"",size:"x-small",variant:"plain",color:"default"},{default:i(()=>[r(te,{size:"22",color:"success",icon:"tabler-users",onClick:re})]),_:1})])]),default:i(()=>[r(we,{class:""},{default:i(()=>[r(Ue,{class:"py-0 px-0"},{default:i(()=>[r(be,{class:"d-flex flex-wrap gap-4 mt-0"},{default:i(()=>[r(X,{class:"pt-0",cols:"12",md:"6"},{default:i(()=>[_("div",Yt,[r(o,{"prepend-inner-icon":"tabler-calendar",density:"compact","show-current":"true",onOnChange:pe,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",reactive:!0}})])]),_:1})]),_:1})]),_:1}),K.value?(D(),j("div",kt,"No hay datos para mostrar")):(D(),j("div",zt))]),_:1})]),_:1})]),_:1}),r(X,{cols:"12",md:"6"},{default:i(()=>[r(ve,{title:"Cursos completados",subtitle:"\xC9xito educativo: Cursos completados."},{append:i(()=>[_("div",Mt,[r(ue,{icon:"",size:"x-small",variant:"plain",color:"default"},{default:i(()=>[r(te,{size:"22",color:"success",icon:"tabler-download",onClick:v})]),_:1}),r(ue,{icon:"",size:"x-small",variant:"plain",color:"default"},{default:i(()=>[r(te,{size:"22",color:"success",icon:"tabler-users",onClick:m})]),_:1})])]),default:i(()=>[r(we,{class:""},{default:i(()=>[r(Ue,{class:"py-0 px-0"},{default:i(()=>[r(be,{class:"d-flex flex-wrap gap-4 mt-0"},{default:i(()=>[r(X,{class:"pt-0",cols:"12",md:"6"},{default:i(()=>[_("div",It,[r(o,{"prepend-inner-icon":"tabler-calendar",density:"compact","show-current":"true",onOnChange:f,config:{position:"auto right",mode:"range",altFormat:"F j, Y",dateFormat:"d-m-Y",reactive:!0}})])]),_:1})]),_:1})]),_:1}),Et]),_:1})]),_:1})]),_:1}),r(X,{cols:"12",md:"12"},{default:i(()=>[r(dt)]),_:1}),r(X,{cols:"12",md:"12"},{default:i(()=>[r($t)]),_:1}),r(X,{cols:"12",md:"12"},{default:i(()=>[r(tt)]),_:1})]),_:1})}}};export{Bt as default};
