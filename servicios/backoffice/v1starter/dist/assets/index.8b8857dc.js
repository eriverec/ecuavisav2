import{R as ue,U as de,r as t,Q as f,v as ce,as as ve,z as X,o as c,x as p,a as n,w as u,q as y,t as o,f as me,e as pe,h as K,b as a,aT as q,$ as fe,aU as _e,aV as he,a1 as ge,c as Z,a3 as D,p as ee,g as ye,aW as xe,F as be,C as we,X as Ve,d as Ce,u as z,N as De,ao as ae,ap as te,a2 as Me,V as ke}from"./index.88d3c7f5.js";import{a as Ie}from"./formatters.a9a9bf7f.js";import{M as Se}from"./index.50982b4e.js";import{V as Ee}from"./VSpacer.2a3e77c9.js";import{V as Le}from"./VPagination.9412c3b8.js";import{p as Y}from"./parseISO.d0bde0b5.js";const Te=a("h1",null,"Exportaci\xF3n de usuarios que han cumplido Desaf\xEDos por Semana",-1),Ye={class:"me-3 d-flex gap-4"},Fe={class:"app-user-search-filter d-flex align-top justify-content-flex-end flex-wrap flex-column gap-0"},$e={key:0,style:{curso:"pointer"},class:"px-0 py-p m-0"},Ne={key:1,style:{curso:"pointer"},class:"px-0 py-p m-0"},Ue={key:2,style:{curso:"pointer"},class:"px-0 py-p m-0"},Pe={key:0,class:"px-0 py-1 text-disabled"},je={key:0,class:"text-disabled"},Re={key:1,class:"text-disabled"},Ae=a("thead",null,[a("tr",null,[a("th",{scope:"col"}," Nombres "),a("th",{scope:"col"}," Fecha de nacimiento "),a("th",{scope:"col"}," Tel\xE9fono "),a("th",{scope:"col"}," Fecha de registro "),a("th",{scope:"col"}," Ciudad "),a("th",{scope:"col"}," Acciones ")])],-1),qe={key:0},ze={class:"d-flex align-center"},Oe={key:1},He={class:"d-flex flex-column"},Be={class:"text-base"},Ge={class:"text-sm text-disabled"},Je={class:"text-base"},Qe={class:"text-base"},We={class:"text-base"},Xe={class:"text-base"},Ke={class:"text-center",style:{width:"5rem"}},Ze=a("tr",null,[a("td",{colspan:"7",class:"text-center"}," No hay datos que mostrar ")],-1),ea=[Ze],aa=a("tr",null,[a("td",{colspan:"7",class:"text-center"}," Cargando datos, por favor espere un momento... ")],-1),ta=[aa],sa={class:"text-sm text-disabled"},ca={__name:"index",setup(la){const M=ue.exports.extendMoment(Se);M.locale("es",[de]),M.tz.setDefault("America/Guayaquil");const F=t("Escoge una semana");t(null);const h=t(0);t(0);const x=t([]),i=t(1),E=t(0),v=t(10),b=t(""),O=t(""),H=t(null),$=t(!1),B=t(null),G=t({loading:!1,disabled:!1}),N=t([]),L=t([]),d=t(null),U=t(!0),T=t(""),k=t(null),se=t(null),I=t(null);t(!1);const P=t([]),J=t([]),g=t(!1),w=M().format("YYYY-MM-DD"),j=M().subtract(30,"days").format("YYYY-MM-DD"),_=t({inicio:j,fin:w}),V=t({message:"Datos guardados",type:"success",model:!1});t(""),t("curso_fecha"),t({_id:"_id",wylexId:"wylexId",site:"site",site_id:"site_id",email:"email",first_name:"first_name",last_name:"last_name",avatar:"avatar",created_at:"created_at",logged_at:"logged_at",logged_at_site:"logged_at_site",updated_at:"updated_at",validated_at:"validated_at",banned_at:"banned_at",country:"country",phone_prefix:"phone_prefix",phone_number:"phone_number",gender:"gender",birth_date:"birth_date",identification_type:"identification_type",identification_number:"identification_number",newsletter_opt_in:"newsletter_opt_in",provider:"provider",platform:"platform",created_in_os:"created_in_os",created_at_suscriber_course:"created_at_suscriber_course",ciudad:"ciudad",telefono:"telefono",birthDate:"birthDate"});const le={fechasModel:[Y(j),Y(w)],fechasVModel:[Y(w)],fechasVConfig:{position:"auto right",mode:"single",minDate:Y(w),altFormat:"d F j, Y",dateFormat:"l, j \\d\\e F \\d\\e Y",valueFormat:"d-m-Y",reactive:!0},fechai:j,fechaV:w,fechaf:w},Q=t(le);async function oe(){const l="https://servicio-desafios.vercel.app/semana/all/get";try{const s=await fetch(l);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();if(r&&r.resp&&Array.isArray(r.data))return r.data.map(m=>({title:m.titulo,value:m._id,desafios:m.desafios}));throw new Error("La estructura de datos no es la esperada")}catch(s){return console.error("Error al obtener las semanas:",s),[]}}async function ne(l){const s="https://servicio-desafios.vercel.app/desafios/search/ids";try{const r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:l})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const m=await r.json();if(m&&m.resp&&Array.isArray(m.data))return m.data.map(e=>({title:e.tituloDesafio,value:e._id}));throw new Error("La estructura de datos no es la esperada")}catch(r){return console.error("Error al obtener los desaf\xEDos:",r),[]}}f(i,async()=>{i.value>E.value&&(i.value=E.value),await C(i.value,v.value,_.value.inicio,_.value.fin,d.value)}),f(v,async()=>{i.value=1,await C(i.value,v.value,_.value.inicio,_.value.fin,d.value)});const ie=ce(()=>{const l=x.value.length?i.value*v.value:0;return x.value.length+i.value*v.value,h.value<v.value?`Mostrandos ${h.value} de ${h.value} registros `:`Mostrando ${l} de ${h.value} registros `});ve(async()=>{U.value=!0,N.value=await oe(),U.value=!1}),f(d,async l=>{if(l){i.value=1;const s=N.value.find(r=>r.value===l);s&&s.desafios&&(L.value=await ne(s.desafios)),await C(i.value,v.value,l)}else L.value=[],x.value=[]});async function C(l=1,s=10,r,m=null){try{if(!r)return!1;g.value=!0;var e=new Headers;e.append("Content-Type","application/json");var R={method:"GET",headers:e,redirect:"follow"};let A=`https://servicio-niveles-puntuacion.vercel.app/grafico-backoffice/usuarios-x-desafio-listado/${r}/${m||"null"}?page=${l}&limit=${s}`;var re=await fetch(A,R);const S=await re.json();S.resp&&(x.value=S.data.map(W=>({...W.userId,subscribed:W.subscribed})),h.value=S.total,E.value=Math.ceil(S.total/S.limit)),g.value=!1}catch(A){V.value={message:"No se pudo recuperar los usuarios, recargue de nuevo.",type:"error",model:!0},g.value=!1,console.error(A.message)}}return f(async()=>T.value,async()=>{T.value?b.value=O.value.filter(l=>l.title.toLowerCase().indexOf(T.value.toLowerCase())>-1||l.value.indexOf(T.value)>-1):b.value=O.value}),f(d,async()=>{d.value&&(i.value=1,await C(i.value,v.value,_.value.inicio,_.value.fin,d.value))}),t(!0),t([]),f(B,async()=>{B.value||(i.value=1,G.value={loading:!0,disabled:!0},await C(i.value,v.value,_.value.inicio,_.value.fin,d.value),G.value={loading:!1,disabled:!1})}),f(async()=>k.value,async()=>{k.value?P.value=J.value.filter(l=>l.title.toLowerCase().indexOf(k.value.toLowerCase())>-1||l.value.indexOf(k.value)>-1):P.value=J.value}),f(se,l=>{l||setTimeout(()=>{k.value=""},1e3)}),f(I,async l=>{l&&d.value&&(i.value=1,await C(i.value,v.value,d.value,l))}),(l,s)=>{const r=X("v-list-item-content"),m=X("RouterLink");return c(),p("section",null,[n(me,{modelValue:V.value.model,"onUpdate:modelValue":s[0]||(s[0]=e=>V.value.model=e),location:"top end",variant:"flat",timeout:V.value.timeout||2e3,color:V.value.type},{default:u(()=>[y(o(V.value.message),1)]),_:1},8,["modelValue","timeout","color"]),n(ke,null,{default:u(()=>[n(pe,{cols:"12",sm:"12",lg:"12"},{default:u(()=>[Te,n(K,{class:"d-flex py-4 gap-4 px-0 flex-wrap",style:{"align-items":"flex-start"}},{default:u(()=>[a("div",Ye,[n(q,{class:"bg-white",modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),density:"compact",variant:"outlined",items:[10,20,30,50]},null,8,["modelValue"]),n(q,{style:{width:"16rem"},class:"bg-white",menu:H.value,"onUpdate:menu":s[2]||(s[2]=e=>H.value=e),"no-data-text":"No existen semanas que mostrar",disabled:U.value,"item-text":"title","item-value":"value",modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=e=>d.value=e),items:N.value,chips:"",label:"Seleccionar la semana de desaf\xEDos","menu-props":{maxHeight:"400"}},{selection:u(({item:e})=>[a("div",null,o(e.title),1)]),item:u(({item:e,props:R})=>[n(fe,_e(he(R)),{default:u(()=>[n(r,null,{default:u(()=>[n(ge,null,{default:u(()=>[a("p",null,"_id: "+o(e.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["menu","disabled","modelValue","items"]),L.value.length>0?(c(),Z(q,{key:0,style:{width:"16rem"},class:"bg-white",modelValue:I.value,"onUpdate:modelValue":s[4]||(s[4]=e=>I.value=e),items:L.value,"item-text":"title","item-value":"value",chips:"",label:"Seleccionar desaf\xEDo","menu-props":{maxHeight:"400"}},null,8,["modelValue","items"])):D("",!0)]),n(Ee),a("div",Fe,[n(ee,{loading:$.value,disabled:$.value||g.value,variant:"tonal",color:"success","prepend-icon":"tabler-screen-share",class:"d-none"},{default:u(()=>[F.value=="Fecha"?(c(),p("span",$e,"Exportar b\xFAsqueda")):D("",!0),F.value=="Curso"?(c(),p("span",Ne,"Exportar curso")):D("",!0),F.value=="Video"?(c(),p("span",Ue,"Exportar b\xFAsqueda")):D("",!0)]),_:1},8,["loading","disabled"]),$.value?(c(),p("small",Pe," Exportando "+o(l.docsExportNumberLength.tamanioActual)+" / "+o(l.docsExportNumberLength.tamanioTotal)+" registros ",1)):D("",!0)])]),_:1}),I.value?(c(),p("small",Re,[y("Se ha filtrado usuarios del curso "),a("b",null,o(d.value&&b.value.length>0?b.value.filter(e=>d.value.includes(e.value))[0].title:""),1),y(" , sobre el video de "),a("b",null,o(P.value.filter(e=>I.value==e.value)[0].title),1),y(" con un total de "+o(h.value)+" registros ",1)])):(c(),p("small",je,[y("Se ha filtrado usuarios de de "),a("b",null,o(d.value&&b.value.length>0?b.value.filter(e=>d.value.includes(e.value))[0].title:""),1),y(" , desde "+o(Q.value.fechai)+" hasta "+o(Q.value.fechaf)+" con un total de "+o(h.value)+" registros ",1)])),n(ye,{class:"mt-1"},{default:u(()=>[n(xe,{class:"text-no-wrap"},{default:u(()=>[Ae,g.value==!1?(c(),p("tbody",qe,[(c(!0),p(be,null,we(x.value,e=>(c(),p("tr",{key:e._id,style:{height:"3.75rem"}},[a("td",null,[a("div",ze,[n(Ve,{variant:"tonal",color:"success",class:"me-3",size:"38"},{default:u(()=>[e.avatar?(c(),Z(Ce,{key:0,src:e.avatar},null,8,["src"])):(c(),p("span",Oe,o(z(Ie)(`${e.first_name} ${e.last_name}`)),1))]),_:2},1024),a("div",He,[a("h6",Be,[n(m,{to:{name:"apps-user-view-id",params:{id:e.wylexId}},class:"font-weight-medium user-list-name"},{default:u(()=>[y(o(e.first_name)+" "+o(e.last_name),1)]),_:2},1032,["to"])]),a("span",Ge,"@"+o(e.email),1)])])]),a("td",null,[a("span",Je,o(e.birthDate),1)]),a("td",null,[a("span",Qe,o(e.telefono),1)]),a("td",null,[a("span",We,o(z(M)(e.created_at_suscriber_course).format("YYYY-MM-DD HH:mm:ss")),1)]),a("td",null,[a("span",Xe,o(e.ciudad),1)]),a("td",Ke,[n(ee,{icon:"",size:"x-small",color:"default",variant:"text",to:{name:"apps-user-view-id",params:{id:e.wylexId}}},{default:u(()=>[n(De,{size:"22",icon:"tabler-eye"})]),_:2},1032,["to"])])]))),128))])):D("",!0),ae(a("tfoot",null,ea,512),[[te,!x.value.length&&g.value==!1]]),ae(a("tfoot",null,ta,512),[[te,g.value]])]),_:1}),n(Me),n(K,{class:"d-flex align-center flex-wrap justify-space-between gap-4 py-3 px-5"},{default:u(()=>[a("span",sa,o(z(ie)),1),n(Le,{modelValue:i.value,"onUpdate:modelValue":s[5]||(s[5]=e=>i.value=e),size:"small","total-visible":5,length:E.value},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{ca as default};
