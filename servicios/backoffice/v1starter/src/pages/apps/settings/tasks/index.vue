<script setup>
import axios from '@axios';

const tabActual = ref('tab-lista')
</script>

<template>
	<section>
		<VRow>
			<VCol class="mt-6" cols="12" md="12" lg="12">

				<VTabs v-model="tabActual" class="v-tabs-pill">
					<VTab value="tab-Principal" ><VIcon icon="mdi-settings" class="pe-1" size="25" />En vivo</VTab>
					<VTab value="tab-bo" ><VIcon icon="mdi-settings" class="pe-1" size="25" />Backoffice</VTab>
					<VTab value="tab-tools" ><VIcon icon="mdi-tools" class="pe-1" size="25" />Newsletter</VTab>
					<VTab value="tab-tools" ><VIcon icon="mdi-tools" class="pe-1" size="25" />Utilidades</VTab>

				</VTabs>

				<VCard class="mt-5">
					<VCardText>
						<VWindow v-model="tabActual">
							<!-- $$$$$$$$$$$$$ tab1 $$$$$$$$$$$$$$ -->
							<VWindowItem value="tab-Principal">
								<div class=" py-5 gap-4 align-items-center">   
									<VCardTitle >Configura el horario de las transmisiones en vivo de ecuavisa.com </VCardTitle>
									<VCardSubtitle> Escoge el ítem que deseas configurar </VCardSubtitle>
								</div>
								<!-- content here -->
								<VRow>
									<VCol cols="12" lg="10" class="mx-auto my-8 align-items-center" >
										<VRow>
											<VCol cols="12" md="4" >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-configuracion-radio' })" >
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-cast-audio-variant"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															En Vivo Audio/Radio
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Configurar
														</VBtn>
													</VCardText>
												</VCard>
											</VCol>
											<VCol cols="12" md="4" >
												<VCard  flat  border class=" cursor-pointer"   @click="$router.push({ name: 'apps-configuracion-envivo' })" >
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-access-point"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															En Vivo
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Configurar
														</VBtn>
													</VCardText>
												</VCard>
											</VCol>
											<VCol cols="12" md="4" >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-configuracion-envivo-quito' })" >
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-access-point"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															En Vivo - Quito
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Configurar
														</VBtn>
													</VCardText>
												</VCard>
											</VCol>
										</VRow>
									</VCol>
								</VRow>
							</VWindowItem>

							<!-- $$$$$$$$$$$$$ tab2 $$$$$$$$$$$$$$ -->
							<VWindowItem value="tab-bo">
								<div class=" py-5 gap-4 align-items-center">   
									<VCardTitle >Configura el horario de las transmisiones en vivo de ecuavisa.com </VCardTitle>
									<VCardSubtitle> Escoge el ítem que deseas configurar </VCardSubtitle>
								</div>
								<!-- content here -->
								<VRow>
									<VCol cols="12" lg="10" class="mx-auto my-8 align-items-center" >
										<VRow>
											<VCol cols="12" md="6" >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-backoffice' })" >
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-account-group-outline"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															Usuarios Backoffice
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Gestionar
														</VBtn>
													</VCardText>
												</VCard>
											</VCol>
											<VCol cols="12" md="6" >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-backoffice-actividad' })">
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-account-clock-outline"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															Actividad de Usuarios
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Ver Reportes
														</VBtn>
													</VCardText>
												</VCard>
											</VCol>
											
										</VRow>
									</VCol>
								</VRow>
							</VWindowItem>
							<!-- $$$$$$$$$$$$$ tab3 $$$$$$$$$$$$$$ -->
							<VWindowItem value="tab-tools">
								<div class=" py-5 gap-4 align-items-center">   
									<VCardTitle >Configura el horario de las transmisiones en vivo de ecuavisa.com </VCardTitle>
									<VCardSubtitle> Escoge el ítem que deseas configurar </VCardSubtitle>
								</div>
								<!-- content here -->
								<VRow>
									<VCol cols="12" lg="10" class="mx-auto my-8 align-items-center" >
										<VRow>
											<VCol cols="12" md="12" center >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-apicustom' })" >
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="tabler-api"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															Apis de Configuración
														</h6>
														<!-- <p>mas info</p> -->
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Gestionar
														</VBtn>
													</VCardText>
												</VCard>

												<!-- kan ban actividades -->
											 	<div id="kanban" class="container">
												    <div v-for="column in columns" :key="column.id" class="column">
												      <h2>{{ column.title }}</h2>
												      <VCard v-for="card in column.cards" :key="card.id" class="card">
												        <template v-if="card.editing">
												        	<VTextField
				                                                v-model="card.title"
				                                                label="Título de actividad"
				                                                placeholder="Escriba el titulo..."
				                                                class="ms-0 me-1 chat-list-search"
				                                            />
												          <!-- <input type="text" v-model="card.title" class="form-control"> -->
												          <VTextField v-model="card.description" label="Descripción" placeholder="Escriba el contenido..." class="ms-0 me-1 chat-list-search"/>
												          	
												          	<VSelect v-model="card.labels" :items="labels" label="Standard" />
												          	<!-- <VSelect v-model="card.columnId" @change="moveCard(card.id, card.columnId)" :items="card.columnId" label="Standard" /> -->
												          	
												          	<select v-model="card.labels" class="form-control">
											            		<option v-for="label in labels" :key="label" :value="label">{{ label }}</option>
												          	</select>
												          	<select v-model="card.columnId" @change="moveCard(card.id, card.columnId)" class="form-control">
												            	<option v-for="column in columns" :key="column.id" :value="column.id">{{ column.title }}</option>
												          	</select>

												          <!-- <input type="text" v-model="card.labels" class="form-control"> -->
												          <button @click="card.editing = false" class="btn btn-primary">Guardar</button>
												        </template>
												        <template v-else>
												          	<h3>{{ card.title }}</h3>
												          	<p>{{ card.description }}</p>
												           	<VChip v-for="label in card.labels" :key="label" color="warning" class="mr-4" >{{ label }} </VChip>
												          	<button @click="card.editing = true" class="btn btn-secondary">Editar</button>
												        </template>
												      </VCard>
												      <button @click="addCard(column.id)" class="btn btn-primary">Agregar tarjeta</button>
												    </div>
												    <button @click="saveData" class="btn btn-primary">Guardar datos</button>
											  	</div>

											</VCol>
											<!-- <VCol cols="12" md="4" >
												<VCard  flat  border class=" cursor-pointer"  @click="$router.push({ name: 'apps-backoffice-actividad' })">
													<VCardText class="text-center">
														<VAvatar rounded size="70" color="primary" variant="tonal" class="p-5 mb-2" >
															<VIcon icon="mdi-account-clock-outline"  size="45" />
														</VAvatar>
														<h6 class="text-h6 my-3">
															Actividad de Usuarios
														</h6>
														<VBtn size="small" variant="tonal" :to="{  name: 'apps-settings-menu' }" >
															Ver Reportes
														</VBtn>
													</VCardText>
												</VCard>
											</VCol> -->
											
										</VRow>
									</VCol>
								</VRow>
							</VWindowItem>

						</VWindow>
					</VCardText>
				</VCard>

			</VCol>
		</VRow>
	</section>
</template>
<style scoped>  
/*.v-card.v-theme--dark .iframe-dark {  display: block; }*/
</style>

<script>
import { createStore } from 'vuex'

const store = createStore({
  state: {
    columns: [
      { id: '1', title: 'Por hacer', cards: [{ id: '1', title: 'Tarjeta 1', description: 'Descripción', labels: ['Importante'], editing: false }] },
      { id: '2', title: 'En progreso', cards: [{ id: '2', title: 'Tarjeta 2', description: 'Descripción', labels: ['Urgente'], editing: false }] },
      { id: '3', title: 'Hecho', cards: [{ id: '3', title: 'Tarjeta 3', description: 'Descripción', labels: ['Opcional'], editing: false }] }
    ],
    labels: ['Importante', 'Urgente', 'Opcional']
  },
  mutations: {
    setColumns(state, columns) {
      state.columns = columns;
    },
    addCard(state, { columnId, card }) {
      const column = state.columns.find(column => column.id === columnId);
      column.cards.push(card);
    },
    moveCard(state, { fromColumnId, toColumnId, cardId }) {
      const fromColumn = state.columns.find(column => column.id === fromColumnId);
      const toColumn = state.columns.find(column => column.id === toColumnId);
      const cardIndex = fromColumn.cards.findIndex(card => card.id === cardId);
      const [card] = fromColumn.cards.splice(cardIndex, 1);
      toColumn.cards.push(card);
    },
    editCard(state, { columnId, cardId, cardData }) {
      const column = state.columns.find(column => column.id === columnId);
      const card = column.cards.find(card => card.id === cardId);
      Object.assign(card, cardData);
    },
    deleteCard(state, { columnId, cardId }) {
      const column = state.columns.find(column => column.id === columnId);
      const cardIndex = column.cards.findIndex(card => card.id === cardId);
      column.cards.splice(cardIndex, 1);
    },
    addLabel(state, { columnId, cardId, label }) {
      const column = state.columns.find(column => column.id === columnId);
      const card = column.cards.find(card => card.id === cardId);
      card.labels.push(label);
    },
    removeLabel(state, { columnId, cardId, label }) {
      const column = state.columns.find(column => column.id === columnId);
      const card = column.cards.find(card => card.id === cardId);
      const labelIndex = card.labels.indexOf(label);
      if (labelIndex !== -1) {
        card.labels.splice(labelIndex, 1);
      }
    }
  }
});



export default {
	data() {
		return {
			datos: []
		};
	},
	watch: {
		// async usuarioFielModel(newVal, oldVal) {
		//   this.maxRegistros = newVal;
			// this.obtenerDatos();
		// }
		
	},
	name: 'Kanban',
  	computed: {
    	columns() {
      		return store.state.columns;
    	}
  	},
	async mounted() {
		this.obtenerDatos();
		await this.accionBackoffice();
	},

	methods: {
		
		moveCard(cardId, columnId) {
		    store.commit('moveCard', { fromColumnId: cardId, toColumnId: columnId, cardId });
	  	},

		async obtenerDatos() {
			const respuesta = await fetch(`https://estadisticas.ecuavisa.com/sites/services/global/datareader.php`);
			const datos = await respuesta.json();
			// const registros = datos; //datos.data;
			// const sumatoriaPorUsuario = {};
			this.datos = datos; // eljson de datos lo hacemos el nuevo valor del app this.datos
		},

		//journal de usuarios del backoffice
		async accionBackoffice (){
			let dateNow = moment().format("DD/MM/YYYY HH:mm:ss").toString();
			let userData = JSON.parse(localStorage.getItem('userData'));
			if(userData.email !== 'admin@demo.com' ){
				var myHeaders = new Headers();
				myHeaders.append("Content-Type", "application/json");
					var log = JSON.stringify({
							"usuario": userData.email,   
							"pagina": "ecuavisa.com-modulos",
							"fecha": dateNow
						});
					var requestOptions = {
						method: 'POST',
						headers: myHeaders,
						body: log,
						redirect: 'follow'
					};
					await fetch(`https://servicio-logs.vercel.app/accion`, requestOptions)
					.then(response =>{			
					}).catch(error => console.log('error', error));
			}
		},

		authorizedCheck (){
			let rol = localStorage.getItem('role');
			if(rol !== 'administrador' && rol !== 'webmaster'){
				this.$router.push({ path: '/pages/errors/not-authorized' })
			}
		},


		addCard(columnId) {
	      const card = { /* datos de la tarjeta */ };
	      store.commit('addCard', { columnId, card });
	    },
	    saveData() {
	      fetch('https://api.example.com/endpoint', {
	        method: 'POST',
	        headers: {
	          'Content-Type': 'application/json'
	        },
	        body: JSON.stringify(store.state.columns)
	      })
	      .then(response => response.json())
	      .then(data => console.log(data))
	      .catch((error) => {
	        console.error('Error:', error);
	      });
	    }
	},
};
</script>

<style>
#kanban {
  display: flex;
  justify-content: space-between;
}

.column {
  width: 200px;
  border: 1px solid #ccc;
  padding: 10px;
}

.card {
  border: 1px solid #ccc;
  margin-bottom: 10px;
  padding: 5px;
}

.label {
  display: inline-block;
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 2px 5px;
  margin-right: 5px;
}
</style>